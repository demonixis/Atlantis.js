var Atlantis=window.Atlantis||{};Atlantis.MusicState={};
Atlantis.AudioManager=function(){Atlantis.MusicState.PLAYING=1;Atlantis.MusicState.STOPPED=2;Atlantis.MusicState.PAUSED=3;var a=function(){this.repeatMusic=!1;this.currentMusic=null;this.volume=1;this.currentState=Atlantis.MusicState.STOPPED};a.prototype.playMusic=function(b,e){this.stopMusic();this.currentMusic=b;this.repeat=e;this.currentMusic.play();this.currentState=Atlantis.MusicState.PLAYING};a.prototype.stopMusic=function(){this.currentState=Atlantis.MusicState.STOPPED};a.prototype.pauseMusic=
function(){null!=this.currentMusic&&this.currentState==Atlantis.MusicState.PLAYING&&(this.currentMusic.pause(),this.currentState=Atlantis.MusicState.PAUSED)};return a}();Atlantis=window.Atlantis||{};Atlantis.Engine=Atlantis.Engine||{};Atlantis.Engine=function(){return{game:null,content:null,stateManager:null,keyboard:null,pointer:null,width:0,height:0}}();
Atlantis.GameApplication=function(){var a=function(b,e,a){Atlantis.Game.call(this,b,e,a);this.stateManager=new Atlantis.StateManager(this);this.components.add(this.stateManager);Atlantis.Engine={game:this,contentManager:this.content,components:this.components,keyboardManager:this.keyboardManager,pointerManager:this.pointerManager,width:this.width,height:this.height,stateManager:this.stateManager}};a.prototype=new Atlantis.Game;return a}();Atlantis=window.Atlantis||{};
Atlantis.State=function(){var a=function(b){this.name=b;this.active=!0;this.stateManager=null;this.assetLoaded=this.initialized=!1;this.visible=this.enabled=!0;this.scene=new Atlantis.SpriteGroup};a.prototype.isActive=function(){return this.visible&&this.enabled};a.prototype.setActive=function(b){this.visible=this.enabled=b};a.prototype.initialize=function(){this.scene.initialize();this.initialized=!0};a.prototype.loadContent=function(b){this.scene.loadContent(b);this.assetLoaded=!0};a.prototype.update=
function(b){this.scene.update(b)};a.prototype.draw=function(b,e){this.scene.draw(b,e)};a.prototype.add=function(b){this.scene.add(b)};a.prototype.remove=function(b){this.scene.remove(b)};a.prototype.get=function(b){return this.scene.get(b)};return a}();
Atlantis.StateManager=function(){var a=function(b){Atlantis.DrawableGameComponent.call(this,b);this.states=[];this.assetLoaded=this.initialized=!1};a.prototype=new Atlantis.DrawableGameComponent;a.prototype.initialize=function(){for(var b=0,e=this.states.length;b<e;b++)this.states[b].initialize();this.initialized=!0};a.prototype.loadContent=function(){for(var b=0,e=this.states.length;b<e;b++)this.states[b].loadContent(this.game.contentManager);this.assetLoaded=!0};a.prototype.update=function(b){for(var e=
0,a=this.states.length;e<a;e++)this.states[e].enabled&&this.states[e].update(b)};a.prototype.draw=function(b,e){for(var a=0,d=this.states.length;a<d;a++)this.states[a].visible&&this.states[a].draw(b,e)};a.prototype.setActive=function(b,e){e&&this.disableStates();if(b instanceof Atlantis.State){var a=this.states.indexOf(b);-1<a&&this.states[a].setActive(!0)}else if("string"==typeof b)for(var d=0,a=-1,f=this.states.length;d<f&&-1==a;)this.states[d].name==b&&(this.states[d].setActive(!0),a=d),d++;else-1<
b&&b<this.states.length&&(this.states[b].active=!0)};a.prototype.disableStates=function(){for(var b=0,e=this.states.length;b<e;b++)this.states[b].active=!1};a.prototype.add=function(b,e,a){a&&this.disableStates();e="undefined"!=typeof e?e:!0;if(b instanceof Array){var d=0;for(a=b.length;d<a;d++)b[d].stateManager=this,b[d].setActive(e),this.initialized&&(b[d].loadContent(this.game.content),b[d].initialize()),this.states.push(b[d])}else b.stateManager=this,b.setActive(e),this.initialized&&(b[d].loadContent(this.game.content),
b[d].initialize()),this.states.push(b)};a.prototype.remove=function(b){var a=null;if(b instanceof Atlantis.state){var c=this.states.indexOf(b);-1<c&&(a=this.states[c],this.states.splice(c,1))}else if("string"==typeof b){for(var d=0,c=-1;d<size&&-1==c;)this.states[d].name==b&&(c=d),d++;-1<c&&(a=this.states[c],this.states.splice(c,1))}else-1<b&&(a=this.states[b],this.states.splice(c,1));return a};a.prototype.get=function(b){var a=null;if("string"==typeof b){for(var c=0,d=-1;c<size&&-1==d;)this.states[c].name==
b&&(d=c),c++;-1<d&&(a=this.states[d])}else-1<a&&(a=this.states[b]);return a};return a}();Atlantis=window.Atlantis||{};
(function(){Atlantis.SpriteAnimation=function(a,b){this.rectangles=Array(a);this.framerate=b;this.index=0;this.max=a;this.elapsedTime=0;this.length=a};Atlantis.SpriteAnimation.prototype.next=function(){return this.rectangles[this.index]};Atlantis.SpriteAnimation.prototype.update=function(a){this.elapsedTime+=a.getElapsedTime();this.elapsedTime>this.framerate&&(this.index++,0==this.index&&Atlantis.notify("atlantis.sprite.animationCompleted"),this.elapsedTime=0)};Atlantis.SpriteAnimator=function(){this.animations=
{};this.spritesheetLength=this.nbSpriteY=this.nbSpriteX=this.textureHeight=this.textureWidth=this.spriteHeight=this.spriteWidth=0;this.currentAnimationName=""};Atlantis.SpriteAnimator.prototype.initialize=function(a,b,e,c){this.animations={};this.spriteWidth=a;this.spriteHeight=b;this.textureWidth=e;this.textureHeight=c;this.nbSpriteX=this.textureWidth/this.spriteWidth;this.nbSpriteY=this.textureHeight/this.spriteHeight;this.spritesheetLength=this.nbSpriteX*this.nbSpriteY;this.currentAnimationName=
""};Atlantis.SpriteAnimator.prototype.add=function(a,b,e){var c=b.length;e=new Atlantis.SpriteAnimation(c,e);if(b instanceof Atlantis.Rectangle)e.rectangles=b;else for(var d=0;d<c;d++){var f=b[d]%this.nbSpriteX,g=Math.floor(b[d]/this.nbSpriteX),f=0<g?f%(this.nbSpriteX*g):f%this.nbSpriteX;e.rectangles[d]=new Atlantis.Rectangle(f*this.spriteWidth,g*this.spriteHeight,this.spriteWidth,this.spriteHeight)}this.animations[a]=e};Atlantis.SpriteAnimator.prototype.play=function(a){this.currentAnimationName=
a;return this.animations[a].next()};Atlantis.SpriteAnimator.prototype.getCurrentAnimation=function(){return""!==this.currentAnimationName?this.animations[this.currentAnimationName]:null};Atlantis.SpriteAnimator.prototype.update=function(a,b){""!==this.currentAnimationName&&this.animations[this.currentAnimationName].update(a)};Atlantis.SpriteAnimator.prototype.checkForIDLEAnimation=function(a){return""!==this.currentAnimationName&&0==a.x&&0==a.y?this.animations[this.currentAnimationName].rectangles[0]:
null}})();Atlantis=window.Atlantis||{};
Atlantis.Entity=function(){var a=function(b){this.visible=this.enabled=!0;this.texture=null;this.textureName="";this.assetLoaded=!1;this.rectangle=new Atlantis.Rectangle;this.sourceRectangle=new Atlantis.Rectangle;Object.defineProperty(this,"x",{get:function(){return this.rectangle.x},set:function(b){this.rectangle.x=b}});Object.defineProperty(this,"y",{get:function(){return this.rectangle.y},set:function(b){this.rectangle.y=b}});Object.defineProperty(this,"width",{get:function(){return this.rectangle.width},set:function(b){this.rectangle.width=
b}});Object.defineProperty(this,"height",{get:function(){return this.rectangle.height},set:function(b){this.rectangle.height=b}});b=b||{};for(var a in b)this[a]=b[a]};a.prototype.initialize=function(){};a.prototype.loadContent=function(b){if(""!=this.textureName&&!1==this.assetLoaded){var a=this;this.texture=b.load(this.textureName);0==this.texture.width&&0==this.texture.height?this.texture.addEventListener("load",function(b){a.updateSizes();a.assetLoaded=!0;Atlantis.notify("Atlantis.Entity.AssetLoaded",
{entity:a.texture})},!1):(this.updateSizes(),this.assetLoaded=!0,Atlantis.notify("Atlantis.Entity.AssetLoaded",{entity:a.texture}))}};a.prototype.update=function(b){};a.prototype.draw=function(b,a){this.visible&&a.drawImage(this.texture,this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height)};a.prototype.updateSizes=function(){Atlantis.getImageSize(this.texture);this.rectangle.width=this.texture.width;this.rectangle.height=this.texture.height};a.prototype.setSize=function(b,
a){if(this.assetLoaded)this.rectangle.width=b,this.rectangle.height=a||b;else var c=this,d=setInterval(function(f){c.assetLoaded&&(c.rectangle.width=b,c.rectangle.height=a||b,clearInterval(d))},150)};a.prototype.setPosition=function(b,a){b instanceof Atlantis.Point||b instanceof Atlantis.Rectangle?(this.rectangle.x=b.x,this.rectangle.y=b.y):(this.rectangle.x=b,this.rectangle.y=a||b)};return a}();Atlantis=window.Atlantis||{};
Atlantis.SpriteGroup=function(){var a=function(){Atlantis.Entity.call(this);this.entities=[]};a.prototype=new Atlantis.Entity;a.prototype.initialize=function(){for(var b=0,a=this.entities.length;b<a;b++)this.entities[b].initialize()};a.prototype.loadContent=function(b){for(var a=0,c=this.entities.length;a<c;a++)this.entities[a].loadContent(b)};a.prototype.update=function(b){if(this.enabled)for(var a=0,c=this.entities.length;a<c;a++)this.entities[a].update(b)};a.prototype.draw=function(b,a){if(this.visible)for(var c=
0,d=this.entities.length;c<d;c++)this.entities[c].draw(b,a)};a.prototype.add=function(b){if(b instanceof Array)for(var a=0,c=b.length;a<c;a++)this.entities.push(b[a]);else this.entities.push(b)};a.prototype.remove=function(b){var a=null;if(b instanceof Atlantis.Entity){var c=this.entities.indexOf(b);-1<c&&(a=this.entities[c],this.entities.splice(c,1))}else-1<b&&(a=this.entities[c],this.entities.splice(c,1));return a};a.prototype.get=function(b){var a=null;-1<b&&(a=this.entities[b]);return a};return a}();Atlantis=window.Atlantis||{};
Atlantis.Sprite=function(){var a=function(b){Atlantis.Entity.call(this);this.direction=new Atlantis.Vector2;this.lastPosition=new Atlantis.Vector2;this.lastDistance=new Atlantis.Vector2;this.acceleration=new Atlantis.Vector2(1,1);this.velocity=new Atlantis.Vector2;this.maxVelocity=1;this.viewport=new Atlantis.Rectangle(0,0,Atlantis.Engine.width,Atlantis.Engine.height);this.isFullyLoaded=this.acrossScreen=this.insideScreen=!1;this.spriteAnimator=new Atlantis.SpriteAnimator;this.hasAnimation=!1;this.elapsedTime=
0;b=b||{};for(var a in b)this[a]=b[a]};a.prototype=new Atlantis.Entity;a.prototype.prepareAnimation=function(b,a){this.hasAnimation=!0;var c=a||b;this.spriteAnimator.initialize(b,c,this.texture.width,this.texture.height);this.rectangle.width=b;this.rectangle.height=c};a.prototype.addAnimation=function(b,a,c){this.spriteAnimator.add(b,a,c);this.sourceRectangle=this.spriteAnimator.animations[b].rectangles[0]};a.prototype.play=function(b){this.sourceRectangle=this.spriteAnimator.play(b)};a.prototype.update=
function(b){this.enabled&&(this.elapsedTime+=b.getElapsedTime(),this.lastDistance.x=this.rectangle.x-this.lastPosition.x,this.lastDistance.y=this.rectangle.y-this.lastPosition.y,this.lastPosition.x=this.rectangle.x,this.lastPosition.y=this.rectangle.y,this.rectangle.x+=this.velocity.x*this.acceleration.x,this.rectangle.y+=this.velocity.y*this.acceleration.y,this.velocity.multiply(this.maxVelocity),this.hasAnimation&&(this.spriteAnimator.update(b),0==this.lastDistance.x&&(0==this.lastDistance.y&&""!==
this.spriteAnimator.currentAnimationName)&&(this.sourceRectangle=this.spriteAnimator.getCurrentAnimation().rectangles[0])))};a.prototype.postUpdate=function(b){this.enabled&&(this.direction.x=this.rectangle.x-this.lastPosition.x,this.direction.y=this.rectangle.y-this.lastPosition.y,this.insideScreen?(this.rectangle.x<this.viewport.x?(this.rectangle.x=this.viewport.x,this.velocity.multiply(0)):this.rectangle.getRight()>this.viewport.width&&(this.rectangle.x=this.viewport.width-this.rectangle.width,
this.velocity.multiply(0)),this.rectangle.y<this.viewport.y?(this.rectangle.y=this.viewport.y,this.velocity.multiply(0)):this.rectangle.getBottom()>this.viewport.height&&(this.rectangle.y=this.viewport.height-this.rectangle.height,this.velocity.multiply(0))):this.acrossScreen&&(this.rectangle.getRight()<this.viewport.x?this.rectangle.x=this.viewport.width:this.rectangle.x>this.viewport.width&&(this.rectangle.x=this.viewport.x),this.rectangle.getBottom()<this.viewport.y?this.rectangle.y=this.viewport.height:
this.position.y>this.viewport.height&&(this.rectangle.y=this.viewport.y)))};a.prototype.draw=function(b,a){this.postUpdate(b);this.visible&&this.assetLoaded&&(this.hasAnimation?a.drawImage(this.texture,this.sourceRectangle.x,this.sourceRectangle.y,this.sourceRectangle.width,this.sourceRectangle.height,this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height):a.drawImage(this.texture,this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height))};return a}();
