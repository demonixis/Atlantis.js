var Atlantis=window.Atlantis||{};Atlantis.MusicState={};
Atlantis.AudioManager=function(){Atlantis.MusicState.PLAYING=1;Atlantis.MusicState.STOPPED=2;Atlantis.MusicState.PAUSED=3;var b=function(){this.repeatMusic=!1;this.currentMusic=null;this.volume=1;this.currentState=Atlantis.MusicState.STOPPED};b.prototype.playMusic=function(a,d){this.stopMusic();this.currentMusic=a;this.repeat=d;this.currentMusic.play();this.currentState=Atlantis.MusicState.PLAYING};b.prototype.stopMusic=function(){this.currentState=Atlantis.MusicState.STOPPED};b.prototype.pauseMusic=
function(){null!=this.currentMusic&&this.currentState==Atlantis.MusicState.PLAYING&&(this.currentMusic.pause(),this.currentState=Atlantis.MusicState.PAUSED)};return b}();Atlantis=window.Atlantis||{};Atlantis.Engine=Atlantis.Engine||{};
Atlantis.Engine=function(){function b(){requestAnimationFrame(b);Atlantis.Engine.game.run()}Atlantis.Engine.game=null;Atlantis.Engine.content=null;Atlantis.Engine.components=null;Atlantis.Engine.stateManager=null;Atlantis.Engine.keyboard=null;Atlantis.Engine.mouse=null;Atlantis.Engine.touch=null;Atlantis.Engine.width=0;Atlantis.Engine.height=0;var a=function(a,c,b){a=new Atlantis.Game(a,c,b);Atlantis.Engine.game=a;Atlantis.Engine.content=a.content;Atlantis.Engine.component=a.components;Atlantis.Engine.keyboard=
a.keyboard;Atlantis.Engine.mouse=a.mouse;Atlantis.Engine.touch=a.touch;Atlantis.Engine.width=a.width;Atlantis.Engine.height=a.height;this.stateManager=new Atlantis.StateManager(a);a.components.add(this.stateManager)};a.prototype.run=function(){Atlantis.Engine.game.initialize();b()};return a}();Atlantis=window.Atlantis||{};
Atlantis.Interpolator=function(){var b=function(){this.active=!1;this.interpolatedValue=this.endValue=this.startValue=this.desiredDuration=this.elapsedTime=0};b.prototype.startInterpolation=function(a,d,c){this.startValue=a;this.endValue=d;this.desiredDuration=c;this.elapsedTime=0;this.interpolatedValue=a;this.active=!0};b.prototype.getInterpolatedValue=function(a){this.active&&(this.elapsedTime+=a,this.elapsedTime>=this.desiredDuration?(this.active=!1,this.elapsedTime=this.desiredDuration,this.interpolatedValue=
this.endValue):this.interpolateValue(this.elapsedTime/this.desiredDuration));return this.interpolatedValue};b.prototype.interpolateValue=function(a){var d=this.startValue;a=0>a?0:a;this.interpolatedValue=d+(this.endValue-d)*(1<a?1:a)};return b}();Atlantis=window.Atlantis||{};
Atlantis.State=function(){var b=function(a){this.name=a;this.active=!0;this.stateManager=null;this.initialized=!1;this.scene=new Atlantis.SpriteGroup};b.prototype.loadContent=function(a){this.scene.loadContent(a);this.scene.initialize();this.initialized=!0};b.prototype.update=function(a){this.scene.update(a)};b.prototype.draw=function(a,d){this.scene.draw(a,d)};b.prototype.add=function(a){this.scene.add(a)};b.prototype.remove=function(a){this.scene.remove(a)};b.prototype.get=function(a){return this.scene.get(a)};
return b}();
Atlantis.StateManager=function(){var b=function(a){Atlantis.DrawableGameComponent.call(this,a);this.states=[];this.initialized=!1};b.prototype=new Atlantis.DrawableGameComponent;b.prototype.loadContent=function(a){for(var d=0,c=this.states.length;d<c;d++)this.states[d].loadContent(a),this.initialized=!0};b.prototype.update=function(a){for(var d=0,c=this.states.length;d<c;d++)this.states[d].active&&this.states[d].update(a)};b.prototype.draw=function(a,d){for(var c=0,b=this.states.length;c<b;c++)this.states[c].active&&
this.states[c].draw(a,d)};b.prototype.setStateActive=function(a,d){"undefined"!=typeof d&&!0==d&&this.disableStates();if(a instanceof Atlantis.State){var c=this.states.indexOf(a);-1<c&&(this.states[c].active=!0)}else if("string"==typeof a)for(var b=0,c=-1,f=this.states.length;b<f&&-1==c;)this.states[b].name==a&&(this.states[b].active=!0,c=b),b++;else-1<a&&(this.states[a].active=!0)};b.prototype.disableStates=function(){for(var a=0,d=this.states.length;a<d;a++)this.states[a].active=!1};b.prototype.switchState=
function(a){this.states=[];this.states.push(a)};b.prototype.add=function(a,d,b){"undefined"!=typeof b&&!0==b&&this.disableStates();d="undefined"!=typeof d?d:!0;if(a instanceof Array){var e=0;for(b=a.length;e<b;e++)a[e].stateManager=this,a[e].active=d,this.initialized&&(a[e].loadContent(this.game.content),a[e].initialize()),this.states.push(a[e])}else a.stateManager=this,a.active=d,this.initialized&&(a[e].loadContent(this.game.content),a[e].initialize()),this.states.push(a)};b.prototype.remove=function(a){var d=
null;if(a instanceof Atlantis.state){var b=this.states.indexOf(a);-1<b&&(d=this.states[b],this.states.splice(b,1))}else if("string"==typeof a){for(var e=0,b=-1;e<size&&-1==b;)this.states[e].name==a&&(b=e),e++;-1<b&&(d=this.states[b],this.states.splice(b,1))}else-1<a&&(d=this.states[a],this.states.splice(b,1));return d};b.prototype.get=function(a){var d=null;if("string"==typeof a){for(var b=0,e=-1;b<size&&-1==e;)this.states[b].name==a&&(e=b),b++;-1<e&&(d=this.states[e])}else-1<d&&(d=this.states[a]);
return d};return b}();Atlantis=window.Atlantis||{};Atlantis.StorageManager=function(){function b(a,b){return(b||"Atlantis.Engine")+"."+a}var a=function(){};a.prototype.save=function(a,c,e){"object"==typeof e&&(e=JSON.stringify(e));localStorage.setItem(b(c,a),e)};a.prototype.load=function(a,c,e){a=localStorage.getItem(b(c,a));return null!=a&&e?JSON.parse(a):a};return a}();Atlantis=window.Atlantis||{};
(function(){Atlantis.SpriteAnimation=function(b,a){this.rectangles=Array(b);this.frameRate=a;this.index=0;this.max=b;this.elapsedTime=0;this.length=b};Atlantis.SpriteAnimation.prototype.next=function(b){this.elapsedTime+=b;this.elapsedTime>this.frameRate&&(this.index++,this.index>=this.max&&(this.index=0),0==this.index&&Atlantis.notify("sprite.AnimationComplete"),this.elapsedTime=0);return this.rectangles[this.index]};Atlantis.SpriteAnimator=function(){this.animations={};this.spritesheetLength=this.nbSpriteY=
this.nbSpriteX=this.textureHeight=this.textureWidth=this.spriteHeight=this.spriteWidth=0};Atlantis.SpriteAnimator.prototype.initialize=function(b,a,d,c){this.animations={};this.spriteWidth=b;this.spriteHeight=a;this.textureWidth=d;this.textureHeight=c;this.nbSpriteX=this.textureWidth/this.spriteWidth;this.nbSpriteY=this.textureHeight/this.spriteHeight;this.spritesheetLength=this.nbSpriteX*this.nbSpriteY};Atlantis.SpriteAnimator.prototype.add=function(b,a,d){var c=a.length;d=new Atlantis.SpriteAnimation(c,
d);if(a instanceof Atlantis.Rectangle)d.rectangles=a;else for(var e=0;e<c;e++){var f=a[e]%this.nbSpriteX,g=Math.floor(a[e]/this.nbSpriteX),f=0<g?f%(this.nbSpriteX*g):f%this.nbSpriteX;d.rectangles[e]=new Atlantis.Rectangle(f*this.spriteWidth,g*this.spriteHeight,this.spriteWidth,this.spriteHeight)}this.animations[b]=d};Atlantis.SpriteAnimator.prototype.update=function(){}})();Atlantis=window.Atlantis||{};
Atlantis.Entity=function(){var b=function(a){this.visible=this.enabled=!0;this.texture=null;this.textureName="";this.assetLoaded=!1;this.rectangle=new Atlantis.Rectangle;this.sourceRectangle=new Atlantis.Rectangle;Object.defineProperty(this,"x",{get:function(){return this.rectangle.x},set:function(a){this.rectangle.x=a}});Object.defineProperty(this,"y",{get:function(){return this.rectangle.y},set:function(a){this.rectangle.y=a}});Object.defineProperty(this,"width",{get:function(){return this.rectangle.width},set:function(a){this.rectangle.width=
a}});Object.defineProperty(this,"height",{get:function(){return this.rectangle.height},set:function(a){this.rectangle.height=a}});a=a||{};for(var b in a)this[b]=a[b]};b.prototype.initialize=function(){};b.prototype.loadContent=function(a){if(""!=this.textureName&&!1==this.assetLoaded){var b=this;this.texture=a.load(this.textureName);0==this.texture.width&&0==this.texture.height?this.texture.addEventListener("load",function(){b.updateSizes();b.assetLoaded=!0;Atlantis.notify("Atlantis.Entity.AssetLoaded",
{entity:b.texture})},!1):(this.updateSizes(),this.assetLoaded=!0,Atlantis.notify("Atlantis.Entity.AssetLoaded",{entity:b.texture}))}};b.prototype.update=function(){};b.prototype.draw=function(a,b){this.visible&&b.drawImage(this.texture,this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height)};b.prototype.updateSizes=function(){Atlantis.getImageSize(this.texture);this.rectangle.width=this.texture.width;this.rectangle.height=this.texture.height};b.prototype.setSize=function(a,b){if(this.assetLoaded)this.rectangle.width=
a,this.rectangle.height=b||a;else var c=this,e=setInterval(function(){c.assetLoaded&&(c.rectangle.width=a,c.rectangle.height=b||a,clearInterval(e))},150)};b.prototype.setPosition=function(a,b){a instanceof Atlantis.Point||a instanceof Atlantis.Rectangle?(this.position.x=a.x,this.position.y=a.y,this.rectangle.x=a.x,this.rectangle.y=a.y):(this.position.x=a,this.position.y=b||a,this.rectangle.x=a,this.rectangle.y=b||a)};return b}();Atlantis=window.Atlantis||{};
Atlantis.Sprite=function(){var b=function(a){Atlantis.Entity.call(this);this.position=new Atlantis.Vector2;this.direction=new Atlantis.Vector2;this.lastPosition=new Atlantis.Vector2;this.lastDistance=new Atlantis.Vector2;this.acceleration=new Atlantis.Vector2(1,1);this.velocity=new Atlantis.Vector2;this.maxVelocity=1;this.viewport=new Atlantis.Rectangle;this.isFullyLoaded=this.acrossScreen=this.insideScreen=!1;this.spriteAnimator=new Atlantis.SpriteAnimator;this.hasAnimation=!1;this.elapsedTime=0;
a=a||{};for(var b in a)this[b]=a[b]};b.prototype=new Atlantis.Entity;b.prototype.prepareAnimation=function(a,b){this.hasAnimation=!0;var c=b||a;this.spriteAnimator.initialize(a,c,this.texture.width,this.texture.height);this.rectangle.width=a;this.rectangle.height=c};b.prototype.addAnimation=function(a,b,c){this.spriteAnimator.add(a,b,c);this.sourceRectangle=this.spriteAnimator.animations[a].rectangles[0]};b.prototype.play=function(a){this.sourceRectangle=this.spriteAnimator.animations[a].next(this.elapsedTime)};
b.prototype.update=function(a){this.enabled&&(this.elapsedTime+=a.getElapsedTime(),this.lastDistance.x=this.position.x-this.lastPosition.x,this.lastDistance.y=this.position.y-this.lastPosition.y,this.lastPosition.x=this.position.x,this.lastPosition.y=this.position.y,this.position.x+=this.velocity.x*this.acceleration.x,this.position.y+=this.velocity.y*this.acceleration.y,this.velocity.multiply(this.maxVelocity),this.rectangle.x=this.position.x,this.rectangle.y=this.position.y,this.hasAnimation&&this.spriteAnimator.update(a,
this.lastDistance))};b.prototype.postUpdate=function(){this.enabled&&(this.direction.x=this.position.x-this.lastPosition.x,this.direction.y=this.position.y-this.lastPosition.y,this.insideScreen?(this.position.x<this.viewport.x?(this.position.x=this.viewport.x,this.velocity.multiply(0)):this.rectangle.getRight()>this.viewport.width&&(this.position.x=this.viewport.width-this.rectangle.width,this.velocity.multiply(0)),this.position.y<this.viewport.y?(this.position.y=this.viewport.y,this.velocity.multiply(0)):
this.rectangle.getBottom()>this.viewport.height&&(this.position.y=this.viewport.height-this.rectangle.height,this.velocity.multiply(0))):this.acrossScreen&&(this.rectangle.getRight()<this.viewport.x?this.position.x=this.viewport.width:this.position.x>this.viewport.width&&(this.position.x=this.viewport.x),this.rectangle.getBottom()<this.viewport.y?this.position.y=this.viewport.height:this.position.y>this.viewport.height&&(this.position.y=this.viewport.y)))};b.prototype.draw=function(a,b){this.postUpdate(a);
this.visible&&this.assetLoaded&&(this.hasAnimation?b.drawImage(this.texture,this.sourceRectangle.x,this.sourceRectangle.y,this.sourceRectangle.width,this.sourceRectangle.height,this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height):b.drawImage(this.texture,this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height))};return b}();Atlantis=window.Atlantis||{};
Atlantis.SpriteGroup=function(){var b=function(){Atlantis.Entity.call(this);this.entities=[]};b.prototype=new Atlantis.Entity;b.prototype.initialize=function(){for(var a=0,b=this.entities.length;a<b;a++)this.entities[a].initialize()};b.prototype.loadContent=function(a){for(var b=0,c=this.entities.length;b<c;b++)this.entities[b].loadContent(a)};b.prototype.update=function(a){if(this.enabled)for(var b=0,c=this.entities.length;b<c;b++)this.entities[b].update(a)};b.prototype.draw=function(a,b){if(this.visible)for(var c=
0,e=this.entities.length;c<e;c++)this.entities[c].draw(a,b)};b.prototype.add=function(a){if(a instanceof Array)for(var b=0,c=a.length;b<c;b++)this.entities.push(a[b]);else this.entities.push(a)};b.prototype.remove=function(a){var b=null;if(a instanceof Atlantis.Entity){var c=this.entities.indexOf(a);-1<c&&(b=this.entities[c],this.entities.splice(c,1))}else-1<a&&(b=this.entities[c],this.entities.splice(c,1));return b};b.prototype.get=function(a){var b=null;-1<a&&(b=this.entities[a]);return b};return b}();
