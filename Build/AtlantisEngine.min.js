(function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var f=(new Date).getTime(),g=Math.max(0,16-(f-a)),h=window.setTimeout(function(){b(f+g)},g);a=f+g;return h});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();var Atlantis=window.Atlantis||{};Atlantis.events={ContentPreloading:"atlantis.preloading",ResolutionChanged:"atlantis.graphics.resize"};
Atlantis.ajax=function(a){var b=a||{},c=a.url,d=a.success||function(){},e;"undefined"!==typeof WinJS?WinJS.xhr({url:c}).then(d):(e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),"POST"===b.method?(e.open("POST",c,b.async),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&d(e.responseText)},e.send(b.data)):(a=b.data?[c,"?",b.data].join(""):c,e.open("GET",a,b.async),e.onreadystatechange=function(){4==e.readyState&&d(e.responseText)},e.send(null)))};
Atlantis.notify=function(a,b){var c=document.createEvent("HTMLEvents");c.initEvent(a,!0,!1);if(b instanceof Object)for(var d in b)c[d]=b[d];document.dispatchEvent(c)};Atlantis.isMobileDevice=function(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1};Atlantis=window.Atlantis||{};Atlantis.ContentManager=function(a){this.rootDirectory=a||"";this._assets=[];this.preloadAssets=[]};Atlantis.ContentManager.PreloadTimerInterval=250;
Atlantis.ContentManager.prototype.preload=function(a){var b=this.preloadAssets.length,c=0;a=function(a){c++};for(var d=0;d<b;d++)this.load(this.preloadAssets[d],a);var e={status:"Loading",progress:0},f=setInterval(function(){e.progress=100*c/b;c===b&&(clearInterval(f),e.status="Complete");Atlantis.notify(Atlantis.events.ContentPreloading,e)},Atlantis.ContentManager.PreloadTimerInterval)};
Atlantis.ContentManager.prototype.load=function(a,b){b="function"===typeof b?b:function(){};if(this._assets[a])b(this._assets[a]);else{var c=a.split("."),c=c[c.length-1];a=this.rootDirectory+a;switch(c){case "png":case "jpg":case "bmp":this.loadImage(a,b);break;case "mp3":case "ogg":case "wav":this.loadAudio(a,b);break;case "mp4":case "ogv":this.loadVideo(a,b);case "xml":case "json":case "js":this.loadResource(a,c,b)}}return this._assets[a]};
Atlantis.ContentManager.prototype.loadImage=function(a,b){var c=new Image;c.onload=function(){this.style.position="absolute";this.style.left="-9999px";document.body.appendChild(c);document.body.removeChild(c);this.style.position="";this.style.left="";b(this)};c.src=a;return this._assets[a]=c};Atlantis.ContentManager.prototype.loadAudio=function(a,b){var c=document.createElement("audio");c.onload=b;c.src=a;c.controls=!1;return this._assets[a]=c};
Atlantis.ContentManager.prototype.loadVideo=function(a,b){var c=document.createElement("video");c.onload=b;c.src=a;return this._assets[a]=c};Atlantis.ContentManager.prototype.loadResource=function(a,b,c){var d=this;Atlantis.ajax({method:"GET",url:a,success:function(e){var f=e;"json"==b&&(f=JSON.parse(e));d._assets[a]=f;c(f)}})};Atlantis.ContentManager.prototype.dispose=function(){this._assets.length=0};Atlantis=window.Atlantis||{};Atlantis.GameComponent=function(a){this.game=a;this.enabled=!0;this.initialized=!1};Atlantis.GameComponent.prototype.initialize=function(){this.initialized=!0};Atlantis.GameComponent.prototype.update=function(a){};Atlantis.GameComponent.prototype.isEnabled=function(){return this.enabled};Atlantis.GameComponent.prototype.isInitialized=function(){return this.initialized};Atlantis.GameComponent.prototype.setEnabled=function(a){this.enabled=a};
Atlantis.DrawableGameComponent=function(a){Atlantis.GameComponent.call(this,a);this.visible=!0;this.assetLoaded=!1};Atlantis.DrawableGameComponent.prototype=new Atlantis.GameComponent;Atlantis.DrawableGameComponent.prototype.loadContent=function(){this.assetLoaded=!0};Atlantis.DrawableGameComponent.prototype.unloadContent=function(){this.assetLoaded=!1};Atlantis.DrawableGameComponent.prototype.draw=function(a,b){};Atlantis.DrawableGameComponent.prototype.isVisible=function(){return this.isVisible};
Atlantis.DrawableGameComponent.prototype.setVisible=function(a){this.isVisible=a};Atlantis.GameComponentCollection=function(){this.components=[];this.drawables=[];this.assetLoaded=this.initialized=!1};Atlantis.GameComponentCollection.prototype.initialize=function(a){a=0;for(var b=this.components.length;a<b;a++)this.components[a].initialize();this.initialized=!0};
Atlantis.GameComponentCollection.prototype.loadContent=function(){for(var a=0,b=this.drawables.length;a<b;a++)this.drawables[a].loadContent();this.assetLoaded=!0};Atlantis.GameComponentCollection.prototype.unloadContent=function(){for(var a=0,b=this.drawables.length;a<b;a++)this.drawables[a].unloadContent();this.assetLoaded=!1};Atlantis.GameComponentCollection.prototype.update=function(a){for(var b=0,c=this.components.length;b<c;b++)this.components[b].isEnabled()&&this.components[b].update(a)};
Atlantis.GameComponentCollection.prototype.draw=function(a,b){for(var c=0,d=this.drawables.length;c<d;c++)this.drawables[c].isVisible()&&this.drawables[c].draw(a,b)};Atlantis.GameComponentCollection.prototype.add=function(a){-1==this.components.indexOf(a)&&(this.components.push(a),this.initialized&&a.initialize(),a instanceof Atlantis.DrawableGameComponent&&(this.drawables.push(a),this.assetLoaded&&a.loadContent()))};
Atlantis.GameComponentCollection.prototype.remove=function(a){var b=this.components.indexOf(a);return-1<b?(this.components.splice(b,1),a instanceof Atlantis.DrawableGameComponent&&(b=this.drawables.indexOf(a),-1<b&&this.drawables.splice(b,1)),!0):!1};Atlantis.GameComponentCollection.prototype.get=function(a){this.components.indexOf(gameComponent);return null};Atlantis=window.Atlantis||{};Atlantis.GameTime=function(){this.reset()};Atlantis.GameTime.prototype.reset=function(){this.totalGameTime=this.elapsedTime=0;this.currentTime=+new Date;this.fps=0};Atlantis.GameTime.prototype.update=function(){var a=+new Date;this.elapsedTime=a-this.currentTime;this.totalGameTime+=this.elapsedTime;this.fps=1E3/(a-this.currentTime);this.currentTime=a};Atlantis.GameTime.prototype.getElapsedTime=function(){return this.elapsedTime};
Atlantis.GameTime.prototype.getTotalGameTime=function(){return this.totalGameTime};Atlantis.GameTime.prototype.getFPS=function(){return this.fps};Atlantis=window.Atlantis||{};Atlantis.MathHelper={Pi:Math.PI,PiOver2:Math.PI/2,PiOver4:Math.PI/4,TwoPi:2*Math.PI,clamp:function(a,b,c){a=a>c?c:a;return a<b?b:a},distance:function(a,b){return Math.abs(a-b)},lerp:function(a,b,c){c=0>c?0:c;return a+(b-a)*(1<c?1:c)},toDegrees:function(a){return 180/Math.PI*a},toRadians:function(a){return Math.PI/180*a},isPowerOfTwo:function(a){return 0<a&&0==(a&a-1)}};Atlantis=window.Atlantis||{};Atlantis.Matrix=function(a){a instanceof Atlantis.Matrix?(a=a.toArray(),this.set(a)):a instanceof Array&&16==a.length?this.set(a):this.M44=this.M43=this.M42=this.M41=this.M34=this.M33=this.M32=this.M31=this.M24=this.M23=this.M22=this.M21=this.M14=this.M13=this.M12=this.M11=0};
Atlantis.Matrix.prototype.set=function(a){16==a.length&&(this.M11=a[0],this.M12=a[1],this.M13=a[2],this.M14=a[3],this.M21=a[4],this.M22=a[5],this.M23=a[6],this.M24=a[7],this.M31=a[8],this.M32=a[9],this.M33=a[10],this.M34=a[11],this.M41=a[12],this.M42=a[13],this.M43=a[14],this.M44=a[15])};Atlantis.Matrix.prototype.getIdentityValues=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};Atlantis.Matrix.prototype.getZeroValues=function(){for(var a=[],b=0;16>b;b++)a.push(0);return a};
Atlantis.Matrix.prototype.setIdentity=function(){this.set(this.getIdentityValues())};Atlantis.Matrix.getMatrixIdentity=function(){var a=new Atlantis.Matrix;a.setIdentity();return a};
Atlantis.Matrix.prototype.toArray=function(){var a=[];a.push(this.M11);a.push(this.M12);a.push(this.M13);a.push(this.M14);a.push(this.M21);a.push(this.M22);a.push(this.M23);a.push(this.M24);a.push(this.M31);a.push(this.M32);a.push(this.M33);a.push(this.M34);a.push(this.M41);a.push(this.M42);a.push(this.M43);a.push(this.M44);return a};Atlantis.Matrix.prototype.setLeft=function(a){this.M11=-a.x;this.M12=-a.y;this.M13=-a.z};
Atlantis.Matrix.prototype.getLeft=function(){var a=new Atlantis.Vector3;a.x=-this.M11;a.y=-this.M12;a.z=-this.M13;return a};Atlantis.Matrix.prototype.setRight=function(a){this.M11=a.x;this.M12=a.y;this.M13=a.z};Atlantis.Matrix.prototype.getRight=function(){var a=new Atlantis.Vector3;a.x=this.M11;a.y=this.M12;a.z=this.M13;return a};Atlantis.Matrix.prototype.setUp=function(a){this.M21=a.x;this.M22=a.y;this.M23=a.z};
Atlantis.Matrix.prototype.getUp=function(){var a=new Atlantis.Vector3;a.x=this.M21;a.y=this.M22;a.z=this.M23;return a};Atlantis.Matrix.prototype.setDown=function(a){this.M21=-a.x;this.M22=-a.y;this.M23=-a.z};Atlantis.Matrix.prototype.getDown=function(){var a=new Atlantis.Vector3;a.x=-this.M21;a.y=-this.M22;a.z=-this.M23;return a};Atlantis.Matrix.prototype.setBackward=function(a){this.M31=a.x;this.M32=a.y;this.M33=a.z};
Atlantis.Matrix.prototype.getBackward=function(){var a=new Atlantis.Vector3;a.x=this.M31;a.y=this.M32;a.z=this.M33;return a};Atlantis.Matrix.prototype.setForward=function(a){this.M31=-a.x;this.M32=-a.y;this.M33=-a.z};Atlantis.Matrix.prototype.getForward=function(){var a=new Atlantis.Vector3;a.x=-this.M31;a.y=-this.M32;a.z=-this.M33;return a};Atlantis.Matrix.prototype.setTranslation=function(a){this.M41=a.x;this.M42=a.y;this.M43=a.z};
Atlantis.Matrix.prototype.add=function(a){var b=this.toArray();a=a.toArray();for(var c=0;16>c;c++)b[c]+=a[c];this.set(b)};Atlantis.Matrix.add=function(a,b){var c=new Atlantis.Matrix(a);c.add(b);return c};Atlantis.Matrix.createRotationX=function(a){var b=getMatrixIdentity(),c=Math.cos(a);a=Math.sin(a);b.M22=c;b.M23=a;b.M32=-a;b.M33=c;return b};Atlantis.Matrix.createRotationY=function(a){var b=getMatrixIdentity(),c=Math.cos(a);a=Math.sin(a);b.M11=c;b.M13=-a;b.M31=a;b.M33=c;return b};
Atlantis.Matrix.createRotationZ=function(a){var b=this.getMatrixIdentity(),c=Math.cos(a);a=Math.sin(a);b.M11=c;b.M13=a;b.M31=-a;b.M33=c;return b};Atlantis.Matrix.createScale=function(a,b,c){var d=Atlantis.Matrix.getMatrixIdentity();d.M11=a;d.M22=b||a;d.M33=c||a;return d};Atlantis.Matrix.createTranslation=function(a,b,c){var d=Atantis.Matrix.getMatrixIdentity();d.M41=a;d.M42=b||a;d.M43=c||a;return d};
Atlantis.Matrix.createLookAt=function(a,b,c){b=Atlantis.Vector3.subtract(b,a);b.normalize();c=Atlantis.Vector3.cross(c,b);c.normalize();var d=Atlantis.Vector3.cross(b,c);d.normalize();var e=Atlantis.Matrix.getMatrixIdentity();e.M11=c.x;e.M21=c.y;e.M31=c.z;e.M12=d.x;e.M22=d.y;e.M32=d.z;e.M13=b.x;e.M23=b.y;e.M33=b.z;e.M41=-Atlantis.Vector3.dot(c,a);e.M42=-Atlantis.Vector3.dot(d,a);e.M43=-Atlantis.Vector3.dot(b,a);return e};
Atlantis.Matrix.createOrthographic=function(a,b,c,d){var e=new Matrix;e.M11=2/a;e.M12=e.M13=e.M14=0;e.M22=2/b;e.M21=e.M23=e.M24=0;e.M33=1/(c-d);e.M31=e.M32=e.M34=0;e.M41=e.M42=0;e.M43=c/(c-d);e.M44=1;return e};Atlantis.Matrix.createOrthographicOffCenter=function(a,b,c,d,e,f){var g=new Atlantis.Matrix;g.M11=2/(b-a);g.M12=0;g.M13=0;g.M14=0;g.M21=0;g.M22=2/(d-c);g.M23=0;g.M24=0;g.M31=0;g.M32=0;g.M33=1/(e-f);g.M34=0;g.M41=(a+b)/(a-b);g.M42=(d+c)/(c-d);g.M43=e/(e-f);g.M44=1;return g};
Atlantis.Matrix.createPerspectiveFieldOfView=function(a,b,c,d){a=1/Math.tan(0.5*a);b=c/(a/b);a=c/a;return Atlantis.Matrix.createPerspectiveOffCenter(-b,b,-a,a,c,d)};Atlantis.Matrix.createPerspetiveFieldOfViewRH=function(a,b,c,d){a=1/Math.tan(0.5*a);b=c/(a/b);a=c/a;return Matrix.createPerspectiveOffCenterRH(-b,b,-a,a,c,d)};
Atlantis.Matrix.createPerspectiveOffCenter=function(a,b,c,d,e,f){f/=f-e;var g=new Atlantis.Matrix;g.M11=2*e/(b-a);g.M22=2*e/(d-c);g.M31=(a+b)/(a-b);g.M32=(d+c)/(c-d);g.M33=f;g.M34=1;g.M43=-e*f;return g};Atlantis.Matrix.createPerspectiveOffCenterRH=function(a,b,c,d,e,f){a=createPerspectiveOffCenter(a,b,c,d,e,f);a.M31*=-1;a.M32*=-1;a.M33*=-1;a.M34*=-1;return a};
Atlantis.Matrix.prototype.invert=function(){var a=this.M31*this.M42-this.M32*this.M41,b=this.M31*this.M43-this.M33*this.M41,c=this.M34*this.M41-this.M31*this.M44,d=this.M32*this.M43-this.M33*this.M42,e=this.M34*this.M42-this.M32*this.M44,f=this.M33*this.M44-this.M34*this.M43,g=this.M22*f+this.M23*e+this.M24*d,h=this.M21*f+this.M23*c+this.M24*b,l=this.M21*-e+this.M22*c+this.M24*a,n=this.M21*d+this.M22*-b+this.M23*a,k=this.M11*g-this.M12*h+this.M13*l-this.M14*n;if(0==Math.abs(k))this.set(this.getZeroValues());
else{var k=1/k,m=this.M11*this.M22-this.M12*this.M21,p=this.M11*this.M23-this.M13*this.M21,q=this.M14*this.M21-this.M11*this.M24,r=this.M12*this.M23-this.M13*this.M22,s=this.M14*this.M22-this.M12*this.M24,t=this.M13*this.M24-this.M14*this.M23,u=this.M12*f+this.M13*e+this.M14*d,f=this.M11*f+this.M13*c+this.M14*b,c=this.M11*-e+this.M12*c+this.M14*a,a=this.M11*d+this.M12*-b+this.M13*a,b=this.M42*t+this.M43*s+this.M44*r,d=this.M41*t+this.M43*q+this.M44*p,e=this.M41*-s+this.M42*q+this.M44*m,v=this.M41*
r+this.M42*-p+this.M43*m,w=this.M32*t+this.M33*s+this.M34*r,t=this.M31*t+this.M33*q+this.M34*p,q=this.M31*-s+this.M32*q+this.M34*m,m=this.M31*r+this.M32*-p+this.M33*m;this.M11=+g*k;this.M12=-u*k;this.M13=+b*k;this.M14=-w*k;this.M21=-h*k;this.M22=+f*k;this.M23=-d*k;this.M24=+t*k;this.M31=+l*k;this.M32=-c*k;this.M33=+e*k;this.M34=-q*k;this.M41=-n*k;this.M42=+a*k;this.M43=-v*k;this.M44=+m*k}};Atlantis.Matrix.invert=function(a){a=new Matrix(a);a.invert();return a};
Atlantis.Matrix.createWorld=function(a,b,c){var d=new Atlantis.Matrix;c=Atlantis.Vector3.cross(b,c);var e=Atlantis.Vector3.cross(c,b);Atlantis.Vector3.normalize(b);c.normalize();e.normalize();d.setTranslation(a);d.M44=1;return d};
Atlantis.Matrix.prototype.multiply=function(a){var b=this.M11*a.M12+this.M12*a.M22+this.M13*a.M32+this.M14*a.M42,c=this.M11*a.M13+this.M12*a.M23+this.M13*a.M33+this.M14*a.M43,d=this.M11*a.M14+this.M12*a.M24+this.M13*a.M34+this.M14*a.M44,e=this.M21*a.M11+this.M22*a.M21+this.M23*a.M31+this.M24*a.M41,f=this.M21*a.M12+this.M22*a.M22+this.M23*a.M32+this.M24*a.M42,g=this.M21*a.M13+this.M22*a.M23+this.M23*a.M33+this.M24*a.M43,h=this.M21*a.M14+this.M22*a.M24+this.M23*a.M34+this.M24*a.M44,l=this.M31*a.M11+
this.M32*a.M21+this.M33*a.M31+this.M34*a.M41,n=this.M31*a.M12+this.M32*a.M22+this.M33*a.M32+this.M34*a.M42,k=this.M31*a.M13+this.M32*a.M23+this.M33*a.M33+this.M34*a.M43,m=this.M31*a.M14+this.M32*a.M24+this.M33*a.M34+this.M34*a.M44,p=this.M41*a.M11+this.M42*a.M21+this.M43*a.M31+this.M44*a.M41,q=this.M41*a.M12+this.M42*a.M22+this.M43*a.M32+this.M44*a.M42,r=this.M41*a.M13+this.M42*a.M23+this.M43*a.M33+this.M44*a.M43,s=this.M41*a.M14+this.M42*a.M24+this.M43*a.M34+this.M44*a.M44;this.M11=this.M11*a.M11+
this.M12*a.M21+this.M13*a.M31+this.M14*a.M41;this.M12=b;this.M13=c;this.M14=d;this.M21=e;this.M22=f;this.M23=g;this.M24=h;this.M31=l;this.M32=n;this.M33=k;this.M34=m;this.M41=p;this.M42=q;this.M43=r;this.M44=s};Atlantis.Matrix.multiply=function(a,b,c){a=new Atlantis.Matrix(a);a.multiply(b);c instanceof Atlantis.Matrix&&a.multiply(c);return a};Atlantis.Matrix.prototype.subtract=function(a){var b=this.toArray();a=a.toArray();for(var c=0;16>c;c++)b[c]-=a[c];this.set(b)};
Atlantis.Matrix.subtract=function(a,b){var c=new Atlantis.Matrix(a);c.subtract(b);return c};Atlantis.Matrix.prototype.toString=function(){for(var a=this.toArray(),b=[],c=0;16>c;c+=4)b.push("["),b.push(a[c]+" "),b.push(a[c+1]+" "),b.push(a[c+2]+" "),b.push(a[c+3]),b.push("] ");return b.join("")};Atlantis=Atlantis||{};Atlantis.Quaternion=function(a,b,c,d){a instanceof Atlantis.Quaternion?(this.x=a.x,this.y=b.x,this.z=c.x,this.w=d.x):(this.x=a,this.y=b,this.z=c,this.w=d)};Atlantis.Quaternion.Identity=function(){return new Atlantis.Quaternion(0,0,0,1)};Atlantis.Quaternion.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w};Atlantis.Quaternion.add=function(a,b){var c=new Quaternion(a);c.add(b);return c};
Atlantis.Quaternion.prototype.conjugate=function(){this.x*=-1;this.y*=-1;this.z*=-1};Atlantis.Quaternion.conjugate=function(a){a=new Quaternion(a);a.conjugate();return a};Atlantis.Quaternion.createFromYawPitchRoll=function(a,b,c){var d=new Quaternion;a*=0.5;var e=0.5*b;b=0.5*c;c=Math.sin(a);a=Math.cos(a);var f=Math.sin(e),e=Math.cos(e),g=Math.sin(b);b=Math.cos(b);d.x=a*f*b+c*e*g;d.y=c*e*b-a*f*g;d.z=a*e*g-c*f*b;d.w=a*e*b-c*f*g;return d};
Atlantis.Quaternion.prototype.toString=function(){return["x: ",this.x," y: ",this.y," z: ",this.z," w: ",this.w].join("")};Atlantis=Atlantis||{};Atlantis.Rectangle=function(a,b,c,d){a instanceof Atlantis.Rectangle?(this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height):(this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0)};Atlantis.Rectangle.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.width+=a.width;this.height+=a.height};Atlantis.Rectangle.prototype.divide=function(a){this.x/=a.x;this.y/=a.y;this.width/=a.width;this.height/=a.height};
Atlantis.Rectangle.prototype.multiply=function(a){this.x*=a.x;this.y*=a.y;this.width*=a.width;this.height*=a.height};Atlantis.Rectangle.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;this.width-=a.width;this.height-=a.height};Atlantis.Rectangle.prototype.contains=function(a,b){return a instanceof Atlantis.Rectangle?this.x<=a.x&&a.getRight()<=this.getRight()&&this.y<=a.y&&a.getBottom()<=this.getBottom():this.x<=a&&a<this.getRight()&&this.y<=b&&b<this.getBottom()};
Atlantis.Rectangle.prototype.intersects=function(a){return a.getLeft()<this.getRight()&&this.getLeft()<a.getRight()&&a.getTop()<this.getBottom()&&this.getTop()<a.getBottom()};Atlantis.Rectangle.prototype.toString=function(){return["x: ",this.x," y: ",this.y," width: ",this.width," height: ",this.height].toString()};Atlantis.Rectangle.prototype.toVector2=function(){return new Atlantis.Vector2(this.x,this.y)};Atlantis.Rectangle.prototype.toPoint=function(){return new Atlantis.Point(this.x,this.y)};
Atlantis.Rectangle.prototype.getTop=function(){return this.y};Atlantis.Rectangle.prototype.getBottom=function(){return this.y+this.height};Atlantis.Rectangle.prototype.getLeft=function(){return this.x};Atlantis.Rectangle.prototype.getRight=function(){return this.x+this.width};Atlantis.Rectangle.prototype.getCenter=function(){return new Atlantis.Point(this.x+this.width/2,this.y+this.height/2)};Atlantis.Rectangle.prototype.getWidth=function(){return this.width};
Atlantis.Rectangle.prototype.getHeight=function(){return this.height};Atlantis.Rectangle.prototype.getTopCenter=function(){return new Atlantis.Vector2(this.x+this.width/2,this.y)};Atlantis.Rectangle.prototype.getBottomCenter=function(){return new Atlantis.Vector2(this.x+this.width/2,this.y+this.height)};Atlantis.Rectangle.prototype.getLeftCenter=function(){return new Atlantis.Vector2(this.x,this.y+this.height/2)};
Atlantis.Rectangle.prototype.getRightCenter=function(){return new Atlantis.Vector2(this.x+this.width,this.y+this.height/2)};Atlantis.Rectangle.prototype.set=function(a,b,c,d){a instanceof Atlantis.Rectangle?(this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height):(this.x=a,this.y=b,this.width=c,this.height=d)};Atlantis.Rectangle.prototype.setPosition=function(a,b){this.x=a;this.y=b};Atlantis.Rectangle.prototype.setSize=function(a,b){this.width=a;this.height=b};
Atlantis.Rectangle.prototype.toString=function(){return["x: ",this.x," y: ",this.y," width: ",this.width," height: ",this.height].join("")};Atlantis=window.Atlantis||{};Atlantis.Point=function(a,b){a.x&&a.y?(this.x=a.x,this.y=a.y):(this.x=a?a:0,this.y=b?b:0)};Atlantis.Point.prototype.toString=function(){return["x: ",this.x," y: ",this.y].join("")};Atlantis.Vector2=function(a,b){a instanceof Atlantis.Vector2?(this.x=a.x,this.y=a.y):(this.x=a?a:0,this.y=b?b:0)};Atlantis.Vector2.Zero=function(){return new Vector2};Atlantis.Vector2.One=function(){return new Vector2(1,1)};Atlantis.Vector2.UnitX=function(){return new Vector2(1,0)};
Atlantis.Vector2.UnitY=function(){return new Vector2(0,1)};Atlantis.Vector2.prototype.add=function(a){a instanceof Atlantis.Vector2?(this.x+=a.x,this.y+=a.y):(this.x+=a,this.y+=a)};Atlantis.Vector2.add=function(a,b){var c=new Atlantis.Vector2(a);c.add(b);return c};Atlantis.Vector2.prototype.subtract=function(a){a instanceof Atlantis.Vector2?(this.x-=a.x,this.y-=a.y):(this.x-=a,this.y-=a)};Atlantis.Vector2.subtract=function(a,b){var c=new Atlantis.Vector2(a);c.subtract(b);return c};
Atlantis.Vector2.prototype.divide=function(a){a instanceof Atlantis.Vector2?(this.x/=a.x,this.y/=a.y):(this.x/=a,this.y/=a)};Atlantis.Vector2.divide=function(a,b){var c=new Atlantis.Vector2(a);c.divide(b);return c};Atlantis.Vector2.prototype.multiply=function(a){a instanceof Atlantis.Vector2?(this.x*=a.x,this.y*=a.y):(this.x*=a,this.y*=a)};Atlantis.Vector2.multiply=function(a,b){var c=new Atlantis.Vector2(a);c.multiply(b);return c};
Atlantis.Vector2.prototype.distance=function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)};Atlantis.Vector2.distance=function(a,b){return(new vector2(a)).distance(b)};Atlantis.Vector2.prototype.distance=function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)};Atlantis.Vector2.dot=function(a,b){return a.x*b.x+a.y*b.y};Atlantis.Vector2.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};
Atlantis.Vector2.lerp=function(a,b,c){return new Atlantis.Vector2(Atlantis.MathHelper.lerp(a.x,b.x,amount),Atlantis.MathHelper.lerp(b.y,b.y,amount))};Atlantis.Vector2.min=function(a,b){var c=new Atlantis.Vector2;c.x=a.x<b.x?a.x:b.x;c.y=a.y<b.y?a.y:b.y;return c};Atlantis.Vector2.max=function(a,b){var c=new Vector2;c.x=a.x>b.x?a.x:b.x;c.y=a.y>b.y?a.y:b.y;return c};Atlantis.Vector2.prototype.negate=function(a){a instanceof Atlantis.Vector2?(this.x=-a.x,this.y=-a.y):(this.x=-a,this.y=-a)};
Atlantis.Vector2.negate=function(a){a=new Atlantis.Vector2(a);a.x*=-1;a.y*=-1;return a};Atlantis.Vector2.prototype.normalize=function(){var a=Atlantis.Vector3.distance(this,new Vector3);0!=a&&(a=1/a,this.set(this.x*a,this.y*a,this.z*a))};Atlantis.Vector2.normalize=function(a){a=new vector2(a);a.normalize();return a};Atlantis.Vector2.transform=function(a,b){return new Atlantis.Vector3(a.x*b.M11+a.y*b.M21+a.z*b.M31+b.M41,a.x*b.M12+a.y*b.M22+a.z*b.M32+b.M42,a.x*b.M13+a.y*b.M23+a.z*b.M33+b.M43)};
Atlantis.Vector2.transformCoordinate=function(a,b){var c=new Atlantis.Vector4;c.x=a.x*b.M11+a.y*b.M21+a.z*b.M31+b.M41;c.y=a.x*b.M12+a.y*b.M22+a.z*b.M32+b.M42;c.z=a.x*b.M13+a.y*b.M23+a.z*b.M33+b.M43;c.w=1/(a.x*b.M14+a.y*b.M24+a.z*b.M34+b.M44);return new Vector3(c.x*c.w,c.y*c.w,c.z*c.w)};Atlantis.Vector2.prototype.set=function(a,b){this.x=a;this.y=b};Atlantis.Vector2.prototype.toString=function(){return["x: ",this.x," y: ",this.y].join("")};Atlantis=window.Atlantis||{};Atlantis.Vector3=function(a,b,c){a instanceof Atlantis.Vector3?(this.x=a.x,this.y=a.y,this.z=a.z):(this.x=a||0,this.y=b||0,this.z=c||0)};Atlantis.Vector3.Zero=function(){return new Atlantis.Vector3(0,0,0)};Atlantis.Vector3.One=function(){return new Atlantis.Vector3(1,1,1)};Atlantis.Vector3.UnitX=function(){return new Atlantis.Vector3(1,0,0)};Atlantis.Vector3.UnitY=function(){return new Atlantis.Vector3(0,1,0)};
Atlantis.Vector3.UnitZ=function(){return new Atlantis.Vector3(0,0,1)};Atlantis.Vector3.Up=function(){return new Atlantis.Vector3(0,1,0)};Atlantis.Vector3.Down=function(){return new Atlantis.Vector3(0,-1,0)};Atlantis.Vector3.Right=function(){return new Atlantis.Vector3(1,0,0)};Atlantis.Vector3.Left=function(){return new Atlantis.Vector3(-1,0,0)};Atlantis.Vector3.Forward=function(){return new Atlantis.Vector3(0,0,-1)};Atlantis.Vector3.Backward=function(){return new Atlantis.Vector3(0,0,1)};
Atlantis.Vector3.prototype.add=function(a){a instanceof Atlantis.Vector3?(this.x+=a.x,this.y+=a.y,this.z+=a.z):(this.x+=a,this.y+=a,this.z+=a)};Atlantis.Vector3.add=function(a,b){var c=new Vector3(a);c.add(b);return c};Atlantis.Vector3.prototype.subtract=function(a){a instanceof Atlantis.Vector3?(this.x-=a.x,this.y-=a.y,this.z-=a.z):(this.x-=a,this.y-=a,this.z-=a)};Atlantis.Vector3.subtract=function(a,b){var c=new Atlantis.Vector3(a);c.subtract(b);return c};
Atlantis.Vector3.prototype.divide=function(a){0!=a.x&&(this.x/=a.x);0!=a.y&&(this.y/=a.y);0!=a.z&&(this.z/=a.z)};Atlantis.Vector3.divide=function(a,b){var c=new Atlantis.Vector3(a);c.divide(b);return c};Atlantis.Vector3.prototype.multiply=function(a){a instanceof Atlantis.Vector3?(this.x*=a.x,this.y*=a.y,this.z*=a.z):(this.x*=a,this.y*=a,this.z*=a)};Atlantis.Vector3.multiply=function(a,b){var c=new Atlantis.Vector3(a);c.multiply(b);return c};
Atlantis.Vector3.cross=function(a,b){var c=new Atlantis.Vector3;c.x=a.y*b.z-b.y*a.z;c.y=-(a.x*b.z-b.x*a.z);c.z=a.x*b.y-b.x*a.y;return c};Atlantis.Vector3.distance=function(a,b){return Math.sqrt(Atlantis.Vector3.distanceSquared(a,b))};Atlantis.Vector3.distanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e};Atlantis.Vector3.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};Atlantis.Vector3.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};
Atlantis.Vector3.prototype.lerp=function(a,b){this.x=Atlantis.MathHelper.lerp(this.x,a.x,b);this.y=Atlantis.MathHelper.lerp(this.y,a.y,b);this.z=Atlantis.MathHelper.lerp(this.z,a.z,b)};Atlantis.Vector3.lerp=function(a,b){var c=Atlantis.MathHelper.lerp(a.x,b.x,amount),d=Atlantis.MathHelper.lerp(a.y,b.y,amount),e=Atlantis.MathHelper.lerp(a.z,b.z,amount);return new Atlantis.Vector3(c,d,e)};
Atlantis.Vector3.min=function(a,b){var c=new Atlantis.Vector3;c.x=a.x<b.x?a.x:b.x;c.y=a.y<b.y?a.y:b.y;c.z=a.z<b.z?a.z:b.z;return c};Atlantis.Vector3.max=function(a,b){var c=new Atlantis.Vector3;c.x=a.x>b.x?a.x:b.x;c.y=a.y>b.y?a.y:b.y;c.z=a.z>b.z?a.z:b.z;return c};Atlantis.Vector3.prototype.negate=function(){this.x*=-1;this.y*=-1;this.z*=-1};Atlantis.Vector3.negate=function(a){a=new Atlantis.Vector3(a);a.negate();return a};
Atlantis.Vector3.prototype.normalize=function(){var a=distance(this,new Atlantis.Vector3);0!=a&&(a=1/a,this.set(this.x*a,this.y*a,this.z*a))};Atlantis.Vector3.normalize=function(a){a=new Vector3(a);a.normalize();return a};Atlantis.Vector3.transform=function(a,b){return new Vector3(a.x*b.M11+a.y*b.M21+a.z*b.M31+b.M41,a.x*b.M12+a.y*b.M22+a.z*b.M32+b.M42,a.x*b.M13+a.y*b.M23+a.z*b.M33+b.M43)};
Atlantis.Vector3.transformCoordinate=function(a,b){var c=new Atlantis.Vector4;c.x=a.x*b.M11+a.y*b.M21+a.z*b.M31+b.M41;c.y=a.x*b.M12+a.y*b.M22+a.z*b.M32+b.M42;c.z=a.x*b.M13+a.y*b.M23+a.z*b.M33+b.M43;c.w=1/(a.x*b.M14+a.y*b.M24+a.z*b.M34+b.M44);return new Atlantis.Vector3(c.x*c.w,c.y*c.w,c.z*c.w)};Atlantis.Vector3.prototype.set=function(a,b,c){this.x=a;this.y=b;this.z=c};Atlantis.Vector3.prototype.toString=function(){return["x: ",this.x," y: ",this.y," z: ",this.z].join("")};Atlantis=window.Atlantis||{};Atlantis.Vector4=function(a,b,c,d){a instanceof Atlantis.Vector4?(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w):(this.x=a||0,this.y=b||0,this.z=c||0,this.w=d||0)};Atlantis.Vector4.prototype.lerp=function(a,b){this.x=Atlantis.MathHelper.lerp(this.x,a.x,b);this.y=Atlantis.MathHelper.lerp(this.y,a.y,b);this.z=Atlantis.MathHelper.lerp(this.z,a.z,b);this.w=Atlantis.MathHelper.lerp(this.w,a.w,b)};Atlantis.Vector4.lerp=function(a,b,c){a=new Vector4(a);a.lerp(b,c);return a};
Atlantis.Vector4.prototype.toString=function(){return["x: ",this.x," y: ",this.y," z: ",this.z," w: ",this.w].join("")};Atlantis=window.Atlantis||{};
Atlantis.Keys={BackSpace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Pause:19,Escape:27,Space:32,Home:36,End:35,Left:37,Up:38,Right:39,Down:40,Suppr:46,PageUp:33,PageDown:34,Insert:45,Num0:48,Num1:49,Num2:50,Num3:51,Num4:52,Num5:53,Num6:54,Num7:55,Num8:56,Num9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Super:91,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,
Numpad9:105,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};Atlantis=window.Atlantis||{};Atlantis.KeyboardState=function(a){this.keys=[];for(var b=0,c=a.length;b<c;b++)this.keys.push(a[b])};Atlantis.KeyboardState.prototype.clone=function(){return new Atlantis.Input.KeyboardState(this.keys)};Atlantis.KeyboardState.prototype.isKeyDown=function(a){return!0===this.keys[a]};Atlantis.KeyboardState.prototype.isKeyUp=function(a){return!1===this.keys[a]};
Atlantis.Keyboard=function(a){this.keys=[];this.maxKeys=a||130;for(var b=0;b<a;b++)this.keys[b]=!1;var c=this;a=function(a){Atlantis.Keyboard.preventDefault&&a.preventDefault();c.keys[a.keyCode]="keydown"===a.type?!0:!1};document.addEventListener("keydown",a,!1);document.addEventListener("keyup",a,!1)};Atlantis.Keyboard.preventDefault=!0;Atlantis.Keyboard.prototype.getState=function(){return new Atlantis.KeyboardState(this.keys)};Atlantis=window.Atlantis||{};Atlantis.ButtonState={Released:0,Pressed:1};Atlantis.MouseState=function(a,b,c,d){this.x=a;this.y=b;this.scrollWheelValue=c;this.leftButton=d[0];this.rightButton=d[2];this.middleButton=d[1]};Atlantis.MouseState.prototype.clone=function(){return new Atlantis.MouseState(this.x,this.y,this.scrollWheelValue,[this.leftButton,this.middleButton,this.rightButton])};
Atlantis.Mouse=function(a){a=a instanceof HTMLElement?a:document.body;this._scroll=this._y=this._x=0;this._buttons=[];this._buttons[0]=!1;this._buttons[1]=!1;this._buttons[2]=!1;this.preventDefault=!0;var b=this,c=function(a){b.preventDefault&&a.preventDefault();b._x=a.offsetX||a.layerX;b._y=a.offsetY||a.layerY;b._buttons[0]=!1;b._buttons[1]=!1;b._buttons[2]=!1;b._buttons[a.button]="mousedown"===a.type?!0:!1;0<a.button&&"mousemove"===a.type&&(b._buttons[a.button]=!0)},d=function(a){b._scroll=Math.max(-1,
Math.min(1,a.wheelDelta||-a.detail))};a.addEventListener("mousedown",c,!1);a.addEventListener("mousemove",c,!1);a.addEventListener("mouseup",c,!1);a.addEventListener("click",c,!1);a.addEventListener("mousewheel",d,!1);a.addEventListener("DOMMouseScroll",d,!1)};Atlantis.Mouse.prototype.getState=function(){return new Atlantis.MouseState(this._x,this._y,this._scroll,this._buttons)};Atlantis=window.Atlantis||{};Atlantis.TouchLocationState={Invalid:1,Moved:2,Pressed:3,Released:4};Atlantis.TouchPanelState=function(a){this.state=a.touchState||Atlantis.TouchLocationState.Invalid;this.position=new Atlantis.Vector2(a.x||0,a.y||0)};Atlantis.TouchPanelState.prototype.clone=function(){return new Atlantis.TouchPanelState({state:this.state,position:{x:this.position.x,y:this.position.y}})};
Atlantis.TouchPanel=function(a){this._states=[];var b=this,c=function(a){var c=a.touches.length;b._states.length=c;for(var f=0;f<c;f++)b._states[f]={x:a.touches[f].clientX,y:a.touches[f].clientY},b._states[f].touchState="touchstart"==a.type?Atlantis.TouchLocationState.Pressed:"touchmove"==a.type?Atlantis.TouchLocationState.Moved:"touchend"==a.type?Atlantis.TouchLocationState.Released:Atlantis.TouchLocationState.Invalid};a.addEventListener("touchstart",c,!1);a.addEventListener("touchmove",c,!1);a.addEventListener("touchend",
c,!1);a.addEventListener("touchcancel",c,!1)};Atlantis.TouchPanel.prototype.getCapabilities=function(){return{hasTouch:!!("ontouchstart"in window)||!!("onmsgesturechange"in window)}};Atlantis.TouchPanel.prototype.getState=function(a){if("number"===typeof a)return new Atlantis.TouchPanelState(this._states[a]?this._states[a]:{});a=[];for(var b=0,c=this._states.length;b<c;b++)a.push(new Atlantis.TouchPanelState(this._states[b]));return a};Atlantis=window.Atlantis||{};Atlantis.GamepadButton={A:0,B:1,X:2,Y:3,LeftShoulder:4,RightShoulder:5,LeftTrigger:6,RightTrigger:7,Select:8,Start:9,L3:10,R3:11,DPadUp:12,DPadDown:13,DPadLeft:14,DPadRight:15};Atlantis.GamepadAxis={Horizontal:0,Vertical:1,HorizontalRight:2,VerticalRight:3};
Atlantis.GamepadState=function(a,b){this.axis=[];this.buttons=[];if(a)for(var c=0,d=a.length;c<d;c++)this.axis.push(a[c]);else for(c=0;6>c;c++)this.axis.push(!1);if(b)for(c=0,d=b.length;c<d;c++)this.buttons.push(b[c]);else for(c=0;15>c;c++)this.buttons.push(!1)};Atlantis.GamepadState.prototype.isButtonDown=function(a){return this.buttons[a]};Atlantis.GamepadState.prototype.isButtonUp=function(a){return!this.buttons[a]};Atlantis.GamepadState.prototype.getAxis=function(a){return this.axis[a]};
Atlantis.Gamepad=function(){Atlantis.GameComponent.call(this);this._gamepads={};this._states={}};Atlantis.Gamepad.prototype=Object.create(Atlantis.GameComponent.prototype);
Atlantis.Gamepad.prototype.initialize=function(){var a=this;window.addEventListener("gamepadconnected",function(b){a._addGamepad(b.gamepad)},!1);window.addEventListener("gamepaddisconnected",function(b){a._removeGamepad(b.gamepad)},!1);navigator.webkitGetGamepads?setInterval(this._scanGamepads.bind(this),500):(Atlantis.GamepadButton.Select=6,Atlantis.GamepadButton.Start=7,Atlantis.GamepadButton.L3=8,Atlantis.GamepadButton.R3=9)};
Atlantis.Gamepad.prototype._addGamepad=function(a){this._gamepads[a.index]=a;this._states[a.index]=new Atlantis.GamepadState};Atlantis.Gamepad.prototype._removeGamepad=function(a){delete this._gamepads[a.index];delete this._states[a.index]};Atlantis.Gamepad.prototype._scanGamepads=function(){for(var a=navigator.webkitGetGamepads(),b=0,c=a.length;b<c;b++)a[b]&&(a[b].index in this._gamepads?this._gamepads[a[b].index]=a[b]:this._addGamepad(a[b]))};
Atlantis.Gamepad.prototype.update=function(a){navigator.webkitGetGamepads&&this._scanGamepads();for(var b in this._gamepads){a=this._gamepads[b];for(var c=0,d=a.buttons.length;c<d;c++){var e=a.buttons[c],f=1===e?!0:!1;"object"==typeof e&&(f=e.pressed);this._states[a.index].buttons[c]=f}c=0;for(d=a.axes.length;c<d;c++)this._states[a.index].axis[c]=a.axes[c].toFixed(4)}};
Atlantis.Gamepad.prototype.getState=function(a){a="undefined"!==typeof a?a:0;return this._gamepads[a]?new Atlantis.GamepadState(this._gamepads[a].axes,this._gamepads[a].buttons):new Atlantis.GamepadState};Atlantis=window.Atlantis||{};Atlantis.RenderTarget=function(a,b,c,d){this._canvas=d;this._canvas||(this._canvas=document.createElement("canvas"),this.setSize(a,b));this._context=null;this._context=c?this._canvas.getContext("webgl")||this._canvas.getContext("experimental-webgl"):this._canvas.getContext("2d");this.isWebGLCanvas=function(){return c};this.setSize(a,b)};Atlantis.RenderTarget.prototype.setData=function(a){this._context.putImageData(a,0,0)};
Atlantis.RenderTarget.prototype.getData=function(){return this._context.getImageData(0,0,this.viewport.width,this.viewport.height)};Atlantis.RenderTarget.prototype.getContext=function(){return this._context};Atlantis.RenderTarget.prototype.getCanvas=function(){return this._canvas};Atlantis.RenderTarget.prototype.getWidth=function(){return this._canvas.width};Atlantis.RenderTarget.prototype.getHeight=function(){return this._canvas.height};
Atlantis.RenderTarget.prototype.setSize=function(a,b){this._canvas.width=a;this._canvas.height=b};Atlantis.RenderTarget.prototype.clear=function(a){this._is3DCanvas?(this._context.clearColor(a.r,a.g,a.b,a.a),this._context.enable(this._context.DEPTH_TEST),this._context.depthFunc(this._context.LEQUAL),this._context.clear(this._context.COLOR_BUFFER_BIT|this._context.DEPTH_BUFFER_BIT)):this._context.clearRect(0,0,this._canvas.width,this._canvas.height)};Atlantis.RenderTarget.prototype.saveAsPng=function(){return this._canvas.toDataURL("image/png")};
Atlantis.RenderTarget.prototype.saveAsJpg=function(){return this._canvas.toDataURL("image/jpg")};Atlantis=window.Atlantis||{};Atlantis.ScaleMode={ScaleToFit:0,ConserveAspectRatio:1,NoScaleCenter:2};
Atlantis.GraphicsDevice=function(a,b,c){c=c||{};c.webGL=c.webGL?!0:!1;c.width=a;c.height=b;this.preferredBackBufferWidth=c.backBufferWidth||a;this.preferredBackBufferHeight=c.backBufferWidth||b;this.viewport=new Atlantis.Rectangle;this.scaleMode=Atlantis.ScaleMode.ScaleToFit;a&&b&&(this._frontBuffer=new Atlantis.RenderTarget(a,b,c.webGL,c.canvas),this._fbContext=this._frontBuffer.getContext(),this._backBuffer=new Atlantis.RenderTarget(this.preferredBackBufferWidth,this.preferredBackBufferHeight,c.webGL),
this._bbCanvas=this._backBuffer.getCanvas(),a=this._frontBuffer.getCanvas(),a.style.msTouchAction="none",a.style.backgroundColor="#000",a.id=a.id?a.id:"AtlantisCanvas",this.viewport.setSize(this.preferredBackBufferWidth,this.preferredBackBufferHeight))};
Atlantis.GraphicsDevice.prototype.applyChanges=function(){this._backBuffer.setSize(this.preferredBackBufferWidth,this.preferredBackBufferHeight);var a=this._frontBuffer.getWidth(),b=this._frontBuffer.getHeight();if(this.scaleMode==Atlantis.ScaleMode.ScaleToFit||a===this.preferredBackBufferWidth&&b===this.preferredBackBufferHeight)this.viewport.set(0,0,a,b);else if(this.scaleMode==Atlantis.ScaleMode.ConserveAspectRatio){var c=0;this.preferredBackBufferWidth>this.preferredBackBufferHeight?(c=this.preferredBackBufferWidth/
a,this.viewport.width=a,this.viewport.height=this.preferredBackBufferHeight*(1+c)):(c=this.preferredBackBufferHeight/b,this.viewport.width=this.preferredBackBufferWidth*(1+c),this.viewport.height=b);this.viewport.x=a/2-this.viewport.width/2;this.viewport.y=b/2-this.viewport.height/2}else this.scaleMode==Atlantis.ScaleMode.NoScaleCenter&&(this.viewport.x=a/2-this.preferredBackBufferWidth/2,this.viewport.y=b/2-this.preferredBackBufferHeight/2,this.viewport.width=this.preferredBackBufferWidth,this.viewport.height=
this.preferredBackBufferHeight);Atlantis.notify(Atlantis.events.ResolutionChanged,{width:this.preferredBackBufferWidth,height:this.preferredBackBufferHeight})};Atlantis.GraphicsDevice.prototype.getBackBuffer=function(){return this._backBuffer};Atlantis.GraphicsDevice.prototype.getFrontBuffer=function(){return this._frontBuffer};Atlantis.GraphicsDevice.prototype.clear=function(a){this._backBuffer.clear(a);this._frontBuffer.clear(a)};
Atlantis.GraphicsDevice.prototype.present=function(){this._fbContext.drawImage(this._bbCanvas,this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height)};
Atlantis.GraphicsDevice.prototype.toggleFullscreen=function(a){a=a instanceof HTMLElement?a:this._frontBuffer.getCanvas();var b=this.isFullscreen();a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||function(){return!1};document.cancelFullScreen=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||function(){return!1};b?document.cancelFullScreen():a.requestFullScreen()};
Atlantis.GraphicsDevice.prototype.isFullscreen=function(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||!1};Atlantis=window.Atlantis||{};Atlantis.SpriteFont=function(a,b,c){this.fontName=a||"Arial";this.size=b||14;this.style=c||"normal"};Atlantis.SpriteFont.prototype.getFont=function(){return[this.style," ",this.size,"px ",this.fontName].join("")};Atlantis=window.Atlantis||{};Atlantis.SpriteSortMode={BackToFront:0,FrontToBack:1,Immediate:2};Atlantis.SpriteEffect={None:0,FlipHorizontaly:1,FlipVerticaly:2};Atlantis.BatchItemType={Texture:0,Font:1};
Atlantis.SpriteBatch=function(a){this._graphicsDevice=a;this._renderTarget=new Atlantis.RenderTarget(a.preferredBackBufferWidth,a.preferredBackBufferHeight,!1);this._viewport=new Atlantis.Rectangle(0,0,a.preferredBackBufferWidth,a.preferredBackBufferHeight);this._canvas=this._renderTarget.getCanvas();this._context=this._renderTarget.getContext();this._batchItems=[];this._batchStarted=!1;this._spriteSortMode=Atlantis.SpriteSortMode.Immediate;this._transformMatrix=null;this._cacheColoredTextures=[];
document.addEventListener(Atlantis.events.ResolutionChanged,this._onResize.bind(this),!1)};Atlantis.SpriteBatch.prototype._onResize=function(a){this._renderTarget.setSize(a.width,a.height);this._viewport.width=a.width;this._viewport.height=a.height};Atlantis.SpriteBatch.prototype.begin=function(a,b){this._batchStarted||(this._batchStarted=!0,this._transformMatrix=b?6===b.length?b:null:null,this._spriteSortMode="number"===typeof a?a:Atlantis.SpriteSortMode.Immediate,this._renderTarget.clear())};
Atlantis.SpriteBatch.prototype._sortBatchItem=function(a,b){return this._spriteSortMode===Atlantis.SpriteSortMode.BackToFront?+a.layerDepth>+b.layerDepth?1:+a.layerDepth<+b.layerDepth?-1:0:+a.layerDepth<+b.layerDepth?1:+a.layerDepth>+b.layerDepth?-1:0};
Atlantis.SpriteBatch.prototype.end=function(){if(this._batchStarted){var a={};this._spriteSortMode!==Atlantis.SpriteSortMode.Immediate&&(this._batchItems=this._batchItems.sort(this._sortBatchItem.bind(this)));var b,c,d,e,f=new Atlantis.Rectangle;this._transformMatrix&&(this._context.save(),this._context.transform(this._transformMatrix[0],this._transformMatrix[1],this._transformMatrix[2],this._transformMatrix[3],this._transformMatrix[4],this._transformMatrix[5]));for(var g=0,h=this._batchItems.length;g<
h;g++)a=this._batchItems[g],b=a.destinationRectangle.x,c=a.destinationRectangle.y,d=a.destinationRectangle.width,e=a.destinationRectangle.height,f.set(b,c,d,e),this._viewport.intersects(f)&&(b=a.origin?a.origin.x:0,c=a.origin?a.origin.y:0,this._context.save(),this._context.translate(a.destinationRectangle.x,a.destinationRectangle.y),this._context.translate(b,c),b=-b,c=-c,a.rotation&&this._context.rotate(a.rotation),a.scale&&this._context.scale(a.scale.x,a.scale.y),a.effect!=Atlantis.SpriteEffect.None&&
(a.effect==Atlantis.SpriteEffect.FlipHorizontaly?(this._context.scale(-1,1),b-=a.destinationRectangle.width):(this._context.scale(1,-1),c-=a.destinationRectangle.height)),a.type===Atlantis.BatchItemType.Texture?a.color&&a.texture2D.width&&a.texture2D.height?Atlantis.SpriteBatch.drawTexture(this._context,this._colorizeTexture(a.texture2D,a.color),b,c,d,e,a.sourceRectangle):Atlantis.SpriteBatch.drawTexture(this._context,a.texture2D,b,c,d,e,a.sourceRectangle):a.type===Atlantis.BatchItemType.Font&&(this._context.fillStyle=
a.color,this._context.font=a.spriteFont.getFont(),this._context.fillText(a.text,b,c)),this._context.restore());this._transformMatrix&&this._context.restore();this._graphicsDevice.getBackBuffer().getContext().drawImage(this._canvas,0,0,this._viewport.width,this._viewport.height);this._batchItems.length=0;this._batchStarted=!1}};Atlantis.SpriteBatch.drawTexture=function(a,b,c,d,e,f,g){g?a.drawImage(b,g.x,g.y,g.width,g.height,c,d,e,f):a.drawImage(b,c,d,e,f)};
Atlantis.SpriteBatch.prototype.draw=function(a,b,c,d,e,f,g,h,l){this._batchStarted&&(b.width||(b.width=a.width,b.height=a.height),this._batchItems.push({type:Atlantis.BatchItemType.Texture,texture2D:a,sourceRectangle:c,destinationRectangle:b,color:d,rotation:e,origin:f,scale:g,effect:h?h:Atlantis.SpriteEffect.None,layerDepth:"number"===typeof l?l:0}))};
Atlantis.SpriteBatch.prototype.drawString=function(a,b,c,d,e,f,g,h,l){this._batchStarted&&this._batchItems.push({type:Atlantis.BatchItemType.Font,spriteFont:a,text:b,destinationRectangle:{x:c.x,y:c.y,width:1,height:1},color:d,rotation:e,origin:f,scale:g,effect:h?h:Atlantis.SpriteEffect.None,layerDepth:"number"===typeof l?l:0})};
Atlantis.SpriteBatch.prototype._colorizeTexture=function(a,b){var c=this._searchColoredTexture(a,b);if(!c){c=document.createElement("canvas");c.width=a.width;c.height=a.height;var d=c.getContext("2d");d.drawImage(a,0,0);for(var e=d.getImageData(0,0,a.width,a.height),f=this._hexaToBytes(b),g=0,h=e.data.length;g<h;g+=4)e.data[g]|=f.r,e.data[g+1]|=f.g,e.data[g+2]|=f.b,e.data[g+3]|=f.a;d.putImageData(e,0,0);this._cacheColoredTextures.push({texture:a,color:b,canvas:c})}return c};
Atlantis.SpriteBatch.prototype._hexaToBytes=function(a){a=a.split("#")[1];var b={r:0,g:0,b:0,a:0},c=a.length;3===c?(b.r=parseInt(a[0]+a[0],16),b.g=parseInt(a[1]+a[1],16),b.b=parseInt(a[2]+a[2],16)):6===c?(b.r=parseInt(a.slice(0,2),16),b.g=parseInt(a.slice(2,4),16),b.b=parseInt(a.slice(4,6),16)):8===c&&(b.r=parseInt(a.slice(0,2),16),b.g=parseInt(a.slice(2,4),16),b.b=parseInt(a.slice(4,6),16),b.a=parseInt(a.slice(6,8),16));return b};
Atlantis.SpriteBatch.prototype._searchColoredTexture=function(a,b){for(var c=0,d=this._cacheColoredTextures.length,e=null;c<d&&null===e;)e=this._cacheColoredTextures[c].texture===a&&this._cacheColoredTextures[c].color===b?this._cacheColoredTextures[c].canvas:null,c++;return e};Atlantis=window.Atlantis||{};
Atlantis.Game=function(){function a(){c.gameTime.update();c.update(c.gameTime);c.draw(c.gameTime);c.beforeDraw(c.gamepad);c._paused||requestAnimationFrame(a)}function b(a){c.width=a.target.innerWidth;c.height=a.target.innerHeight;c.canvas.width=c.width;c.canvas.height=c.height}var c=null,d=function(a,b,d,h){this.settings=h||{};this.settings.webGL=!1;a=a||window.innerWidth||640;b=b||window.innerHeight||480;this.domElement=document.body;typeof d instanceof HTMLElement?this.domElement=d:"string"===typeof d&&
("."===d[0]?(d=d.replace(".",""),this.domElement=document.getElementsByClassName(d)[0]):(d="#"===d[0]?d.replace("#",""):d,this.domElement=document.getElementById(d)));this.gameTime=new Atlantis.GameTime;this.components=new Atlantis.GameComponentCollection;this.content=new Atlantis.ContentManager;this.gamepad=this.touchPanel=this.mouse=this.keyboard=null;this.graphicsDevice=new Atlantis.GraphicsDevice(a,b,this.settings);this.canvas=this.settings.canvas;this.context=this.frontBuffer=null;this._paused=
this.initialized=!1;c=this};d.version="0.2a";d.prototype.initialize=function(){this.frontBuffer=this.graphicsDevice.getFrontBuffer();this.context=this.frontBuffer.getContext();this.canvas||(this.canvas=this.frontBuffer.getCanvas());this.keyboard=new Atlantis.Keyboard;this.mouse=new Atlantis.Mouse(this.frontBuffer.getCanvas());this.touchPanel=new Atlantis.TouchPanel(this.frontBuffer.getCanvas());this.gamepad=new Atlantis.Gamepad;this.components.add(this.gamepad);this.settings.resizeEnabled&&window.addEventListener("resize",
b,!1);this.domElement&&!this.settings.canvas&&this.domElement.appendChild(this.frontBuffer.getCanvas());this.components.initialize()};d.prototype.loadContent=function(){this.components.loadContent(this.content)};d.prototype.unloadContent=function(){this.components.unloadContent()};d.prototype.update=function(a){this.components.update(a)};d.prototype.draw=function(a,b){this.settings.autoClear&&this.graphicsDevice.clear();this.components.draw(a,b)};d.prototype.beforeDraw=function(a){this.graphicsDevice.present()};
d.prototype.run=function(){this.initialized||(this.initialized=!0,this.initialize(),this.loadContent(),a())};d.prototype.pause=function(){cancelAnimationFrame(a);this._paused=!0};d.prototype.resume=function(){this._paused&&(this._paused=!1,a())};return d}();Atlantis=window.Atlantis||{};Atlantis.MusicState={Playing:1,Stopped:2,Paused:3};Atlantis.AudioManager=function(){this.repeatMusic=!1;this.currentMusic=null;this.volume=1;this.currentState=Atlantis.MusicState.STOPPED};Atlantis.AudioManager.prototype.playOneShot=function(a){a.play()};Atlantis.AudioManager.prototype.play=function(a,b){this.stopMusic();this.currentMusic=a;this.repeat=b;this.currentMusic.play();this.currentState=Atlantis.MusicState.Playing};
Atlantis.AudioManager.prototype.stop=function(){this.currentMusic.stop();this.currentState=Atlantis.MusicState.Stopped};Atlantis.AudioManager.prototype.pause=function(){this.currentState==Atlantis.MusicState.Playing&&(this.currentMusic.pause(),this.currentState=Atlantis.MusicState.Paused)};Atlantis.AudioManager.prototype.resume=function(){this.currentState==Atlantis.MusicState.Paused&&(this.currentMusic.play(),this.currentState=Atlantis.MusicState.Playing)};Atlantis=window.Atlantis||{};
Atlantis.Random={value:function(){return Math.random()},randomFloat:function(a,b){return Math.random()*(b-a)+a},randomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},vector2:function(a,b){return new Atlantis.Vector2(this.randomFloat(a,b),this.randomFloat(a,b))},vector3:function(a,b){return new Atlantis.Vector3(this.randomFloat(a,b),this.randomFloat(a,b),this.randomFloat(a,b))},vector4:function(a,b){return new Atlantis.Vector4(this.randomFloat(a,b),this.randomFloat(a,b),this.randomFloat(a,
b),this.randomFloat(a,b))},color:function(){return"#"+Math.floor(16777215*Math.random()).toString(16)}};Atlantis=window.Atlantis||{};Atlantis.State=function(a){this.name=a;this.active=!0;this.stateManager=null;this.assetLoaded=this.initialized=!1;this.visible=this.enabled=!0;this.scene=new Atlantis.Scene2D};Atlantis.State.prototype.isActive=function(){return this.visible&&this.enabled};Atlantis.State.prototype.isEnabled=function(){return this.enabled};Atlantis.State.prototype.isVisible=function(){return this.visible};Atlantis.State.prototype.setActive=function(a){this.visible=this.enabled=a};
Atlantis.State.prototype.initialize=function(){this.scene.initialize();this.initialized=!0};Atlantis.State.prototype.loadContent=function(a){this.scene.loadContent(a);this.assetLoaded=!0};Atlantis.State.prototype.update=function(a){this.scene.update(a)};Atlantis.State.prototype.draw=function(a){this.scene.draw(a)};Atlantis.State.prototype.add=function(a){this.scene.add(a)};Atlantis.State.prototype.remove=function(a){this.scene.remove(a)};Atlantis.State.prototype.get=function(a){return this.scene.get(a)};
Atlantis.StateManager=function(a){Atlantis.DrawableGameComponent.call(this,a);this.states=[];this.assetLoaded=this.initialized=!1;this.spriteBatch=null};Atlantis.StateManager.prototype=new Atlantis.DrawableGameComponent;Atlantis.StateManager.prototype.initialize=function(){this.spriteBatch=new Atlantis.SpriteBatch(this.game.graphicsDevice);for(var a=0,b=this.states.length;a<b;a++)this.states[a].initialize();this.initialized=!0};
Atlantis.StateManager.prototype.loadContent=function(){for(var a=0,b=this.states.length;a<b;a++)this.states[a].loadContent(this.game.content);this.assetLoaded=!0};Atlantis.StateManager.prototype.update=function(a){for(var b=0,c=this.states.length;b<c;b++)this.states[b].isEnabled()&&this.states[b].update(a)};Atlantis.StateManager.prototype.draw=function(a,b){this.spriteBatch.begin();for(var c=0,d=this.states.length;c<d;c++)this.states[c].isVisible()&&this.states[c].draw(this.spriteBatch);this.spriteBatch.end()};
Atlantis.StateManager.prototype.setActive=function(a,b){b&&this.disableStates();if(a instanceof Atlantis.State){var c=this.states.indexOf(a);-1<c&&this.states[c].setActive(!0)}else if("string"==typeof a)for(var d=0,c=-1,e=this.states.length;d<e&&-1==c;)this.states[d].name==a&&(this.states[d].setActive(!0),c=d),d++;else-1<a&&a<this.states.length&&(this.states[a].active=!0)};
Atlantis.StateManager.prototype.loadLevel=function(a){var b=this.states.length,c=b-1;this.disableStates();if("string"==typeof a)for(var d=0;d<b;d++){if(this.states[d].name==a){c=d;break}}else"number"===typeof a&&(c=a<b?a:c);-1<c&&(this.states[c].active=!0)};Atlantis.StateManager.prototype.disableStates=function(){for(var a=0,b=this.states.length;a<b;a++)this.states[a].setActive(!1)};
Atlantis.StateManager.prototype.add=function(a,b,c){c&&this.disableStates();a.stateManager=this;a.setActive("undefined"!=typeof b?b:!0);this.initialized&&(a[i].initialize(),a[i].loadContent(this.game.content));this.states.push(a)};Atlantis.StateManager.prototype.remove=function(a){var b=null;if("string"==typeof a){for(var c=0,d=-1;c<size&&-1==d;)this.states[c].name==a&&(d=c),c++;-1<d&&(b=this.states[d],this.states.splice(d,1))}else-1<a&&(b=this.states[a],this.states.splice(d,1));return b};
Atlantis.StateManager.prototype.get=function(a){var b=null;if("string"==typeof a){for(var c=0,d=-1;c<size&&-1==d;)this.states[c].name==a&&(d=c),c++;-1<d&&(b=this.states[d])}else-1<b&&(b=this.states[a]);return b};Atlantis=window.Atlantis||{};Atlantis.StorageManager=function(){};Atlantis.StorageManager.prototype.save=function(a,b,c){"object"==typeof c&&(c=JSON.stringify(c));localStorage.setItem(this.getLocalStorageKey(b,a),c)};Atlantis.StorageManager.prototype.load=function(a,b,c){return(a=localStorage.getItem(this.getLocalStorageKey(b,a)))&&c?JSON.parse(a):a};Atlantis.StorageManager.prototype.getLocalStorageKey=function(a,b){return[b,".",a].join("")};Atlantis=window.Atlantis||{};
Atlantis.KeyboardComponent=function(){var a=Atlantis.Keys,b=function(a){Atlantis.GameComponent.call(this,a);this.keysState=a.keyboard.getState();this.previousKeysState=null};b.prototype=Object.create(Atlantis.GameComponent.prototype);b.prototype.update=function(a){this.previousKeysState=this.keysState;this.keysState=this.game.keyboard.getState()};b.prototype.pressed=function(a){return this.keysState.isKeyDown(a)};b.prototype.released=function(a){return this.keysState.isKeyUp(a)};b.prototype.justPressed=
function(a){return this.keysState.isKeyUp(a)&&this.previousKeysState.isKeyDown(a)};b.prototype.justReleased=function(a){return this.keysState.isKeyDown(a)&&this.previousKeysState.isKeyUp(a)};b.prototype.up=function(){return this.pressed(a.Up)};b.prototype.down=function(){return this.pressed(a.Down)};b.prototype.left=function(){return this.pressed(a.Left)};b.prototype.right=function(){return this.pressed(a.Right)};b.prototype.enter=function(){return this.pressed(a.Enter)};b.prototype.space=function(){return this.pressed(a.Space)};
b.prototype.escape=function(){return this.pressed(a.Escape)};b.prototype.control=function(){return this.pressed(a.Control)};b.prototype.shift=function(){return this.pressed(a.Shift)};b.prototype.tab=function(){return this.pressed(a.Tab)};return b}();Atlantis=window.Atlantis||{};Atlantis.app={};Atlantis.input={};Atlantis.screen={};
Atlantis.GameApplication=function(a,b,c,d){Atlantis.Game.call(this,a,b,c,d);this.audioManager=new Atlantis.AudioManager;this.storageManager=new Atlantis.StorageManager;this.stateManager=new Atlantis.StateManager(this);this.components.add(this.stateManager);var e=this;Atlantis.app={game:e,content:e.content,components:e.components,storage:e.storageManager,level:e.stateManager};Atlantis.input={keys:null,mouse:null,touch:null,gamepad:null};Atlantis.screen={width:a,height:b,getCanvasWidth:function(){return e.graphicsDevice.getFrontBuffer().getWidth()},
getCanvasHeight:function(){return e.graphicsDevice.getFrontBuffer().getHeight()}};document.addEventListener(Atlantis.events.ResolutionChanged,function(a){Atlantis.screen.width=a.width;Atlantis.screen.height=a.height},!1)};Atlantis.GameApplication.prototype=new Atlantis.Game;
Atlantis.GameApplication.prototype.initialize=function(){Atlantis.Game.prototype.initialize.call(this);Atlantis.screen.width=this.graphicsDevice.preferredBackBufferWidth;Atlantis.screen.height=this.graphicsDevice.preferredBackBufferHeight;var a=new Atlantis.KeyboardComponent(this);this.components.add(a);Atlantis.input.keys=a};Atlantis=window.Atlantis||{};Atlantis.SpriteAnimation=function(a,b){this.rectangles=Array(a);this.framerate=b;this.index=0;this.max=a;this.elapsedTime=0;this.length=a};Atlantis.SpriteAnimation.prototype.next=function(){this.index>=this.rectangles.length&&(this.index=0);return this.rectangles[this.index]};Atlantis.SpriteAnimation.prototype.update=function(a){this.elapsedTime+=a.getElapsedTime();this.elapsedTime>this.framerate&&(this.index++,this.elapsedTime=0)};
Atlantis.SpriteAnimator=function(){this.animations={};this.spritesheetLength=this.nbSpriteY=this.nbSpriteX=this.textureHeight=this.textureWidth=this.spriteHeight=this.spriteWidth=0;this.currentAnimationName=""};
Atlantis.SpriteAnimator.prototype.initialize=function(a,b,c,d){this.animations={};this.spriteWidth=a;this.spriteHeight=b;this.textureWidth=c;this.textureHeight=d;this.nbSpriteX=this.textureWidth/this.spriteWidth;this.nbSpriteY=this.textureHeight/this.spriteHeight;this.spritesheetLength=this.nbSpriteX*this.nbSpriteY;this.currentAnimationName=""};
Atlantis.SpriteAnimator.prototype.add=function(a,b,c){var d=b.length;c=new Atlantis.SpriteAnimation(d,c);if(b instanceof Atlantis.Rectangle)c.rectangles=b;else for(var e=0;e<d;e++){var f=b[e]%this.nbSpriteX,g=Math.floor(b[e]/this.nbSpriteX),f=0<g?f%(this.nbSpriteX*g):f%this.nbSpriteX;c.rectangles[e]=new Atlantis.Rectangle(f*this.spriteWidth,g*this.spriteHeight,this.spriteWidth,this.spriteHeight)}this.animations[a]=c};Atlantis.SpriteAnimator.prototype.play=function(a){this.currentAnimationName=a;return this.animations[a].next()};
Atlantis.SpriteAnimator.prototype.getCurrentAnimation=function(){return""!==this.currentAnimationName?this.animations[this.currentAnimationName]:null};Atlantis.SpriteAnimator.prototype.update=function(a,b){""!==this.currentAnimationName&&this.animations[this.currentAnimationName].update(a)};Atlantis.SpriteAnimator.prototype.checkForIDLEAnimation=function(a){return""!==this.currentAnimationName&&0==a.x&&0==a.y?this.animations[this.currentAnimationName].rectangles[0]:null};Atlantis=window.Atlantis||{};Atlantis.Camera2D=function(a,b,c,d){this.y=this.x=0;this.viewport=new Atlantis.Rectangle(0,0,c,d);this._center=new Atlantis.Vector2(Atlantis.screen.width>>1,Atlantis.screen.height>>1);this._follow=null;var e=this;document.addEventListener(Atlantis.events.ResolutionChanged,function(a){e._center=new Atlantis.Vector2(Atlantis.screen.width>>1,Atlantis.screen.height>>1)},!1)};Atlantis.Camera2D.prototype.follow=function(a){this._follow=a};
Atlantis.Camera2D.prototype.getSpritePosition=function(){return this._follow?this.getRelativePosition(this._follow):{x:this.x,y:this.y}};Atlantis.Camera2D.prototype.getRelativePosition=function(a){return{x:a.rectangle.x+this.x,y:a.rectangle.y+this.y}};
Atlantis.Camera2D.prototype.update=function(){if(this._follow){var a=this._follow.rectangle.x-this._follow.lastPosition.x,b=this._follow.rectangle.y-this._follow.lastPosition.y,c=this._follow.rectangle.x,d=this._follow.rectangle.y;if(this._follow.rectangle.x>=this._center.x&&this.x<this.viewport.getRight()-Atlantis.screen.width||this._follow.rectangle.x<=this._center.x&&this.x>this.viewport.x)this.x+=a,c=this._center.x;if(this._follow.rectangle.y>=this._center.y&&this.y<this.viewport.getBottom()-
Atlantis.screen.height||this._follow.rectangle.y<=this._center.y&&this.y>this.viewport.y)this.y+=b,d=this._center.y;this._follow.move(c,d)}this.x<this.viewport.x?this.x=this.viewport.x:this.x+Atlantis.screen.width>this.viewport.getRight()?this.x=this.viewport.getRight()-Atlantis.screen.width:this.y<this.viewport.y&&(this.y=this.viewport.y);this.y+Atlantis.screen.height>this.viewport.getBottom()&&(this.y=this.viewport.getBottom()-Atlantis.screen.height)};Atlantis=window.Atlantis||{};
Atlantis.Sprite=function(a,b){this.name="GameObject";this.visible=this.enabled=!0;this.texture=null;this.textureName="string"===typeof a?a:"";this.assetLoaded=!1;this.rectangle=new Atlantis.Rectangle;this.color=this.sourceRectangle=null;this.rotation=0;this.scale=new Atlantis.Vector2(1,1);this.origin=new Atlantis.Vector2;this.layerDepth=Atlantis.Sprite.Counter++;this.direction=new Atlantis.Vector2;this.lastPosition=new Atlantis.Vector2;this.lastDistance=new Atlantis.Vector2;this.acceleration=new Atlantis.Vector2(1,
1);this.velocity=new Atlantis.Vector2;this.maxVelocity=1;this.viewport=new Atlantis.Rectangle;this.acrossScreen=this.insideScreen=!1;this.spriteAnimator=new Atlantis.SpriteAnimator;this.elapsedTime=0;b=b||{};for(var c in b)this[c]=b[c];this._reqPrepareAnims=this._reqSize=null;this._reqAddAnims=[]};Atlantis.Sprite.Counter=0;Atlantis.Sprite.prototype.initialize=function(){this.viewport=new Atlantis.Rectangle(0,0,Atlantis.screen.width,Atlantis.screen.height)};
Atlantis.Sprite.prototype.loadContent=function(a,b){b="function"===typeof b?b:function(){};if(""!=this.textureName&&!1==this.assetLoaded){var c=this;this.texture=a.load(this.textureName,function(a){c.rectangle.width=a.width;c.rectangle.height=a.height;c.assetLoaded=!0;c._reqPrepareAnims&&c.prepareAnimation(c._reqPrepareAnims.width,c._reqPrepareAnims.height);if(c._reqAddAnims.length){a=0;for(var e=c._reqAddAnims.length;a<e;a++)c.addAnimation(c._reqAddAnims[a].name,c._reqAddAnims[a].framesIndex,c._reqAddAnims[a].frameRate)}c._reqSize&&
c.setSize(c._reqSize.width,c._reqSize.height);b(c)})}else b(this)};Atlantis.Sprite.prototype.prepareAnimation=function(a,b){if(this.assetLoaded){this.hasAnimation=!0;var c=b||a;this.spriteAnimator.initialize(a,c,this.texture.width||this.rectangle.width,this.texture.height||this.rectangle.height);this.rectangle.width=a;this.rectangle.height=c}else this._reqPrepareAnims={width:a,height:b}};
Atlantis.Sprite.prototype.addAnimation=function(a,b,c){this.assetLoaded?(this.spriteAnimator.add(a,b,c),this.sourceRectangle=this.spriteAnimator.animations[a].rectangles[0]):this._reqAddAnims.push({name:a,framesIndex:b,frameRate:c})};Atlantis.Sprite.prototype.play=function(a){this.assetLoaded&&(this.sourceRectangle=this.spriteAnimator.play(a))};
Atlantis.Sprite.prototype.update=function(a){this.enabled&&(this.lastDistance.x=this.rectangle.x-this.lastPosition.x,this.lastDistance.y=this.rectangle.y-this.lastPosition.y,this.lastPosition.x=this.rectangle.x,this.lastPosition.y=this.rectangle.y,this.rectangle.x+=this.velocity.x*this.acceleration.x,this.rectangle.y+=this.velocity.y*this.acceleration.y,this.velocity.multiply(this.maxVelocity),this.hasAnimation&&this.assetLoaded&&(this.spriteAnimator.update(a),0==this.lastDistance.x&&0==this.lastDistance.y&&
""!==this.spriteAnimator.currentAnimationName&&(this.sourceRectangle=this.spriteAnimator.getCurrentAnimation().rectangles[0])))};
Atlantis.Sprite.prototype.postUpdate=function(){this.enabled&&(this.direction.x=this.rectangle.x-this.lastPosition.x,this.direction.y=this.rectangle.y-this.lastPosition.y,this.insideScreen?(this.rectangle.x<this.viewport.x?(this.rectangle.x=this.viewport.x,this.velocity.multiply(0)):this.rectangle.getRight()>this.viewport.width&&(this.rectangle.x=this.viewport.width-this.rectangle.width,this.velocity.multiply(0)),this.rectangle.y<this.viewport.y?(this.rectangle.y=this.viewport.y,this.velocity.multiply(0)):
this.rectangle.getBottom()>this.viewport.height&&(this.rectangle.y=this.viewport.height-this.rectangle.height,this.velocity.multiply(0))):this.acrossScreen&&(this.rectangle.getRight()<this.viewport.x?this.rectangle.x=this.viewport.width:this.rectangle.x>this.viewport.width&&(this.rectangle.x=this.viewport.x),this.rectangle.getBottom()<this.viewport.y?this.rectangle.y=this.viewport.height:this.rectangle.y>this.viewport.height&&(this.rectangle.y=this.viewport.y)))};
Atlantis.Sprite.prototype.draw=function(a){this.postUpdate();this.visible&&this.assetLoaded&&a.draw(this.texture,this.rectangle,this.sourceRectangle,this.color,this.rotation,this.origin,this.scale,this.effect,this.layerDepth)};Atlantis.Sprite.prototype.setSize=function(a,b){this.assetLoaded?(this.rectangle.width=a||this.rectangle.width,this.rectangle.height=b||this.rectangle.height):this._reqSize={width:a,height:b}};Atlantis.Sprite.prototype.isActive=function(){return this.enabled&&this.visible};
Atlantis.Sprite.prototype.setActive=function(a){this.visible=this.enabled=a};Atlantis.Sprite.prototype.move=function(a,b){this.rectangle.x=a;this.rectangle.y=b;this.lastPosition.x=a;this.lastPosition.y=b};Atlantis.Sprite.prototype.translate=function(a,b){this.rectangle.x+=a;this.rectangle.y+=b};Atlantis.Sprite.prototype.getX=function(){return this.rectangle.x};Atlantis.Sprite.prototype.getY=function(){return this.rectangle.y};Atlantis.Sprite.prototype.getWidth=function(){return this.rectangle.width};
Atlantis.Sprite.prototype.getHeight=function(){return this.rectangle.height};Atlantis.Sprite.prototype.setDirection=function(a){this.direction.x=x;this.direction.y=y};Atlantis.Sprite.prototype.getDirection=function(){return this.direction};Atlantis.Sprite.prototype.getName=function(){return this.name};Atlantis.Sprite.prototype.setName=function(a){this.name=a};Atlantis.Sprite.prototype.getBoundingRect=function(){return this.rectangle};Atlantis=window.Atlantis||{};Atlantis.SpriteGroup=function(){this.visible=this.enabled=!0;this._loaded=this._initialized=!1;this._sprites=[]};Atlantis.SpriteGroup.prototype.initialize=function(){if(!this._initialized){for(var a=0,b=this._sprites.length;a<b;a++)this._sprites[a].initialize();this._initialized=!0}};Atlantis.SpriteGroup.prototype.loadContent=function(a){if(!this._loaded){for(var b=0,c=this._sprites.length;b<c;b++)this._sprites[b].loadContent(a);this._loaded=!0}};
Atlantis.SpriteGroup.prototype.update=function(a){if(this.enabled)for(var b=0,c=this._sprites.length;b<c;b++)this._sprites[b].enabled&&this._sprites[b].update(a)};Atlantis.SpriteGroup.prototype.draw=function(a){if(this.visible)for(var b=0,c=this._sprites.length;b<c;b++)this._sprites[b].visible&&this._sprites[b].draw(a)};Atlantis.SpriteGroup.prototype.add=function(a){a instanceof Atlantis.Sprite&&-1===this._sprites.indexOf(a)&&this._sprites.push(a)};
Atlantis.SpriteGroup.prototype.remove=function(a){var b=null;if(a instanceof Atlantis.Sprite){var c=this._sprites.indexOf(a);-1<c&&(b=this._sprites[c],this._sprites.splice(c,1))}else-1<a&&(b=this._sprites[c],this._sprites.splice(c,1));return b};Atlantis.SpriteGroup.prototype.get=function(a){var b=null;-1<a&&(b=this._sprites[a]);return b};Atlantis.SpriteGroup.prototype.clear=function(){this._sprites.length=0};Atlantis=window.Atlantis||{};Atlantis.Scene2D=function(){Atlantis.SpriteGroup.call(this);this.camera=new Atlantis.Camera2D(0,0,Atlantis.screen.width,Atlantis.screen.height);this._tilemap=null};Atlantis.Scene2D.prototype=Object.create(Atlantis.SpriteGroup.prototype);
Atlantis.Scene2D.prototype.add=function(a){a instanceof Atlantis.Sprite?Atlantis.SpriteGroup.prototype.add.call(this,a):a instanceof Atlantis.Camera2D?this.camera=a:a instanceof Atlantis._tilemap&&(this._tilemap=a,this._tilemap.loaded&&this.camera.viewport.set(0,0,this._tilemap.mapWidth,this._tilemap.mapHeight))};
Atlantis.Scene2D.prototype.remove=function(a){a instanceof Atlantis.Sprite||"number"===typeof a?Atlantis.SpriteGroup.prototype.remove.call(this,a):a instanceof Atlantis._tilemap&&(this._tilemap=null)};Atlantis.Scene2D.prototype.lateUpdate=function(){this.camera.update();this.tilemap&&this.tilemap.update(this.camera)};Atlantis.Scene2D.prototype.draw=function(a){this.lateUpdate();this.visible&&(Atlantis.SpriteGroup.prototype.draw.call(this,a),this._tilemap&&this._tilemap.draw(a,this.camera))};Atlantis=window.Atlantis||{};Atlantis.TilemapLayerType={Tiles:"tilelayer",Background:"imagelayer",Objects:"objectlayer"};Atlantis.TilemapProjection={Orthogonal:"orthogonal",Isometric:"isometric"};
Atlantis.Tileset=function(a){this.firstGID=+a.firstgid||1;this.id=Atlantis.Tileset.Counter++;this.name=a.name||["Tileset_",this.id].join("");this.texture=a.texture;this.width=+a.imagewidth|0;this.height=+a.imageheight|0;this.margin=+a.margin|0;this.padding=+a.spacing|0;this.tileWidth=+a.tilewidth|0;this.tileHeight=+a.tileheight|0;this.properties=a.properties||{}};Atlantis.Tileset.Counter=0;
Atlantis.TilemapLayer=function(a){a=a||{};this.id=Atlantis.TilemapLayer.Counter++;this.data=a.data||[];this.type=a.type||Atlantis.TilemapLayer.Tiles;this.visible=a.visible;this.opacity=+a.opacity;this.name=a.name||["Layer_",this.id].join("");this.width=+a.width|0;this.height=+a.height|0;this.offset={x:+a.x|0,y:+a.y|0};this.properties=a.properties||{};this.backgroundId=+a.backgroundId||+this.properties.backgroundId||0;this.tilesetId=+a.tilesetId||+this.properties.tilesetId||0};
Atlantis.TilemapLayer.Counter=0;
Atlantis.Tilemap=function(a){a=a||{};this.id=Atlantis.Tilemap.Counter++;this.name=a.name||["Tilemap_",this.id].join("");this.version=+a.version|0;this.projection=a.orientation||a.projection||Atlantis.TilemapProjection.Orthogonal;this.layers=a.layers||[];this.tilesets=a.tilesets||[];this.backgrounds=a.backgrounds||[];this.width=+a.width|0;this.height=+a.height|0;this.tileWidth=+a.tilewidth|0;this.tileHeight=+a.tileheight|0;this.mapWidth=this.width*this.tileWidth;this.mapHeight=this.height*this.tileHeight;
this.properties=a.properties||{};this.loaded="undefined"!==typeof a.loaded?a.loaded:!1;this.visible="undefined"!==typeof a.visible?a.visible:!0;this._cacheTilesCanvas=[]};Atlantis.Tilemap.Counter=0;Atlantis.Tilemap.prototype.update=function(a){};
Atlantis.Tilemap.prototype.draw=function(a,b){if(this.visible&&this.loaded)for(var c=0,d=this.layers.length;c<d;c++)this.layers[c].visible&&(this.layers[c].type===Atlantis.TilemapLayerType.Background?this.drawBackground(a,this.layers[c],this.backgrounds[this.layers[c].backgroundId]):this.layers[c].type===Atlantis.TilemapLayerType.Tiles&&this.drawLayer(a,b,this.layers[c],this.tilesets[this.layers[c].tilesetId]))};Atlantis.Tilemap.prototype.drawBackground=function(a,b,c){a.draw(c,{x:b.offset.x,y:b.offset.y})};
Atlantis.Tilemap.prototype.drawLayer=function(a,b,c,d){var e=d.width/d.tileWidth,f=b.x/this.tileWidth,g=b.y/this.tileHeight;startX=Math.floor(f);startY=Math.floor(g);stopX=Math.min(Math.round((b.x+Atlantis.screen.width)/d.tileWidth)+1,c.width);stopY=Math.min(Math.round((b.y+Atlantis.screen.height)/d.tileHeight)+1,c.height);for(var h=b=0,l=0,n=0,h=0,k=startX;k<stopX;k++)for(var m=startY;m<stopY;m++)if(h=c.data[k+m*c.width]-d.firstGID,0<=h){b=h%e;h=Math.floor(h/e);b=0<h?b%(e*h):b%e;l=(k+c.offset.x-
f)*this.tileWidth;n=(m+c.offset.y-g)*this.tileHeight;if(this.projection===Atlantis.TilemapProjection.Isometric)var p=(l+n)/2,l=l-n,n=p;a.draw(d.texture,{x:l,y:n,width:this.tileWidth,height:this.tileHeight},{x:b*d.tileWidth,y:h*d.tileHeight,width:d.tileWidth,height:d.tileHeight})}};Atlantis.Tilemap.prototype.getTileIdAt=function(a,b,c){return this.layers[a]?(a=this.layers[a],b=Math.floor(b/this.tileWidth),c=Math.floor(c/this.tileHeight),a.data[b+c*a.width]):0};
Atlantis.Tilemap.prototype.getTileAt=function(a,b,c,d){if(this.layers[b]){var e=this.layers[b];b=this.getTileIdAt(b,c,d);e=[e.id,"_",a.id,"_",b].join("");if(this._cacheTilesCanvas[e])return this._cacheTilesCanvas[e];c=document.createElement("canvas");d=c.getContext("2d");c.width=a.tileWidth;c.height=a.tileHeight;if(0<=b){var f=a.imagewidth/a.tilewidth,g=b%f;b=Math.floor(b/f);d.drawImage(a.texture,{x:(0<b?g%(f*b):g%f)*a.tileWidth,y:b*a.tileHeight,width:a.tileWidth,height:a.tileHeight},{x:0,y:0,width:this.tileWidth,
height:this.tileHeight});return this._cacheTilesCanvas[e]=c}}return null};Atlantis=window.Atlantis||{};
Atlantis.TmxLoader={load:function(a,b,c){var d=new Atlantis.Tilemap;a.load(b,function(b){for(var f=0,g=0,f=0,g=b.tilesets.length;f<g;f++)d.tilesets.push(new Atlantis.Tileset(b.tilesets[f])),d.tilesets[f].texture=a.load(b.tilesets[f].image),d.tilesets[f].texture.width=b.tilesets[f].imagewidth,d.tilesets[f].texture.height=b.tilesets[f].imageheight;f=0;for(g=b.layers.length;f<g;f++)d.layers.push(new Atlantis.TilemapLayer(b.layers[f])),b.layers[f].image&&(d.backgrounds.push(a.load(b.layers[f].image)),d.layers[f].backgroundId=
f);d.height=b.height;d.width=b.width;d.tileWidth=b.tilewidth;d.tileHeight=b.tileheight;d.mapWidth=d.width*d.tileWidth;d.mapHeight=d.height*d.tileHeight;d.projection=b.orientation;d.version=b.version;d.properties=b.properties;d.visible=!0;d.loaded=!0;c&&c(d)});return d}};
