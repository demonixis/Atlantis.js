var Atlantis=window.Atlantis||{};Atlantis.MusicState={};
Atlantis.AudioManager=function(){Atlantis.MusicState.PLAYING=1;Atlantis.MusicState.STOPPED=2;Atlantis.MusicState.PAUSED=3;var b=function(){this.repeatMusic=!1;this.currentMusic=null;this.volume=1;this.currentState=Atlantis.MusicState.STOPPED};b.prototype.playMusic=function(a,e){this.stopMusic();this.currentMusic=a;this.repeat=e;this.currentMusic.play();this.currentState=Atlantis.MusicState.PLAYING};b.prototype.stopMusic=function(){this.currentState=Atlantis.MusicState.STOPPED};b.prototype.pauseMusic=
function(){null!=this.currentMusic&&this.currentState==Atlantis.MusicState.PLAYING&&(this.currentMusic.pause(),this.currentState=Atlantis.MusicState.PAUSED)};return b}();Atlantis=window.Atlantis||{};
Atlantis.State=function(){var b=function(a){this.name=a;this.active=!0;this.stateManager=null;this.assetLoaded=this.initialized=!1;this.visible=this.enabled=!0;this.scene=new Atlantis.SpriteGroup};b.prototype.isActive=function(){return this.visible&&this.enabled};b.prototype.isEnabled=function(){return this.enabled};b.prototype.isVisible=function(){return this.visible};b.prototype.setActive=function(a){this.visible=this.enabled=a};b.prototype.initialize=function(){this.scene.initialize();this.initialized=
!0};b.prototype.loadContent=function(a){this.scene.loadContent(a);this.assetLoaded=!0};b.prototype.update=function(a){this.scene.update(a)};b.prototype.draw=function(a,e){this.scene.draw(a,e)};b.prototype.add=function(a){this.scene.add(a)};b.prototype.remove=function(a){this.scene.remove(a)};b.prototype.get=function(a){return this.scene.get(a)};return b}();
Atlantis.StateManager=function(){var b=function(a){Atlantis.DrawableGameComponent.call(this,a);this.states=[];this.assetLoaded=this.initialized=!1};b.prototype=new Atlantis.DrawableGameComponent;b.prototype.initialize=function(){for(var a=0,e=this.states.length;a<e;a++)this.states[a].initialize();this.initialized=!0};b.prototype.loadContent=function(){for(var a=0,e=this.states.length;a<e;a++)this.states[a].loadContent(this.game.content);this.assetLoaded=!0};b.prototype.update=function(a){for(var e=
0,b=this.states.length;e<b;e++)this.states[e].isEnabled()&&this.states[e].update(a)};b.prototype.draw=function(a,e){for(var b=0,d=this.states.length;b<d;b++)this.states[b].isVisible()&&this.states[b].draw(a,e)};b.prototype.setActive=function(a,e){e&&this.disableStates();if(a instanceof Atlantis.State){var b=this.states.indexOf(a);-1<b&&this.states[b].setActive(!0)}else if("string"==typeof a)for(var d=0,b=-1,f=this.states.length;d<f&&-1==b;)this.states[d].name==a&&(this.states[d].setActive(!0),b=d),
d++;else-1<a&&a<this.states.length&&(this.states[a].active=!0)};b.prototype.loadLevel=function(a){var e=this.states.length,b=e-1;this.disableStates();if("string"==typeof a)for(var d=0;d<e;d++){if(this.states[d].name==a){b=d;break}}else"number"===typeof a&&(b=a<e?a:b);-1<b&&(this.states[b].active=!0)};b.prototype.disableStates=function(){for(var a=0,b=this.states.length;a<b;a++)this.states[a].setActive(!1)};b.prototype.add=function(a,b,c){c&&this.disableStates();a.stateManager=this;a.setActive("undefined"!=
typeof b?b:!0);this.initialized&&(a[i].initialize(),a[i].loadContent(this.game.content));this.states.push(a)};b.prototype.remove=function(a){var b=null;if("string"==typeof a){for(var c=0,d=-1;c<size&&-1==d;)this.states[c].name==a&&(d=c),c++;-1<d&&(b=this.states[d],this.states.splice(d,1))}else-1<a&&(b=this.states[a],this.states.splice(d,1));return b};b.prototype.get=function(a){var b=null;if("string"==typeof a){for(var c=0,d=-1;c<size&&-1==d;)this.states[c].name==a&&(d=c),c++;-1<d&&(b=this.states[d])}else-1<
b&&(b=this.states[a]);return b};return b}();Atlantis=window.Atlantis||{};Atlantis.StorageManager=function(){function b(a,b){return(b||"Atlantis.Engine")+"."+a}var a=function(){};a.prototype.save=function(a,c,d){"object"==typeof d&&(d=JSON.stringify(d));localStorage.setItem(b(c,a),d)};a.prototype.load=function(a,c,d){a=localStorage.getItem(b(c,a));return null!=a&&d?JSON.parse(a):a};return a}();Atlantis=window.Atlantis||{};
Atlantis.Interpolator=function(){var b=function(){this.active=!1;this.interpolatedValue=this.endValue=this.startValue=this.desiredDuration=this.elapsedTime=0};b.prototype.startInterpolation=function(a,b,c){this.startValue=a;this.endValue=b;this.desiredDuration=c;this.elapsedTime=0;this.interpolatedValue=a;this.active=!0};b.prototype.getInterpolatedValue=function(a){this.active&&(this.elapsedTime+=a,this.elapsedTime>=this.desiredDuration?(this.active=!1,this.elapsedTime=this.desiredDuration,this.interpolatedValue=
this.endValue):this.interpolateValue(this.elapsedTime/this.desiredDuration));return this.interpolatedValue};b.prototype.interpolateValue=function(a){this.interpolatedValue=Atlantis.MathHelper.lerp(this.startValue,this.endValue,a)};return b}();Atlantis=window.Atlantis||{};
Atlantis.KeyboardComponent=function(){var b=Atlantis.Keys,a=function(a){Atlantis.GameComponent.call(this,a);this.keysState=a.keyboard.getState();this.previousKeysState=null};a.prototype=new Atlantis.GameComponent;a.prototype.update=function(a){this.previousKeysState=this.keysState;this.keysState=this.game.keyboard.getState()};a.prototype.pressed=function(a){return this.keysState.isKeyDown(a)};a.prototype.released=function(a){return this.keysState.isKeyUp(a)};a.prototype.justPressed=function(a){return this.keysState.isKeyUp(a)&&
this.previousKeysState.isKeyDown(a)};a.prototype.justReleased=function(a){return this.keysState.isKeyDown(a)&&this.previousKeysState.isKeyUp(a)};a.prototype.up=function(){return this.pressed(b.Up)};a.prototype.down=function(){return this.pressed(b.Down)};a.prototype.left=function(){return this.pressed(b.Left)};a.prototype.right=function(){return this.pressed(b.Right)};a.prototype.enter=function(){return this.pressed(b.Enter)};a.prototype.space=function(){return this.pressed(b.Space)};a.prototype.escape=
function(){return this.pressed(b.Escape)};a.prototype.control=function(){return this.pressed(b.Control)};a.prototype.shift=function(){return this.pressed(b.Shift)};a.prototype.tab=function(){return this.pressed(b.Tab)};return a}();Atlantis=window.Atlantis||{};Atlantis.Application={};
Atlantis.GameApplication=function(){var b=function(a,b,c){Atlantis.Game.call(this,a,b,c);this.stateManager=new Atlantis.StateManager(this);this.components.add(this.stateManager);var d=this;Atlantis.Application={loadLevel:function(a){return d.stateManager.loadLevel(levelName)},Game:this,ContentManager:this.content,Components:this.components,Keyboard:null,Width:a,Height:b,StateManager:this.stateManager}};b.prototype=new Atlantis.Game;b.prototype.initialize=function(){Atlantis.Game.prototype.initialize.call(this);
var a=new Atlantis.KeyboardComponent(this);this.components.add(a);Atlantis.Application.Keyboard=a;Atlantis.Application.Pointer=this.pointer};return b}();Atlantis=window.Atlantis||{};
(function(){Atlantis.SpriteAnimation=function(b,a){this.rectangles=Array(b);this.framerate=a;this.index=0;this.max=b;this.elapsedTime=0;this.length=b};Atlantis.SpriteAnimation.prototype.next=function(){this.index>=this.rectangles.length&&(this.index=0);return this.rectangles[this.index]};Atlantis.SpriteAnimation.prototype.update=function(b){this.elapsedTime+=b.getElapsedTime();this.elapsedTime>this.framerate&&(this.index++,0==this.index&&Atlantis.notify("atlantis.sprite.animationCompleted"),this.elapsedTime=
0)};Atlantis.SpriteAnimator=function(){this.animations={};this.spritesheetLength=this.nbSpriteY=this.nbSpriteX=this.textureHeight=this.textureWidth=this.spriteHeight=this.spriteWidth=0;this.currentAnimationName=""};Atlantis.SpriteAnimator.prototype.initialize=function(b,a,e,c){this.animations={};this.spriteWidth=b;this.spriteHeight=a;this.textureWidth=e;this.textureHeight=c;this.nbSpriteX=this.textureWidth/this.spriteWidth;this.nbSpriteY=this.textureHeight/this.spriteHeight;this.spritesheetLength=
this.nbSpriteX*this.nbSpriteY;this.currentAnimationName=""};Atlantis.SpriteAnimator.prototype.add=function(b,a,e){var c=a.length;e=new Atlantis.SpriteAnimation(c,e);if(a instanceof Atlantis.Rectangle)e.rectangles=a;else for(var d=0;d<c;d++){var f=a[d]%this.nbSpriteX,g=Math.floor(a[d]/this.nbSpriteX),f=0<g?f%(this.nbSpriteX*g):f%this.nbSpriteX;e.rectangles[d]=new Atlantis.Rectangle(f*this.spriteWidth,g*this.spriteHeight,this.spriteWidth,this.spriteHeight)}this.animations[b]=e};Atlantis.SpriteAnimator.prototype.play=
function(b){this.currentAnimationName=b;return this.animations[b].next()};Atlantis.SpriteAnimator.prototype.getCurrentAnimation=function(){return""!==this.currentAnimationName?this.animations[this.currentAnimationName]:null};Atlantis.SpriteAnimator.prototype.update=function(b,a){""!==this.currentAnimationName&&this.animations[this.currentAnimationName].update(b)};Atlantis.SpriteAnimator.prototype.checkForIDLEAnimation=function(b){return""!==this.currentAnimationName&&0==b.x&&0==b.y?this.animations[this.currentAnimationName].rectangles[0]:
null}})();Atlantis=window.Atlantis||{};
Atlantis.Sprite=function(){var b=function(a,b){this.name="GameObject";this.visible=this.enabled=!0;this.texture=null;this.textureName="string"===typeof a?a:"";this.assetLoaded=!1;this.rectangle=new Atlantis.Rectangle;this.sourceRectangle=new Atlantis.Rectangle;this.direction=new Atlantis.Vector2;this.lastPosition=new Atlantis.Vector2;this.lastDistance=new Atlantis.Vector2;this.acceleration=new Atlantis.Vector2(1,1);this.velocity=new Atlantis.Vector2;this.maxVelocity=1;this.viewport=new Atlantis.Rectangle;
this.isFullyLoaded=this.acrossScreen=this.insideScreen=!1;this.spriteAnimator=new Atlantis.SpriteAnimator;this.hasAnimation=!1;this.elapsedTime=0;b=b||{};for(var c in b)this[c]=b[c];this._reqPrepareAnims=this._reqSize=null;this._reqAddAnims=[]};b.prototype.initialize=function(){this.viewport=new Atlantis.Rectangle(0,0,Atlantis.Application.Width,Atlantis.Application.Height)};b.prototype.loadContent=function(a,b){b="function"===typeof b?b:function(){};if(""!=this.textureName&&!1==this.assetLoaded){var c=
this;this.texture=a.load(this.textureName,function(a){c.rectangle.width=a.width;c.rectangle.height=a.height;c.assetLoaded=!0;c._reqPrepareAnims&&c.prepareAnimation(c._reqPrepareAnims.width,c._reqPrepareAnims.height);if(c._reqAddAnims.length){a=0;for(var f=c._reqAddAnims.length;a<f;a++)c.addAnimation(c._reqAddAnims[a].name,c._reqAddAnims[a].framesIndex,c._reqAddAnims[a].frameRate)}c._reqSize&&c.setSize(c._reqSize.width,c._reqSize.height);b(c)})}else b(this)};b.prototype.prepareAnimation=function(a,
b){if(this.assetLoaded){this.hasAnimation=!0;var c=b||a;this.spriteAnimator.initialize(a,c,this.texture.width||this.rectangle.width,this.texture.height||this.rectangle.height);this.rectangle.width=a;this.rectangle.height=c}else this._reqPrepareAnims={width:a,height:b}};b.prototype.addAnimation=function(a,b,c){this.assetLoaded?(this.spriteAnimator.add(a,b,c),this.sourceRectangle=this.spriteAnimator.animations[a].rectangles[0]):this._reqAddAnims.push({name:a,framesIndex:b,frameRate:c})};b.prototype.play=
function(a){this.assetLoaded&&(this.sourceRectangle=this.spriteAnimator.play(a))};b.prototype.update=function(a){this.enabled&&(this.elapsedTime+=a.getElapsedTime(),this.lastDistance.x=this.rectangle.x-this.lastPosition.x,this.lastDistance.y=this.rectangle.y-this.lastPosition.y,this.lastPosition.x=this.rectangle.x,this.lastPosition.y=this.rectangle.y,this.rectangle.x+=this.velocity.x*this.acceleration.x,this.rectangle.y+=this.velocity.y*this.acceleration.y,this.velocity.multiply(this.maxVelocity),
this.hasAnimation&&this.assetLoaded&&(this.spriteAnimator.update(a),0==this.lastDistance.x&&0==this.lastDistance.y&&""!==this.spriteAnimator.currentAnimationName&&(this.sourceRectangle=this.spriteAnimator.getCurrentAnimation().rectangles[0])))};b.prototype.postUpdate=function(a){this.enabled&&(this.direction.x=this.rectangle.x-this.lastPosition.x,this.direction.y=this.rectangle.y-this.lastPosition.y,this.insideScreen?(this.rectangle.x<this.viewport.x?(this.rectangle.x=this.viewport.x,this.velocity.multiply(0)):
this.rectangle.getRight()>this.viewport.width&&(this.rectangle.x=this.viewport.width-this.rectangle.width,this.velocity.multiply(0)),this.rectangle.y<this.viewport.y?(this.rectangle.y=this.viewport.y,this.velocity.multiply(0)):this.rectangle.getBottom()>this.viewport.height&&(this.rectangle.y=this.viewport.height-this.rectangle.height,this.velocity.multiply(0))):this.acrossScreen&&(this.rectangle.getRight()<this.viewport.x?this.rectangle.x=this.viewport.width:this.rectangle.x>this.viewport.width&&
(this.rectangle.x=this.viewport.x),this.rectangle.getBottom()<this.viewport.y?this.rectangle.y=this.viewport.height:this.rectangle.y>this.viewport.height&&(this.rectangle.y=this.viewport.y)))};b.prototype.draw=function(a,b){this.postUpdate(a);this.visible&&this.assetLoaded&&(this.hasAnimation?b.drawImage(this.texture,this.sourceRectangle.x,this.sourceRectangle.y,this.sourceRectangle.width,this.sourceRectangle.height,this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height):b.drawImage(this.texture,
this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height))};b.prototype.setSize=function(a,b){this.assetLoaded?(this.rectangle.width=a||this.rectangle.width,this.rectangle.height=b||this.rectangle.height):this._reqSize={width:a,height:b}};b.prototype.isActive=function(){return this.enabled&&this.visible};b.prototype.setActive=function(a){this.visible=this.enabled=a};b.prototype.move=function(a,b){this.rectangle.x=a;this.rectangle.y=b};b.prototype.translate=function(a,b){this.rectangle.x+=
a;this.rectangle.y+=b};b.prototype.getX=function(){return this.rectangle.x};b.prototype.getY=function(){return this.rectangle.y};b.prototype.getWidth=function(){return this.rectangle.width};b.prototype.getHeight=function(){return this.rectangle.height};b.prototype.setDirection=function(a){this.direction.x=x;this.direction.y=y};b.prototype.getDirection=function(){return this.direction};b.prototype.getName=function(){return this.name};b.prototype.setName=function(a){this.name=a};b.prototype.getBoundingRect=
function(){return this.rectangle};return b}();Atlantis=window.Atlantis||{};
Atlantis.SpriteGroup=function(){var b=function(){Atlantis.Sprite.call(this);this.entities=[]};b.prototype=new Atlantis.Sprite;b.prototype.initialize=function(){for(var a=0,b=this.entities.length;a<b;a++)this.entities[a].initialize()};b.prototype.loadContent=function(a){for(var b=0,c=this.entities.length;b<c;b++)this.entities[b].loadContent(a)};b.prototype.update=function(a){if(this.enabled)for(var b=0,c=this.entities.length;b<c;b++)this.entities[b].enabled&&this.entities[b].update(a)};b.prototype.draw=
function(a,b){if(this.visible)for(var c=0,d=this.entities.length;c<d;c++)this.entities[c].visible&&this.entities[c].draw(a,b)};b.prototype.add=function(a){if(a instanceof Array)for(var b=0,c=a.length;b<c;b++)this.entities.push(a[b]);else this.entities.push(a)};b.prototype.remove=function(a){var b=null;if(a instanceof Atlantis.Entity){var c=this.entities.indexOf(a);-1<c&&(b=this.entities[c],this.entities.splice(c,1))}else-1<a&&(b=this.entities[c],this.entities.splice(c,1));return b};b.prototype.get=
function(a){var b=null;-1<a&&(b=this.entities[a]);return b};b.prototype.clear=function(){this.entities.length=0};return b}();
