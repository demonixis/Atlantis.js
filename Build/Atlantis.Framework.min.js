!function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),s=window.setTimeout(function(){e(i+n)},n);return t=i+n,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var Atlantis=window.Atlantis||{};Atlantis.events={ContentPreloading:"atlantis.preloading",ResolutionChanged:"atlantis.graphics.resize"},Atlantis.ajax=function(t){var e,i=t||{},n=t.url,s=t.success||function(){};if("undefined"!=typeof WinJS)WinJS.xhr({url:n}).then(s);else if(e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),"POST"===i.method)e.open("POST",n,i.async),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&s(e.responseText)},e.send(i.data);else{var a=i.data?[n,"?",i.data].join(""):n;e.open("GET",a,i.async),e.onreadystatechange=function(){4==e.readyState&&s(e.responseText)},e.send(null)}},Atlantis.notify=function(t,e){var i=document.createEvent("HTMLEvents");if(i.initEvent(t,!0,!1),e instanceof Object)for(var n in e)i[n]=e[n];document.dispatchEvent(i)},Atlantis.isMobileDevice=function(){return navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|Windows Phone/i)},Atlantis._createProperty=function(t,e,i,n){Object.defineProperty(t,e,{get:i,set:n,enumerable:!0,configurable:!0})};var Atlantis=window.Atlantis||{};Atlantis.ContentManager=function(t){this.rootDirectory=t||"",this._assets={},this.preloader=[]},Atlantis.ContentManager.PreloadTimerInterval=250,Atlantis.ContentManager.prototype.preload=function(t,e){for(var i=this.preloader.length,n=0,t="function"==typeof t?t:function(){},e="function"==typeof e?e:function(){},s=function(){n++},a=0;i>a;a++)this.load(this.preloader[a],s);var r=this,o={status:"Loading",progress:0},h=setInterval(function(){o.progress=100*n/i,n===i&&(clearInterval(h),o.status="Complete",r.preloader.length=0,e()),Atlantis.notify(Atlantis.events.ContentPreloading,o),t(o)},Atlantis.ContentManager.PreloadTimerInterval)},Atlantis.ContentManager.prototype.load=function(t,e){var e="function"==typeof e?e:function(){},i=t.split("."),n=i[i.length-1];if(t=this.rootDirectory+t,this._assets[t])return e(this._assets[t]),this._assets[t];switch(n){case"png":case"jpg":case"bmp":this.loadImage(t,e);break;case"mp3":case"ogg":case"wav":this.loadAudio(t,e);break;case"mp4":case"ogv":this.loadVideo(t,e);case"xml":case"json":case"js":this.loadResource(t,n,e)}return this._assets[t]},Atlantis.ContentManager.prototype.loadImage=function(t,e){var i=new Image;return i.onload=function(){this.style.position="absolute",this.style.left="-9999px",document.body.appendChild(i),document.body.removeChild(i),this.style.position="",this.style.left="",e(this)},i.src=t,this._assets[t]=i,i},Atlantis.ContentManager.prototype.loadAudio=function(t,e){var i=document.createElement("audio");return i.src=t,i.load(),i.controls=!1,this._assets[t]=i,e(i),i},Atlantis.ContentManager.prototype.loadVideo=function(t,e){var i=document.createElement("video");return i.onload=e,i.src=t,this._assets[t]=i,i},Atlantis.ContentManager.prototype.loadResource=function(t,e,i){var n=this;Atlantis.ajax({method:"GET",url:t,success:function(s){var a=s;"json"==e&&(a=JSON.parse(s)),n._assets[t]=a,i(a)}})},Atlantis.ContentManager.prototype.dispose=function(){this._assets.length=0};var Atlantis=window.Atlantis||{};Atlantis.GameComponent=function(t){this.game=t,this.enabled=!0,this.initialized=!1},Atlantis.GameComponent.prototype.initialize=function(){this.initialized=!0},Atlantis.GameComponent.prototype.update=function(){},Atlantis.GameComponent.prototype.isEnabled=function(){return this.enabled},Atlantis.GameComponent.prototype.isInitialized=function(){return this.initialized},Atlantis.GameComponent.prototype.setEnabled=function(t){this.enabled=t},Atlantis.DrawableGameComponent=function(t){Atlantis.GameComponent.call(this,t),this.visible=!0,this.assetLoaded=!1},Atlantis.DrawableGameComponent.prototype=new Atlantis.GameComponent,Atlantis.DrawableGameComponent.prototype.loadContent=function(){this.assetLoaded=!0},Atlantis.DrawableGameComponent.prototype.unloadContent=function(){this.assetLoaded=!1},Atlantis.DrawableGameComponent.prototype.draw=function(){},Atlantis.DrawableGameComponent.prototype.isVisible=function(){return this.isVisible},Atlantis.DrawableGameComponent.prototype.setVisible=function(t){this.isVisible=t},Atlantis.GameComponentCollection=function(){this.components=[],this.drawables=[],this.initialized=!1,this.assetLoaded=!1},Atlantis.GameComponentCollection.prototype.initialize=function(){for(var t=0,e=this.components.length;e>t;t++)this.components[t].initialize();this.initialized=!0},Atlantis.GameComponentCollection.prototype.loadContent=function(){for(var t=0,e=this.drawables.length;e>t;t++)this.drawables[t].loadContent();this.assetLoaded=!0},Atlantis.GameComponentCollection.prototype.unloadContent=function(){for(var t=0,e=this.drawables.length;e>t;t++)this.drawables[t].unloadContent();this.assetLoaded=!1},Atlantis.GameComponentCollection.prototype.update=function(t){for(var e=0,i=this.components.length;i>e;e++)this.components[e].isEnabled()&&this.components[e].update(t)},Atlantis.GameComponentCollection.prototype.draw=function(t,e){for(var i=0,n=this.drawables.length;n>i;i++)this.drawables[i].isVisible()&&this.drawables[i].draw(t,e)},Atlantis.GameComponentCollection.prototype.add=function(t){-1==this.components.indexOf(t)&&(this.components.push(t),this.initialized&&t.initialize(),t instanceof Atlantis.DrawableGameComponent&&(this.drawables.push(t),this.assetLoaded&&t.loadContent()))},Atlantis.GameComponentCollection.prototype.remove=function(t){var e=this.components.indexOf(t);return e>-1?(this.components.splice(e,1),t instanceof Atlantis.DrawableGameComponent&&(e=this.drawables.indexOf(t),e>-1&&this.drawables.splice(e,1)),!0):!1},Atlantis.GameComponentCollection.prototype.get=function(t){var e=null,i=this.components.indexOf(gameComponent);return i>-1&&(e=this.components[t]),null};var Atlantis=window.Atlantis||{};Atlantis.GameTime=function(){this.reset()},Atlantis.GameTime.prototype.reset=function(){this.elapsedTime=0,this.totalGameTime=0,this.currentTime=+new Date,this.fps=0},Atlantis.GameTime.prototype.update=function(){var t=+new Date;this.elapsedTime=t-this.currentTime,this.totalGameTime+=this.elapsedTime,this.fps=1e3/(t-this.currentTime),this.currentTime=t},Atlantis.GameTime.prototype.getElapsedTime=function(){return this.elapsedTime},Atlantis.GameTime.prototype.getTotalGameTime=function(){return this.totalGameTime},Atlantis.GameTime.prototype.getFPS=function(){return this.fps};var Atlantis=window.Atlantis||{};Atlantis.MathHelper={Pi:Math.PI,PiOver2:Math.PI/2,PiOver4:Math.PI/4,TwoPi:2*Math.PI,clamp:function(t,e,i){return t=t>i?i:t,t=e>t?e:t},distance:function(t,e){return Math.abs(t-e)},lerp:function(t,e,i){return i=0>i?0:i,i=i>1?1:i,t+(e-t)*i},toDegrees:function(t){return t*(180/Math.PI)},toRadians:function(t){return t*(Math.PI/180)},isPowerOfTwo:function(t){return t>0&&0==(t&t-1)}};var Atlantis=Atlantis||{};Atlantis.Rectangle=function(t,e,i,n){t instanceof Atlantis.Rectangle?(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height):(this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0)},Atlantis.Rectangle.prototype.add=function(t){this.x+=t.x,this.y+=t.y,this.width+=t.width,this.height+=t.height},Atlantis.Rectangle.prototype.divide=function(t){this.x/=t.x,this.y/=t.y,this.width/=t.width,this.height/=t.height},Atlantis.Rectangle.prototype.multiply=function(t){this.x*=t.x,this.y*=t.y,this.width*=t.width,this.height*=t.height},Atlantis.Rectangle.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y,this.width-=t.width,this.height-=t.height},Atlantis.Rectangle.prototype.contains=function(t,e){return t instanceof Atlantis.Rectangle?this.x<=t.x&&t.getRight()<=this.getRight()&&this.y<=t.y&&t.getBottom()<=this.getBottom():this.x<=t&&t<this.getRight()&&this.y<=e&&e<this.getBottom()},Atlantis.Rectangle.prototype.intersects=function(t){return t.getLeft()<this.getRight()&&this.getLeft()<t.getRight()&&t.getTop()<this.getBottom()&&this.getTop()<t.getBottom()},Atlantis.Rectangle.prototype.toString=function(){return["x: ",this.x," y: ",this.y," width: ",this.width," height: ",this.height].toString()},Atlantis.Rectangle.prototype.toVector2=function(){return new Atlantis.Vector2(this.x,this.y)},Atlantis.Rectangle.prototype.toPoint=function(){return new Atlantis.Point(this.x,this.y)},Atlantis.Rectangle.prototype.getTop=function(){return this.y},Atlantis.Rectangle.prototype.getBottom=function(){return this.y+this.height},Atlantis.Rectangle.prototype.getLeft=function(){return this.x},Atlantis.Rectangle.prototype.getRight=function(){return this.x+this.width},Atlantis.Rectangle.prototype.getCenter=function(){return new Atlantis.Point(this.x+this.width/2,this.y+this.height/2)},Atlantis.Rectangle.prototype.getWidth=function(){return this.width},Atlantis.Rectangle.prototype.getHeight=function(){return this.height},Atlantis.Rectangle.prototype.getTopCenter=function(){return new Atlantis.Vector2(this.x+this.width/2,this.y)},Atlantis.Rectangle.prototype.getBottomCenter=function(){return new Atlantis.Vector2(this.x+this.width/2,this.y+this.height)},Atlantis.Rectangle.prototype.getLeftCenter=function(){return new Atlantis.Vector2(this.x,this.y+this.height/2)},Atlantis.Rectangle.prototype.getRightCenter=function(){return new Atlantis.Vector2(this.x+this.width,this.y+this.height/2)},Atlantis.Rectangle.prototype.set=function(t,e,i,n){t instanceof Atlantis.Rectangle?(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height):(this.x=t,this.y=e,this.width=i,this.height=n)},Atlantis.Rectangle.prototype.setPosition=function(t,e){this.x=t,this.y=e},Atlantis.Rectangle.prototype.setSize=function(t,e){this.width=t,this.height=e},Atlantis.Rectangle.prototype.toString=function(){return["x: ",this.x," y: ",this.y," width: ",this.width," height: ",this.height].join("")};var Atlantis=window.Atlantis||{};Atlantis.Matrix=function(t){if(t instanceof Atlantis.Matrix){var t=t.toArray();this.set(t)}else t instanceof Array&&16==t.length?this.set(t):(this.M11=0,this.M12=0,this.M13=0,this.M14=0,this.M21=0,this.M22=0,this.M23=0,this.M24=0,this.M31=0,this.M32=0,this.M33=0,this.M34=0,this.M41=0,this.M42=0,this.M43=0,this.M44=0)},Atlantis.Matrix.prototype.set=function(t){16==t.length&&(this.M11=t[0],this.M12=t[1],this.M13=t[2],this.M14=t[3],this.M21=t[4],this.M22=t[5],this.M23=t[6],this.M24=t[7],this.M31=t[8],this.M32=t[9],this.M33=t[10],this.M34=t[11],this.M41=t[12],this.M42=t[13],this.M43=t[14],this.M44=t[15])},Atlantis.Matrix.prototype.getIdentityValues=function(){var t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return t},Atlantis.Matrix.prototype.getZeroValues=function(){for(var t=[],e=0;16>e;e++)t.push(0);return t},Atlantis.Matrix.prototype.setIdentity=function(){this.set(this.getIdentityValues())},Atlantis.Matrix.getMatrixIdentity=function(){var t=new Atlantis.Matrix;return t.setIdentity(),t},Atlantis.Matrix.prototype.toArray=function(){var t=[];return t.push(this.M11),t.push(this.M12),t.push(this.M13),t.push(this.M14),t.push(this.M21),t.push(this.M22),t.push(this.M23),t.push(this.M24),t.push(this.M31),t.push(this.M32),t.push(this.M33),t.push(this.M34),t.push(this.M41),t.push(this.M42),t.push(this.M43),t.push(this.M44),t},Atlantis.Matrix.prototype.setLeft=function(t){this.M11=-t.x,this.M12=-t.y,this.M13=-t.z},Atlantis.Matrix.prototype.getLeft=function(){var t=new Atlantis.Vector3;return t.x=-this.M11,t.y=-this.M12,t.z=-this.M13,t},Atlantis.Matrix.prototype.setRight=function(t){this.M11=t.x,this.M12=t.y,this.M13=t.z},Atlantis.Matrix.prototype.getRight=function(){var t=new Atlantis.Vector3;return t.x=this.M11,t.y=this.M12,t.z=this.M13,t},Atlantis.Matrix.prototype.setUp=function(t){this.M21=t.x,this.M22=t.y,this.M23=t.z},Atlantis.Matrix.prototype.getUp=function(){var t=new Atlantis.Vector3;return t.x=this.M21,t.y=this.M22,t.z=this.M23,t},Atlantis.Matrix.prototype.setDown=function(t){this.M21=-t.x,this.M22=-t.y,this.M23=-t.z},Atlantis.Matrix.prototype.getDown=function(){var t=new Atlantis.Vector3;return t.x=-this.M21,t.y=-this.M22,t.z=-this.M23,t},Atlantis.Matrix.prototype.setBackward=function(t){this.M31=t.x,this.M32=t.y,this.M33=t.z},Atlantis.Matrix.prototype.getBackward=function(){var t=new Atlantis.Vector3;return t.x=this.M31,t.y=this.M32,t.z=this.M33,t},Atlantis.Matrix.prototype.setForward=function(t){this.M31=-t.x,this.M32=-t.y,this.M33=-t.z},Atlantis.Matrix.prototype.getForward=function(){var t=new Atlantis.Vector3;return t.x=-this.M31,t.y=-this.M32,t.z=-this.M33,t},Atlantis.Matrix.prototype.setTranslation=function(t){this.M41=t.x,this.M42=t.y,this.M43=t.z},Atlantis.Matrix.prototype.add=function(t){for(var e=this.toArray(),i=t.toArray(),n=0;16>n;n++)e[n]+=i[n];this.set(e)},Atlantis.Matrix.add=function(t,e){var i=new Atlantis.Matrix(t);return i.add(e),i},Atlantis.Matrix.createRotationX=function(t){var e=getMatrixIdentity(),i=Math.cos(t),n=Math.sin(t);return e.M22=i,e.M23=n,e.M32=-n,e.M33=i,e},Atlantis.Matrix.createRotationY=function(t){var e=getMatrixIdentity(),i=Math.cos(t),n=Math.sin(t);return e.M11=i,e.M13=-n,e.M31=n,e.M33=i,e},Atlantis.Matrix.createRotationZ=function(t){var e=this.getMatrixIdentity(),i=Math.cos(t),n=Math.sin(t);return e.M11=i,e.M13=n,e.M31=-n,e.M33=i,e},Atlantis.Matrix.createScale=function(t,e,i){var n=Atlantis.Matrix.getMatrixIdentity();return n.M11=t,n.M22=e||t,n.M33=i||t,n},Atlantis.Matrix.createTranslation=function(t,e,i){var n=Atantis.Matrix.getMatrixIdentity();return n.M41=t,n.M42=e||t,n.M43=i||t,n},Atlantis.Matrix.createLookAt=function(t,e,i){var n=Atlantis.Vector3.subtract(e,t);n.normalize();var s=Atlantis.Vector3.cross(i,n);s.normalize();var a=Atlantis.Vector3.cross(n,s);a.normalize();var r=Atlantis.Matrix.getMatrixIdentity();return r.M11=s.x,r.M21=s.y,r.M31=s.z,r.M12=a.x,r.M22=a.y,r.M32=a.z,r.M13=n.x,r.M23=n.y,r.M33=n.z,r.M41=-Atlantis.Vector3.dot(s,t),r.M42=-Atlantis.Vector3.dot(a,t),r.M43=-Atlantis.Vector3.dot(n,t),r},Atlantis.Matrix.createOrthographic=function(t,e,i,n){var s=new Matrix;return s.M11=2/t,s.M12=s.M13=s.M14=0,s.M22=2/e,s.M21=s.M23=s.M24=0,s.M33=1/(i-n),s.M31=s.M32=s.M34=0,s.M41=s.M42=0,s.M43=i/(i-n),s.M44=1,s},Atlantis.Matrix.createOrthographicOffCenter=function(t,e,i,n,s,a){var r=new Atlantis.Matrix;return r.M11=2/(e-t),r.M12=0,r.M13=0,r.M14=0,r.M21=0,r.M22=2/(n-i),r.M23=0,r.M24=0,r.M31=0,r.M32=0,r.M33=1/(s-a),r.M34=0,r.M41=(t+e)/(t-e),r.M42=(n+i)/(i-n),r.M43=s/(s-a),r.M44=1,r},Atlantis.Matrix.createPerspectiveFieldOfView=function(t,e,i,n){var s=1/Math.tan(.5*t),a=s/e,r=i/a,o=i/s;return Atlantis.Matrix.createPerspectiveOffCenter(-r,r,-o,o,i,n)},Atlantis.Matrix.createPerspetiveFieldOfViewRH=function(t,e,i,n){var s=1/Math.tan(.5*t),a=s/e,r=i/a,o=i/s;return Matrix.createPerspectiveOffCenterRH(-r,r,-o,o,i,n)},Atlantis.Matrix.createPerspectiveOffCenter=function(t,e,i,n,s,a){var r=a/(a-s),o=new Atlantis.Matrix;return o.M11=2*s/(e-t),o.M22=2*s/(n-i),o.M31=(t+e)/(t-e),o.M32=(n+i)/(i-n),o.M33=r,o.M34=1,o.M43=-s*r,o},Atlantis.Matrix.createPerspectiveOffCenterRH=function(t,e,i,n,s,a){var r=createPerspectiveOffCenter(t,e,i,n,s,a);return r.M31*=-1,r.M32*=-1,r.M33*=-1,r.M34*=-1,r},Atlantis.Matrix.prototype.invert=function(){var t=this.M31*this.M42-this.M32*this.M41,e=this.M31*this.M43-this.M33*this.M41,i=this.M34*this.M41-this.M31*this.M44,n=this.M32*this.M43-this.M33*this.M42,s=this.M34*this.M42-this.M32*this.M44,a=this.M33*this.M44-this.M34*this.M43,r=this.M22*a+this.M23*s+this.M24*n,o=this.M21*a+this.M23*i+this.M24*e,h=this.M21*-s+this.M22*i+this.M24*t,c=this.M21*n+this.M22*-e+this.M23*t,l=this.M11*r-this.M12*o+this.M13*h-this.M14*c;if(0==Math.abs(l))return void this.set(this.getZeroValues());l=1/l;var u=this.M11*this.M22-this.M12*this.M21,p=this.M11*this.M23-this.M13*this.M21,d=this.M14*this.M21-this.M11*this.M24,f=this.M12*this.M23-this.M13*this.M22,M=this.M14*this.M22-this.M12*this.M24,A=this.M13*this.M24-this.M14*this.M23,y=this.M12*a+this.M13*s+this.M14*n,g=this.M11*a+this.M13*i+this.M14*e,m=this.M11*-s+this.M12*i+this.M14*t,x=this.M11*n+this.M12*-e+this.M13*t,w=this.M42*A+this.M43*M+this.M44*f,v=this.M41*A+this.M43*d+this.M44*p,_=this.M41*-M+this.M42*d+this.M44*u,V=this.M41*f+this.M42*-p+this.M43*u,b=this.M32*A+this.M33*M+this.M34*f,z=this.M31*A+this.M33*d+this.M34*p,S=this.M31*-M+this.M32*d+this.M34*u,B=this.M31*f+this.M32*-p+this.M33*u;this.M11=+r*l,this.M12=-y*l,this.M13=+w*l,this.M14=-b*l,this.M21=-o*l,this.M22=+g*l,this.M23=-v*l,this.M24=+z*l,this.M31=+h*l,this.M32=-m*l,this.M33=+_*l,this.M34=-S*l,this.M41=-c*l,this.M42=+x*l,this.M43=-V*l,this.M44=+B*l},Atlantis.Matrix.invert=function(t){var e=new Matrix(t);return e.invert(),e},Atlantis.Matrix.createWorld=function(t,e,i){{var n=new Atlantis.Matrix,s=Atlantis.Vector3.cross(e,i),a=Atlantis.Vector3.cross(s,e);Atlantis.Vector3.normalize(e)}return s.normalize(),a.normalize(),n.setTranslation(t),n.M44=1,n},Atlantis.Matrix.prototype.multiply=function(t){var e=this.M11*t.M11+this.M12*t.M21+this.M13*t.M31+this.M14*t.M41,i=this.M11*t.M12+this.M12*t.M22+this.M13*t.M32+this.M14*t.M42,n=this.M11*t.M13+this.M12*t.M23+this.M13*t.M33+this.M14*t.M43,s=this.M11*t.M14+this.M12*t.M24+this.M13*t.M34+this.M14*t.M44,a=this.M21*t.M11+this.M22*t.M21+this.M23*t.M31+this.M24*t.M41,r=this.M21*t.M12+this.M22*t.M22+this.M23*t.M32+this.M24*t.M42,o=this.M21*t.M13+this.M22*t.M23+this.M23*t.M33+this.M24*t.M43,h=this.M21*t.M14+this.M22*t.M24+this.M23*t.M34+this.M24*t.M44,c=this.M31*t.M11+this.M32*t.M21+this.M33*t.M31+this.M34*t.M41,l=this.M31*t.M12+this.M32*t.M22+this.M33*t.M32+this.M34*t.M42,u=this.M31*t.M13+this.M32*t.M23+this.M33*t.M33+this.M34*t.M43,p=this.M31*t.M14+this.M32*t.M24+this.M33*t.M34+this.M34*t.M44,d=this.M41*t.M11+this.M42*t.M21+this.M43*t.M31+this.M44*t.M41,f=this.M41*t.M12+this.M42*t.M22+this.M43*t.M32+this.M44*t.M42,M=this.M41*t.M13+this.M42*t.M23+this.M43*t.M33+this.M44*t.M43,A=this.M41*t.M14+this.M42*t.M24+this.M43*t.M34+this.M44*t.M44;this.M11=e,this.M12=i,this.M13=n,this.M14=s,this.M21=a,this.M22=r,this.M23=o,this.M24=h,this.M31=c,this.M32=l,this.M33=u,this.M34=p,this.M41=d,this.M42=f,this.M43=M,this.M44=A},Atlantis.Matrix.multiply=function(t,e,i){var n=new Atlantis.Matrix(t);return n.multiply(e),i instanceof Atlantis.Matrix&&n.multiply(i),n},Atlantis.Matrix.prototype.subtract=function(t){for(var e=this.toArray(),i=t.toArray(),n=0;16>n;n++)e[n]-=i[n];this.set(e)},Atlantis.Matrix.subtract=function(t,e){var i=new Atlantis.Matrix(t);return i.subtract(e),i},Atlantis.Matrix.prototype.toString=function(){for(var t=this.toArray(),e=[],i=0;16>i;i+=4)e.push("["),e.push(t[i]+" "),e.push(t[i+1]+" "),e.push(t[i+2]+" "),e.push(t[i+3]),e.push("] ");return e.join("")};var Atlantis=Atlantis||{};Atlantis.Quaternion=function(t,e,i,n){t instanceof Atlantis.Quaternion?(this.x=t.x,this.y=e.x,this.z=i.x,this.w=n.x):(this.x=t,this.y=e,this.z=i,this.w=n)},Atlantis.Quaternion.Identity=function(){return new Atlantis.Quaternion(0,0,0,1)},Atlantis.Quaternion.prototype.add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w},Atlantis.Quaternion.add=function(t,e){var i=new Quaternion(t);return i.add(e),i},Atlantis.Quaternion.prototype.conjugate=function(){this.x*=-1,this.y*=-1,this.z*=-1},Atlantis.Quaternion.conjugate=function(t){var e=new Quaternion(t);return e.conjugate(),e},Atlantis.Quaternion.createFromYawPitchRoll=function(t,e,i){var n=new Quaternion,s=.5*t,a=.5*e,r=.5*i,o=Math.sin(s),h=Math.cos(s),c=Math.sin(a),l=Math.cos(a),u=Math.sin(r),p=Math.cos(r);return n.x=h*c*p+o*l*u,n.y=o*l*p-h*c*u,n.z=h*l*u-o*c*p,n.w=h*l*p-o*c*u,n},Atlantis.Quaternion.prototype.toString=function(){return["x: ",this.x," y: ",this.y," z: ",this.z," w: ",this.w].join("")};var Atlantis=window.Atlantis||{};Atlantis.Point=function(t,e){t.x&&t.y?(this.x=t.x,this.y=t.y):(this.x=t?t:0,this.y=e?e:0)},Atlantis.Point.prototype.toString=function(){return["x: ",this.x," y: ",this.y].join("")},Atlantis.Vector2=function(t,e){t instanceof Atlantis.Vector2?(this.x=t.x,this.y=t.y):(this.x=t?t:0,this.y=e?e:0)},Atlantis.Vector2.Zero=function(){return new Vector2},Atlantis.Vector2.One=function(){return new Vector2(1,1)},Atlantis.Vector2.UnitX=function(){return new Vector2(1,0)},Atlantis.Vector2.UnitY=function(){return new Vector2(0,1)},Atlantis.Vector2.prototype.add=function(t){t instanceof Atlantis.Vector2?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=t)},Atlantis.Vector2.add=function(t,e){var i=new Atlantis.Vector2(t);return i.add(e),i},Atlantis.Vector2.prototype.subtract=function(t){t instanceof Atlantis.Vector2?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=t)},Atlantis.Vector2.subtract=function(t,e){var i=new Atlantis.Vector2(t);return i.subtract(e),i},Atlantis.Vector2.prototype.divide=function(t){t instanceof Atlantis.Vector2?(this.x/=t.x,this.y/=t.y):(this.x/=t,this.y/=t)},Atlantis.Vector2.divide=function(t,e){var i=new Atlantis.Vector2(t);return i.divide(e),i},Atlantis.Vector2.prototype.multiply=function(t){t instanceof Atlantis.Vector2?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t)},Atlantis.Vector2.multiply=function(t,e){var i=new Atlantis.Vector2(t);return i.multiply(e),i},Atlantis.Vector2.prototype.distance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},Atlantis.Vector2.distance=function(t,e){var i=new vector2(t);return i.distance(e)},Atlantis.Vector2.prototype.distance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},Atlantis.Vector2.dot=function(t,e){return t.x*e.x+t.y*e.y},Atlantis.Vector2.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Atlantis.Vector2.lerp=function(t,e){return new Atlantis.Vector2(Atlantis.MathHelper.lerp(t.x,e.x,amount),Atlantis.MathHelper.lerp(e.y,e.y,amount))},Atlantis.Vector2.min=function(t,e){var i=new Atlantis.Vector2;return i.x=t.x<e.x?t.x:e.x,i.y=t.y<e.y?t.y:e.y,i},Atlantis.Vector2.max=function(t,e){var i=new Vector2;return i.x=t.x>e.x?t.x:e.x,i.y=t.y>e.y?t.y:e.y,i},Atlantis.Vector2.prototype.negate=function(t){t instanceof Atlantis.Vector2?(this.x=-t.x,this.y=-t.y):(this.x=-t,this.y=-t)},Atlantis.Vector2.negate=function(t){var e=new Atlantis.Vector2(t);return e.x*=-1,e.y*=-1,e},Atlantis.Vector2.prototype.normalize=function(){var t=Atlantis.Vector3.distance(this,new Vector3);0!=t&&(t=1/t,this.set(this.x*t,this.y*t,this.z*t))},Atlantis.Vector2.normalize=function(t){var e=new vector2(t);return e.normalize(),e},Atlantis.Vector2.transform=function(t,e){var i=new Atlantis.Vector3(t.x*e.M11+t.y*e.M21+t.z*e.M31+e.M41,t.x*e.M12+t.y*e.M22+t.z*e.M32+e.M42,t.x*e.M13+t.y*e.M23+t.z*e.M33+e.M43);return i},Atlantis.Vector2.transformCoordinate=function(t,e){var i=new Atlantis.Vector4;return i.x=t.x*e.M11+t.y*e.M21+t.z*e.M31+e.M41,i.y=t.x*e.M12+t.y*e.M22+t.z*e.M32+e.M42,i.z=t.x*e.M13+t.y*e.M23+t.z*e.M33+e.M43,i.w=1/(t.x*e.M14+t.y*e.M24+t.z*e.M34+e.M44),new Vector3(i.x*i.w,i.y*i.w,i.z*i.w)},Atlantis.Vector2.prototype.set=function(t,e){this.x=t,this.y=e},Atlantis.Vector2.prototype.toString=function(){return["x: ",this.x," y: ",this.y].join("")};var Atlantis=window.Atlantis||{};Atlantis.Vector3=function(t,e,i){t instanceof Atlantis.Vector3?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0)},Atlantis.Vector3.Zero=function(){return new Atlantis.Vector3(0,0,0)},Atlantis.Vector3.One=function(){return new Atlantis.Vector3(1,1,1)},Atlantis.Vector3.UnitX=function(){return new Atlantis.Vector3(1,0,0)},Atlantis.Vector3.UnitY=function(){return new Atlantis.Vector3(0,1,0)},Atlantis.Vector3.UnitZ=function(){return new Atlantis.Vector3(0,0,1)},Atlantis.Vector3.Up=function(){return new Atlantis.Vector3(0,1,0)},Atlantis.Vector3.Down=function(){return new Atlantis.Vector3(0,-1,0)},Atlantis.Vector3.Right=function(){return new Atlantis.Vector3(1,0,0)},Atlantis.Vector3.Left=function(){return new Atlantis.Vector3(-1,0,0)},Atlantis.Vector3.Forward=function(){return new Atlantis.Vector3(0,0,-1)},Atlantis.Vector3.Backward=function(){return new Atlantis.Vector3(0,0,1)},Atlantis.Vector3.prototype.add=function(t){t instanceof Atlantis.Vector3?(this.x+=t.x,this.y+=t.y,this.z+=t.z):(this.x+=t,this.y+=t,this.z+=t)},Atlantis.Vector3.add=function(t,e){var i=new Vector3(t);return i.add(e),i},Atlantis.Vector3.prototype.subtract=function(t){t instanceof Atlantis.Vector3?(this.x-=t.x,this.y-=t.y,this.z-=t.z):(this.x-=t,this.y-=t,this.z-=t)},Atlantis.Vector3.subtract=function(t,e){var i=new Atlantis.Vector3(t);return i.subtract(e),i},Atlantis.Vector3.prototype.divide=function(t){0!=t.x&&(this.x/=t.x),0!=t.y&&(this.y/=t.y),0!=t.z&&(this.z/=t.z)},Atlantis.Vector3.divide=function(t,e){var i=new Atlantis.Vector3(t);return i.divide(e),i},Atlantis.Vector3.prototype.multiply=function(t){t instanceof Atlantis.Vector3?(this.x*=t.x,this.y*=t.y,this.z*=t.z):(this.x*=t,this.y*=t,this.z*=t)},Atlantis.Vector3.multiply=function(t,e){var i=new Atlantis.Vector3(t);return i.multiply(e),i},Atlantis.Vector3.cross=function(t,e){var i=new Atlantis.Vector3;return i.x=t.y*e.z-e.y*t.z,i.y=-(t.x*e.z-e.x*t.z),i.z=t.x*e.y-e.x*t.y,i},Atlantis.Vector3.distance=function(t,e){return Math.sqrt(Atlantis.Vector3.distanceSquared(t,e))},Atlantis.Vector3.distanceSquared=function(t,e){var i=t.x-e.x,n=t.y-e.y,s=t.z-e.z;return i*i+n*n+s*s},Atlantis.Vector3.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},Atlantis.Vector3.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Atlantis.Vector3.prototype.lerp=function(t,e){this.x=Atlantis.MathHelper.lerp(this.x,t.x,e),this.y=Atlantis.MathHelper.lerp(this.y,t.y,e),this.z=Atlantis.MathHelper.lerp(this.z,t.z,e)},Atlantis.Vector3.lerp=function(t,e){var i=Atlantis.MathHelper.lerp(t.x,e.x,amount),n=Atlantis.MathHelper.lerp(t.y,e.y,amount),s=Atlantis.MathHelper.lerp(t.z,e.z,amount);return new Atlantis.Vector3(i,n,s)},Atlantis.Vector3.min=function(t,e){var i=new Atlantis.Vector3;return i.x=t.x<e.x?t.x:e.x,i.y=t.y<e.y?t.y:e.y,i.z=t.z<e.z?t.z:e.z,i},Atlantis.Vector3.max=function(t,e){var i=new Atlantis.Vector3;return i.x=t.x>e.x?t.x:e.x,i.y=t.y>e.y?t.y:e.y,i.z=t.z>e.z?t.z:e.z,i},Atlantis.Vector3.prototype.negate=function(){this.x*=-1,this.y*=-1,this.z*=-1},Atlantis.Vector3.negate=function(t){var e=new Atlantis.Vector3(t);return e.negate(),e},Atlantis.Vector3.prototype.normalize=function(){var t=distance(this,new Atlantis.Vector3);0!=t&&(t=1/t,this.set(this.x*t,this.y*t,this.z*t))},Atlantis.Vector3.normalize=function(t){var e=new Vector3(t);return e.normalize(),e},Atlantis.Vector3.transform=function(t,e){var i=new Vector3(t.x*e.M11+t.y*e.M21+t.z*e.M31+e.M41,t.x*e.M12+t.y*e.M22+t.z*e.M32+e.M42,t.x*e.M13+t.y*e.M23+t.z*e.M33+e.M43);return i},Atlantis.Vector3.transformCoordinate=function(t,e){var i=new Atlantis.Vector4;return i.x=t.x*e.M11+t.y*e.M21+t.z*e.M31+e.M41,i.y=t.x*e.M12+t.y*e.M22+t.z*e.M32+e.M42,i.z=t.x*e.M13+t.y*e.M23+t.z*e.M33+e.M43,i.w=1/(t.x*e.M14+t.y*e.M24+t.z*e.M34+e.M44),new Atlantis.Vector3(i.x*i.w,i.y*i.w,i.z*i.w)},Atlantis.Vector3.prototype.set=function(t,e,i){this.x=t,this.y=e,this.z=i},Atlantis.Vector3.prototype.toString=function(){return["x: ",this.x," y: ",this.y," z: ",this.z].join("")};var Atlantis=window.Atlantis||{};Atlantis.Vector4=function(t,e,i,n){t instanceof Atlantis.Vector4?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)},Atlantis.Vector4.prototype.lerp=function(t,e){this.x=Atlantis.MathHelper.lerp(this.x,t.x,e),this.y=Atlantis.MathHelper.lerp(this.y,t.y,e),this.z=Atlantis.MathHelper.lerp(this.z,t.z,e),this.w=Atlantis.MathHelper.lerp(this.w,t.w,e)},Atlantis.Vector4.lerp=function(t,e,i){var n=new Vector4(t);return n.lerp(e,i),n},Atlantis.Vector4.prototype.toString=function(){return["x: ",this.x," y: ",this.y," z: ",this.z," w: ",this.w].join("")};var Atlantis=window.Atlantis||{};Atlantis.KeyboardState=function(t){this.keys=[];for(var e=0,i=t.length;i>e;e++)this.keys.push(t[e])},Atlantis.KeyboardState.prototype.clone=function(){return new Atlantis.Input.KeyboardState(this.keys)},Atlantis.KeyboardState.prototype.isKeyDown=function(t){return this.keys[t]===!0},Atlantis.KeyboardState.prototype.isKeyUp=function(t){return this.keys[t]===!1},Atlantis.Keyboard=function(t){this.keys=[],this.maxKeys=t||130;for(var e=0;t>e;e++)this.keys[e]=!1;var i=this,n=function(t){Atlantis.Keyboard.preventDefault&&t.preventDefault(),i.keys[t.keyCode]="keydown"===t.type?!0:!1};document.addEventListener("keydown",n,!1),document.addEventListener("keyup",n,!1)},Atlantis.Keyboard.preventDefault=!1,Atlantis.Keyboard.prototype.getState=function(){return new Atlantis.KeyboardState(this.keys)};var Atlantis=window.Atlantis||{};Atlantis.ButtonState={Released:0,Pressed:1},Atlantis.MouseState=function(t,e,i,n){this.x=t,this.y=e,this.scrollWheelValue=i,this.leftButton=n[0],this.rightButton=n[2],this.middleButton=n[1]},Atlantis.MouseState.prototype.clone=function(){return new Atlantis.MouseState(this.x,this.y,this.scrollWheelValue,[this.leftButton,this.middleButton,this.rightButton])},Atlantis.Mouse=function(t){var t=t instanceof HTMLElement?t:document.body;this._x=0,this._y=0,this._scroll=0,this._buttons=[],this._buttons[0]=!1,this._buttons[1]=!1,this._buttons[2]=!1,this.preventDefault=!0;var e=this,i=function(){e._buttons[0]=!1,e._buttons[1]=!1,e._buttons[2]=!1},n=function(n){e._x=(n.pageX-t.offsetLeft)*Atlantis.Game.scaleFactor.x,e._y=(n.pageY-t.offsetTop)*Atlantis.Game.scaleFactor.y,"mousemove"!==n.type&&"pointermove"!==n.type&&(i(),e._buttons[n.button]="mousedown"===n.type||"pointerdown"===n.type?!0:!1)},s=function(t){e._scroll=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail))};window.PointerEvent?(t.addEventListener("pointerdown",n,!1),t.addEventListener("pointermove",n,!1),t.addEventListener("pointerup",n,!1)):(t.addEventListener("mousedown",n,!1),t.addEventListener("mousemove",n,!1),t.addEventListener("mouseup",n,!1)),t.addEventListener("mousewheel",s,!1),t.addEventListener("DOMMouseScroll",s,!1)},Atlantis.Mouse.prototype.getState=function(){return new Atlantis.MouseState(this._x,this._y,this._scroll,this._buttons)};var Atlantis=window.Atlantis||{};Atlantis.TouchLocationState={Invalid:1,Moved:2,Pressed:3,Released:4},Atlantis.TouchCollection=function(t){Array.call(this);for(var t=t||[],e=0,i=t.length;i>e;e++)this.push(new Atlantis.TouchPanelState(t[e]))},Atlantis.TouchCollection.prototype=Object.create(Array.prototype),Atlantis.TouchCollection.prototype.clone=function(){for(var t=[],e=0,i=this.length;i>e;e++)t.push(this[e].clone());return new Atlantis.TouchCollection(t)},Atlantis.TouchPanelState=function(t){this.state=t.touchState||Atlantis.TouchLocationState.Invalid,this.position=new Atlantis.Vector2(0|+t.x,0|+t.y)},Atlantis.TouchPanelState.prototype.clone=function(){return new Atlantis.TouchPanelState({touchState:this.state,x:this.position.x,y:this.position.y})},Atlantis.TouchPanel=function(t){this._states=[];var e=this,i=function(i,n){e._states[i]||(e._states[i]={x:0,y:0,touchState:Atlantis.TouchLocationState.Invalid}),n.touches?(e._states[i].x=n.touches[i].pageX-t.offsetLeft,e._states[i].y=n.touches[i].pageY-t.offsetTop):(e._states[i].x=n.clientX-t.offsetLeft,e._states[i].y=n.clientY-t.offsetTop),e._states[i].x*=Atlantis.Game.scaleFactor.x,e._states[i].y*=Atlantis.Game.scaleFactor.y,"pointerdown"==n.type||"touchstart"==n.type?e._states[i].touchState=Atlantis.TouchLocationState.Pressed:"pointermove"==n.type||"touchmove"==n.type?(n.preventDefault(),e._states[i].touchState=Atlantis.TouchLocationState.Moved):e._states[i].touchState="pointerup"==n.type||"touchend"==n.type?Atlantis.TouchLocationState.Released:Atlantis.TouchLocationState.Invalid},n=function(t){var n=t.touches.length;if(n||"touchend"!==t.type&&"touchcancel"!==t.type){e._states.length=n;for(var s=0;n>s;s++)i(s,t)}else for(var s=0,a=e._states.length;a>s;s++)e._states[s].touchState=Atlantis.TouchLocationState.Released},s=function(t){t.preventDefault(),i(0,t)
};window.PointerEvent?(t.addEventListener("pointerdown",s,!1),t.addEventListener("pointermove",s,!1),t.addEventListener("pointerend",s,!1),t.addEventListener("pointercancel",s,!1)):(t.addEventListener("touchstart",n,!1),t.addEventListener("touchmove",n,!1),t.addEventListener("touchend",n,!1),t.addEventListener("touchcancel",n,!1))},Atlantis.TouchPanel.prototype.getCapabilities=function(){return{hasTouch:!!("ontouchstart"in window)||!!("ongesturechange"in window)}},Atlantis.TouchPanel.prototype.getState=function(t){return"number"==typeof t?new Atlantis.TouchPanelState(this._states[t]?this._states[t]:{}):new Atlantis.TouchCollection(this._states)};var Atlantis=window.Atlantis||{};Atlantis.GamepadButton={A:0,B:1,X:2,Y:3,LeftShoulder:4,RightShoulder:5,LeftTrigger:6,RightTrigger:7,Select:8,Start:9,L3:10,R3:11,DPadUp:12,DPadDown:13,DPadLeft:14,DPadRight:15},Atlantis.GamepadAxis={Horizontal:0,Vertical:1,HorizontalRight:2,VerticalRight:3},Atlantis.GamepadState=function(t,e){if(this.axis=[],this.buttons=[],t)for(var i=0,n=t.length;n>i;i++)this.axis.push(t[i]);else for(var i=0;6>i;i++)this.axis.push(0);if(e)for(var i=0,n=e.length;n>i;i++)this.buttons.push(e[i]);else for(var i=0;15>i;i++)this.buttons.push(!1)},Atlantis.GamepadState.prototype.isButtonDown=function(t){return this.buttons[t]},Atlantis.GamepadState.prototype.isButtonUp=function(t){return!this.buttons[t]},Atlantis.GamepadState.prototype.getAxis=function(t){return this.axis[t]},Atlantis.Gamepad=function(){Atlantis.GameComponent.call(this),this._gamepads=[],this._states={}},Atlantis.Gamepad.prototype=Object.create(Atlantis.GameComponent.prototype),Atlantis.Gamepad.prototype.initialize=function(){var t=this;navigator.getGamepads=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads,this._gamepadsSupported=navigator.getGamepads?!0:!1,window.addEventListener("gamepadconnected",function(e){t._addGamepad(e.gamepad)},!1),window.addEventListener("gamepaddisconnected",function(e){t._removeGamepad(e.gamepad)},!1)},Atlantis.Gamepad.prototype._addGamepad=function(t){this._gamepads.push(t),this._states[t.index]=new Atlantis.GamepadState},Atlantis.Gamepad.prototype._removeGamepad=function(t){delete this._gamepads[t.index],delete this._states[t.index]},Atlantis.Gamepad.prototype._updateGamepads=function(){for(var t=navigator.getGamepads(),e=0;e<t.length;e++)t[e]&&-1===this._gamepads.indexOf(t[e])&&this._addGamepad(t[e])},Atlantis.Gamepad.prototype.update=function(){if(this._gamepadsSupported){this._updateGamepads();for(var t=0,e=this._gamepads.length;e>t;t++){for(var i=this._gamepads[t],n=0,s=i.buttons.length;s>n;n++){var a=i.buttons[n],r=1===a?!0:!1;"object"==typeof a&&(r=a.pressed,a=a.value),this._states[i.index].buttons[n]=r}for(var n=0,s=i.axes.length;s>n;n++)this._states[i.index].axis[n]=0|+i.axes[n]}}},Atlantis.Gamepad.prototype.getState=function(t){var t="undefined"!=typeof t?t:0;return this._gamepads[t]?new Atlantis.GamepadState(this._states[t].axis,this._states[t].buttons):new Atlantis.GamepadState};var Atlantis=window.Atlantis||{};Atlantis.Keys={BackSpace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Pause:19,Escape:27,Space:32,Home:36,End:35,Left:37,Up:38,Right:39,Down:40,Suppr:46,PageUp:33,PageDown:34,Insert:45,Num0:48,Num1:49,Num2:50,Num3:51,Num4:52,Num5:53,Num6:54,Num7:55,Num8:56,Num9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Super:91,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};var Atlantis=window.Atlantis||{};Atlantis.ScaleMode={ScaleToFit:0,ConserveAspectRatio:1,NoScaleCenter:2},Atlantis.GraphicsDevice=function(t,e,i){var i=i||{};if(i.webGL=i.webGL?!0:!1,i.width=t,i.height=e,this.preferredBackBufferWidth=i.backBufferWidth||t,this.preferredBackBufferHeight=i.backBufferHeight||e,this.viewport=new Atlantis.Rectangle,this.scaleMode=Atlantis.ScaleMode.ScaleToFit,t&&e){this._frontBuffer=new Atlantis.RenderTarget(t,e,i.webGL,i.canvas),this._fbContext=this._frontBuffer.getContext(),this._backBuffer=new Atlantis.RenderTarget(this.preferredBackBufferWidth,this.preferredBackBufferHeight,i.webGL),this._bbCanvas=this._backBuffer.getCanvas();var n=this._frontBuffer.getCanvas();n.style.msTouchAction="none",n.style.backgroundColor="#000",n.id=n.id?n.id:"AtlantisCanvas",this.viewport.setSize(this.preferredBackBufferWidth,this.preferredBackBufferHeight)}},Atlantis.GraphicsDevice.prototype.applyChanges=function(){this._backBuffer.setSize(this.preferredBackBufferWidth,this.preferredBackBufferHeight);var t=this._frontBuffer.getWidth(),e=this._frontBuffer.getHeight();if(this.scaleMode==Atlantis.ScaleMode.ScaleToFit||t===this.preferredBackBufferWidth&&e===this.preferredBackBufferHeight)this.viewport.set(0,0,t,e);else if(this.scaleMode==Atlantis.ScaleMode.ConserveAspectRatio){var i=0;this.preferredBackBufferWidth>this.preferredBackBufferHeight?(i=this.preferredBackBufferWidth/t,this.viewport.width=t,this.viewport.height=this.preferredBackBufferHeight*(1+i)):(i=this.preferredBackBufferHeight/e,this.viewport.width=this.preferredBackBufferWidth*(1+i),this.viewport.height=e),this.viewport.x=t/2-this.viewport.width/2,this.viewport.y=e/2-this.viewport.height/2}else this.scaleMode==Atlantis.ScaleMode.NoScaleCenter&&(this.viewport.x=t/2-this.preferredBackBufferWidth/2,this.viewport.y=e/2-this.preferredBackBufferHeight/2,this.viewport.width=this.preferredBackBufferWidth,this.viewport.height=this.preferredBackBufferHeight);Atlantis.Game.scaleFactor.x=this.preferredBackBufferWidth/this._frontBuffer.getWidth(),Atlantis.Game.scaleFactor.y=this.preferredBackBufferHeight/this._frontBuffer.getHeight(),Atlantis.notify(Atlantis.events.ResolutionChanged,{width:this.preferredBackBufferWidth,height:this.preferredBackBufferHeight})},Atlantis.GraphicsDevice.prototype.getBackBuffer=function(){return this._backBuffer},Atlantis.GraphicsDevice.prototype.getFrontBuffer=function(){return this._frontBuffer},Atlantis.GraphicsDevice.prototype.clear=function(t){this._backBuffer.clear(t),this._frontBuffer.clear(t)},Atlantis.GraphicsDevice.prototype.present=function(){this._fbContext.drawImage(this._bbCanvas,this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height)},Atlantis.GraphicsDevice.prototype.toggleFullscreen=function(t){var t=t instanceof HTMLElement?t:this._frontBuffer.getCanvas(),e=this.isFullscreen();t.requestFullScreen=t.requestFullScreen||t.webkitRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||function(){return!1},document.cancelFullScreen=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||function(){return!1},e?document.cancelFullScreen():t.requestFullScreen()},Atlantis.GraphicsDevice.prototype.isFullscreen=function(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||!1};var Atlantis=window.Atlantis||{};Atlantis.SpriteSortMode={BackToFront:0,FrontToBack:1,Immediate:2},Atlantis.SpriteEffect={None:0,FlipHorizontaly:1,FlipVerticaly:2},Atlantis.BatchItemType={Texture:0,Font:1},Atlantis.SpriteBatch=function(t){this._graphicsDevice=t,this._renderTarget=new Atlantis.RenderTarget(t.preferredBackBufferWidth,t.preferredBackBufferHeight,!1),this._viewport=new Atlantis.Rectangle(0,0,t.preferredBackBufferWidth,t.preferredBackBufferHeight),this._canvas=this._renderTarget.getCanvas(),this._context=this._renderTarget.getContext(),this._batchItems=[],this._batchStarted=!1,this._spriteSortMode=Atlantis.SpriteSortMode.Immediate,this._transformMatrix=null,this._cacheColoredTextures=[],document.addEventListener(Atlantis.events.ResolutionChanged,this._onResize.bind(this),!1)},Atlantis.SpriteBatch.prototype._onResize=function(t){this._renderTarget.setSize(t.width,t.height),this._viewport.width=t.width,this._viewport.height=t.height},Atlantis.SpriteBatch.prototype.begin=function(t,e){this._batchStarted||(this._batchStarted=!0,this._transformMatrix=e&&6===e.length?e:null,this._spriteSortMode="number"==typeof t?t:Atlantis.SpriteSortMode.Immediate,this._renderTarget.clear())},Atlantis.SpriteBatch.prototype._sortBatchItem=function(t,e){return this._spriteSortMode===Atlantis.SpriteSortMode.BackToFront?+t.layerDepth>+e.layerDepth?1:+t.layerDepth<+e.layerDepth?-1:0:+t.layerDepth<+e.layerDepth?1:+t.layerDepth>+e.layerDepth?-1:0},Atlantis.SpriteBatch.prototype.end=function(){if(this._batchStarted){var t={};this._spriteSortMode!==Atlantis.SpriteSortMode.Immediate&&(this._batchItems=this._batchItems.sort(this._sortBatchItem.bind(this)));var e,i,n,s,a,r,o=new Atlantis.Rectangle;this._transformMatrix&&(this._context.save(),this._context.transform(this._transformMatrix[0],this._transformMatrix[1],this._transformMatrix[2],this._transformMatrix[3],this._transformMatrix[4],this._transformMatrix[5]));for(var h=0,c=this._batchItems.length;c>h;h++)t=this._batchItems[h],e=t.destinationRectangle.x,i=t.destinationRectangle.y,n=t.destinationRectangle.width,s=t.destinationRectangle.height,o.set(e,i,n,s),this._viewport.intersects(o)&&(a=t.origin?t.origin.x:0,r=t.origin?t.origin.y:0,this._context.save(),this._context.translate(t.destinationRectangle.x,t.destinationRectangle.y),this._context.translate(a,r),e=-a,i=-r,t.rotation&&this._context.rotate(t.rotation),t.scale&&this._context.scale(t.scale.x,t.scale.y),t.effect!=Atlantis.SpriteEffect.None&&(t.effect==Atlantis.SpriteEffect.FlipHorizontaly?(this._context.scale(-1,1),e-=t.destinationRectangle.width):(this._context.scale(1,-1),i-=t.destinationRectangle.height)),t.type===Atlantis.BatchItemType.Texture?t.color&&t.texture2D.width&&t.texture2D.height?Atlantis.SpriteBatch.drawTexture(this._context,this._colorizeTexture(t.texture2D,t.color),e,i,n,s,t.sourceRectangle):Atlantis.SpriteBatch.drawTexture(this._context,t.texture2D,e,i,n,s,t.sourceRectangle):t.type===Atlantis.BatchItemType.Font&&(this._context.fillStyle=t.color,this._context.font=t.spriteFont.getFont(),this._context.fillText(t.text,e,i)),this._context.restore());this._transformMatrix&&this._context.restore(),this._graphicsDevice.getBackBuffer().getContext().drawImage(this._canvas,0,0,this._viewport.width,this._viewport.height),this._batchItems.length=0,this._batchStarted=!1}},Atlantis.SpriteBatch.drawTexture=function(t,e,i,n,s,a,r){r?t.drawImage(e,r.x,r.y,r.width,r.height,i,n,s,a):t.drawImage(e,i,n,s,a)},Atlantis.SpriteBatch.prototype.draw=function(t,e,i,n,s,a,r,o,h){this._batchStarted&&(e.width||(e.width=t.width,e.height=t.height),this._batchItems.push({type:Atlantis.BatchItemType.Texture,texture2D:t,sourceRectangle:i,destinationRectangle:e,color:n,rotation:s,origin:a,scale:r,effect:o?o:Atlantis.SpriteEffect.None,layerDepth:"number"==typeof h?h:0}))},Atlantis.SpriteBatch.prototype.drawString=function(t,e,i,n,s,a,r,o,h){this._batchStarted&&this._batchItems.push({type:Atlantis.BatchItemType.Font,spriteFont:t,text:e,destinationRectangle:{x:i.x,y:i.y,width:1,height:1},color:n,rotation:s,origin:a,scale:r,effect:o?o:Atlantis.SpriteEffect.None,layerDepth:"number"==typeof h?h:0})},Atlantis.SpriteBatch.prototype._colorizeTexture=function(t,e){var i=this._searchColoredTexture(t,e);if(!i){i=document.createElement("canvas"),i.width=t.width,i.height=t.height;var n=i.getContext("2d");n.drawImage(t,0,0);for(var s=n.getImageData(0,0,t.width,t.height),a=this._hexaToBytes(e),r=0,o=s.data.length;o>r;r+=4)s.data[r]=a.r|s.data[r],s.data[r+1]=a.g|s.data[r+1],s.data[r+2]=a.b|s.data[r+2],s.data[r+3]=a.a|s.data[r+3];n.putImageData(s,0,0),this._cacheColoredTextures.push({texture:t,color:e,canvas:i})}return i},Atlantis.SpriteBatch.prototype._hexaToBytes=function(t){var e=t.split("#")[1],i={r:0,g:0,b:0,a:0},n=e.length;return 3===n?(i.r=parseInt(e[0]+e[0],16),i.g=parseInt(e[1]+e[1],16),i.b=parseInt(e[2]+e[2],16)):6===n?(i.r=parseInt(e.slice(0,2),16),i.g=parseInt(e.slice(2,4),16),i.b=parseInt(e.slice(4,6),16)):8===n&&(i.r=parseInt(e.slice(0,2),16),i.g=parseInt(e.slice(2,4),16),i.b=parseInt(e.slice(4,6),16),i.a=parseInt(e.slice(6,8),16)),i},Atlantis.SpriteBatch.prototype._searchColoredTexture=function(t,e){for(var i=0,n=this._cacheColoredTextures.length,s=null;n>i&&null===s;)s=this._cacheColoredTextures[i].texture===t&&this._cacheColoredTextures[i].color===e?this._cacheColoredTextures[i].canvas:null,i++;return s};var Atlantis=window.Atlantis||{};Atlantis.RenderTarget=function(t,e,i,n){this._canvas=n,this._canvas||(this._canvas=document.createElement("canvas"),this.setSize(t,e)),this._context=null,this._context=i?this._canvas.getContext("webgl")||this._canvas.getContext("experimental-webgl"):this._canvas.getContext("2d"),this.isWebGLCanvas=function(){return i},this.setSize(t,e)},Atlantis.RenderTarget.prototype.setData=function(t){this._context.putImageData(t,0,0)},Atlantis.RenderTarget.prototype.getData=function(){var t=this._context.getImageData(0,0,this.viewport.width,this.viewport.height);return t},Atlantis.RenderTarget.prototype.getContext=function(){return this._context},Atlantis.RenderTarget.prototype.getCanvas=function(){return this._canvas},Atlantis.RenderTarget.prototype.getWidth=function(){return this._canvas.width},Atlantis.RenderTarget.prototype.getHeight=function(){return this._canvas.height},Atlantis.RenderTarget.prototype.setSize=function(t,e){this._canvas.width=t,this._canvas.height=e},Atlantis.RenderTarget.prototype.clear=function(t){this._is3DCanvas?(this._context.clearColor(t.r,t.g,t.b,t.a),this._context.enable(this._context.DEPTH_TEST),this._context.depthFunc(this._context.LEQUAL),this._context.clear(this._context.COLOR_BUFFER_BIT|this._context.DEPTH_BUFFER_BIT)):this._context.clearRect(0,0,this._canvas.width,this._canvas.height)},Atlantis.RenderTarget.prototype.saveAsPng=function(){return this._canvas.toDataURL("image/png")},Atlantis.RenderTarget.prototype.saveAsJpg=function(){return this._canvas.toDataURL("image/jpg")};var Atlantis=window.Atlantis||{};Atlantis.SpriteFont=function(t,e,i){this.fontName=t||"Arial",this.size=e||14,this.style=i||"normal"},Atlantis.SpriteFont.prototype.getFont=function(){return[this.style," ",this.size,"px ",this.fontName].join("")};var Atlantis=window.Atlantis||{};Atlantis.Preloader=function(t){this.screenWidth=t.graphicsDevice.preferredBackBufferWidth,this.screenHeight=t.graphicsDevice.preferredBackBufferHeight,this.screenWidthPerTwo=this.screenWidth/2,this.screenHeightPerTwo=this.screenHeight/2,this.logoRect={x:this.screenWidth-96-15,y:this.screenHeight-96-15,width:96,height:96},this.spriteFont=new Atlantis.SpriteFont("Arial",32)},Atlantis.Preloader.prototype.onProgress=function(t,e){var i=["Game loading ",e.progress,"%"].join(""),n=t.measureText(i),s=this.screenWidthPerTwo-n.width/2,a=this.screenHeightPerTwo-this.spriteFont.size/2;t.clearRect(0,0,this.screenWidth,this.screenHeight),t.fillStyle="#fafafa",t.font=this.spriteFont.getFont(),t.fillText(i,s,a)};var Atlantis=window.Atlantis||{};Atlantis.Game=function(){function t(){i.gameTime.update(),i.update(i.gameTime),i.draw(i.gameTime),i.afterDraw(i.gamepad),i._paused||requestAnimationFrame(t)}function e(t){i.width=t.target.innerWidth,i.height=t.target.innerHeight,i.canvas.width=i.width,i.canvas.height=i.height}var i=null,n=function(t,e,n,s){this.settings=s||{},this.settings.webGL=!1;var t=t||window.innerWidth,e=e||window.innerHeight;this.domElement=document.body,typeof n instanceof HTMLElement?this.domElement=n:"string"==typeof n&&("."===n[0]?(n=n.replace(".",""),this.domElement=document.getElementsByClassName(n)[0]):(n="#"===n[0]?n.replace("#",""):n,this.domElement=document.getElementById(n))),this.domElement instanceof HTMLCanvasElement&&(this.settings.canvas=this.domElement),this.gameTime=new Atlantis.GameTime,this.components=new Atlantis.GameComponentCollection,this.content=new Atlantis.ContentManager,this.keyboard=null,this.mouse=null,this.touchPanel=null,this.gamepad=null,this.preloader=null,this.graphicsDevice=new Atlantis.GraphicsDevice(t,e,this.settings),this.canvas=this.settings.canvas,this.frontBuffer=null,this.context=null,this.initialized=!1,this._paused=!1,i=this};return n.version="0.2a",n.scaleFactor=new Atlantis.Vector2(1,1),n.prototype._internalIntialize=function(){this.frontBuffer=this.graphicsDevice.getFrontBuffer(),this.context=this.frontBuffer.getContext(),this.canvas||(this.canvas=this.frontBuffer.getCanvas()),this.keyboard=new Atlantis.Keyboard,this.mouse=new Atlantis.Mouse(this.frontBuffer.getCanvas()),this.touchPanel=new Atlantis.TouchPanel(this.frontBuffer.getCanvas()),this.gamepad=new Atlantis.Gamepad,this.components.add(this.gamepad),this.settings.resizeEnabled&&window.addEventListener("resize",e,!1),this.domElement&&!this.settings.canvas&&this.domElement.appendChild(this.frontBuffer.getCanvas())},n.prototype.initialize=function(){this.components.initialize()},n.prototype.loadContent=function(){this.components.loadContent(this.content)},n.prototype.unloadContent=function(){this.components.unloadContent()},n.prototype.update=function(t){this.components.update(t)},n.prototype.draw=function(t,e){this.settings.autoClear&&this.graphicsDevice.clear(),this.components.draw(t,e)},n.prototype.afterDraw=function(){this.graphicsDevice.present()},n.prototype.run=function(){var e=this,i=function(){e.initialize(),e.initialized=!0,e.loadContent(),t()};this.initialized||(this.initialized=!0,this._internalIntialize(),this.content.preloader.length?(null===this.preloader&&(this.preloader=new Atlantis.Preloader(this)),this.content.preload(function(t){this.preloader.onProgress(this.context,t)}.bind(this),function(){this.context.clearRect(0,0,this.frontBuffer.getWidth(),this.frontBuffer.getHeight()),i()}.bind(this))):i())},n.prototype.pause=function(){cancelAnimationFrame(t),this._paused=!0},n.prototype.resume=function(){this._paused&&(this._paused=!1,t())},n}();