{"version":3,"sources":["atlantis.framework.min.js"],"names":["Atlantis","window","events","ContentPreloading","ResolutionChanged","ajax","parameters","params","url","callback","success","xhr","XMLHttpRequest","method","open","onreadystatechange","readyState","status","responseText","send","data","gUrl","join","notify","name","event","document","createEvent","initEvent","Object","i","dispatchEvent","isMobileDevice","navigator","userAgent","match","_createProperty","object","property","fn0","fn1","defineProperty","get","set","enumerable","configurable","ContentManager","rootDirectory","this","_assets","preloader","PreloadTimerInterval","prototype","preload","progressCallback","doneCallback","countAssets","length","nbLoaded","onLoaded","asset","load","that","progress","timer","setInterval","clearInterval","assetName","temp","split","ext","loadImage","loadAudio","loadVideo","loadResource","imageName","image","Image","onload","style","position","left","body","appendChild","removeChild","src","audioName","audio","createElement","controls","videoName","video","resourceUrl","response","result","JSON","parse","dispose","GameComponent","game","enabled","initialized","initialize","update","gameTime","isEnabled","isInitialized","setEnabled","DrawableGameComponent","call","visible","assetLoaded","loadContent","unloadContent","draw","context","isVisible","setVisible","GameComponentCollection","components","drawables","content","l","add","gameComponent","indexOf","push","remove","index","splice","GameTime","reset","elapsedTime","totalGameTime","currentTime","Date","fps","now","getElapsedTime","getTotalGameTime","getFPS","MathHelper","Pi","Math","PI","PiOver2","PiOver4","TwoPi","clamp","value","min","max","distance","value1","value2","abs","hermite","tangent1","tangent2","amount","sCubed","sSquared","lerp","smoothStep","toDegrees","radians","toRadians","degrees","isPowerOfTwo","Rectangle","x","y","width","height","rectangle","divide","fromRectangle","multiply","subtract","contains","getRight","getBottom","intersects","getLeft","getTop","toString","toVector2","Vector2","toPoint","Point","getCenter","getWidth","getHeight","getTopCenter","getBottomCenter","getLeftCenter","getRightCenter","setPosition","setSize","clone","Matrix","values","toArray","Array","M11","M12","M13","M14","M21","M22","M23","M24","M31","M32","M33","M34","M41","M42","M43","M44","getIdentityValues","getZeroValues","setIdentity","getMatrixIdentity","matrix","setLeft","vector","z","Vector3","setRight","setUp","getUp","setDown","getDown","setBackward","getBackward","setForward","getForward","setTranslation","mValues","eValues","matA","matB","createRotationX","rotation","cos","sin","createRotationY","createRotationZ","createScale","sx","sy","sz","createTranslation","createLookAt","target","upVector","zAxis","normalize","xAxis","cross","yAxis","dot","createOrthographic","zNear","zFar","createOrthographicOffCenter","right","bottom","top","createPerspectiveFieldOfView","fov","aspect","yScale","tan","xScale","halfWidth","halfHeight","createPerspectiveOffCenter","createPerspetiveFieldOfViewRH","createPerspectiveOffCenterRH","zRange","invert","b0","b1","b2","b3","b4","b5","d11","d12","d13","d14","det","a0","a1","a2","a3","a4","a5","d21","d22","d23","d24","d31","d32","d33","d34","d41","d42","d43","d44","mat","createWorld","forward","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","matrixA","matrixB","matrixC","builder","Quaternion","w","fromQuaternion","quaternion","Identity","quaternion1","quaternion2","conjugate","createFromYawPitchRoll","yaw","pitch","roll","halfYaw","halfPitch","halfRoll","sinYaw","cosYaw","sinPitch","cosPitch","sinRoll","cosRoll","fromVector","Zero","One","UnitX","UnitY","vec1","vec2","addToRef","subtractToRef","divideToRef","multiplyToRef","vector2","v1","v2","sqrt","lerpToRef","minToRef","maxToRef","negate","vec","normalizeToRef","reflect","normal","ReflectToRef","reflectToRef","val","smoothStepToRef","transform","transformToRef","transformNormal","transformNormalToRef","UnitZ","Up","Down","Right","Left","Forward","Backward","distanceSquared","dx","dy","dz","factor","transformCoordinate","Vector4","KeyboardState","keys","Input","isKeyDown","key","isKeyUp","Keyboard","maxKeys","onKeyStateChange","preventDefault","keyCode","type","addEventListener","getState","ButtonState","Released","Pressed","MouseState","scrollWheelValue","buttons","leftButton","rightButton","middleButton","Mouse","domElement","HTMLElement","_x","_y","_scroll","_buttons","resetButtonState","onMouseEvent","pageX","offsetLeft","Game","scaleFactor","pageY","offsetTop","button","onMouseScroll","wheelDelta","detail","TouchLocationState","Invalid","Moved","TouchCollection","touchStates","TouchPanelState","create","states","panelState","state","TouchPanel","_states","eventNames","up","down","cancel","move","lastEventType","isPointerEvent","wrapEvent","id","touches","clientX","clientY","onTouchHandler","onPointerHandler","maxTouchPoints","msMaxTouchPoints","PointerEvent","MSPointerEvent","getCapabilities","hasTouch","GamepadButton","A","B","X","Y","LeftShoulder","RightShoulder","LeftTrigger","RightTrigger","Select","Start","L3","R3","DPadUp","DPadDown","DPadLeft","DPadRight","GamepadAxis","Horizontal","Vertical","HorizontalRight","VerticalRight","GamepadState","axis","isButtonDown","isButtonUp","getAxis","Gamepad","_gamepads","getGamepads","webkitGetGamepads","msGetGamepads","webkitGamepads","_gamepadsSupported","_addGamepad","gamepad","_removeGamepad","_updateGamepads","gamepads","j","m","btnVal","pressed","axes","Keys","BackSpace","Tab","Enter","Shift","Control","Alt","Pause","Escape","Space","Home","End","Suppr","PageUp","PageDown","Insert","Num0","Num1","Num2","Num3","Num4","Num5","Num6","Num7","Num8","Num9","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","Z","Super","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","ScaleMode","ScaleToFit","ConserveAspectRatio","NoScaleCenter","GraphicsDevice","settings","preferredBackBufferWidth","backBufferWidth","preferredBackBufferHeight","backBufferHeight","disableSmoothing","forceDisableSmoothing","viewport","scaleMode","_frontBuffer","RenderTarget","canvas","_fbContext","getContext","_backBuffer","_bbCanvas","getCanvas","msTouchAction","backgroundColor","applyChanges","fbWidth","fbHeight","diffPercent","getBackBuffer","getFrontBuffer","clear","color","imageSmoothingEnabled","present","drawImage","toggleFullscreen","element","fs","isFullscreen","requestFullScreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","cancelFullScreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen","webkitIsFullScreen","mozFullScreen","msFullscreenElement","SpriteSortMode","BackToFront","FrontToBack","Immediate","SpriteEffect","None","FlipHorizontaly","FlipVerticaly","BatchItemType","Texture","Font","SpriteBatch","graphicsDevice","_graphicsDevice","_viewport","_canvas","_context","_batchItems","_batchStarted","_spriteSortMode","_transformMatrix","_cacheColoredTextures","_batchRect","_onResize","bind","begin","spriteSortMode","transformMatrix","save","texture2D","destinationRectangle","sourceRectangle","origin","scale","effect","layerDepth","_drawBatchItem","drawString","spriteFont","text","end","sort","_sortBatchItem","restore","drawTexture","texture","fillStyle","font","getFont","strokeStyle","lineWidth","wrapText","strokeText","_wrapText","size","fillText","oX","oY","translate","rotate","_colorizeTexture","_searchColoredTexture","imageData","getImageData","cColor","_hexaToBytes","r","g","b","a","putImageData","hexa","bColor","parseInt","slice","itemA","itemB","maxWidth","lineHeight","words","line","n","testLine","metrics","measureText","testWidth","_data","_needUpdate","fromImage","rt","setData","getData","getPixelData","clearRect","saveAsPng","toDataURL","saveAsJpg","SpriteFont","fontName","sClone","Preloader","screenWidth","screenHeight","screenWidthPerTwo","screenHeightPerTwo","onProgress","progressMessage","round","mainLoop","_instance","afterDraw","_paused","requestAnimationFrame","onResize","innerWidth","innerHeight","replace","getElementsByClassName","getElementById","HTMLCanvasElement","version","keyboard","mouse","touchPanel","frontBuffer","_internalIntialize","resizeEnabled","autoClear","run","startProcess","focus","pause","cancelAnimationFrame","resume"],"mappings":"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","file":"atlantis.framework.min.js","sourcesContent":["/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\nAtlantis.events = {\r\n    ContentPreloading: \"atlantis.preloading\",\r\n    ResolutionChanged: \"atlantis.graphics.resize\"\r\n};\r\n\r\n/**\r\n * Ajax method for POST and GET calls.\r\n * @method ajax\r\n * @exemple Atlantis.ajax({ url: http://foo.php, data: \"level_id=2&layer=3\", method: \"GET\", async: false, success: myCallback });\r\n */\r\nAtlantis.ajax = function(parameters) {\r\n    var params = parameters || {};\r\n    var url = parameters.url;\r\n    var callback = parameters.success || function() {};\r\n    var xhr = new XMLHttpRequest();\r\n\r\n    if (params.method === \"POST\") {\r\n        xhr.open(\"POST\", url);\r\n        xhr.onreadystatechange = function() {\r\n            if (xhr.readyState == 4 && xhr.status == 200) {\r\n                callback(xhr.responseText);\r\n            }\r\n        };\r\n        xhr.send(params.data);\r\n    } else {\r\n        var gUrl = params.data ? ([url, \"?\", params.data].join(\"\")) : url;\r\n\r\n        xhr.open(\"GET\", gUrl);\r\n        xhr.onreadystatechange = function() {\r\n            if (xhr.readyState == 4) {\r\n                callback(xhr.responseText);\r\n            }\r\n        };\r\n        xhr.send(null);\r\n    }\r\n};\r\n\r\n/**\r\n * An event notifier.\r\n * @method notify\r\n * @param {String} name The name of the event to send.\r\n * @param {Object} params An object to send for registered handlers.\r\n */\r\nAtlantis.notify = function(name, params) {\r\n    var event = document.createEvent(\"HTMLEvents\");\r\n    event.initEvent(name, true, false);\r\n\r\n    if (params instanceof Object) {\r\n        for (var i in params) {\r\n            event[i] = params[i];\r\n        }\r\n    }\r\n\r\n    document.dispatchEvent(event);\r\n};\r\n\r\n/**\r\n * Determine whether the current device is a mobile or not by using the userAgent string (They said that's bad)\r\n * @method isMobileDevice\r\n * @return {Boolean} Returns `true` for a mobile device otherwise it returns `false`.  \r\n */\r\nAtlantis.isMobileDevice = function() {\r\n    return navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|Windows Phone/i);\r\n};\r\n\r\n/**\r\n * Create a property\r\n * @method _createProperty\r\n * @private\r\n */\r\nAtlantis._createProperty = function(object, property, fn0, fn1) {\r\n    Object.defineProperty(object, property, {\r\n        get: fn0,\r\n        set: fn1,\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * Create a content manager that manage _assets.\r\n * @constructor\r\n * @class ContentManager\r\n * @param {String} rootDirectory The root folder to load _assets (default is the current folder).\r\n */\r\nAtlantis.ContentManager = function(rootDirectory) {\r\n    this.rootDirectory = rootDirectory || \"\";\r\n    this._assets = {};\r\n    this.preloader = [];\r\n};\r\n\r\nAtlantis.ContentManager.PreloadTimerInterval = 250;\r\n\r\n/**\r\n * Start the preloading process by using the `preloader` Array.\r\n * @method preload\r\n * @param {Function} progressCallback The callback to call when an asset has been loaded.\r\n * @param {Function} doneCallback The callback to call when all the assets are loaded.\r\n */\r\nAtlantis.ContentManager.prototype.preload = function(progressCallback, doneCallback) {\r\n    var countAssets = this.preloader.length,\r\n        nbLoaded = 0;\r\n\r\n    progressCallback = (typeof(progressCallback) === \"function\") ? progressCallback : function() {};\r\n    doneCallback = (typeof(doneCallback) === \"function\") ? doneCallback : function() {};\r\n\r\n    var onLoaded = function(asset) {\r\n        nbLoaded++;\r\n    };\r\n\r\n    for (var i = 0; i < countAssets; i++) {\r\n        this.load(this.preloader[i], onLoaded);\r\n    }\r\n\r\n    var that = this;\r\n    var progress = {\r\n        status: \"Loading\",\r\n        progress: 0\r\n    };\r\n\r\n    var timer = setInterval(function() {\r\n        progress.progress = (nbLoaded * 100.0) / countAssets;\r\n\r\n        if (nbLoaded === countAssets) {\r\n            clearInterval(timer);\r\n            progress.status = \"Complete\";\r\n            that.preloader.length = 0;\r\n            doneCallback();\r\n        }\r\n\r\n        Atlantis.notify(Atlantis.events.ContentPreloading, progress);\r\n        progressCallback(progress);\r\n    }, Atlantis.ContentManager.PreloadTimerInterval);\r\n};\r\n\r\n/**\r\n * Load an asset from the root directory.\r\n * Supported formats are :\r\n *      - Images : png, jpg, bmp\r\n *      - Audio : mp3, ogg, wav\r\n *      - Video : mp4, ogv\r\n *      - Data : xml, json, js\r\n *\r\n *  The type is define with the file extension.\r\n *\r\n * @method load\r\n * @param {String} assetName The asset name\r\n * @param {Function} callback A callback function called when the asset is loaded.\r\n */\r\nAtlantis.ContentManager.prototype.load = function(assetName, callback) {\r\n    callback = (typeof(callback) === \"function\") ? callback : function() {};\r\n\r\n    var temp = assetName.split(\".\");\r\n    var ext = temp[(temp.length - 1)];\r\n    assetName = this.rootDirectory + assetName;\r\n\r\n    if (this._assets[assetName]) {\r\n        callback(this._assets[assetName]);\r\n        return this._assets[assetName];\r\n    } else {\r\n        switch (ext) {\r\n            case \"png\":\r\n            case \"jpg\":\r\n            case \"bmp\":\r\n                this.loadImage(assetName, callback);\r\n                break;\r\n            case \"mp3\":\r\n            case \"ogg\":\r\n            case \"wav\":\r\n                this.loadAudio(assetName, callback);\r\n                break;\r\n            case \"mp4\":\r\n            case \"ogv\":\r\n                this.loadVideo(assetName, callback);\r\n                break;\r\n            case \"xml\":\r\n            case \"json\":\r\n            case \"js\":\r\n                this.loadResource(assetName, ext, callback);\r\n                break;\r\n        }\r\n\r\n        return this._assets[assetName];\r\n    }\r\n};\r\n\r\n/**\r\n * Load and store an image.\r\n * @method loadImage\r\n * @param {String} imageName The path of the image.\r\n * @param {Function} callback (optional) The callback to call when the image is loaded.\r\n * @return {Image} Returns the image.\r\n */\r\nAtlantis.ContentManager.prototype.loadImage = function(imageName, callback) {\r\n    var image = new Image();\r\n    image.onload = function() {\r\n        this.style.position = \"absolute\";\r\n        this.style.left = \"-9999px\";\r\n\r\n        document.body.appendChild(image);\r\n        document.body.removeChild(image);\r\n\r\n        this.style.position = \"\";\r\n        this.style.left = \"\";\r\n        callback(this);\r\n    };\r\n    image.src = imageName;\r\n    this._assets[imageName] = image;\r\n    return image;\r\n};\r\n\r\n/**\r\n * Load and store a sound or a music.\r\n * @method loadAudio\r\n * @param {String} audioName The path of the media.\r\n * @param {Function} callback (optional) The callback to call when the media is loaded.\r\n * @return {HTMLAudioElement} Returns the image.\r\n */\r\nAtlantis.ContentManager.prototype.loadAudio = function(audioName, callback) {\r\n    var audio = document.createElement(\"audio\");\r\n    audio.src = audioName;\r\n    audio.load();\r\n    audio.controls = false;\r\n    this._assets[audioName] = audio;\r\n    callback(audio);\r\n    return audio;\r\n};\r\n\r\n\r\n/**\r\n * Load and store a video.\r\n * @method loadVideo\r\n * @param {String} videoName The path of the video.\r\n * @param {Function} callback (optional) The callback to call when the video is loaded.\r\n * @return {HTMLVideoElement} Returns the video.\r\n */\r\nAtlantis.ContentManager.prototype.loadVideo = function(videoName, callback) {\r\n    var video = document.createElement(\"video\");\r\n    video.onload = callback;\r\n    video.src = videoName;\r\n    this._assets[videoName] = video;\r\n    return video;\r\n};\r\n\r\n/**\r\n * Load and store a resources file. If the file's extension is `.json` then it's parsed using `JSON.parse` function.\r\n * @method loadResource\r\n * @param {String} resourceUrl The path of the resource file.\r\n * @param {String} ext The extension of the resource file.\r\n * @param {Function} callback (optional) The callback to call when the resource file is loaded.\r\n * @return {HTMLVideoElement} Returns the resource.\r\n */\r\nAtlantis.ContentManager.prototype.loadResource = function(resourceUrl, ext, callback) {\r\n    var that = this;\r\n    Atlantis.ajax({\r\n        method: \"GET\",\r\n        url: resourceUrl,\r\n        success: function(response) {\r\n            var result = response;\r\n            if (ext == \"json\") {\r\n                result = JSON.parse(response);\r\n            }\r\n            that._assets[resourceUrl] = result;\r\n            callback(result);\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Dispose all assets\r\n * @method dispose\r\n */\r\nAtlantis.ContentManager.prototype.dispose = function() {\r\n    this._assets.length = 0;\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n// ---------------------- //\r\n// --- Game Component --- //\r\n// ---------------------- //\r\n\r\n/**\r\n * Create a game component.\r\n * @constructor\r\n * @class GameComponent\r\n * @param {Atlantis.Game} game A game instance.\r\n */\r\nAtlantis.GameComponent = function(game) {\r\n    this.game = game;\r\n    this.enabled = true;\r\n    this.initialized = false;\r\n};\r\n\r\n/**\r\n * Initialize the logic of the component.\r\n * @method initialize\r\n */\r\nAtlantis.GameComponent.prototype.initialize = function() {\r\n    this.initialized = true;\r\n};\r\n\r\n/**\r\n * Update the logic of the component.\r\n * @method update\r\n * @param {Atlantis.GameTime} gameTime\r\n */\r\nAtlantis.GameComponent.prototype.update = function(gameTime) {};\r\n\r\n// ---\r\n// --- Getters and setters\r\n// ---\r\n\r\n/**\r\n * Gets the status of the component.\r\n * @method isEnabled\r\n * @return {Boolean} The status of the component.\r\n */\r\nAtlantis.GameComponent.prototype.isEnabled = function() {\r\n    return this.enabled;\r\n};\r\n\r\n/**\r\n * Flags used to determine if the initialization processes is done.\r\n * @method isInitialized\r\n * @return {Boolean}\r\n */\r\nAtlantis.GameComponent.prototype.isInitialized = function() {\r\n    return this.initialized;\r\n};\r\n\r\n/**\r\n * Gets the status of the component.\r\n * @method @setEnabled\r\n * @param {Boolean} enabled Sets to true to enable\r\n */\r\nAtlantis.GameComponent.prototype.setEnabled = function(enabled) {\r\n    this.enabled = enabled;\r\n};\r\n\r\n// ------------------------------------------------ //\r\n// ---  Drawable Game Component implementation  --- //\r\n// ------------------------------------------------ //\r\n\r\n/**\r\n * Create a drawable game component.\r\n * @constructor\r\n * @class DrawableGameComponent\r\n * @extends Atlantis.GameComponent\r\n * @param {Atlantis.Game} game A game instance.\r\n */\r\nAtlantis.DrawableGameComponent = function(game) {\r\n    Atlantis.GameComponent.call(this, game);\r\n    this.visible = true;\r\n    this.assetLoaded = false;\r\n};\r\n\r\nAtlantis.DrawableGameComponent.prototype = new Atlantis.GameComponent();\r\n\r\n/**\r\n * Load assets of the component.\r\n * @method loadContent\r\n */\r\nAtlantis.DrawableGameComponent.prototype.loadContent = function() {\r\n    this.assetLoaded = true;\r\n};\r\n\r\n/**\r\n * Unload and dispose all assets of the component.\r\n * @method unloadContent\r\n */\r\nAtlantis.DrawableGameComponent.prototype.unloadContent = function() {\r\n    this.assetLoaded = false;\r\n};\r\n\r\n/** \r\n * Draw the component on screen.\r\n * @method draw\r\n * @param {Atlantis.GameTime} gameTime\r\n * @param {Object} context The canvas context.\r\n */\r\nAtlantis.DrawableGameComponent.prototype.draw = function(gameTime, context) {};\r\n\r\n/**\r\n * Gets the visibility of the component.\r\n * @method isVisible\r\n * @return {Boolean} Return true if visible otherwise return false\r\n */\r\nAtlantis.DrawableGameComponent.prototype.isVisible = function() {\r\n    return this.isVisible;\r\n};\r\n\r\n/**\r\n * Set the component visible or invisible\r\n * @method setVisible\r\n * @param visible\r\n */\r\nAtlantis.DrawableGameComponent.prototype.setVisible = function(visible) {\r\n    this.isVisible = visible;\r\n};\r\n\r\n// ------------------------------------------------ //\r\n// --- Game Component Collection implementation --- //\r\n// ------------------------------------------------ //\r\n\r\n/**\r\n * Create a collection of game components.\r\n * @constructor\r\n */\r\nAtlantis.GameComponentCollection = function() {\r\n    this.components = [];\r\n    this.drawables = [];\r\n    this.initialized = false;\r\n    this.assetLoaded = false;\r\n};\r\n\r\n/**\r\n * Initialize logic.\r\n * @method initialize\r\n */\r\nAtlantis.GameComponentCollection.prototype.initialize = function(content) {\r\n    for (var i = 0, l = this.components.length; i < l; i++) {\r\n        this.components[i].initialize();\r\n    }\r\n    this.initialized = true;\r\n};\r\n\r\n/**\r\n * Load assets\r\n * @method loadContent\r\n */\r\nAtlantis.GameComponentCollection.prototype.loadContent = function() {\r\n    for (var i = 0, l = this.drawables.length; i < l; i++) {\r\n        this.drawables[i].loadContent();\r\n    }\r\n    this.assetLoaded = true;\r\n};\r\n\r\n/**\r\n * Unload assets\r\n * @method unloadContent\r\n */\r\nAtlantis.GameComponentCollection.prototype.unloadContent = function() {\r\n    for (var i = 0, l = this.drawables.length; i < l; i++) {\r\n        this.drawables[i].unloadContent();\r\n    }\r\n    this.assetLoaded = false;\r\n};\r\n\r\n/**\r\n * Update all components\r\n * @method update\r\n * @param {Atlantis.GameTime} gameTime\r\n */\r\nAtlantis.GameComponentCollection.prototype.update = function(gameTime) {\r\n    for (var i = 0, l = this.components.length; i < l; i++) {\r\n        if (this.components[i].isEnabled()) {\r\n            this.components[i].update(gameTime);\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Draw all components\r\n * @method draw\r\n */\r\nAtlantis.GameComponentCollection.prototype.draw = function(gameTime, context) {\r\n    for (var i = 0, l = this.drawables.length; i < l; i++) {\r\n        if (this.drawables[i].isVisible()) {\r\n            this.drawables[i].draw(gameTime, context);\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Add a component to the collection\r\n * @method add\r\n * @param {Atlantis.GameComponent} A component or drawable gameComponent to add.\r\n */\r\nAtlantis.GameComponentCollection.prototype.add = function(gameComponent) {\r\n    if (this.components.indexOf(gameComponent) == -1) {\r\n        this.components.push(gameComponent);\r\n\r\n        if (this.initialized) {\r\n            gameComponent.initialize();\r\n        }\r\n\r\n        if (gameComponent instanceof Atlantis.DrawableGameComponent) {\r\n            this.drawables.push(gameComponent);\r\n\r\n            if (this.assetLoaded) {\r\n                gameComponent.loadContent();\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Remove a component from the collection\r\n * @method remove\r\n * @return {Boolean} Return true if the component has been successfully removed.\r\n */\r\nAtlantis.GameComponentCollection.prototype.remove = function(gameComponent) {\r\n    var index = this.components.indexOf(gameComponent);\r\n    if (index > -1) {\r\n        this.components.splice(index, 1);\r\n        if (gameComponent instanceof Atlantis.DrawableGameComponent) {\r\n            index = this.drawables.indexOf(gameComponent);\r\n            if (index > -1) {\r\n                this.drawables.splice(index, 1);\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\n\r\n/**\r\n * Get a component from the collection by its index\r\n * @method get\r\n * @param {Number} index The index of the component.\r\n * @return {Component} Returns the component if it exists, otherwise it returns `null`.\r\n */\r\nAtlantis.GameComponentCollection.prototype.get = function(index) {\r\n    if (index > -1 && index < this.components.length) {\r\n        return this.components[index];\r\n    }\r\n\r\n    return null;\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * Create a game time object who's responsible to get time informations.\r\n * @constructor\r\n * @class GameTime\r\n */\r\nAtlantis.GameTime = function() {\r\n    this.reset();\r\n};\r\n\r\n/**\r\n * Reset the game timer.\r\n * @method reset\r\n */\r\nAtlantis.GameTime.prototype.reset = function() {\r\n    this.elapsedTime = 0;\r\n    this.totalGameTime = 0;\r\n    this.currentTime = +new Date();\r\n    this.fps = 0;\r\n};\r\n\r\n/**\r\n * Update the game time.\r\n * @method update\r\n */\r\nAtlantis.GameTime.prototype.update = function() {\r\n    var now = +new Date();\r\n    this.elapsedTime = now - this.currentTime;\r\n    this.totalGameTime += this.elapsedTime;\r\n    this.fps = 1000 / (now - this.currentTime);\r\n    this.currentTime = now;\r\n};\r\n\r\n/**\r\n * Gets the elapsed time since last frame.\r\n * @method getElapsedTime\r\n * @return {Number} The elapsed time since last frame.\r\n */\r\nAtlantis.GameTime.prototype.getElapsedTime = function() {\r\n    return this.elapsedTime;\r\n};\r\n\r\n/**\r\n * Gets the total elapsed time since the begining.\r\n * @method getTotalGameTime\r\n * @return {Number} The total elapsed time.\r\n */\r\nAtlantis.GameTime.prototype.getTotalGameTime = function() {\r\n    return this.totalGameTime;\r\n};\r\n\r\n/**\r\n * Gets the current FPS indice.\r\n * @method getFPS\r\n * @return {Number} Return the current FPS.\r\n */\r\nAtlantis.GameTime.prototype.getFPS = function() {\r\n    return this.fps;\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * @class MathHelpers\r\n */\r\nAtlantis.MathHelper = {\r\n    /**\r\n     * Gets PI value.\r\n     * @attribute Pi\r\n     * @readOnly\r\n     * @type {Number}\r\n     */\r\n    Pi: Math.PI,\r\n\r\n    /**\r\n     * Gets PI over 2 value.\r\n     * @attribute PiOver2\r\n     * @readOnly\r\n     * @type {Number}\r\n     */\r\n    PiOver2: Math.PI / 2,\r\n\r\n    /**\r\n     * Gets PI over 4 value.\r\n     * @attribute PiOver4\r\n     * @readOnly\r\n     * @type {Number}\r\n     */\r\n    PiOver4: Math.PI / 4,\r\n\r\n    /**\r\n     * Gets PI * 2 value.\r\n     * @attribute TwoPi\r\n     * @readOnly\r\n     * @type {Number}\r\n     */\r\n    TwoPi: Math.PI * 2,\r\n\r\n    /**\r\n     *\r\n     * @method clamp\r\n     */\r\n    clamp: function(value, min, max) {\r\n        value = (value > max) ? max : value;\r\n        value = (value < min) ? min : value;\r\n        return value;\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @method distance\r\n     */\r\n    distance: function(value1, value2) {\r\n        return Math.abs(value1 - value2);\r\n    },\r\n\r\n    hermite: function(value1, tangent1, value2, tangent2, amount) {\r\n        var sCubed = amount * amount * amount;\r\n        var sSquared = amount * amount;\r\n\r\n        if (amount === 0) {\r\n            return value1;\r\n        } else if (amount === 1) {\r\n            return value2;\r\n        }\r\n\r\n        return (2 * value1 - 2 * value2 + tangent2 + tangent1) * sCubed + (3 * value2 - 3 * value1 - 2 * tangent1 - tangent2) * sSquared + tangent1 * amount + value1;\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @method lerp\r\n     */\r\n    lerp: function(value1, value2, amount) {\r\n        amount = amount < 0 ? 0 : amount;\r\n        amount = amount > 1 ? 1 : amount;\r\n        return value1 + (value2 - value1) * amount;\r\n    },\r\n\r\n    smoothStep: function(value1, value2, amount) {\r\n        var result = this.clamp(amount, 0, 1);\r\n        result = this.hermite(value1, 0, value2, 0, result);\r\n        return result;\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @method toDegrees\r\n     */\r\n    toDegrees: function(radians) {\r\n        return (radians * (180 / Math.PI));\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @method toRadians\r\n     */\r\n    toRadians: function(degrees) {\r\n        return (degrees * (Math.PI / 180));\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @method isPowerOfTwo\r\n     */\r\n    isPowerOfTwo: function(value) {\r\n        return (value > 0) && ((value & (value - 1)) === 0);\r\n    }\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = Atlantis || {};\r\n\r\n/**\r\n * Describes a rectangle structure.\r\n * @constructor\r\n * @class Rectangle\r\n * @param {Number} x A value for X coordinate.\r\n * @param {Number} y A value for Y coordinate.\r\n * @param {Number} width A value for the width of the rectangle.\r\n * @param {Number} height A value for the height of the rectangle\r\n */\r\nAtlantis.Rectangle = function(x, y, width, height) {\r\n    this.x = x || 0;\r\n    this.y = y || 0;\r\n    this.width = width || 0;\r\n    this.height = height || 0;\r\n};\r\n\r\n/**\r\n * Add a rectangle to this rectangle.\r\n * @method add\r\n * @param {Atlantis.Rectangle} rectangle The rectangle to add.\r\n */\r\nAtlantis.Rectangle.prototype.add = function(rectangle) {\r\n    this.x += rectangle.x;\r\n    this.y += rectangle.y;\r\n    this.width += rectangle.width;\r\n    this.height += rectangle.height;\r\n};\r\n\r\n/**\r\n * Divide a rectangle to this rectangle.\r\n * @method divide\r\n * @param {Atlantis.Rectangle} rectangle The rectangle to divide.\r\n */\r\nAtlantis.Rectangle.prototype.divide = function(rectangle) {\r\n    this.x /= rectangle.x;\r\n    this.y /= rectangle.y;\r\n    this.width /= rectangle.width;\r\n    this.height /= rectangle.height;\r\n};\r\n\r\nAtlantis.Rectangle.prototype.fromRectangle = function(rectangle) {\r\n    this.x = rectangle.x ? +rectangle.x : 0;\r\n    this.y = rectangle.y ? +rectangle.y : 0;\r\n    this.width = rectangle.width ? +rectangle.width : 0;\r\n    this.height = rectangle.height ? +rectangle.height : 0;\r\n};\r\n\r\n/**\r\n * Multiply a rectangle to this rectangle.\r\n * @method multiply\r\n * @param {Atlantis.Rectangle} rectangle The rectangle to multiply.\r\n */\r\nAtlantis.Rectangle.prototype.multiply = function(rectangle) {\r\n    this.x *= rectangle.x;\r\n    this.y *= rectangle.y;\r\n    this.width *= rectangle.width;\r\n    this.height *= rectangle.height;\r\n};\r\n\r\n/**\r\n * Subtract a rectangle to this rectangle.\r\n * @method subtract\r\n * @param {Atlantis.Rectangle} rectangle The rectangle to subtract.\r\n */\r\nAtlantis.Rectangle.prototype.subtract = function(rectangle) {\r\n    this.x -= rectangle.x;\r\n    this.y -= rectangle.y;\r\n    this.width -= rectangle.width;\r\n    this.height -= rectangle.height;\r\n};\r\n\r\n/**\r\n * Determine if a Rectangle, Point or coordinates are contains in rectangle\r\n * @method contains\r\n * @param {Number|Point|Rectangle} X coordinate or an instance of Point or an instance of Rectangle.\r\n * @param {Number} Y coordinate.\r\n */\r\nAtlantis.Rectangle.prototype.contains = function(value1, value2) {\r\n    if (value1 instanceof Atlantis.Rectangle) {\r\n        return (this.x <= value1.x) && (value1.getRight() <= this.getRight()) && (this.y <= value1.y) && (value1.getBottom() <= this.getBottom());\r\n    } else {\r\n        return (this.x <= value1) && (value1 < this.getRight()) && (this.y <= value2) && (value2 < this.getBottom());\r\n    }\r\n};\r\n\r\n/**\r\n *\r\n * @method contains\r\n */\r\nAtlantis.Rectangle.prototype.intersects = function(rectangle) {\r\n    return (rectangle.getLeft() < this.getRight()) && (this.getLeft() < rectangle.getRight()) && (rectangle.getTop() < this.getBottom()) && (this.getTop() < rectangle.getBottom());\r\n};\r\n\r\nAtlantis.Rectangle.prototype.toString = function() {\r\n    return [\"x: \", this.x, \" y: \", this.y, \" width: \", this.width, \" height: \", this.height].toString();\r\n};\r\n\r\n/**\r\n * gets the position.\r\n * @return The position.\r\n */\r\nAtlantis.Rectangle.prototype.toVector2 = function() {\r\n    return new Atlantis.Vector2(this.x, this.y);\r\n};\r\n\r\n/**\r\n * Gets the position.\r\n * @return The position.\r\n */\r\nAtlantis.Rectangle.prototype.toPoint = function() {\r\n    return new Atlantis.Point(this.x, this.y);\r\n};\r\n\r\n// ---\r\n// --- Getters and setters\r\n// ---\r\n\r\n/**\r\n * Gets the top value.\r\n * @method getTop\r\n * @return {Number} Top coordinate (y)\r\n */\r\nAtlantis.Rectangle.prototype.getTop = function() {\r\n    return this.y;\r\n};\r\n\r\n/**\r\n * Gets the bottom value.\r\n * @method getBottom\r\n * @return {Number} Bottom coordinate (y + height)\r\n */\r\nAtlantis.Rectangle.prototype.getBottom = function() {\r\n    return this.y + this.height;\r\n};\r\n\r\n/**\r\n * Gets the left value.\r\n * @method getLeft\r\n * @return {Number} Left coordinate (x)\r\n */\r\nAtlantis.Rectangle.prototype.getLeft = function() {\r\n    return this.x;\r\n};\r\n\r\n/**\r\n * Gets the right value.\r\n * @method getRight\r\n * @return {Number} Right value (x + width)\r\n */\r\nAtlantis.Rectangle.prototype.getRight = function() {\r\n    return this.x + this.width;\r\n};\r\n\r\n/**\r\n * Gets the center of the rectangle.\r\n * @method getCenter\r\n * @return {Number} Center of the rectangle.\r\n * @return {Atlantis.Point} A point of the center of the rectangle.\r\n */\r\nAtlantis.Rectangle.prototype.getCenter = function() {\r\n    return new Atlantis.Point(this.x + (this.width / 2), this.y + (this.height / 2));\r\n};\r\n\r\n/**\r\n * Gets width\r\n * @return {Number} Return the with.\r\n */\r\nAtlantis.Rectangle.prototype.getWidth = function() {\r\n    return this.width;\r\n};\r\n\r\n/**\r\n * Gets height\r\n * @return {Number} Return the height\r\n */\r\nAtlantis.Rectangle.prototype.getHeight = function() {\r\n    return this.height;\r\n};\r\n\r\n/**\r\n * Gets the top center.\r\n * @return {Atlantis.Vector2} The top center of the rectangle\r\n */\r\nAtlantis.Rectangle.prototype.getTopCenter = function() {\r\n    return new Atlantis.Vector2(this.x + this.width / 2, this.y);\r\n};\r\n\r\n/**\r\n * Gets the bottom center.\r\n * @return {Atlantis.Vector2} The bottom center.\r\n */\r\nAtlantis.Rectangle.prototype.getBottomCenter = function() {\r\n    return new Atlantis.Vector2(this.x + this.width / 2, this.y + this.height);\r\n};\r\n\r\n/**\r\n * Gets the left center.\r\n * @return {Atlantis.Vector2} The left center.\r\n */\r\nAtlantis.Rectangle.prototype.getLeftCenter = function() {\r\n    return new Atlantis.Vector2(this.x, this.y + this.height / 2);\r\n};\r\n\r\n/**\r\n * Gets the right center.\r\n * @return {Atlantis.Vector2} The right center.\r\n */\r\nAtlantis.Rectangle.prototype.getRightCenter = function() {\r\n    return new Atlantis.Vector2(this.x + this.width, this.y + this.height / 2);\r\n};\r\n\r\n/**\r\n * Sets values to rectangle.\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @param {Number} width\r\n * @param {Number} height\r\n */\r\nAtlantis.Rectangle.prototype.set = function(x, y, width, height) {\r\n    if (x instanceof Atlantis.Rectangle) {\r\n        this.x = x.x;\r\n        this.y = x.y;\r\n        this.width = x.width;\r\n        this.height = x.height;\r\n    } else {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.width = width;\r\n        this.height = height;\r\n    }\r\n};\r\n\r\n/**\r\n * Sets the position of the rectangle\r\n * @param {Number|Altantis.Vector2|Atlantis.Point} x\r\n * @param {Number} y\r\n */\r\nAtlantis.Rectangle.prototype.setPosition = function(x, y) {\r\n    this.x = x;\r\n    this.y = y;\r\n};\r\n\r\n/**\r\n * Sets the size of the rectangle.\r\n * @param {Number} width\r\n * @param {Number} height\r\n */\r\nAtlantis.Rectangle.prototype.setSize = function(width, height) {\r\n    this.width = width;\r\n    this.height = height;\r\n};\r\n\r\nAtlantis.Rectangle.prototype.clone = function() {\r\n    return new Atlantis.Rectangle(this.x, this.y, this.width, this.height);\r\n};\r\n\r\n/**\r\n * Gets a string from this object.\r\n * @method toString\r\n * @return {String}\r\n */\r\nAtlantis.Rectangle.prototype.toString = function() {\r\n    return [\"x: \", this.x, \" y: \", this.y, \" width: \", this.width, \" height: \", this.height].join(\"\");\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * Create a matrix. Parameter can be a matrix, an array of 16 floats or nothing (all fields case are sets to 0).\r\n * @class Matrix\r\n * @constructor\r\n * @param {Atlantis.Matrix|Array} \r\n */\r\nAtlantis.Matrix = function(values) {\r\n    if (values instanceof Atlantis.Matrix) {\r\n        this.set(values.toArray());\r\n    } else if (values instanceof Array && values.length == 16) {\r\n        this.set(values);\r\n    } else {\r\n        this.M11 = 0;\r\n        this.M12 = 0;\r\n        this.M13 = 0;\r\n        this.M14 = 0;\r\n        this.M21 = 0;\r\n        this.M22 = 0;\r\n        this.M23 = 0;\r\n        this.M24 = 0;\r\n        this.M31 = 0;\r\n        this.M32 = 0;\r\n        this.M33 = 0;\r\n        this.M34 = 0;\r\n        this.M41 = 0;\r\n        this.M42 = 0;\r\n        this.M43 = 0;\r\n        this.M44 = 0;\r\n    }\r\n};\r\n\r\nAtlantis.Matrix.prototype.clone = function() {\r\n    return new Atlantis.Matrix(this.toArray());\r\n};\r\n\r\n/**\r\n * Set all values of the matrix.\r\n * @method set\r\n * @param {Array} values An array of 16 values who start at M11 and stop at M44\r\n */\r\nAtlantis.Matrix.prototype.set = function(values) {\r\n    if (values.length == 16) {\r\n        this.M11 = values[0];\r\n        this.M12 = values[1];\r\n        this.M13 = values[2];\r\n        this.M14 = values[3];\r\n        this.M21 = values[4];\r\n        this.M22 = values[5];\r\n        this.M23 = values[6];\r\n        this.M24 = values[7];\r\n        this.M31 = values[8];\r\n        this.M32 = values[9];\r\n        this.M33 = values[10];\r\n        this.M34 = values[11];\r\n        this.M41 = values[12];\r\n        this.M42 = values[13];\r\n        this.M43 = values[14];\r\n        this.M44 = values[15];\r\n    }\r\n};\r\n\r\n/**\r\n * Gets identity value for push it into matrix.\r\n * @method getIdentityValues\r\n * @return {Array} Return an array that correspond of identity matrix.\r\n */\r\nAtlantis.Matrix.prototype.getIdentityValues = function() {\r\n    var values = [\r\n        1, 0, 0, 0,\r\n        0, 1, 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1\r\n    ];\r\n    return values;\r\n};\r\n\r\n/**\r\n * Gets an array of values setted to 0.\r\n * @method getZeroValues\r\n * @return {Array} Return an array with 0.\r\n */\r\nAtlantis.Matrix.prototype.getZeroValues = function() {\r\n    var values = [];\r\n    for (var i = 0; i < 16; i++) {\r\n        values.push(0.0);\r\n    }\r\n    return values;\r\n};\r\n\r\n/**\r\n * Sets the matrix to identity.\r\n * @method setIdentity\r\n */\r\nAtlantis.Matrix.prototype.setIdentity = function() {\r\n    this.set(this.getIdentityValues());\r\n};\r\n\r\n/**\r\n * Gets an identity matrix.\r\n * @method getMatrixIdentity\r\n * @static\r\n * @return {Atlantis.Matrix} Return an identity matrix.\r\n */\r\nAtlantis.Matrix.getMatrixIdentity = function() {\r\n    var matrix = new Atlantis.Matrix();\r\n    matrix.setIdentity();\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Gets values of matrix in array. Start at M11 to M44.\r\n * @method toArray\r\n * @return {Array} An array of values.\r\n */\r\nAtlantis.Matrix.prototype.toArray = function() {\r\n    var values = [];\r\n    values.push(this.M11);\r\n    values.push(this.M12);\r\n    values.push(this.M13);\r\n    values.push(this.M14);\r\n    values.push(this.M21);\r\n    values.push(this.M22);\r\n    values.push(this.M23);\r\n    values.push(this.M24);\r\n    values.push(this.M31);\r\n    values.push(this.M32);\r\n    values.push(this.M33);\r\n    values.push(this.M34);\r\n    values.push(this.M41);\r\n    values.push(this.M42);\r\n    values.push(this.M43);\r\n    values.push(this.M44);\r\n    return values;\r\n};\r\n\r\n/**\r\n * Sets the left of the matrix.\r\n * @method setLeft\r\n * @param {Atlantis.Vector3} vector A vector to use.\r\n */\r\nAtlantis.Matrix.prototype.setLeft = function(vector) {\r\n    this.M11 = -vector.x;\r\n    this.M12 = -vector.y;\r\n    this.M13 = -vector.z;\r\n};\r\n\r\n/**\r\n * Gets the left of the matrix.\r\n * @method getLeft\r\n * @return {Atlantis.Matrix} Return a the left vector of the matrix.\r\n */\r\nAtlantis.Matrix.prototype.getLeft = function() {\r\n    var vector = new Atlantis.Vector3();\r\n    vector.x = -this.M11;\r\n    vector.y = -this.M12;\r\n    vector.z = -this.M13;\r\n    return vector;\r\n};\r\n\r\n/**\r\n * Sets the right of the matrix.\r\n * @method setRight\r\n * @param {Atlantis.Vector3} vector\r\n */\r\nAtlantis.Matrix.prototype.setRight = function(vector) {\r\n    this.M11 = vector.x;\r\n    this.M12 = vector.y;\r\n    this.M13 = vector.z;\r\n};\r\n\r\n/**\r\n * Gets the right of the matrix.\r\n * @method getRight\r\n * @return {Atlantis.Matrix} Return a the right vector of the matrix.\r\n */\r\nAtlantis.Matrix.prototype.getRight = function() {\r\n    var vector = new Atlantis.Vector3();\r\n    vector.x = this.M11;\r\n    vector.y = this.M12;\r\n    vector.z = this.M13;\r\n    return vector;\r\n};\r\n\r\n/**\r\n * Sets the up of the matrix.\r\n * @method setUp\r\n * @param {Atlantis.Vector3} vector\r\n */\r\nAtlantis.Matrix.prototype.setUp = function(vector) {\r\n    this.M21 = vector.x;\r\n    this.M22 = vector.y;\r\n    this.M23 = vector.z;\r\n};\r\n\r\n/**\r\n * Gets the up of the matrix.\r\n * @method getUp\r\n * @return {Atlantis.Matrix} Return a the up vector of the matrix.\r\n */\r\nAtlantis.Matrix.prototype.getUp = function() {\r\n    var vector = new Atlantis.Vector3();\r\n    vector.x = this.M21;\r\n    vector.y = this.M22;\r\n    vector.z = this.M23;\r\n    return vector;\r\n};\r\n\r\n/**\r\n * Sets the down of the matrix.\r\n * @method setDown\r\n * @param {Atlantis.Vector3} vector\r\n */\r\nAtlantis.Matrix.prototype.setDown = function(vector) {\r\n    this.M21 = -vector.x;\r\n    this.M22 = -vector.y;\r\n    this.M23 = -vector.z;\r\n};\r\n\r\n/**\r\n * Gets the down of the matrix.\r\n * @method getDown\r\n * @return {Atlantis.Matrix} Return a the down vector of the matrix.\r\n */\r\nAtlantis.Matrix.prototype.getDown = function() {\r\n    var vector = new Atlantis.Vector3();\r\n    vector.x = -this.M21;\r\n    vector.y = -this.M22;\r\n    vector.z = -this.M23;\r\n    return vector;\r\n};\r\n\r\n/**\r\n * Sets the backward of the matrix.\r\n * @method setBackward\r\n * @param {Atlantis.Vector3} vector\r\n */\r\nAtlantis.Matrix.prototype.setBackward = function(vector) {\r\n    this.M31 = vector.x;\r\n    this.M32 = vector.y;\r\n    this.M33 = vector.z;\r\n};\r\n\r\n/**\r\n * Gets the backward of the matrix.\r\n * @method getBackward\r\n * @return {Atlantis.Matrix} Return a the backward vector of the matrix.\r\n */\r\nAtlantis.Matrix.prototype.getBackward = function() {\r\n    var vector = new Atlantis.Vector3();\r\n    vector.x = this.M31;\r\n    vector.y = this.M32;\r\n    vector.z = this.M33;\r\n    return vector;\r\n};\r\n\r\n/**\r\n * Sets the forward of the matrix.\r\n * @method setForward\r\n * @param {Atlantis.Vector3} vector\r\n */\r\nAtlantis.Matrix.prototype.setForward = function(vector) {\r\n    this.M31 = -vector.x;\r\n    this.M32 = -vector.y;\r\n    this.M33 = -vector.z;\r\n};\r\n\r\n/**\r\n * Gets the forward of the matrix.\r\n * @method getForward\r\n * @return {Atlantis.Matrix} Return a the forward vector of the matrix.\r\n */\r\nAtlantis.Matrix.prototype.getForward = function() {\r\n    var vector = new Atlantis.Vector3();\r\n    vector.x = -this.M31;\r\n    vector.y = -this.M32;\r\n    vector.z = -this.M33;\r\n    return vector;\r\n};\r\n\r\n/**\r\n * Sets translation.\r\n * @method setTranslation\r\n * @param {Atlantis.Vetor3} position The position to set.\r\n */\r\nAtlantis.Matrix.prototype.setTranslation = function(position) {\r\n    this.M41 = position.x;\r\n    this.M42 = position.y;\r\n    this.M43 = position.z;\r\n};\r\n\r\n/**\r\n * Add a matrix to this matrix.\r\n * @method add\r\n * @param {Atlantis.Matrix} matrix A matrix to add.\r\n */\r\nAtlantis.Matrix.prototype.add = function(matrix) {\r\n    var mValues = this.toArray();\r\n    var eValues = matrix.toArray();\r\n\r\n    for (var i = 0; i < 16; i++) {\r\n        mValues[i] += eValues[i];\r\n    }\r\n    this.set(mValues);\r\n};\r\n\r\n/**\r\n * Add two matrix.\r\n * @method add\r\n * @static\r\n * @param {Atlantis.Matrix} matA A matrix\r\n * @param {Atlantis.Matrix} matB Another matrix to add with the first\r\n * @return {Atlantis.Matrix} Return a new matrix.\r\n */\r\nAtlantis.Matrix.add = function(matA, matB) {\r\n    var matrix = new Atlantis.Matrix(matA);\r\n    matrix.add(matB);\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Create a rotation matrix on X axis.\r\n * @method createRotationX\r\n * @static\r\n * @param {Atlantis.Vector3} rotation An angle in radians\r\n * @return {Atlantis.Matrix} Return a rotation matrix on X axis.\r\n */\r\nAtlantis.Matrix.createRotationX = function(rotation) {\r\n    var matrix = Atlantis.Matrix.getMatrixIdentity();\r\n    var cos = Math.cos(rotation);\r\n    var sin = Math.sin(rotation);\r\n\r\n    matrix.M22 = cos;\r\n    matrix.M23 = sin;\r\n    matrix.M32 = -sin;\r\n    matrix.M33 = cos;\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Create a rotation matrix on Y axis.\r\n * @method createRotationY\r\n * @static\r\n * @param {Atlantis.Vector3} rotation An angle in radians\r\n * @return {Atlantis.Matrix} Return a rotation matrix on Y axis.\r\n */\r\nAtlantis.Matrix.createRotationY = function(rotation) {\r\n    var matrix = Atlantis.Matrix.getMatrixIdentity();\r\n    var cos = Math.cos(rotation);\r\n    var sin = Math.sin(rotation);\r\n\r\n    matrix.M11 = cos;\r\n    matrix.M13 = -sin;\r\n    matrix.M31 = sin;\r\n    matrix.M33 = cos;\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Create a rotation matrix on Z axis.\r\n * @method createRotationX\r\n * @static\r\n * @param {Atlantis.Vector3} rotation An angle in radians\r\n * @return {Atlantis.Matrix} Return a rotation matrix on Z axis.\r\n */\r\nAtlantis.Matrix.createRotationZ = function(rotation) {\r\n    var matrix = this.getMatrixIdentity();\r\n\r\n    var cos = Math.cos(rotation);\r\n    var sin = Math.sin(rotation);\r\n\r\n    matrix.M11 = cos;\r\n    matrix.M13 = sin;\r\n    matrix.M31 = -sin;\r\n    matrix.M33 = cos;\r\n\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Create a scale matrix.\r\n * @method createScale\r\n * @static\r\n * @param {Number} sx Desired scale on X axis.\r\n * @param {Number} sy Desired scale on Y axis.\r\n * @param {Number} sz Desired scale on Z axis.\r\n * @return {Atlantis.Matrix} Return a scale matrix.\r\n */\r\nAtlantis.Matrix.createScale = function(sx, sy, sz) {\r\n    var matrix = Atlantis.Matrix.getMatrixIdentity();\r\n    matrix.M11 = sx;\r\n    matrix.M22 = sy || sx;\r\n    matrix.M33 = sz || sx;\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Create a translation matrix.\r\n * @method createTranslation\r\n * @static\r\n * @param x Position on X axis.\r\n * @param y Position on Y axis.\r\n * @param z Position on Z axis.\r\n * @return Return a matrix translation.\r\n */\r\nAtlantis.Matrix.createTranslation = function(x, y, z) {\r\n    var matrix = Atlantis.Matrix.getMatrixIdentity();\r\n    matrix.M41 = x;\r\n    matrix.M42 = y || x;\r\n    matrix.M43 = z || x;\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Create a view matrix.\r\n * @metod createLookAt\r\n * @static\r\n * @param {Atlantis.Vector3} position The position of the camera.\r\n * @param Atlantis.Vector3} target The target of the camera.\r\n * @param Atlantis.Vector3} upVector Vector up\r\n * @return {Atlantis.Matrix} Return a view camera.\r\n */\r\nAtlantis.Matrix.createLookAt = function(position, target, upVector) {\r\n    var zAxis = Atlantis.Vector3.subtract(target, position);\r\n    zAxis.normalize();\r\n    var xAxis = Atlantis.Vector3.cross(upVector, zAxis);\r\n    xAxis.normalize();\r\n    var yAxis = Atlantis.Vector3.cross(zAxis, xAxis);\r\n    yAxis.normalize();\r\n\r\n    var matrix = Atlantis.Matrix.getMatrixIdentity();\r\n\r\n    matrix.M11 = xAxis.x;\r\n    matrix.M21 = xAxis.y;\r\n    matrix.M31 = xAxis.z;\r\n\r\n    matrix.M12 = yAxis.x;\r\n    matrix.M22 = yAxis.y;\r\n    matrix.M32 = yAxis.z;\r\n\r\n    matrix.M13 = zAxis.x;\r\n    matrix.M23 = zAxis.y;\r\n    matrix.M33 = zAxis.z;\r\n\r\n    matrix.M41 = -Atlantis.Vector3.dot(xAxis, position);\r\n    matrix.M42 = -Atlantis.Vector3.dot(yAxis, position);\r\n    matrix.M43 = -Atlantis.Vector3.dot(zAxis, position);\r\n\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Create an orthogonal projection matrix.\r\n * @method createOrthograhic\r\n * @static\r\n * @param {Number} width\r\n * @param {Number} height\r\n * @param {Number} zNear\r\n * @param {Number} zFar\r\n * @return {Atlantis.Matrix}\r\n */\r\nAtlantis.Matrix.createOrthographic = function(width, height, zNear, zFar) {\r\n    var matrix = new Atlantis.Matrix();\r\n    matrix.M11 = 2.0 / width;\r\n    matrix.M12 = matrix.M13 = matrix.M14 = 0.0;\r\n    matrix.M22 = 2.0 / height;\r\n    matrix.M21 = matrix.M23 = matrix.M24 = 0.0;\r\n    matrix.M33 = 1.0 / (zNear - zFar);\r\n    matrix.M31 = matrix.M32 = matrix.M34 = 0.0;\r\n    matrix.M41 = matrix.M42 = 0.0;\r\n    matrix.M43 = zNear / (zNear - zFar);\r\n    matrix.M44 = 1.0;\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Create a customized orthogonal projection matrix.\r\n * @method createOrthographicOffCenter\r\n * @static\r\n * @param {Number} width\r\n * @param {Number} height\r\n * @param {Number} zNear\r\n * @param {Number} zFar\r\n * @return {Atlantis.Matrix}\r\n */\r\nAtlantis.Matrix.createOrthographicOffCenter = function(left, right, bottom, top, zNear, zFar) {\r\n    var matrix = new Atlantis.Matrix();\r\n    matrix.M11 = (2.0 / (right - left));\r\n    matrix.M12 = 0.0;\r\n    matrix.M13 = 0.0;\r\n    matrix.M14 = 0.0;\r\n    matrix.M21 = 0.0;\r\n    matrix.M22 = (2.0 / (top - bottom));\r\n    matrix.M23 = 0.0;\r\n    matrix.M24 = 0.0;\r\n    matrix.M31 = 0.0;\r\n    matrix.M32 = 0.0;\r\n    matrix.M33 = (1.0 / (zNear - zFar));\r\n    matrix.M34 = 0.0;\r\n    matrix.M41 = ((left + right) / (left - right));\r\n    matrix.M42 = ((top + bottom) / (bottom - top));\r\n    matrix.M43 = (zNear / (zNear - zFar));\r\n    matrix.M44 = 1.0;\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Create a perspective field of view matrix with Left hand notation.\r\n * @method createPerspectiveFieldOfView\r\n * @static\r\n * @param {Number} fov Desired field of view (Math.PI / 4 is a good value)\r\n * @param {Number} aspect Desired aspect ratio (Screen width / height)\r\n * @param {Number} near Near clip\r\n * @param {Number} far Far clip\r\n * @return {Atlantis.Matrix} Return a matrix of this type of perspective.\r\n */\r\nAtlantis.Matrix.createPerspectiveFieldOfView = function(fov, aspect, zNear, zFar) {\r\n    var yScale = (1.0 / Math.tan(fov * 0.5));\r\n    var xScale = yScale / aspect;\r\n    var halfWidth = zNear / xScale;\r\n    var halfHeight = zNear / yScale;\r\n\r\n    return Atlantis.Matrix.createPerspectiveOffCenter(-halfWidth, halfWidth, -halfHeight, halfHeight, zNear, zFar);\r\n};\r\n\r\n/**\r\n * Create a perspective field of view matrix with Right hand notation.\r\n * @method createPerspectiveFieldOfViewRH\r\n * @static\r\n * @param {Number} fov Desired field of view (Math.PI / 4 is a good value)\r\n * @param {Number} aspect Desired aspect ratio (Screen width / height)\r\n * @param {Number} near Near clip\r\n * @param {Number} far Far clip\r\n * @return {Atlantis.Matrix} Return a matrix of this type of perspective.\r\n */\r\nAtlantis.Matrix.createPerspetiveFieldOfViewRH = function(fov, aspect, zNear, zFar) {\r\n    var yScale = (1.0 / Math.tan(fov * 0.5));\r\n    var xScale = yScale / aspect;\r\n    var halfWidth = zNear / xScale;\r\n    var halfHeight = zNear / yScale;\r\n\r\n    return Atlantis.Matrix.createPerspectiveOffCenterRH(-halfWidth, halfWidth, -halfHeight, halfHeight, zNear, zFar);\r\n};\r\n\r\n/**\r\n * Create a custom perspective matrix.\r\n * @method createPerspectiveOffCenter\r\n * @static\r\n * @param {Number} left Minimum X value of the viewing volume.\r\n * @param {Number} right Maximum X value of the viewing volume.\r\n * @param {Number} bottom Minimum Y value of the viewing volume.\r\n * @param {Number} top Maximum Y value of the viewing volume.\r\n * @param {Number} zNear Minimum Z value of the viewing volume.\r\n * @param {Number} zFar Maximum Z value of the viewing volume.\r\n * @return {Atlantis.Matrix} Return a new custom perspective matrix.\r\n */\r\nAtlantis.Matrix.createPerspectiveOffCenter = function(left, right, bottom, top, zNear, zFar) {\r\n    var zRange = zFar / (zFar - zNear);\r\n    var matrix = new Atlantis.Matrix();\r\n    matrix.M11 = 2.0 * zNear / (right - left);\r\n    matrix.M22 = 2.0 * zNear / (top - bottom);\r\n    matrix.M31 = (left + right) / (left - right);\r\n    matrix.M32 = (top + bottom) / (bottom - top);\r\n    matrix.M33 = zRange;\r\n    matrix.M34 = 1.0;\r\n    matrix.M43 = -zNear * zRange;\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Create a custom perspective matrix (Right hand).\r\n * @method createPerspectiveOffCenter\r\n * @static\r\n * @param {Number} left Minimum X value of the viewing volume.\r\n * @param {Number} right Maximum X value of the viewing volume.\r\n * @param {Number} bottom Minimum Y value of the viewing volume.\r\n * @param {Number} top Maximum Y value of the viewing volume.\r\n * @param {Number} zNear Minimum Z value of the viewing volume.\r\n * @param {Number} zFar Maximum Z value of the viewing volume.\r\n * @return {Atlantis.Matrix} Return a new custom perspective matrix.\r\n */\r\nAtlantis.Matrix.createPerspectiveOffCenterRH = function(left, right, bottom, top, zNear, zFar) {\r\n    var matrix = Atlantis.Matrix.createPerspectiveOffCenter(left, right, bottom, top, zNear, zFar);\r\n    matrix.M31 *= -1.0;\r\n    matrix.M32 *= -1.0;\r\n    matrix.M33 *= -1.0;\r\n    matrix.M34 *= -1.0;\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Invert the current Matrix.\r\n * @method invert\r\n */\r\nAtlantis.Matrix.prototype.invert = function() {\r\n    var b0 = (this.M31 * this.M42) - (this.M32 * this.M41);\r\n    var b1 = (this.M31 * this.M43) - (this.M33 * this.M41);\r\n    var b2 = (this.M34 * this.M41) - (this.M31 * this.M44);\r\n    var b3 = (this.M32 * this.M43) - (this.M33 * this.M42);\r\n    var b4 = (this.M34 * this.M42) - (this.M32 * this.M44);\r\n    var b5 = (this.M33 * this.M44) - (this.M34 * this.M43);\r\n\r\n    var d11 = this.M22 * b5 + this.M23 * b4 + this.M24 * b3;\r\n    var d12 = this.M21 * b5 + this.M23 * b2 + this.M24 * b1;\r\n    var d13 = this.M21 * -b4 + this.M22 * b2 + this.M24 * b0;\r\n    var d14 = this.M21 * b3 + this.M22 * -b1 + this.M23 * b0;\r\n\r\n    var det = this.M11 * d11 - this.M12 * d12 + this.M13 * d13 - this.M14 * d14;\r\n\r\n    if (Math.abs(det) === 0.0) {\r\n        this.set(this.getZeroValues());\r\n        return;\r\n    }\r\n\r\n    det = 1.0 / det;\r\n\r\n    var a0 = (this.M11 * this.M22) - (this.M12 * this.M21);\r\n    var a1 = (this.M11 * this.M23) - (this.M13 * this.M21);\r\n    var a2 = (this.M14 * this.M21) - (this.M11 * this.M24);\r\n    var a3 = (this.M12 * this.M23) - (this.M13 * this.M22);\r\n    var a4 = (this.M14 * this.M22) - (this.M12 * this.M24);\r\n    var a5 = (this.M13 * this.M24) - (this.M14 * this.M23);\r\n\r\n    var d21 = this.M12 * b5 + this.M13 * b4 + this.M14 * b3;\r\n    var d22 = this.M11 * b5 + this.M13 * b2 + this.M14 * b1;\r\n    var d23 = this.M11 * -b4 + this.M12 * b2 + this.M14 * b0;\r\n    var d24 = this.M11 * b3 + this.M12 * -b1 + this.M13 * b0;\r\n\r\n    var d31 = this.M42 * a5 + this.M43 * a4 + this.M44 * a3;\r\n    var d32 = this.M41 * a5 + this.M43 * a2 + this.M44 * a1;\r\n    var d33 = this.M41 * -a4 + this.M42 * a2 + this.M44 * a0;\r\n    var d34 = this.M41 * a3 + this.M42 * -a1 + this.M43 * a0;\r\n\r\n    var d41 = this.M32 * a5 + this.M33 * a4 + this.M34 * a3;\r\n    var d42 = this.M31 * a5 + this.M33 * a2 + this.M34 * a1;\r\n    var d43 = this.M31 * -a4 + this.M32 * a2 + this.M34 * a0;\r\n    var d44 = this.M31 * a3 + this.M32 * -a1 + this.M33 * a0;\r\n\r\n    this.M11 = +d11 * det;\r\n    this.M12 = -d21 * det;\r\n    this.M13 = +d31 * det;\r\n    this.M14 = -d41 * det;\r\n    this.M21 = -d12 * det;\r\n    this.M22 = +d22 * det;\r\n    this.M23 = -d32 * det;\r\n    this.M24 = +d42 * det;\r\n    this.M31 = +d13 * det;\r\n    this.M32 = -d23 * det;\r\n    this.M33 = +d33 * det;\r\n    this.M34 = -d43 * det;\r\n    this.M41 = -d14 * det;\r\n    this.M42 = +d24 * det;\r\n    this.M43 = -d34 * det;\r\n    this.M44 = +d44 * det;\r\n};\r\n\r\n/**\r\n * Calculate the inverse of the specified matrix.\r\n * @method invert\r\n * @static\r\n * @param matrix The matrix to use.\r\n * @return {Atlantis.Matrix} Return the inverse of the matrix.\r\n */\r\nAtlantis.Matrix.invert = function(matrix) {\r\n    var mat = new Atlantis.Matrix(matrix);\r\n    mat.invert();\r\n    return mat;\r\n};\r\n\r\n/**\r\n * Create a world matrix.\r\n * @method createWorld\r\n * @static\r\n * @param {Atlantis.Vector3} position\r\n * @param {Atlantis.Vector3} forward\r\n * @param {Atlantis.Vector3} upVector\r\n * @return {Atlantis.Matrix} Return a world matrix.\r\n */\r\nAtlantis.Matrix.createWorld = function(position, forward, upVector) {\r\n    var matrix = new Atlantis.Matrix();\r\n\r\n    var x = Atlantis.Vector3.cross(forward, upVector);\r\n    var y = Atlantis.Vector3.cross(x, forward);\r\n    x.normalize();\r\n    y.normalize();\r\n\r\n    matrix.setTranslation(position);\r\n    matrix.M44 = 1.0;\r\n\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Multiply this matrix by another matrix.\r\n * @method multiply\r\n * @param {Atlantis.Matrix} matrix A matrix to multiply.\r\n */\r\nAtlantis.Matrix.prototype.multiply = function(matrix) {\r\n    var m11 = (((this.M11 * matrix.M11) + (this.M12 * matrix.M21)) + (this.M13 * matrix.M31)) + (this.M14 * matrix.M41);\r\n    var m12 = (((this.M11 * matrix.M12) + (this.M12 * matrix.M22)) + (this.M13 * matrix.M32)) + (this.M14 * matrix.M42);\r\n    var m13 = (((this.M11 * matrix.M13) + (this.M12 * matrix.M23)) + (this.M13 * matrix.M33)) + (this.M14 * matrix.M43);\r\n    var m14 = (((this.M11 * matrix.M14) + (this.M12 * matrix.M24)) + (this.M13 * matrix.M34)) + (this.M14 * matrix.M44);\r\n    var m21 = (((this.M21 * matrix.M11) + (this.M22 * matrix.M21)) + (this.M23 * matrix.M31)) + (this.M24 * matrix.M41);\r\n    var m22 = (((this.M21 * matrix.M12) + (this.M22 * matrix.M22)) + (this.M23 * matrix.M32)) + (this.M24 * matrix.M42);\r\n    var m23 = (((this.M21 * matrix.M13) + (this.M22 * matrix.M23)) + (this.M23 * matrix.M33)) + (this.M24 * matrix.M43);\r\n    var m24 = (((this.M21 * matrix.M14) + (this.M22 * matrix.M24)) + (this.M23 * matrix.M34)) + (this.M24 * matrix.M44);\r\n    var m31 = (((this.M31 * matrix.M11) + (this.M32 * matrix.M21)) + (this.M33 * matrix.M31)) + (this.M34 * matrix.M41);\r\n    var m32 = (((this.M31 * matrix.M12) + (this.M32 * matrix.M22)) + (this.M33 * matrix.M32)) + (this.M34 * matrix.M42);\r\n    var m33 = (((this.M31 * matrix.M13) + (this.M32 * matrix.M23)) + (this.M33 * matrix.M33)) + (this.M34 * matrix.M43);\r\n    var m34 = (((this.M31 * matrix.M14) + (this.M32 * matrix.M24)) + (this.M33 * matrix.M34)) + (this.M34 * matrix.M44);\r\n    var m41 = (((this.M41 * matrix.M11) + (this.M42 * matrix.M21)) + (this.M43 * matrix.M31)) + (this.M44 * matrix.M41);\r\n    var m42 = (((this.M41 * matrix.M12) + (this.M42 * matrix.M22)) + (this.M43 * matrix.M32)) + (this.M44 * matrix.M42);\r\n    var m43 = (((this.M41 * matrix.M13) + (this.M42 * matrix.M23)) + (this.M43 * matrix.M33)) + (this.M44 * matrix.M43);\r\n    var m44 = (((this.M41 * matrix.M14) + (this.M42 * matrix.M24)) + (this.M43 * matrix.M34)) + (this.M44 * matrix.M44);\r\n\r\n    this.M11 = m11;\r\n    this.M12 = m12;\r\n    this.M13 = m13;\r\n    this.M14 = m14;\r\n    this.M21 = m21;\r\n    this.M22 = m22;\r\n    this.M23 = m23;\r\n    this.M24 = m24;\r\n    this.M31 = m31;\r\n    this.M32 = m32;\r\n    this.M33 = m33;\r\n    this.M34 = m34;\r\n    this.M41 = m41;\r\n    this.M42 = m42;\r\n    this.M43 = m43;\r\n    this.M44 = m44;\r\n};\r\n\r\n/**\r\n * Multiply a two matrix.\r\n * @method multiply\r\n * @static\r\n * @param {Atlantis.Matrix} matrixA A matrix.\r\n * @param {Atlantis.Matrix} matrixB Another matrix.\r\n * @param {Atlantis.Matrix} matrixC Another matrix (optional).\r\n * @return {Atlantis.Matrix} Return a new matrix.\r\n */\r\nAtlantis.Matrix.multiply = function(matrixA, matrixB, matrixC) {\r\n    var matrix = new Atlantis.Matrix(matrixA);\r\n    matrix.multiply(matrixB);\r\n\r\n    if (matrixC instanceof Atlantis.Matrix) {\r\n        matrix.multiply(matrixC);\r\n    }\r\n\r\n    return matrix;\r\n};\r\n\r\n/**\r\n * Subtract a matrix to this matrix.\r\n * @method subtract\r\n * @param {Atlantis.Matrix} matrix A matrix to add.\r\n */\r\nAtlantis.Matrix.prototype.subtract = function(matrix) {\r\n    var mValues = this.toArray();\r\n    var eValues = matrix.toArray();\r\n\r\n    for (var i = 0; i < 16; i++) {\r\n        mValues[i] -= eValues[i];\r\n    }\r\n    this.set(mValues);\r\n};\r\n\r\n/**\r\n * Subtract two matrix.\r\n * @method subtract\r\n * @static\r\n * @param {Atlantis.Matrix} matA A matrix.\r\n * @param {Atlantis.Matrix} matB Another matrix to use to subtract with the first matrix.\r\n * @return {Atlantis.Matrix} Return a new matrix.\r\n */\r\nAtlantis.Matrix.subtract = function(matA, matB) {\r\n    var mat = new Atlantis.Matrix(matA);\r\n    mat.subtract(matB);\r\n    return mat;\r\n};\r\n\r\n/**\r\n * Gets a string from this object.\r\n * @method toString\r\n * @return {String}\r\n */\r\nAtlantis.Matrix.prototype.toString = function() {\r\n    var values = this.toArray();\r\n    var builder = [];\r\n\r\n    for (var i = 0; i < 16; i += 4) {\r\n        builder.push(\"[\");\r\n        builder.push(values[i] + \" \");\r\n        builder.push(values[i + 1] + \" \");\r\n        builder.push(values[i + 2] + \" \");\r\n        builder.push(values[i + 3]);\r\n        builder.push(\"] \");\r\n    }\r\n    return builder.join(\"\");\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = Atlantis || {};\r\n\r\n/**\r\n * Describes a quaternion.\r\n * @class Quaternion\r\n * @constructor\r\n * @param {Number|Quaternion} x Value for X coordinate.\r\n * @param {Quaternion} y Value for Y coordinate.\r\n * @param {Quaternion} z Value for Z coordinate.\r\n * @param {Quaternion} w Value for W coordinate.\r\n */\r\nAtlantis.Quaternion = function(x, y, z, w) {\r\n    this.x = x ? +x : 0;\r\n    this.y = y ? +y : 0;\r\n    this.z = z ? +z : 0;\r\n    this.z = w ? +w : 0;\r\n};\r\n\r\nAtlantis.Quaternion.prototype.fromQuaternion = function(quaternion) {\r\n    this.x = quaternion.x;\r\n    this.y = quaternion.y;\r\n    this.z = quaternion.z;\r\n    this.w = quaternion.w;\r\n};\r\n\r\n/**\r\n * Gets an Quaternion sets to identity.\r\n * @method Identity\r\n * @return {Atlantis.Quaternion} Return a new Quaternion sets to identity.\r\n */\r\nAtlantis.Quaternion.Identity = function() {\r\n    return new Atlantis.Quaternion(0, 0, 0, 1);\r\n};\r\n\r\n/**\r\n * Add a Quaternion to this quaternion.\r\n * @method add\r\n */\r\nAtlantis.Quaternion.prototype.add = function(quaternion) {\r\n    this.x += quaternion.x;\r\n    this.y += quaternion.y;\r\n    this.z += quaternion.z;\r\n    this.w += quaternion.w;\r\n};\r\n\r\n/**\r\n * Add two quaternions.\r\n * @method add\r\n * @static\r\n * @method {Atlantis.Quaternion} quaternion1\r\n * @method {Atlantis.Quaternion} quaternion1\r\n * @return {Atlantis.Quaternion} Return a new quaternion.\r\n */\r\nAtlantis.Quaternion.add = function(quaternion1, quaternion2) {\r\n    var result = new Atlantis.Quaternion(quaternion1);\r\n    result.add(quaternion2);\r\n    return result;\r\n};\r\n\r\n/**\r\n * Conjugate the Quaternion.\r\n * @method conjugate\r\n */\r\nAtlantis.Quaternion.prototype.conjugate = function() {\r\n    this.x *= -1;\r\n    this.y *= -1;\r\n    this.z *= -1;\r\n};\r\n\r\n/**\r\n * Gets a quaternion who's the conjugate of the quaternion passed to parameter.\r\n * @method conjugate\r\n * @static\r\n * @param {Atlantis.Quaternion} A quaterion to conjugate.\r\n * @return {Atlantis.Quaternion} Return a new conjugate Quaternion.\r\n */\r\nAtlantis.Quaternion.conjugate = function(quaternion) {\r\n    var result = new Atlantis.Quaternion(quaternion);\r\n    result.conjugate();\r\n    return result;\r\n};\r\n\r\n/**\r\n * Create a quaternion with three rotations\r\n * @param yaw Value of yaw rotation (Y)\r\n * @param pitch Value of pitch rotation (X)\r\n * @param roll Value of roll rotation (Z)\r\n * @return Return a quaternion with three rotations.\r\n */\r\nAtlantis.Quaternion.createFromYawPitchRoll = function(yaw, pitch, roll) {\r\n    var result = new Atlantis.Quaternion();\r\n\r\n    var halfYaw = yaw * 0.5;\r\n    var halfPitch = pitch * 0.5;\r\n    var halfRoll = roll * 0.5;\r\n\r\n    var sinYaw = Math.sin(halfYaw);\r\n    var cosYaw = Math.cos(halfYaw);\r\n    var sinPitch = Math.sin(halfPitch);\r\n    var cosPitch = Math.cos(halfPitch);\r\n    var sinRoll = Math.sin(halfRoll);\r\n    var cosRoll = Math.cos(halfRoll);\r\n\r\n    result.x = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\r\n    result.y = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\r\n    result.z = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\r\n    result.w = (cosYaw * cosPitch * cosRoll) - (sinYaw * sinPitch * sinRoll);\r\n\r\n    return result;\r\n};\r\n\r\nAtlantis.Quaternion.prototype.clone = function() {\r\n    return new Atlantis.Quaternion(this.x, this.y, this.z, this.w);\r\n};\r\n\r\n/**\r\n * Gets a string from this object.\r\n * @method toString\r\n * @return {String}\r\n */\r\nAtlantis.Quaternion.prototype.toString = function() {\r\n    return [\"x: \", this.x, \" y: \", this.y, \" z: \", this.z, \" w: \", this.w].join(\"\");\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * Describes a point.\r\n * @constructor\r\n * @class Point\r\n * @param {Number} x A value for X coordinate.\r\n * @param {Number} y A value for Y coordinate.\r\n */\r\nAtlantis.Point = function (x, y) {\r\n    this.x = x ? +x : 0;\r\n    this.y = y ? +y : 0;\r\n};\r\n\r\nAtlantis.Point.clone = function (x, y) {\r\n    return new Atlantis.Point(this.x, this.y);\r\n};\r\n\r\n/**\r\n* Gets a string from this object.\r\n* @method toString\r\n* @return {String}\r\n*/\r\nAtlantis.Point.prototype.toString = function () {\r\n    return [\"x: \", this.x, \" y: \", this.y].join(\"\");\r\n};\r\n\r\n/**\r\n* Describes a 2D-vector.\r\n* @constructor\r\n* @class Vector2\r\n*/\r\nAtlantis.Vector2 = function (x, y) {\r\n    this.x = x ? +x : 0;\r\n    this.y = y ? +y : 0;\r\n};\r\n\r\nAtlantis.Vector2.prototype.fromVector = function(vector) {\r\n    this.x = vector.x;\r\n    this.y = vector.y;\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with all coordinates sets to zero.\r\n * @method Zero\r\n */\r\nAtlantis.Vector2.Zero = function () {\r\n    return new Atlantis.Vector2(0.0, 0.0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with all coordinates sets to one.\r\n * @method One\r\n */\r\nAtlantis.Vector2.One = function () {\r\n    return new Atlantis.Vector2(1.0, 1.0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with X coordinate set to one.\r\n * @method UnitX\r\n */\r\nAtlantis.Vector2.UnitX = function () {\r\n    return new Atlantis.Vector2(1.0, 0.0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with Y coordinate set to one.\r\n * @method UnitY\r\n */\r\nAtlantis.Vector2.UnitY = function () {\r\n    return new Atlantis.Vector2(0.0, 1.0);\r\n};\r\n\r\n/**\r\n* Add this vector by another vector or value.\r\n* @method add\r\n* @param {Atlantis.Vector2} value A vector or a value to add to this vector.\r\n*/\r\nAtlantis.Vector2.prototype.add = function (value) {\r\n    if (typeof(value) === \"number\") {\r\n        this.x += value;\r\n        this.y += value;\r\n    }\r\n    else {\r\n        this.x += value.x;\r\n        this.y += value.y;\r\n    }\r\n};\r\n\r\n/**\r\n* Add two vectors.\r\n* @method add\r\n* @static\r\n* @param {Atlantis.Vector2} A vector.\r\n* @param {Atlantis.Vector2} Another vector.\r\n*/\r\nAtlantis.Vector2.add = function (vec1, vec2) {\r\n    var vector = vec1.clone();\r\n    vector.add(vec2);\r\n    return vector;\r\n};\r\n\r\nAtlantis.Vector2.addToRef = function (vec1, vec2, result) {\r\n    result.x = vec1.x + vec2.x;\r\n    result.y = vec1.y + vec2.y;\r\n};\r\n\r\n/**\r\n* Substract this vector by another vector or value.\r\n* @method subtract\r\n* @param {Atlantis.Vector2} value A vector or a value to subtract to this vector.\r\n*/\r\nAtlantis.Vector2.prototype.subtract = function (value) {\r\n    if (typeof(value) === \"number\") {\r\n        this.x -= value;\r\n        this.y -= value;\r\n    }\r\n    else {\r\n        this.x -= value.x;\r\n        this.y -= value.y;\r\n    }\r\n};\r\n\r\n/**\r\n* Subtract two vectors.\r\n* @method subtract\r\n* @static\r\n* @param {Atlantis.Vector2} A vector.\r\n* @param {Atlantis.Vector2} Another vector.\r\n*/\r\nAtlantis.Vector2.subtract = function (vec1, vec2) {\r\n    var vector = vec1.clone();\r\n    vector.subtract(vec2);\r\n    return vector;\r\n};\r\n\r\nAtlantis.Vector2.subtractToRef = function (vec1, vec2, result) {\r\n    result.x = vec1.x - vec2.x;\r\n    result.y = vec1.y - vec2.y;\r\n};\r\n\r\n/**\r\n* Divide this vector by another vector\r\n* @method divide\r\n* @param {Atlantis.Vector2} value A vector or a value to divide to this vector.\r\n*/\r\nAtlantis.Vector2.prototype.divide = function (value) {\r\n    if (typeof(value) === \"number\") {\r\n        this.x /= value;\r\n        this.y /= value;\r\n    }\r\n    else {\r\n        this.x /= value.x;\r\n        this.y /= value.y;\r\n    }\r\n};\r\n\r\n/**\r\n* Divide two vectors.\r\n* @method divide\r\n* @static\r\n* @param {Atlantis.Vector2} A vector.\r\n* @param {Atlantis.Vector2} Another vector.\r\n*/\r\nAtlantis.Vector2.divide = function (vec1, vec2) {\r\n    var vector = vec1.clone();\r\n    vector.divide(vec2);\r\n    return vector;\r\n};\r\n\r\nAtlantis.Vector2.divideToRef = function (vec1, vec2, result) {\r\n    result.x = vec1.x / vec2.x;\r\n    result.y = vec1.y / vec2.y;\r\n};\r\n\r\n/**\r\n* Multiply this vector by another vector or a value.\r\n* @method multiply\r\n* @param {Atlantis.Vector2} value A vector or a value to multiply to this vector.\r\n*/\r\nAtlantis.Vector2.prototype.multiply = function (value) {\r\n    if (typeof(value) === \"number\") {\r\n        this.x *= value;\r\n        this.y *= value;\r\n    }\r\n    else {\r\n        this.x *= value.x;\r\n        this.y *= value.y;\r\n    }\r\n};\r\n\r\n/**\r\n* Multiply two vectors.\r\n* @method multiply\r\n* @static\r\n* @param {Atlantis.Vector2} A vector.\r\n* @param {Atlantis.Vector2} Another vector.\r\n*/\r\nAtlantis.Vector2.multiply = function (vec1, vec2) {\r\n    var vector = vec1.clone();\r\n    vector.multiply(vec2);\r\n    return vector;\r\n};\r\n\r\nAtlantis.Vector2.multiplyToRef = function (vec1, vec2, result) {\r\n    result.x = vec1.x * vec2.x;\r\n    result.y = vec1.y * vec2.y;\r\n};\r\n\r\n/**\r\n* Gets distance between this vector and the vector passed in parameter.\r\n* @method getDistance\r\n* @param {Atlantis.Vector2} vector2 The vector2 to use to determine the distance.\r\n* @return {Number} The distance between this vector and the vector passed in parameter.\r\n*/\r\nAtlantis.Vector2.prototype.distance = function (vector2) {\r\n    return Atlantis.Vector2.distance(this, vector2);\r\n};\r\n\r\n/**\r\n* Gets the distance between two vectors.\r\n* @method distance\r\n* @static\r\n* @param {Atlantis.Vector2} A vector.\r\n* @param {Atlantis.Vector2} Another vector.\r\n*/\r\nAtlantis.Vector2.distance = function (vec1, vec2) {\r\n    var v1 = vec1.x - vec2.x;\r\n    var v2 = vec1.y - vec2.y;\r\n    return Math.sqrt((v1 * v1) + (v2 * v2));\r\n};\r\n\r\nAtlantis.Vector2.prototype.dot = function (vec2) {\r\n    return Atlantis.Vector2.dot(this, vec2);\r\n};\r\n\r\n/**\r\n* Calculate the dot product of two vectors.\r\n* @method dot\r\n* @static\r\n* @param {Atlantis.Vector2} First vector to use.\r\n* @param {Atlantis.Vector2} Second vector to use.\r\n* @return {Number} Return the dot product of the two vectors.\r\n*/\r\nAtlantis.Vector2.dot = function (vec1, vec2) {\r\n    return (vec1.x * vec2.x) + (vec1.y * vec2.y);\r\n};\r\n\r\n/**\r\n* Gets the length of the vector.\r\n* @return {Number} Return the length of the vector.\r\n*/\r\nAtlantis.Vector2.prototype.length = function () {\r\n    return Atlantis.Vector2.length(this);\r\n};\r\n\r\nAtlantis.Vector2.length = function (vec2) {\r\n    return Math.sqrt((vec2.x * vec2.x) + (vec2.y * vec2.y));\r\n};\r\n\r\n/**\r\n* Performs a linear interpolation between to vectors.\r\n* @method lerp\r\n* @static\r\n* @param {Atlantis.Vector2} First vector to use.\r\n* @param {Atlantis.Vector2} Second vector to use.\r\n* @param amount\r\n* @return\r\n*/\r\nAtlantis.Vector2.lerp = function (vec1, vec2, amount) {\r\n    var vector = new Atlantis.Vector2.Zero();\r\n    Atlantis.Vector2.lerpToRef(vec1, vec2, amount, vector);\r\n    return vector;\r\n};\r\n\r\nAtlantis.Vector2.lerpToRef = function (vec1, vec2, amount, result) {\r\n    result.x = Atlantis.MathHelper.lerp(vec1.x, vec2.x, amount);\r\n    result.y = Atlantis.MathHelper.lerp(vec1.y, vec2.y, amount);\r\n};\r\n\r\n/**\r\n* Gets a vector of the minimum of the two vectors.\r\n* @method min\r\n* @static\r\n* @param vec1\r\n* @param vec2\r\n* @return Return a vector that correspond of the minimum of the two vectors.\r\n*/\r\nAtlantis.Vector2.min = function (vec1, vec2) {\r\n    var result = new Atlantis.Vector2();\r\n    Atlantis.Vector2.minToRef(vec1, vec2, result);\r\n    return result;\r\n};\r\n\r\nAtlantis.Vector2.minToRef = function (vec1, vec2, result) {\r\n    result.x = (vec1.x < vec2.x) ? vec1.x : vec2.x;\r\n    result.y = (vec1.y < vec2.y) ? vec1.y : vec2.y;\r\n};\r\n\r\n/**\r\n* Gets a vector of the maximum of the two vectors.\r\n* @method max\r\n* @static\r\n* @param vec1\r\n* @param vec2\r\n* @return Return a vector that correspond of the maximum of the two vectors.\r\n*/\r\nAtlantis.Vector2.max = function (vec1, vec2) {\r\n    var result = Atlantis.Vector2.Zero();\r\n    Atlantis.Vector2.maxToRef(vec1, vec2, result);\r\n    return result;\r\n};\r\n\r\nAtlantis.Vector2.maxToRef = function (vec1, vec2, result) {\r\n    result.x = (vec1.x > vec2.x) ? vec1.x : vec2.x;\r\n    result.y = (vec1.y > vec2.y) ? vec1.y : vec2.y;\r\n};\r\n\r\n/**\r\n* Negate this vector\r\n* @method negate\r\n*/\r\nAtlantis.Vector2.prototype.negate = function (value) {\r\n    if (typeof(value) === \"number\") {\r\n        this.x = -value;\r\n        this.y = -value;\r\n    }\r\n    else {\r\n        this.x = -value.x;\r\n        this.y = -value.y;\r\n    }\r\n};\r\n\r\n/**\r\n* Negate a vector.\r\n* @method negate\r\n* @static\r\n* @param {Atlantis.Vector2} A vector to use.\r\n* @return {Atlantis.Vector2} Return the negated vector.\r\n*/\r\nAtlantis.Vector2.negate = function (vector) {\r\n    var vec = vector.clone();\r\n    vec.x *= -1;\r\n    vec.y *= -1;\r\n    return vec;\r\n};\r\n\r\n/**\r\n* Normalize this vector.\r\n* @method normalize\r\n*/\r\nAtlantis.Vector2.prototype.normalize = function () {\r\n    Atlantis.Vector2.normalizeToRef(this);\r\n};\r\n\r\n/** Gets a normalized vector.\r\n* \r\n* @method normalize\r\n* @static\r\n* @param {Atlantis.Vector2} A vector to normalize.\r\n*/\r\nAtlantis.Vector2.normalize = function (vector) {\r\n    var vec = vector.clone();\r\n    vec.normalize();\r\n    return vec;\r\n};\r\n\r\nAtlantis.Vector2.normalizeToRef = function (vector) {\r\n    var distance = Math.sqrt((vector.x * vector.x) + (vector.y * vector.y));\r\n\r\n    if (!distance) {\r\n        vector.x = 0;\r\n        vector.y = 0;\r\n    }\r\n\r\n    var value = 1.0 / distance;\r\n    \r\n    vector.x *= value;\r\n    vector.y *= value;\r\n};\r\n\r\nAtlantis.Vector2.reflect = function (vector, normal) {\r\n    var result = new Atlantis.Vector2();\r\n    Atlantis.ReflectToRef(vector, normal, result);\r\n    return result;\r\n};\r\n\r\nAtlantis.Vector2.reflectToRef = function (vector, normal, result) {\r\n    var val = 2 * ((vector.x * normal.x) + (vector.y * normal.y));\r\n    result.x = vector.x - (normal.x * val);\r\n    result.y = vector.y - (normal.y * val);\r\n};\r\n\r\nAtlantis.Vector2.smoothStep = function (value1, value2, amount) {\r\n    var result = new Atlantis.Vector2();\r\n    Atlantis.Vector2.smoothStepToRef(value1, value2, amount, result);\r\n    return result;\r\n};\r\n\r\nAtlantis.Vector2.smoothStepToRef = function (value1, value2, amount, result) {\r\n    result.x = Atlantis.MathHelper.smoothStep(value1.x, value2.x, amount);\r\n    result.y = Atlantis.MathHelper.smoothStep(value1.y, value2.y, amount);\r\n};\r\n\r\n/**\r\n* Gets a transformed vector from a position and a matrix.\r\n* @method transform\r\n* @param {Atlantis.Vector2} position\r\n* @param {Atlantis.Matrix} matrix\r\n* @return {Atlantis.Vector2} A tranformed vector.\r\n*/\r\nAtlantis.Vector2.transform = function (position, matrix) {\r\n    var vector = new Atlantis.Vector3();\r\n    Atlantis.Vector2.transformToRef(position, matrix, vector);\r\n    return vector;\r\n};\r\n\r\nAtlantis.Vector2.transformToRef = function (position, matrix, result) {\r\n    var x = (position.x * matrix.M11) + (position.y * matrix.M21) + matrix.M41;\r\n    var y = (position.x * matrix.M12) + (position.y * matrix.M22) + matrix.M42;\r\n    result.x = x;\r\n    result.x = y;\r\n};\r\n\r\nAtlantis.Vector2.transformNormal = function (normal, matrix) {\r\n    var vector = new Atlantis.Vector3();\r\n    Atlantis.Vector2.transformNormalToRef(normal, matrix, vector);\r\n    return vector;\r\n};\r\n\r\nAtlantis.Vector2.transformNormalToRef = function (normal, matrix, result) {\r\n    var x = (normal.x * matrix.M11) + (normal.y * matrix.M21);\r\n    var y = (normal.x * matrix.M12) + (normal.y * matrix.M22);\r\n    result.x = x;\r\n    result.y = y;\r\n};\r\n\r\n/**\r\n* Sets the coordinates.\r\n* @method set\r\n* @param {Number} X value.\r\n* @param {Number} Y value.\r\n*/\r\nAtlantis.Vector2.prototype.set = function (x, y) {\r\n    this.x = x;\r\n    this.y = y;\r\n};\r\n\r\nAtlantis.Vector2.prototype.clone = function () {\r\n    return new Atlantis.Vector2(this.x, this.y);\r\n};\r\n\r\n/**\r\n * Gets a string from this object.\r\n * @method toString\r\n * @return {String}\r\n */\r\nAtlantis.Vector2.prototype.toString = function () {\r\n    return [\"x: \", this.x, \" y: \", this.y].join(\"\");\r\n};\r\n\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * Describes a 3D-vector.\r\n * @constructor\r\n * @class Vector3\r\n * @param {Number|Atlantis.Vector3} The X value or a Vector3 object     * @param {Number} The Y value.\r\n * @param {Number} The Z value.\r\n */\r\nAtlantis.Vector3 = function(x, y, z) {\r\n    this.x = x ? +x : 0;\r\n    this.y = y ? +y : 0;\r\n    this.z = z ? +z : 0;\r\n};\r\n\r\nAtlantis.Vector3.prototype.fromVector = function (vector) {\r\n   this.x = vector.x;\r\n   this.y = vector.y;\r\n   this.z = vector.z;\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with all coordinates sets to zero.\r\n * @method Zero\r\n */\r\nAtlantis.Vector3.Zero = function() {\r\n    return new Atlantis.Vector3(0, 0, 0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with all coordinates sets to one.\r\n * @method One\r\n */\r\nAtlantis.Vector3.One = function() {\r\n    return new Atlantis.Vector3(1.0, 1.0, 1.0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with X coordinate set to one.\r\n * @method UnitX\r\n */\r\nAtlantis.Vector3.UnitX = function() {\r\n    return new Atlantis.Vector3(1.0, 0.0, 0.0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with Y coordinate set to one.\r\n * @method UnitY\r\n */\r\nAtlantis.Vector3.UnitY = function() {\r\n    return new Atlantis.Vector3(0.0, 1.0, 0.0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with Z coordinate set to one.\r\n * @method UnitZ\r\n */\r\nAtlantis.Vector3.UnitZ = function() {\r\n    return new Atlantis.Vector3(0.0, 0.0, 1.0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with Y coordinate set to one.\r\n * @method Up\r\n */\r\nAtlantis.Vector3.Up = function() {\r\n    return new Atlantis.Vector3(0.0, 1.0, 0.0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with Y coordinate set to -1.\r\n * @method Down\r\n */\r\nAtlantis.Vector3.Down = function() {\r\n    return new Atlantis.Vector3(0.0, -1.0, 0.0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with X coordinate set to one.\r\n * @method Right\r\n */\r\nAtlantis.Vector3.Right = function() {\r\n    return new Atlantis.Vector3(1.0, 0.0, 0.0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with X coordinate set to -1.\r\n * @method Left\r\n */\r\nAtlantis.Vector3.Left = function() {\r\n    return new Atlantis.Vector3(-1.0, 0.0, 0.0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with Z coordinate set to -1.\r\n * @method Forward\r\n */\r\nAtlantis.Vector3.Forward = function() {\r\n    return new Atlantis.Vector3(0.0, 0.0, -1.0);\r\n};\r\n\r\n/**\r\n * Gets a Vector3 with Z coordinate set to one.\r\n * @method Backward\r\n */\r\nAtlantis.Vector3.Backward = function() {\r\n    return new Atlantis.Vector3(0.0, 0.0, 1.0);\r\n};\r\n\r\n/**\r\n * Add a Vector3 to the current vector.\r\n * @method add\r\n * @param {Number|Atlantis.Vector3} vector The Vector3 to add.\r\n */\r\nAtlantis.Vector3.prototype.add = function(vector) {\r\n    if (vector instanceof Atlantis.Vector3) {\r\n        this.x += vector.x;\r\n        this.y += vector.y;\r\n        this.z += vector.z;\r\n    } else {\r\n        this.x += vector;\r\n        this.y += vector;\r\n        this.z += vector;\r\n    }\r\n};\r\n\r\n/**\r\n * Add two vectors.\r\n * @method add\r\n * @static\r\n * @param {Atlantis.Vector3} vec1\r\n * @param {Atlantis.Vector3} vec2\r\n * @return {Atlantis.Vector3} Return a new Vector3\r\n */\r\nAtlantis.Vector3.add = function(vec1, vec2) {\r\n    var result = new Atlantis.Vector3(vec1);\r\n    result.add(vec2);\r\n    return result;\r\n};\r\n\r\n/**\r\n * Subtract a Vector3 to the current vector.\r\n * @method subtract\r\n * @param {Number|Atlantis.Vector3} vector The Vector3 to Subtract.\r\n */\r\nAtlantis.Vector3.prototype.subtract = function(vector) {\r\n    if (vector instanceof Atlantis.Vector3) {\r\n        this.x -= vector.x;\r\n        this.y -= vector.y;\r\n        this.z -= vector.z;\r\n    } else {\r\n        this.x -= vector;\r\n        this.y -= vector;\r\n        this.z -= vector;\r\n    }\r\n};\r\n\r\n/**\r\n * Subtract two vectors.\r\n * @method subtract\r\n * @static\r\n * @param {Atlantis.Vector3} vec1\r\n * @param {Atlantis.Vector3} vec2\r\n * @return {Atlantis.Vector3} Return a news Vector3.\r\n */\r\nAtlantis.Vector3.subtract = function(vec1, vec2) {\r\n    var result = new Atlantis.Vector3(vec1);\r\n    result.subtract(vec2);\r\n    return result;\r\n};\r\n\r\n/**\r\n * divide a Vector3 to the current vector.\r\n * @method divide\r\n * @param {Atlantis.Vector3} vector The Vector3 to divide.\r\n */\r\nAtlantis.Vector3.prototype.divide = function(vector) {\r\n    if (vector.x !== 0) {\r\n        this.x /= vector.x;\r\n    }\r\n    if (vector.y !== 0) {\r\n        this.y /= vector.y;\r\n    }\r\n    if (vector.z !== 0) {\r\n        this.z /= vector.z;\r\n    }\r\n};\r\n\r\n/**\r\n * Divide two vectors.\r\n * @method divide\r\n * @static\r\n * @param {Atlantis.Vector3} vec1\r\n * @param {Atlantis.Vector3} vec2\r\n * @return {Atlantis.Vector3} Return a new Vector3.\r\n */\r\nAtlantis.Vector3.divide = function(vec1, vec2) {\r\n    var vector = new Atlantis.Vector3(vec1);\r\n    vector.divide(vec2);\r\n    return vector;\r\n};\r\n\r\n/**\r\n * multiply a Vector3 to the current vector.\r\n * @method multiply\r\n * @param {Number|Atlantis.Vector3} vector The Vector3 to multiply.\r\n */\r\nAtlantis.Vector3.prototype.multiply = function(vector) {\r\n    if (vector instanceof Atlantis.Vector3) {\r\n        this.x *= vector.x;\r\n        this.y *= vector.y;\r\n        this.z *= vector.z;\r\n    } else {\r\n        this.x *= vector;\r\n        this.y *= vector;\r\n        this.z *= vector;\r\n    }\r\n};\r\n\r\n/**\r\n * Multiply a two vectors.\r\n * @method multiply\r\n * @param {Atlantis.Vector3} A vector.\r\n * @param {Atlantis.Vector3} Another vector.\r\n * @return {Atlantis.Vector3} Return a new vector.\r\n */\r\nAtlantis.Vector3.multiply = function(vec1, vec2) {\r\n    var vector = new Atlantis.Vector3(vec1);\r\n    vector.multiply(vec2);\r\n    return vector;\r\n};\r\n\r\n/**\r\n * Calculates the cross products of two vectors.\r\n * @method cross\r\n * @static\r\n * @param {Atlantis.Vector3} vec1 Fist vector to use.\r\n * @param {Atlantis.Vector3} vec2 Second vector to use.\r\n * @return {Atlantis.Vector3} the cross products of the two vectors.\r\n */\r\nAtlantis.Vector3.cross = function(vec1, vec2) {\r\n    var vector = new Atlantis.Vector3();\r\n    vector.x = (vec1.y * vec2.z) - (vec2.y * vec1.z);\r\n    vector.y = -((vec1.x * vec2.z) - (vec2.x * vec1.z));\r\n    vector.z = (vec1.x * vec2.y) - (vec2.x * vec1.y);\r\n    return vector;\r\n};\r\n\r\n/**\r\n * Gets the distance between two vectors.\r\n * @method distance\r\n * @static\r\n * @param {Atlantis.Vector3} vector\r\n * @return {Number} Return the distance between two vectors.\r\n */\r\nAtlantis.Vector3.distance = function(vec1, vec2) {\r\n    return Math.sqrt(Atlantis.Vector3.distanceSquared(vec1, vec2));\r\n};\r\n\r\n/**\r\n * Gets the distance squared between to vectors.\r\n * @method distanceSquared\r\n * @param {Atlantis.Vector3} vec1\r\n * @param {Atlantis.Vector3} vec2\r\n * @return {Number}\r\n */\r\nAtlantis.Vector3.distanceSquared = function(vec1, vec2) {\r\n    var dx = vec1.x - vec2.x;\r\n    var dy = vec1.y - vec2.y;\r\n    var dz = vec1.z - vec2.z;\r\n    return (dx * dx) + (dy * dy) + (dz * dz);\r\n};\r\n\r\n/**\r\n * Calculates the dot product of two vectors.\r\n * @method dot\r\n * @static\r\n * @param {Atlantis.Vector3} vec1 First vector to use.\r\n * @param {Atlantis.Vector3} vec2 Second vector to use.\r\n * @return {Number} Return the dot product of two vectors.\r\n */\r\nAtlantis.Vector3.dot = function(vec1, vec2) {\r\n    return (vec1.x * vec2.x) + (vec1.y * vec2.y) + (vec1.z * vec2.z);\r\n};\r\n\r\n/**\r\n * Gets the length of the vector.\r\n * @method length\r\n * @return {Number} Return the length of the vector.\r\n */\r\nAtlantis.Vector3.prototype.length = function() {\r\n    return Math.sqrt((this.x * this.x) + (this.y * this.y) + (this.z * this.z));\r\n};\r\n\r\n/**\r\n * Linear interpolation between this vector and the vector passed in parameter.\r\n * @method lerp\r\n * @param {Atlantis.Vector3} vector A vector to use for interpolation\r\n * @param {Number} amount Value between 0 and 1 indicating the weight of vector.\r\n */\r\nAtlantis.Vector3.prototype.lerp = function(vector, amount) {\r\n    this.x = Atlantis.MathHelper.lerp(this.x, vector.x, amount);\r\n    this.y = Atlantis.MathHelper.lerp(this.y, vector.y, amount);\r\n    this.z = Atlantis.MathHelper.lerp(this.z, vector.z, amount);\r\n};\r\n\r\n/**\r\n * Linearly interpolates between two vectors.\r\n * @method lerp\r\n * @static\r\n * @param {Atlantis.Vector3} vec1 First vector\r\n * @param {Atlantis.Vector3} vec2 Second vector\r\n * @param {Number} amount Value between 0 and 1 indicating the weight of vec2.\r\n * @return {Atlantis.Vector3} Return a interpolated Vector3.\r\n */\r\nAtlantis.Vector3.lerp = function(vec1, vec2, amount) {\r\n    var x = Atlantis.MathHelper.lerp(vec1.x, vec2.x, amount);\r\n    var y = Atlantis.MathHelper.lerp(vec1.y, vec2.y, amount);\r\n    var z = Atlantis.MathHelper.lerp(vec1.z, vec2.z, amount);\r\n    return new Atlantis.Vector3(x, y, z);\r\n};\r\n\r\n/**\r\n * Gets a vector of the minimum of the two vectors.\r\n * @method min\r\n * @static\r\n * @param {Atlantis.Vector3} vec1\r\n * @param {Atlantis.Vector3} vec2\r\n * @return {Atlantis.Vector3} Return a vector that correspond of the minimum of the two vectors.\r\n */\r\nAtlantis.Vector3.min = function(vec1, vec2) {\r\n    var vector = new Atlantis.Vector3();\r\n    vector.x = (vec1.x < vec2.x) ? vec1.x : vec2.x;\r\n    vector.y = (vec1.y < vec2.y) ? vec1.y : vec2.y;\r\n    vector.z = (vec1.z < vec2.z) ? vec1.z : vec2.z;\r\n    return vector;\r\n};\r\n\r\n/**\r\n * Gets a vector of the maximum of the two vectors.\r\n * @method max\r\n * @static\r\n * @param {Atlantis.Vector3} vec1\r\n * @param {Atlantis.Vector3} vec2\r\n * @return {Atlantis.Vector3} Return a vector that correspond of the maximum of the two vectors.\r\n */\r\nAtlantis.Vector3.max = function(vec1, vec2) {\r\n    var vector = new Atlantis.Vector3();\r\n    vector.x = (vec1.x > vec2.x) ? vec1.x : vec2.x;\r\n    vector.y = (vec1.y > vec2.y) ? vec1.y : vec2.y;\r\n    vector.z = (vec1.z > vec2.z) ? vec1.z : vec2.z;\r\n    return vector;\r\n};\r\n\r\n/**\r\n * Negate the vector.\r\n * @method negate\r\n */\r\nAtlantis.Vector3.prototype.negate = function() {\r\n    this.x *= -1;\r\n    this.y *= -1;\r\n    this.z *= -1;\r\n};\r\n\r\n/**\r\n * Negate a vector.\r\n * @method negate\r\n * @static\r\n * @param {Atlantis.Vector3} vector The vector to negate.\r\n * @return {Atlantis.Vector3} Return a negated vector.\r\n */\r\nAtlantis.Vector3.negate = function(vector) {\r\n    var vec = new Atlantis.Vector3(vector);\r\n    vec.negate();\r\n    return vec;\r\n};\r\n\r\n/**\r\n * Normalize vector.\r\n * @static\r\n * @method normalize\r\n */\r\nAtlantis.Vector3.prototype.normalize = function() {\r\n    var factor = Atlantis.Vector3.distance(this, new Atlantis.Vector3());\r\n\r\n    if (factor !== 0) {\r\n        factor = 1.0 / factor;\r\n        this.set(this.x * factor, this.y * factor, this.z * factor);\r\n    }\r\n};\r\n\r\n/**\r\n * Normalize a vector.\r\n * @method normalize\r\n * @param {Atlantis.Vector3} vector A vector to normalize.\r\n * @return {Atlantis.Vector3} result A normalized vector.\r\n */\r\nAtlantis.Vector3.normalize = function(vector) {\r\n    var result = new Atlantis.Vector3(vector);\r\n    result.normalize();\r\n    return result;\r\n};\r\n\r\n/**\r\n * Gets a transformed Vector3 from a position and a matrix.\r\n * @method tranform\r\n * @static\r\n * @param {Atlantis.Vector3} position\r\n * @param {Atlantis.Matrix} matrix\r\n * @return {Atlantis.Vector3} A tranformed vector.\r\n */\r\nAtlantis.Vector3.transform = function(position, matrix) {\r\n    var vector = new Atlantis.Vector3(\r\n        (position.x * matrix.M11) + (position.y * matrix.M21) + (position.z * matrix.M31) + matrix.M41, (position.x * matrix.M12) + (position.y * matrix.M22) + (position.z * matrix.M32) + matrix.M42, (position.x * matrix.M13) + (position.y * matrix.M23) + (position.z * matrix.M33) + matrix.M43\r\n    );\r\n\r\n    return vector;\r\n};\r\n\r\n/**\r\n * Gets an homogeneous transformed vector from a position and a matrix.\r\n * @method transformCoordinate\r\n * @static\r\n * @param {Atlantis.Vector3} position\r\n * @param {Atlantis.Matrix} matrix\r\n * @return {Atlantis.Vector4} A tranformed vector.\r\n */\r\nAtlantis.Vector3.transformCoordinate = function(position, transform) {\r\n    var vector = new Atlantis.Vector4();\r\n    vector.x = (position.x * transform.M11) + (position.y * transform.M21) + (position.z * transform.M31) + transform.M41;\r\n    vector.y = (position.x * transform.M12) + (position.y * transform.M22) + (position.z * transform.M32) + transform.M42;\r\n    vector.z = (position.x * transform.M13) + (position.y * transform.M23) + (position.z * transform.M33) + transform.M43;\r\n    vector.w = 1.0 / ((position.x * transform.M14) + (position.y * transform.M24) + (position.z * transform.M34) + transform.M44);\r\n    return new Atlantis.Vector3(vector.x * vector.w, vector.y * vector.w, vector.z * vector.w);\r\n};\r\n\r\n/**\r\n * Changes the 3 coordinates.\r\n * @method set\r\n * @param x The new X coordinate.\r\n * @param y The new Y coordinate.\r\n * @param z The new Z coordinate.\r\n */\r\nAtlantis.Vector3.prototype.set = function(x, y, z) {\r\n    this.x = x;\r\n    this.y = y;\r\n    this.z = z;\r\n};\r\n\r\nAtlantis.Vector3.prototype.clone = function () {\r\n    return new Atlantis.Vector3(this.x, this.y, this.z);\r\n};\r\n\r\n/**\r\n * Gets a string from this object.\r\n * @method toString\r\n * @return {String}\r\n */\r\nAtlantis.Vector3.prototype.toString = function() {\r\n    return [\"x: \", this.x, \" y: \", this.y, \" z: \", this.z].join(\"\");\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * Describes a 4D-vector.\r\n * @constructor\r\n * @class Vector4\r\n * @param {Number|Atlantis.Vector4} Value for x coordinate or a Vector4 object.\r\n * @param {Number} Value for y coordinate\r\n * @param {Number} Value for z coordinate.\r\n * @param {Number} Value for w coordinate.\r\n */\r\nAtlantis.Vector4 = function(x, y, z, w) {\r\n    this.x = x ? +x : 0;\r\n    this.y = y ? +y : 0;\r\n    this.z = z ? +z : 0;\r\n    this.z = w ? +w : 0;\r\n};\r\n\r\n/**\r\n * Copy a vector to this vector.\r\n * @method fromVector\r\n * @param {Vector4} vector The vector to use.\r\n */\r\nAtlantis.Vector4.prototype.fromVector = function(vector) {\r\n    this.x = vector.x;\r\n    this.y = vector.y;\r\n    this.z = vector.z;\r\n    this.w = vector.w;\r\n};\r\n\r\n/**\r\n * Linear interpolation.\r\n * @method lerp\r\n * @param {Atlantis.Vector4} vector A vector to use for interpolation\r\n * @param {Number} amount Value between 0 and 1 indicating the weight of vector.\r\n */\r\nAtlantis.Vector4.prototype.lerp = function(vector, amount) {\r\n    this.x = Atlantis.MathHelper.lerp(this.x, vector.x, amount);\r\n    this.y = Atlantis.MathHelper.lerp(this.y, vector.y, amount);\r\n    this.z = Atlantis.MathHelper.lerp(this.z, vector.z, amount);\r\n    this.w = Atlantis.MathHelper.lerp(this.w, vector.w, amount);\r\n};\r\n\r\n/**\r\n * Linearly interpolates between two vectors.\r\n * @method lerp\r\n * @static\r\n * @param {Atlantis.Vector4} vec1 First vector\r\n * @param {Atlantis.Vector4} vec2 Second vector\r\n * @param {Number} amount Value between 0 and 1 indicating the weight of vec2.\r\n * @return {Atlantis.Vector4} Return a interpolated Vector3.\r\n */\r\nAtlantis.Vector4.lerp = function(vec1, vec2, amount) {\r\n    var vector = new Atlantis.Vector4(vec1);\r\n    vector.lerp(vec2, amount);\r\n    return vector;\r\n};\r\n\r\nAtlantis.Vector4.prototype.clone = function() {\r\n    return new Atlantis.Vector4(this.x, this.y, this.z, this.w);\r\n};\r\n\r\n/**\r\n * Gets a string from this object.\r\n * @method toString\r\n * @return {String}\r\n */\r\nAtlantis.Vector4.prototype.toString = function() {\r\n    return [\"x: \", this.x, \" y: \", this.y, \" z: \", this.z, \" w: \", this.w].join(\"\");\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n// --------------------------------------- //\r\n// ---  Keyboard State implementation  --- //\r\n// --------------------------------------- //\r\n\r\n/**\r\n * Define a keyboard state.\r\n * @class KeyboardState\r\n * @constructor\r\n */\r\nAtlantis.KeyboardState = function(keys) {\r\n    this.keys = [];\r\n    // Cloning the array\r\n    for (var i = 0, l = keys.length; i < l; i++) {\r\n        this.keys.push(keys[i]);\r\n    }\r\n};\r\n\r\nAtlantis.KeyboardState.prototype.clone = function() {\r\n    return new Atlantis.Input.KeyboardState(this.keys);\r\n};\r\n\r\n/**\r\n * Determine if the key is pressed.\r\n * @method isKeyDown\r\n * @param {Number} button The button to test.\r\n * @return {Boolean} Return true if the key is pressed.\r\n */\r\nAtlantis.KeyboardState.prototype.isKeyDown = function(key) {\r\n    return this.keys[key] === true;\r\n};\r\n\r\n/**\r\n * Determine if the key is pressed.\r\n * @method isKeyUp\r\n * @param {Number} button The button to test.\r\n * @return {Boolean} Return true if the key is released.\r\n */\r\nAtlantis.KeyboardState.prototype.isKeyUp = function(key) {\r\n    return this.keys[key] === false;\r\n};\r\n\r\n// --------------------------------------- //\r\n// --- Keyboard Manager implementation --- //\r\n// --------------------------------------- //\r\n\r\n/**\r\n * A keyboard input manager.\r\n * @constructor\r\n * @class KeyboardManager\r\n */\r\nAtlantis.Keyboard = function(maxKeys) {\r\n    this.keys = [];\r\n    this.maxKeys = maxKeys || 130;\r\n\r\n    for (var i = 0; i < maxKeys; i++) {\r\n        this.keys[i] = false;\r\n    }\r\n\r\n    var that = this;\r\n\r\n    var onKeyStateChange = function(event) {\r\n        if (Atlantis.Keyboard.preventDefault) {\r\n            event.preventDefault();\r\n        }\r\n\r\n        that.keys[event.keyCode] = (event.type === \"keydown\") ? true : false;\r\n    };\r\n\r\n    document.addEventListener(\"keydown\", onKeyStateChange, false);\r\n    document.addEventListener(\"keyup\", onKeyStateChange, false);\r\n};\r\n\r\nAtlantis.Keyboard.preventDefault = false;\r\n\r\n/**\r\n * Gets the current state of the keyboard.\r\n * @method getState\r\n * @return {Atlantis.KeyboardState} Return the state of the keyboard.\r\n */\r\nAtlantis.Keyboard.prototype.getState = function() {\r\n    return new Atlantis.KeyboardState(this.keys);\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * Define a button state which is released or pressed.\r\n * @class ButtonState\r\n * @static\r\n */\r\nAtlantis.ButtonState = {\r\n\tReleased: 0,\r\n\tPressed: 1\r\n};\r\n\r\n// ---\r\n// --- MouseState implementation\r\n// ---\r\n\r\n/**\r\n * Define a mouse state.\r\n * @class MouseState\r\n * @constructor\r\n * @param {Number} x The position of the cursor on X axis.\r\n * @param {Number} y The position of the cursor on Y axis.\r\n * @param {Number} scroolWheelValue The value of the scroll\r\n * @param {Array} buttons An array with the states of each buttons\r\n */\r\nAtlantis.MouseState = function(x, y, scrollWheelValue, buttons) {\r\n\tthis.x = x;\r\n\tthis.y = y;\r\n\tthis.scrollWheelValue = scrollWheelValue;\r\n\tthis.leftButton = buttons[0];\r\n\tthis.rightButton = buttons[2];\r\n\tthis.middleButton = buttons[1];\r\n};\r\n\r\n/**\r\n * Clone the current state.\r\n * @method clone\r\n * @return {Atlantis.MouseState} Return a clone of this instance.\r\n */\r\nAtlantis.MouseState.prototype.clone = function() {\r\n\treturn new Atlantis.MouseState(this.x, this.y, this.scrollWheelValue, [this.leftButton, this.middleButton, this.rightButton]);\r\n};\r\n\r\n// ---\r\n// --- Mouse implementation\r\n// ---\r\n\r\n/**\r\n * The Mouse class is responsible to manage mouse events.\r\n * @class Mouse\r\n * @constructor\r\n * @param {HTMLElement} domElement The DOM element to use (default is document.body).\r\n */\r\nAtlantis.Mouse = function(domElement) {\r\n\tdomElement = (domElement instanceof HTMLElement) ? domElement : document.body;\r\n\tthis._x = 0;\r\n\tthis._y = 0;\r\n\tthis._scroll = 0;\r\n\tthis._buttons = [];\r\n\tthis._buttons[0] = false; // Left\r\n\tthis._buttons[1] = false; // Middle\r\n\tthis._buttons[2] = false; // Right\r\n\tthis.preventDefault = true;\r\n\r\n\tvar that = this;\r\n\r\n\tvar resetButtonState = function() {\r\n\t\tthat._buttons[0] = false;\r\n\t\tthat._buttons[1] = false;\r\n\t\tthat._buttons[2] = false;\r\n\t};\r\n\r\n\tvar onMouseEvent = function(event) {\r\n\t\tthat._x = (event.pageX - domElement.offsetLeft) * Atlantis.Game.scaleFactor.x;\r\n\t\tthat._y = (event.pageY - domElement.offsetTop) * Atlantis.Game.scaleFactor.y;\r\n\r\n\t\tif (event.type === \"mousemove\" || event.type === \"pointermove\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tresetButtonState();\r\n\r\n\t\tif ((event.type === \"mousedown\") || (event.type === \"pointerdown\")) {\r\n\t\t\tthat._buttons[event.button] = true;\r\n\t\t} else {\r\n\t\t\tthat._buttons[event.button] = false;\r\n\t\t}\r\n\t};\r\n\r\n\tvar onMouseScroll = function(event) {\r\n\t\tthat._scroll = Math.max(-1, Math.min(1, (event.wheelDelta || -event.detail)));\r\n\t};\r\n\r\n\tdomElement.addEventListener(\"mousedown\", onMouseEvent, false);\r\n\tdomElement.addEventListener(\"mousemove\", onMouseEvent, false);\r\n\tdomElement.addEventListener(\"mouseup\", onMouseEvent, false);\r\n\r\n\t//domElement.addEventListener(\"click\", onMouseEvent, false);\r\n\tdomElement.addEventListener(\"mousewheel\", onMouseScroll, false);\r\n\tdomElement.addEventListener(\"DOMMouseScroll\", onMouseScroll, false);\r\n};\r\n\r\n/**\r\n * Gets the state of the mouse.\r\n * @method getState\r\n * @return {Atlantis.MouseState} Return the state of the mouse at this time.\r\n */\r\nAtlantis.Mouse.prototype.getState = function() {\r\n\treturn new Atlantis.MouseState(this._x, this._y, this._scroll, this._buttons);\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * Define the type of touch event\r\n * - Invalid\r\n * - Moved\r\n * - Pressed\r\n * - Released\r\n * @class TouchLocationState\r\n * @static\r\n */\r\nAtlantis.TouchLocationState = {\r\n\tInvalid: 1,\r\n\tMoved: 2,\r\n\tPressed: 3,\r\n\tReleased: 4\r\n};\r\n\r\nAtlantis.TouchCollection = function(touchStates) {\r\n\tArray.call(this);\r\n\r\n\ttouchStates = touchStates || [];\r\n\tfor (var i = 0, l = touchStates.length; i < l; i++) {\r\n\t\tthis.push(new Atlantis.TouchPanelState(touchStates[i]));\r\n\t}\r\n};\r\n\r\nAtlantis.TouchCollection.prototype = Object.create(Array.prototype);\r\n\r\nAtlantis.TouchCollection.prototype.clone = function() {\r\n\tvar states = [];\r\n\r\n\tfor (var i = 0, l = this.length; i < l; i++) {\r\n\t\tstates.push(this[i].clone());\r\n\t}\r\n\r\n\treturn new Atlantis.TouchCollection(states);\r\n};\r\n\r\n/**\r\n * Define a touch state with a position and a touch state.\r\n * @class TouchPanelState\r\n * @constructor\r\n * @param {Object} panelState An object that contains states and position of the touch event.\r\n */\r\nAtlantis.TouchPanelState = function(panelState) {\r\n\tthis.state = panelState.state || Atlantis.TouchLocationState.Invalid;\r\n\tthis.position = panelState.position ? panelState.position : new Atlantis.Vector2(0, 0);\r\n};\r\n\r\n/**\r\n * Gets a clone of this state.\r\n * @method clone\r\n * @return {Atlantis.TouchPanelState} Return a clone of this instance.\r\n */\r\nAtlantis.TouchPanelState.prototype.clone = function() {\r\n\treturn new Atlantis.TouchPanelState({\r\n\t\tstate: this.state,\r\n\t\tposition: {\r\n\t\t\tx: this.position.x,\r\n\t\t\ty: this.position.y\r\n\t\t}\r\n\t});\r\n};\r\n\r\n/**\r\n * This class is responsible to manage touch events.\r\n * @class TouchPanel\r\n * @constructor\r\n * @param {HTMLElement} The DOM element to use for events (default is document.body).\r\n */\r\nAtlantis.TouchPanel = function(domElement) {\r\n\tthis._states = [\r\n\t\tnew Atlantis.TouchPanelState({}),\r\n\t\tnew Atlantis.TouchPanelState({}),\r\n\t\tnew Atlantis.TouchPanelState({})\r\n\t];\r\n\r\n\tvar eventNames = {\r\n\t\tup: \"touchend\",\r\n\t\tdown: \"touchstart\",\r\n\t\tcancel: \"touchcancel\",\r\n\t\tmove: \"touchmove\",\r\n\t\tcallback: null\r\n\t};\r\n\r\n\tvar that = this;\r\n\tvar lastEventType = null;\r\n\tvar isPointerEvent = false;\r\n\r\n\tvar wrapEvent = function(id, event) {\r\n\t\tif (!that._states[id]) {\r\n\t\t\tthat._states[id] = new Atlantis.TouchPanelState();\r\n\t\t}\r\n\r\n\t\tif (event.touches) {\r\n\t\t\tthat._states[id].position.x = event.touches[id].pageX - domElement.offsetLeft;\r\n\t\t\tthat._states[id].position.y = event.touches[id].pageY - domElement.offsetTop;\r\n\t\t} else {\r\n\t\t\tthat._states[id].position.x = event.clientX - domElement.offsetLeft;\r\n\t\t\tthat._states[id].position.y = event.clientY - domElement.offsetTop;\r\n\t\t}\r\n\r\n\t\tthat._states[id].position.x *= Atlantis.Game.scaleFactor.x;\r\n\t\tthat._states[id].position.y *= Atlantis.Game.scaleFactor.y;\r\n\r\n\t\t// Special hack for pointer event because in lot of cases, a pointermove event\r\n\t\t// is triggered.\r\n\t\tif (isPointerEvent) {\r\n\t\t\tvar result = (lastEventType === eventNames.down && event.type === eventNames.move);\r\n\t\t\tlastEventType = event.type;\r\n\r\n\t\t\tif (result) {\r\n\t\t\t\tlastEventType = null;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (event.type == eventNames.down) {\r\n\t\t\tthat._states[id].state = Atlantis.TouchLocationState.Pressed;\r\n\t\t} else if (event.type == eventNames.move) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthat._states[id].state = Atlantis.TouchLocationState.Moved;\r\n\t\t} else if (event.type == eventNames.up) {\r\n\t\t\tthat._states[id].state = Atlantis.TouchLocationState.Released;\r\n\t\t} else {\r\n\t\t\tthat._states[id].state = Atlantis.TouchLocationState.Invalid;\r\n\t\t}\r\n\t};\r\n\r\n\tvar onTouchHandler = function(event) {\r\n\t\tvar i = 0,\r\n\t\t\tl = 0;\r\n\r\n\t\tif (event.type === \"touchend\" || event.type === \"touchcancel\") {\r\n\t\t\tfor (i = 0, l = that._states.length; i < l; i++) {\r\n\t\t\t\tthat._states[i].state = event.type === \"touchend\" ? Atlantis.TouchLocationState.Released : Atlantis.TouchLocationState.Invalid;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (i = 0, l = event.touches.length; i < l; i++) {\r\n\t\t\t\twrapEvent(i, event);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar onPointerHandler = function(event) {\r\n\t\tevent.preventDefault();\r\n\t\tif (event.type === \"MSPointerUp\" || event.type === \"MSPointerCancel\" || event.type === \"pointerup\" || event.type === \"pointercancel\") {\r\n\t\t\tthat._states[0].state = (event.type === \"MSPointerUp\" || event.type === \"pointerup\") ? Atlantis.TouchLocationState.Released : Atlantis.TouchLocationState.Invalid;\r\n\t\t} else {\r\n\t\t\twrapEvent(0, event);\r\n\t\t}\r\n\t};\r\n\r\n\tvar maxTouchPoints = +navigator.maxTouchPoints || +navigator.msMaxTouchPoints;\r\n\tif (maxTouchPoints === 0) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// IE11+\r\n\tif (window.PointerEvent) { // IE11+\r\n\t\teventNames.up = \"pointerup\";\r\n\t\teventNames.down = \"pointerdown\";\r\n\t\teventNames.move = \"pointermove\";\r\n\t\teventNames.cancel = \"pointercancel\";\r\n\t\teventNames.callback = onPointerHandler;\r\n\t} else if (window.MSPointerEvent) { // IE10\r\n\t\teventNames.up = \"MSPointerUp\";\r\n\t\teventNames.down = \"MSPointerDown\";\r\n\t\teventNames.move = \"MSPointerMove\";\r\n\t\teventNames.cancel = \"MSPointerCancel\";\r\n\t\teventNames.callback = onPointerHandler;\r\n\t} else { // Touch events\r\n\t\teventNames.callback = onTouchHandler;\r\n\t}\r\n\r\n\tisPointerEvent = (eventNames.down !== \"touchstart\");\r\n\r\n\tdomElement.addEventListener(eventNames.down, eventNames.callback, false);\r\n\tdomElement.addEventListener(eventNames.move, eventNames.callback, false);\r\n\tdomElement.addEventListener(eventNames.up, eventNames.callback, false);\r\n\tdomElement.addEventListener(eventNames.cancel, eventNames.callback, false);\r\n};\r\n\r\n/**\r\n * Gets the capabilities of the touch panel.\r\n * @method getCapabilities\r\n * @return {Object} Return an object which contains touch panel capabilities.\r\n */\r\nAtlantis.TouchPanel.prototype.getCapabilities = function() {\r\n\treturn {\r\n\t\thasTouch: !!(\"ontouchstart\" in window) || !!(\"ongesturechange\" in window)\r\n\t};\r\n};\r\n\r\n/** \r\n * Get the state of the touch panel at this time.\r\n * @method getState\r\n * @param {Number} id (optional) A finger id.\r\n * @return {Atlantis.TouchCollection|Atlantis.TouchPanelState} if no finger is passed, it return an array of Atlantis.TouchPanelState,\r\n *         otherwise it returns an Atlantis.TouchPanelState of the finger id passed in parameter.\r\n */\r\nAtlantis.TouchPanel.prototype.getState = function(id) {\r\n\tif (typeof(id) === \"number\") {\r\n\t\treturn new Atlantis.TouchPanelState(this._states[id] ? this._states[id] : {});\r\n\t} else {\r\n\t\treturn new Atlantis.TouchCollection(this._states);\r\n\t}\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * Define buttons for the gamepad\r\n * @class GamepadButton\r\n * @static\r\n */\r\nAtlantis.GamepadButton = {\r\n    A: 0,\r\n    B: 1,\r\n    X: 2,\r\n    Y: 3,\r\n    LeftShoulder: 4,\r\n    RightShoulder: 5,\r\n    LeftTrigger: 6,\r\n    RightTrigger: 7,\r\n    Select: 8,\r\n    Start: 9,\r\n    L3: 10,\r\n    R3: 11,\r\n    DPadUp: 12,\r\n    DPadDown: 13,\r\n    DPadLeft: 14,\r\n    DPadRight: 15\r\n};\r\n\r\n/**\r\n * Define axis for the gamepad\r\n * @class GamepadAxis\r\n * @static\r\n */\r\nAtlantis.GamepadAxis = {\r\n    Horizontal: 0,\r\n    Vertical: 1,\r\n    HorizontalRight: 2,\r\n    VerticalRight: 3\r\n};\r\n\r\n// ---\r\n// --- GamepadState implementation\r\n// ---\r\n\r\n/**\r\n * Define the state of the gamepad at a specified time\r\n * @class GamepadState\r\n * @constructor\r\n * @param {Array} axis An array of axis values\r\n * @param {Array} buttons An array of buttons values (true/false)\r\n */\r\nAtlantis.GamepadState = function(axis, buttons) {\r\n    this.axis = [];\r\n    this.buttons = [];\r\n    var i = 0,\r\n        l = 0;\r\n\r\n    if (axis) {\r\n        for (i = 0, l = axis.length; i < l; i++) {\r\n            this.axis.push(axis[i]);\r\n        }\r\n    } else {\r\n        for (i = 0; i < 6; i++) {\r\n            this.axis.push(0);\r\n        }\r\n    }\r\n\r\n    if (buttons) {\r\n        for (i = 0, l = buttons.length; i < l; i++) {\r\n            this.buttons.push(buttons[i]);\r\n        }\r\n    } else {\r\n        for (i = 0; i < 15; i++) {\r\n            this.buttons.push(false);\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Indicate if the button is down.\r\n * @method isButtonDown\r\n * @param (Number|Atlantis.GamepadButton) The identifier of the button\r\n * @param {Boolean|Number} Return the value of the button.\r\n */\r\nAtlantis.GamepadState.prototype.isButtonDown = function(button) {\r\n    return this.buttons[button];\r\n};\r\n\r\n/**\r\n * Indicate if the button is up.\r\n * @method isButtonUp\r\n * @param (Number|Atlantis.GamepadButton) The identifier of the button\r\n * @param {Boolean|Number} Return the value of the button.\r\n */\r\nAtlantis.GamepadState.prototype.isButtonUp = function(button) {\r\n    return !this.buttons[button];\r\n};\r\n\r\n/**\r\n * Gets the value of an axis.\r\n * @method getAxis\r\n * @param (Number|Atlantis.GamepadAxis) The identifier of the axis\r\n * @param {Number} Return the value of the axis between -1 and 1.\r\n */\r\nAtlantis.GamepadState.prototype.getAxis = function(axis) {\r\n    return this.axis[axis];\r\n};\r\n\r\n// ---\r\n// --- Gamepad implementation\r\n// ---\r\n\r\n/**\r\n * The gamepad class is responsible to manage gamepads connected to the device.\r\n * @class Gamepad\r\n * @constructor\r\n * @extends Atlantis.GameComponent\r\n */\r\nAtlantis.Gamepad = function() {\r\n    Atlantis.GameComponent.call(this);\r\n    this._gamepads = [];\r\n    this._states = {};\r\n};\r\n\r\nAtlantis.Gamepad.prototype = Object.create(Atlantis.GameComponent.prototype);\r\n\r\n/**\r\n * Initialize the component and start event listeners\r\n * @method initialize\r\n */\r\nAtlantis.Gamepad.prototype.initialize = function() {\r\n    var that = this;\r\n\r\n    navigator.getGamepads = navigator.getGamepads || navigator.webkitGetGamepads || navigator.msGetGamepads || navigator.webkitGamepads;\r\n\r\n    this._gamepadsSupported = navigator.getGamepads ? true : false;\r\n\r\n    window.addEventListener(\"gamepadconnected\", function(event) {\r\n        that._addGamepad(event.gamepad);\r\n    }, false);\r\n\r\n    window.addEventListener(\"gamepaddisconnected\", function(event) {\r\n        that._removeGamepad(event.gamepad);\r\n    }, false);\r\n};\r\n\r\n// Add a gamepad\r\nAtlantis.Gamepad.prototype._addGamepad = function(gamepad) {\r\n    this._gamepads.push(gamepad);\r\n    this._states[gamepad.index] = new Atlantis.GamepadState();\r\n};\r\n\r\n// Remove a gamepad\r\nAtlantis.Gamepad.prototype._removeGamepad = function(gamepad) {\r\n    delete this._gamepads[gamepad.index];\r\n    delete this._states[gamepad.index];\r\n};\r\n\r\nAtlantis.Gamepad.prototype._updateGamepads = function() {\r\n    var gamepads = navigator.getGamepads();\r\n\r\n    for (var i = 0; i < gamepads.length; i++) {\r\n        if (gamepads[i]) {\r\n            if (this._gamepads.indexOf(gamepads[i]) === -1) {\r\n                this._addGamepad(gamepads[i]);\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Update states of connected gamepads\r\n * @method update\r\n * @param {Atlantis.GameTime} gameTime\r\n */\r\nAtlantis.Gamepad.prototype.update = function(gameTime) {\r\n    if (this._gamepadsSupported) {\r\n        var j = 0,\r\n            m = 0;\r\n\r\n        this._updateGamepads();\r\n\r\n        for (var i = 0, l = this._gamepads.length; i < l; i++) {\r\n            var gamepad = this._gamepads[i];\r\n\r\n            for (j = 0, m = gamepad.buttons.length; j < m; j++) {\r\n                var btnVal = gamepad.buttons[j];\r\n                var pressed = (btnVal === 1.0) ? true : false;\r\n\r\n                if (typeof(btnVal) == \"object\") {\r\n                    pressed = btnVal.pressed;\r\n                    btnVal = btnVal.value;\r\n                }\r\n\r\n                this._states[gamepad.index].buttons[j] = pressed;\r\n            }\r\n\r\n            for (j = 0, m = gamepad.axes.length; j < m; j++) {\r\n                this._states[gamepad.index].axis[j] = +gamepad.axes[j] | 0;\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Gets the state of the gamepad\r\n * @method getState\r\n * @return {Atlantis.GamepadState} Return the state at this time.\r\n */\r\nAtlantis.Gamepad.prototype.getState = function(index) {\r\n    index = (typeof(index) !== \"undefined\") ? index : 0;\r\n    if (this._gamepads[index]) {\r\n        return new Atlantis.GamepadState(this._states[index].axis, this._states[index].buttons);\r\n    } else {\r\n        return new Atlantis.GamepadState();\r\n    }\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * An enumeration of keys who can be pressed/released\r\n * @class Keys\r\n */\r\nAtlantis.Keys = {\r\n    BackSpace: 8,\r\n    Tab: 9,\r\n    Enter: 13,\r\n    Shift: 16,\r\n    Control: 17,\r\n    Alt: 18,\r\n    Pause: 19,\r\n    Escape: 27,\r\n    Space: 32,\r\n    Home: 36,\r\n    End: 35,\r\n    Left: 37,\r\n    Up: 38,\r\n    Right: 39,\r\n    Down: 40,\r\n    Suppr: 46,\r\n    PageUp: 33,\r\n    PageDown: 34,\r\n    Insert: 45,\r\n    Num0: 48,\r\n    Num1: 49,\r\n    Num2: 50,\r\n    Num3: 51,\r\n    Num4: 52,\r\n    Num5: 53,\r\n    Num6: 54,\r\n    Num7: 55,\r\n    Num8: 56,\r\n    Num9: 57,\r\n    A: 65,\r\n    B: 66,\r\n    C: 67,\r\n    D: 68,\r\n    E: 69,\r\n    F: 70,\r\n    G: 71,\r\n    H: 72,\r\n    I: 73,\r\n    J: 74,\r\n    K: 75,\r\n    L: 76,\r\n    M: 77,\r\n    N: 78,\r\n    O: 79,\r\n    P: 80,\r\n    Q: 81,\r\n    R: 82,\r\n    S: 83,\r\n    T: 84,\r\n    U: 85,\r\n    V: 86,\r\n    W: 87,\r\n    X: 88,\r\n    Y: 89,\r\n    Z: 90,\r\n    Super: 91,\r\n    Numpad0: 96,\r\n    Numpad1: 97,\r\n    Numpad2: 98,\r\n    Numpad3: 99,\r\n    Numpad4: 100,\r\n    Numpad5: 101,\r\n    Numpad6: 102,\r\n    Numpad7: 103,\r\n    Numpad8: 104,\r\n    Numpad9: 105,\r\n    F1: 112,\r\n    F2: 113,\r\n    F3: 114,\r\n    F4: 115,\r\n    F5: 116,\r\n    F6: 117,\r\n    F7: 118,\r\n    F8: 119,\r\n    F9: 120,\r\n    F10: 121,\r\n    F11: 122,\r\n    F12: 123\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n\r\n/**\r\n * An enumeration to define the scale mode\r\n * - ScaleToFit: Take all the space on the screen.\r\n * - ConserveAspectRatio: Take the maximum space but conserve the ratio.\r\n * - NoScaleCenter: Center the content on the screen.\r\n *\r\n * @static\r\n */\r\nAtlantis.ScaleMode = {\r\n    ScaleToFit: 0,\r\n    ConserveAspectRatio: 1,\r\n    NoScaleCenter: 2\r\n};\r\n\r\n/**\r\n * The graphics device is response to manage screen (canvas) and draws (render target).\r\n * @class GraphicsDevice\r\n * @constructor\r\n * @param {Number} width The desired screen width\r\n * @param {Number} height The desired screen height\r\n * @param {Object} settings A list of options (webGL, backBufferWidth/Height, canvas).\r\n */\r\nAtlantis.GraphicsDevice = function(width, height, settings) {\r\n    settings = settings || {};\r\n    settings.width = width;\r\n    settings.height = height;\r\n\r\n    this.preferredBackBufferWidth = settings.backBufferWidth || width;\r\n    this.preferredBackBufferHeight = settings.backBufferHeight || height;\r\n\r\n    this.disableSmoothing = false;\r\n    this.forceDisableSmoothing = false;\r\n\r\n    this.viewport = new Atlantis.Rectangle();\r\n    this.scaleMode = Atlantis.ScaleMode.ScaleToFit;\r\n\r\n    if (width && height) {\r\n        // The front buffer (what you see).\r\n        this._frontBuffer = new Atlantis.RenderTarget(width, height, settings.canvas);\r\n        this._fbContext = this._frontBuffer.getContext();\r\n\r\n        // The back buffer (what you don't see).\r\n        this._backBuffer = new Atlantis.RenderTarget(this.preferredBackBufferWidth, this.preferredBackBufferHeight);\r\n        this._bbCanvas = this._backBuffer.getCanvas();\r\n\r\n        var canvas = this._frontBuffer.getCanvas();\r\n        canvas.style.msTouchAction = \"none\";\r\n        canvas.style.backgroundColor = \"#000\";\r\n        canvas.id = canvas.id ? canvas.id : \"AtlantisCanvas\";\r\n\r\n        this.viewport.setSize(this.preferredBackBufferWidth, this.preferredBackBufferHeight);\r\n    }\r\n};\r\n\r\n/**\r\n * Apply the values of preferredBackBufferWidth/Height to the screen.\r\n * The back buffer is moved according to the scale mode.\r\n * Note that an event of type Atlantis.event.ResolutionChanged is fired at the end of the process.\r\n * @method applyChanges\r\n */\r\nAtlantis.GraphicsDevice.prototype.applyChanges = function() {\r\n    this._backBuffer.setSize(this.preferredBackBufferWidth, this.preferredBackBufferHeight);\r\n\r\n    var fbWidth = this._frontBuffer.getWidth(),\r\n        fbHeight = this._frontBuffer.getHeight();\r\n\r\n    // If the screen size AND the backbuffer size are the same OR the scale mode is scale to fit.\r\n    if (this.scaleMode == Atlantis.ScaleMode.ScaleToFit || ((fbWidth === this.preferredBackBufferWidth) && (fbHeight === this.preferredBackBufferHeight))) {\r\n        this.viewport.set(0, 0, fbWidth, fbHeight);\r\n    } else if (this.scaleMode == Atlantis.ScaleMode.ConserveAspectRatio) {\r\n        var diffPercent = 0;\r\n\r\n        if (this.preferredBackBufferWidth > this.preferredBackBufferHeight) {\r\n            diffPercent = (this.preferredBackBufferWidth / fbWidth);\r\n            this.viewport.width = fbWidth;\r\n            this.viewport.height = this.preferredBackBufferHeight * (1 + diffPercent);\r\n        } else {\r\n            diffPercent = (this.preferredBackBufferHeight / fbHeight);\r\n            this.viewport.width = this.preferredBackBufferWidth * (1 + diffPercent);\r\n            this.viewport.height = fbHeight;\r\n        }\r\n\r\n        this.viewport.x = fbWidth / 2 - this.viewport.width / 2;\r\n        this.viewport.y = fbHeight / 2 - this.viewport.height / 2;\r\n    } else if (this.scaleMode == Atlantis.ScaleMode.NoScaleCenter) {\r\n        this.viewport.x = (fbWidth / 2) - (this.preferredBackBufferWidth / 2);\r\n        this.viewport.y = (fbHeight / 2) - (this.preferredBackBufferHeight / 2);\r\n        this.viewport.width = this.preferredBackBufferWidth;\r\n        this.viewport.height = this.preferredBackBufferHeight;\r\n    }\r\n\r\n    Atlantis.Game.scaleFactor.x = this.preferredBackBufferWidth / this._frontBuffer.getWidth();\r\n    Atlantis.Game.scaleFactor.y = this.preferredBackBufferHeight / this._frontBuffer.getHeight();\r\n\r\n    Atlantis.notify(Atlantis.events.ResolutionChanged, {\r\n        width: this.preferredBackBufferWidth,\r\n        height: this.preferredBackBufferHeight\r\n    });\r\n};\r\n\r\n/**\r\n * Gets the back buffer renderTarget.\r\n * @method getBackBuffer\r\n * @return {Atlantis.RenderTarget} Return the renderTarget of the back buffer.\r\n */\r\nAtlantis.GraphicsDevice.prototype.getBackBuffer = function() {\r\n    return this._backBuffer;\r\n};\r\n\r\n/**\r\n * Gets the front buffer renderTarget.\r\n * @method getFrontBuffer\r\n * @return {Atlantis.RenderTarget} Return the renderTarget of the front buffer.\r\n */\r\nAtlantis.GraphicsDevice.prototype.getFrontBuffer = function() {\r\n    return this._frontBuffer;\r\n};\r\n\r\n/**\r\n * Clear all buffers\r\n * @method clear\r\n * @param {String} color The clear color (default black).\r\n */\r\nAtlantis.GraphicsDevice.prototype.clear = function(color) {\r\n    this._backBuffer.clear(color);\r\n    this._frontBuffer.clear(color);\r\n\r\n    if (this.disableSmoothing) {\r\n        this._backBuffer.getContext().imageSmoothingEnabled = false;\r\n        this._fbContext.imageSmoothingEnabled = false;\r\n    }\r\n};\r\n\r\n/**\r\n * Draw the back buffer into the front buffer.\r\n * @method present\r\n */\r\nAtlantis.GraphicsDevice.prototype.present = function() {\r\n    this._fbContext.drawImage(this._bbCanvas, this.viewport.x, this.viewport.y, this.viewport.width, this.viewport.height);\r\n};\r\n\r\n/**\r\n * Toggle the passed element in fullscreen mode if the browser support this feature.\r\n * @method toggleFullscreen\r\n * @param {HTMLElement} The node to use (default is the canvas element).\r\n */\r\nAtlantis.GraphicsDevice.prototype.toggleFullscreen = function(element) {\r\n    element = element instanceof HTMLElement ? element : this._frontBuffer.getCanvas();\r\n    var fs = this.isFullscreen();\r\n\r\n    element.requestFullScreen = element.requestFullScreen || element.webkitRequestFullscreen || element.mozRequestFullScreen || element.msRequestFullscreen || function() {\r\n        return false;\r\n    };\r\n    document.cancelFullScreen = document.cancelFullScreen || document.webkitCancelFullScreen || document.mozCancelFullScreen || document.msExitFullscreen || function() {\r\n        return false;\r\n    };\r\n\r\n    if (fs) {\r\n        document.cancelFullScreen();\r\n    } else {\r\n        element.requestFullScreen();\r\n    }\r\n};\r\n\r\n/**\r\n * Indicate if the fullscreen mode is active\r\n * @method isFullscreen\r\n * @return {Boolean} Return true if the fullscreen mode is active, o\r\n */\r\nAtlantis.GraphicsDevice.prototype.isFullscreen = function() {\r\n    return document.webkitIsFullScreen || document.mozFullScreen || document.msFullscreenElement || false;\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * Define the sort mode of a sprite batch.\r\n * - BackToFront: All items of the batch are drawn to the smallest to the biggest layer depth\r\n * - FrontToBack: All items of the batch are drawn to the biggest to the smallest layer depth\r\n * - Immediate: No sorting, all is drawn without layer depth sorting.\r\n * @class SpriteSortMode\r\n * @static\r\n */\r\nAtlantis.SpriteSortMode = {\r\n    BackToFront: 0,\r\n    FrontToBack: 1,\r\n    Immediate: 2\r\n};\r\n\r\n/**\r\n * Define an effect to apply on a sprite.\r\n * @class SpriteEffect\r\n * @static\r\n */\r\nAtlantis.SpriteEffect = {\r\n    None: 0,\r\n    FlipHorizontaly: 1,\r\n    FlipVerticaly: 2\r\n};\r\n\r\nAtlantis.BatchItemType = {\r\n    Texture: 0,\r\n    Font: 1\r\n};\r\n\r\n/**\r\n * Define a SpriteBatch that is responsible to draw multiple elements on screen on one pass.\r\n * @class SpriteBatch\r\n * @constructor\r\n * @param {Atlantis.Graphics.GraphicsDevice} The graphics device.\r\n */\r\nAtlantis.SpriteBatch = function(graphicsDevice) {\r\n    this._graphicsDevice = graphicsDevice;\r\n\r\n    // Canvas used to render all item of the batch.\r\n    this._viewport = new Atlantis.Rectangle(0, 0, graphicsDevice.preferredBackBufferWidth, graphicsDevice.preferredBackBufferHeight);\r\n    this._canvas = this._graphicsDevice.getBackBuffer().getCanvas();\r\n    this._context = this._graphicsDevice.getBackBuffer().getContext();\r\n\r\n    this._batchItems = [];\r\n    this._batchStarted = false;\r\n    this._spriteSortMode = Atlantis.SpriteSortMode.Immediate;\r\n    this._transformMatrix = null;\r\n    this._cacheColoredTextures = [];\r\n    this._batchRect = new Atlantis.Rectangle();\r\n\r\n    document.addEventListener(Atlantis.events.ResolutionChanged, this._onResize.bind(this), false);\r\n};\r\n\r\nAtlantis.SpriteBatch.prototype._onResize = function(event) {\r\n    this._viewport.width = event.width;\r\n    this._viewport.height = event.height;\r\n};\r\n\r\n/**\r\n * Begin the batch operation.\r\n * @method begin\r\n * @param {Atlantis.SpriteSortMode} The type of sorting to use (option, default is Immediate).\r\n * @param {Array} A transform matrix to apply for all items (optional). The matrix is a 3x3 matrix in a single array.\r\n *        - [ScaleX, SkewX, SkewY, ScaleY, TranslationX, TranslationY]\r\n */\r\nAtlantis.SpriteBatch.prototype.begin = function(spriteSortMode, transformMatrix) {\r\n    if (!this._batchStarted) {\r\n        this._batchStarted = true;\r\n        this._spriteSortMode = typeof(spriteSortMode) === \"number\" ? spriteSortMode : Atlantis.SpriteSortMode.Immediate;\r\n\r\n        this._transformMatrix = transformMatrix;\r\n\r\n        if (this._transformMatrix) {\r\n            this._context.save();\r\n\r\n            this._context.transform(\r\n                this._transformMatrix[0], this._transformMatrix[1], this._transformMatrix[2],\r\n                this._transformMatrix[3], this._transformMatrix[4], this._transformMatrix[5]);\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Draw a texture on the screen\r\n * @method draw\r\n * @param {Image} The image or canvas to draw.\r\n * @param {Atlantis.Rectangle|Atlantis.Vector2} The position or the rectangle of the image.\r\n * @param {Atlantis.Rectangle} A source rectangle.\r\n * @param {String} A color to apply on the image in hex format.\r\n * @param {Number} Rotation of the image.\r\n * @param {Atlantis.Vector2} Origin of the image (defaut is 0, 0 on top/left).\r\n * @param {Atlantis.Vector2} Scale of the image (default is 1/1);\r\n * @param {Atlantis.SpriteEffect} An effect to apply (default is none).\r\n * @param {Number} The layer depth (Important when SpriteSortMode is set to BackToFront or FrontToBack).\r\n */\r\nAtlantis.SpriteBatch.prototype.draw = function(texture2D, destinationRectangle, sourceRectangle, color, rotation, origin, scale, effect, layerDepth) {\r\n    if (this._batchStarted) {\r\n        if (!destinationRectangle.width) {\r\n            destinationRectangle.width = texture2D.width;\r\n            destinationRectangle.height = texture2D.height;\r\n        }\r\n\r\n        if (this._spriteSortMode == Atlantis.SpriteSortMode.Immediate) {\r\n            this._drawBatchItem(texture2D, destinationRectangle, sourceRectangle, color, rotation, origin, scale, effect, layerDepth, Atlantis.BatchItemType.Texture);\r\n        } else {\r\n            this._batchItems.push({\r\n                type: Atlantis.BatchItemType.Texture,\r\n                texture2D: texture2D,\r\n                sourceRectangle: sourceRectangle,\r\n                destinationRectangle: destinationRectangle,\r\n                color: color,\r\n                rotation: rotation,\r\n                origin: origin,\r\n                scale: scale,\r\n                effect: effect ? effect : Atlantis.SpriteEffect.None,\r\n                layerDepth: +layerDepth | 0\r\n            });\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Draw a string on the screen\r\n * @method drawString\r\n * @param {Atlantis.SpriteFont} The SpriteFont to use.\r\n * @param {String} The string to draw.\r\n * @param {Atlantis.Vector2} The position of the string.\r\n * @param {String} The color of the string in hex format.\r\n * @param {Number} Rotation of the image.\r\n * @param {Atlantis.Vector2} Origin of the image (defaut is 0, 0 on top/left).\r\n * @param {Atlantis.Vector2} Scale of the image (default is 1/1);\r\n * @param {Atlantis.SpriteEffect} An effect to apply (default is none).\r\n * @param {Number} The layer depth (Important when SpriteSortMode is set to BackToFront or FrontToBack).\r\n */\r\nAtlantis.SpriteBatch.prototype.drawString = function(spriteFont, text, position, color, rotation, origin, scale, effect, layerDepth) {\r\n    if (this._batchStarted) {\r\n        if (this._spriteSortMode === Atlantis.SpriteSortMode.Immediate) {\r\n            this._drawBatchItem(spriteFont, position, text, color, rotation, origin, scale, effect, layerDepth, Atlantis.BatchItemType.Font);\r\n        } else {\r\n            this._batchItems.push({\r\n                type: Atlantis.BatchItemType.Font,\r\n                texture2D: spriteFont,\r\n                sourceRectangle: text,\r\n                destinationRectangle: {\r\n                    x: position.x,\r\n                    y: position.y,\r\n                    width: 1,\r\n                    height: 1\r\n                },\r\n                color: color,\r\n                rotation: rotation,\r\n                origin: origin,\r\n                scale: scale,\r\n                effect: effect ? effect : Atlantis.SpriteEffect.None,\r\n                layerDepth: +layerDepth | 0\r\n            });\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Execute the batch process and draw the result in the screen.\r\n * @method end\r\n */\r\nAtlantis.SpriteBatch.prototype.end = function() {\r\n    if (this._batchStarted) {\r\n        if (this._spriteSortMode !== Atlantis.SpriteSortMode.Immediate) {\r\n            this._batchItems = this._batchItems.sort(this._sortBatchItem.bind(this));\r\n\r\n            for (var i = 0, l = this._batchItems.length; i < l; i++) {\r\n                this._drawBatchItem(this._batchItems[i].texture2D, this._batchItems[i].destinationRectangle, this._batchItems[i].sourceRectangle, this._batchItems[i].color, this._batchItems[i].rotation, this._batchItems[i].origin, this._batchItems[i].scale, this._batchItems[i].effect, this._batchItems[i].layerDepth, this._batchItems[i].type);\r\n            }\r\n\r\n            this._batchItems.length = 0;\r\n        }\r\n\r\n        if (this._transformMatrix) {\r\n            this._context.restore();\r\n        }\r\n\r\n        this._batchStarted = false;\r\n    }\r\n};\r\n\r\n/**\r\n * Draw a texture on the screen\r\n * @method drawTexture\r\n * @static\r\n * @param {CanvasContext} The canvas context.\r\n * @param {Image} The image or canvas to draw.\r\n * @param {Number} x coordinate.\r\n * @param {Number} y coordinate.\r\n * @param {Number} width of the image.\r\n * @param {Number} height of the image.\r\n * @param {Atlantis.Rectangle} A source rectangle.\r\n */\r\nAtlantis.SpriteBatch.drawTexture = function(context, texture, x, y, width, height, sourceRectangle) {\r\n    if (sourceRectangle) {\r\n        context.drawImage(texture, sourceRectangle.x, sourceRectangle.y, sourceRectangle.width, sourceRectangle.height, x, y, width, height);\r\n    } else {\r\n        context.drawImage(texture, x, y, width, height);\r\n    }\r\n};\r\n\r\nAtlantis.SpriteBatch.drawString = function(context, spriteFont, text, position, color) {\r\n    context.fillStyle = color;\r\n    context.font = spriteFont.getFont();\r\n\r\n    if (spriteFont.strokeStyle && spriteFont.lineWidth) {\r\n        context.lineWidth = spriteFont.lineWidth;\r\n        context.strokeStyle = spriteFont.strokeStyle;\r\n\r\n        if (!spriteFont.wrapText) {\r\n            context.strokeText(text, position.x, position.y);\r\n        }\r\n    }\r\n\r\n    if (!spriteFont.wrapText) {\r\n        context.fillText(text, position.x, position.y);\r\n    } else {\r\n        Atlantis.SpriteBatch._wrapText(context, text, position.x, position.y, position.width, spriteFont.size, spriteFont.strokeStyle && spriteFont.lineWidth);\r\n    }\r\n};\r\n\r\nAtlantis.SpriteBatch.prototype._drawBatchItem = function(texture2D, destinationRectangle, sourceRectangle, color, rotation, origin, scale, effect, layerDepth, type) {\r\n    // If the entity is visible on the screen.   \r\n    this._batchRect.fromRectangle(destinationRectangle);\r\n\r\n    if (this._viewport.intersects(this._batchRect)) {\r\n        var oX = origin ? origin.x : 0;\r\n        var oY = origin ? origin.y : 0;\r\n\r\n        this._context.save();\r\n\r\n        this._context.translate(destinationRectangle.x, destinationRectangle.y);\r\n        this._context.translate(oX, oY);\r\n        this._batchRect.x = -oX;\r\n        this._batchRect.y = -oY;\r\n\r\n        if (rotation) {\r\n            this._context.rotate(rotation);\r\n        }\r\n\r\n        if (scale) {\r\n            this._context.scale(scale.x, scale.y);\r\n        }\r\n\r\n        if (effect && effect !== Atlantis.SpriteEffect.None) {\r\n            if (effect == Atlantis.SpriteEffect.FlipHorizontaly) {\r\n                this._context.scale(-1, 1);\r\n                this._batchRect.x -= this._batchRect.width;\r\n            } else {\r\n                this._context.scale(1, -1);\r\n                this._batchRect.y -= this._batchRect.height;\r\n            }\r\n        }\r\n\r\n        if (type === Atlantis.BatchItemType.Texture) {\r\n            if (color && texture2D.width && texture2D.height) {\r\n                Atlantis.SpriteBatch.drawTexture(this._context, this._colorizeTexture(texture2D, color), this._batchRect.x, this._batchRect.y, this._batchRect.width, this._batchRect.height, sourceRectangle);\r\n            } else {\r\n                Atlantis.SpriteBatch.drawTexture(this._context, texture2D, this._batchRect.x, this._batchRect.y, this._batchRect.width, this._batchRect.height, sourceRectangle);\r\n            }\r\n        } else if (type === Atlantis.BatchItemType.Font) {\r\n            // Because JavaScript is so Magic..\r\n            // The prototype become (spriteFont, text, position, color)\r\n            Atlantis.SpriteBatch.drawString(this._context, texture2D, sourceRectangle, this._batchRect, color);\r\n        }\r\n\r\n        this._context.restore();\r\n    }\r\n};\r\n\r\n// Colorize a texture and put it in a cache.\r\nAtlantis.SpriteBatch.prototype._colorizeTexture = function(texture, color) {\r\n    var canvas = this._searchColoredTexture(texture, color);\r\n\r\n    if (!canvas) {\r\n        canvas = document.createElement(\"canvas\");\r\n        canvas.width = texture.width;\r\n        canvas.height = texture.height;\r\n\r\n        var context = canvas.getContext(\"2d\");\r\n        context.drawImage(texture, 0, 0);\r\n\r\n        var imageData = context.getImageData(0, 0, texture.width, texture.height);\r\n        var cColor = this._hexaToBytes(color);\r\n\r\n        for (var i = 0, l = imageData.data.length; i < l; i += 4) {\r\n            imageData.data[i] = cColor.r | imageData.data[i];\r\n            imageData.data[i + 1] = cColor.g | imageData.data[i + 1];\r\n            imageData.data[i + 2] = cColor.b | imageData.data[i + 2];\r\n            imageData.data[i + 3] = cColor.a | imageData.data[i + 3];\r\n        }\r\n\r\n        context.putImageData(imageData, 0, 0);\r\n\r\n        this._cacheColoredTextures.push({\r\n            texture: texture,\r\n            color: color,\r\n            canvas: canvas\r\n        });\r\n    }\r\n\r\n    return canvas;\r\n};\r\n\r\n// Convert an hexa color to byte color.\r\nAtlantis.SpriteBatch.prototype._hexaToBytes = function(color) {\r\n    var hexa = color.split(\"#\")[1];\r\n    var bColor = {\r\n        r: 0,\r\n        g: 0,\r\n        b: 0,\r\n        a: 0\r\n    };\r\n    var size = hexa.length;\r\n\r\n    if (size === 3) {\r\n        bColor.r = parseInt((hexa[0] + hexa[0]), 16);\r\n        bColor.g = parseInt((hexa[1] + hexa[1]), 16);\r\n        bColor.b = parseInt((hexa[2] + hexa[2]), 16);\r\n    } else if (size === 6) {\r\n        bColor.r = parseInt(hexa.slice(0, 2), 16);\r\n        bColor.g = parseInt(hexa.slice(2, 4), 16);\r\n        bColor.b = parseInt(hexa.slice(4, 6), 16);\r\n    } else if (size === 8) {\r\n        bColor.r = parseInt(hexa.slice(0, 2), 16);\r\n        bColor.g = parseInt(hexa.slice(2, 4), 16);\r\n        bColor.b = parseInt(hexa.slice(4, 6), 16);\r\n        bColor.a = parseInt(hexa.slice(6, 8), 16);\r\n    }\r\n\r\n    return bColor;\r\n};\r\n\r\n// Search if a colored texture is already in the cache.\r\nAtlantis.SpriteBatch.prototype._searchColoredTexture = function(texture, color) {\r\n    var i = 0;\r\n    var size = this._cacheColoredTextures.length;\r\n    var canvas = null;\r\n\r\n    while (i < size && canvas === null) {\r\n        canvas = (this._cacheColoredTextures[i].texture === texture && this._cacheColoredTextures[i].color === color) ? this._cacheColoredTextures[i].canvas : null;\r\n        i++;\r\n    }\r\n\r\n    return canvas;\r\n};\r\n\r\nAtlantis.SpriteBatch.prototype._sortBatchItem = function(itemA, itemB) {\r\n    if (this._spriteSortMode === Atlantis.SpriteSortMode.BackToFront) {\r\n        if (+itemA.layerDepth > +itemB.layerDepth) {\r\n            return 1;\r\n        }\r\n\r\n        if (+itemA.layerDepth < +itemB.layerDepth) {\r\n            return -1;\r\n        }\r\n\r\n        return 0;\r\n    } else {\r\n        if (+itemA.layerDepth < +itemB.layerDepth) {\r\n            return 1;\r\n        }\r\n\r\n        if (+itemA.layerDepth > +itemB.layerDepth) {\r\n            return -1;\r\n        }\r\n\r\n        return 0;\r\n    }\r\n};\r\n\r\nAtlantis.SpriteBatch._wrapText = function(context, text, x, y, maxWidth, lineHeight, strokeText) {\r\n    var words = text.split(\" \");\r\n    var line = \"\";\r\n\r\n    for (var n = 0; n < words.length; n++) {\r\n        var testLine = line + words[n] + \" \";\r\n        var metrics = context.measureText(testLine);\r\n        var testWidth = metrics.width;\r\n        if (testWidth > maxWidth && n > 0) {\r\n            if (strokeText) {\r\n                context.strokeText(line, x, y);\r\n            }\r\n\r\n            context.fillText(line, x, y);\r\n            line = words[n] + \" \";\r\n            y += lineHeight;\r\n        } else {\r\n            line = testLine;\r\n        }\r\n    }\r\n\r\n    if (strokeText) {\r\n        context.strokeText(line, x, y);\r\n    }\r\n\r\n    context.fillText(line, x, y);\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * A render target is a graphics surface where we can draw\r\n * @constructor\r\n * @class RenderTarget\r\n * @param {Number} width Desired width.\r\n * @param {Number} height Desired height.\r\n * @param {HTMLCanvas} (optional) A canvas to use with this renderTarget\r\n */\r\nAtlantis.RenderTarget = function(width, height, canvas) {\r\n    this._canvas = canvas;\r\n\r\n    if (!this._canvas) {\r\n        this._canvas = document.createElement(\"canvas\");\r\n        this.setSize(width, height);\r\n    }\r\n\r\n    this._context = null;\r\n    this._data = null;\r\n    this._needUpdate = false;\r\n    this._context = this._canvas.getContext(\"2d\");\r\n    this.setSize(width, height);\r\n};\r\n\r\nAtlantis.RenderTarget.fromImage = function(image) {\r\n    var rt = new Atlantis.RenderTarget(image.width, image.height, false);\r\n    rt._context.drawImage(image, 0, 0, image.width, image.height);\r\n    return rt;\r\n};\r\n\r\n/**\r\n * Set the image data of the canvas.\r\n * @method setData\r\n * @param {Object} imageData Data to put in the canvas.\r\n */\r\nAtlantis.RenderTarget.prototype.setData = function(imageData) {\r\n    this._context.putImageData(imageData, 0, 0);\r\n};\r\n\r\n/**\r\n * Gets the image data of the canvas.\r\n * @method getData\r\n * @return {Object} Return the ImageData of the context.\r\n */\r\nAtlantis.RenderTarget.prototype.getData = function() {\r\n    if (!this._data || this._needUpdate) {\r\n        this._data = this._context.getImageData(0, 0, this._canvas.width, this._canvas.height);\r\n    }\r\n    return this._data;\r\n};\r\n\r\nAtlantis.RenderTarget.prototype.getPixelData = function(x, y) {\r\n    var color = this._context.getImageData(x, y, 1, 1).data;\r\n    return {\r\n        r: color[0],\r\n        g: color[1],\r\n        b: color[2],\r\n        a: color[3]\r\n    };\r\n};\r\n\r\n/**\r\n * Get the context of the canvas used to draw.\r\n * @method\r\n * @return {CanvasContext} Return the canvas context.\r\n */\r\nAtlantis.RenderTarget.prototype.getContext = function() {\r\n    return this._context;\r\n};\r\n\r\n/**\r\n * Gets the canvas used to draw.\r\n * @method getCanvas\r\n * @return {HTMLCanvas} Return the canvas used to draw.\r\n */\r\nAtlantis.RenderTarget.prototype.getCanvas = function() {\r\n    return this._canvas;\r\n};\r\n\r\n/**\r\n * Gets the width of the drawing surface.\r\n * @method getWidth\r\n * @return {Number} Return the width of the drawing surface.\r\n */\r\nAtlantis.RenderTarget.prototype.getWidth = function() {\r\n    return this._canvas.width;\r\n};\r\n\r\n/**\r\n * Gets the height of the drawing surface.\r\n * @method getHeight\r\n * @return {Number} Return the height of the drawing surface.\r\n */\r\nAtlantis.RenderTarget.prototype.getHeight = function() {\r\n    return this._canvas.height;\r\n};\r\n\r\n/**\r\n * Change the size of the drawing surface.\r\n * @method setSize\r\n * @param {Number} width The new width.\r\n * @param {Number} height The new height.\r\n */\r\nAtlantis.RenderTarget.prototype.setSize = function(width, height) {\r\n    this._canvas.width = width;\r\n    this._canvas.height = height;\r\n};\r\n\r\n/**\r\n * Clear the entire surface\r\n * @method clear\r\n */\r\nAtlantis.RenderTarget.prototype.clear = function(color) {\r\n    this._context.clearRect(0, 0, this._canvas.width, this._canvas.height);\r\n};\r\n\r\n/**\r\n * Save the content of the renderTarget to an image\r\n * @method saveAsPng\r\n * @return {String} Return a base64 of the image with mime type \"image/png\"\r\n */\r\nAtlantis.RenderTarget.prototype.saveAsPng = function() {\r\n    return this._canvas.toDataURL(\"image/png\");\r\n};\r\n\r\n/**\r\n * Save the content of the renderTarget to an image\r\n * @method saveAsJpg\r\n * @return {String} Return a base64 of the image with mime type \"image/jpg\"\r\n */\r\nAtlantis.RenderTarget.prototype.saveAsJpg = function() {\r\n    return this._canvas.toDataURL(\"image/jpg\");\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * Define a drawable text.\r\n * @class SpriteFont\r\n * @constructor\r\n * @param {String} The font name to use (default Arial). You can use a webfont loaded in CSS.\r\n * @param {Number} The size of the font.\r\n * @param {String} The style of the font (normal, italic, bold)\r\n */\r\nAtlantis.SpriteFont = function(fontName, size, style) {\r\n    this.fontName = fontName || \"Arial\";\r\n    this.size = size || 14;\r\n    this.style = style || \"normal\";\r\n    this.strokeStyle = null;\r\n    this.lineWidth = 0;\r\n};\r\n\r\n/**\r\n * Gets the string passed to drawing context.\r\n * @method getFont\r\n * @return {String} Return the string passed to the drawing context.\r\n */\r\nAtlantis.SpriteFont.prototype.getFont = function() {\r\n    return [this.style, \" \", this.size, \"px \", this.fontName].join(\"\");\r\n};\r\n\r\nAtlantis.SpriteFont.prototype.clone = function() {\r\n    var sClone = new Atlantis.SpriteFont(this.fontName, this.size, this.style);\r\n    sClone.strokeStyle = this.strokeStyle;\r\n    sClone.lineWidth = this.lineWidth;\r\n    return sClone;\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\n/**\r\n * The Preloader is used during asset loading in game class.\r\n * @class Preloader\r\n * @constructor\r\n * @param {Atlantis.Game} game\r\n */\r\nAtlantis.Preloader = function(game) {\r\n    this.screenWidth = game.graphicsDevice.preferredBackBufferWidth;\r\n    this.screenHeight = game.graphicsDevice.preferredBackBufferHeight;\r\n    this.screenWidthPerTwo = this.screenWidth / 2;\r\n    this.screenHeightPerTwo = this.screenHeight / 2;\r\n    this.spriteFont = new Atlantis.SpriteFont(\"Arial\", 32);\r\n};\r\n\r\n/**\r\n * Called when an asset is loaded.\r\n * @method onProgress\r\n * @param {Object} context The canvas context.\r\n * @param {Number} progress The loading progression in percent.\r\n */\r\nAtlantis.Preloader.prototype.onProgress = function(context, progress) {\r\n    var progressMessage = [\"Game loading \", Math.round(progress.progress), \"%\"].join(\"\");\r\n    var size = context.measureText(progressMessage),\r\n        x = (this.screenWidthPerTwo) - (size.width / 2),\r\n        y = (this.screenHeightPerTwo) - (this.spriteFont.size / 2);\r\n\r\n    context.clearRect(0, 0, this.screenWidth, this.screenHeight);\r\n    context.fillStyle = \"#fafafa\";\r\n    context.font = this.spriteFont.getFont();\r\n    context.fillText(progressMessage, x, y);\r\n};\n/**\r\n * AtlantisEngine.js a lightweight JavaScript game engine.\r\n *\r\n * @module Atlantis\r\n * @submodule Framework\r\n * @namespace Atlantis\r\n */\r\n\r\nvar Atlantis = window.Atlantis || {};\r\n\r\nAtlantis.Game = (function() {\r\n    var _instance = null;\r\n\r\n    /**\r\n     * Create a game instance who is the starting point of the Framework.\r\n     * @constructor\r\n     * @class Game\r\n     * @param {Number} width Desired screen width.\r\n     * @param {height} height Desired screen height.\r\n     * @param {domElement} (optional) domElement Sepecify a DOM element to attach the canvas.\r\n     * @param {params} (optional) params\r\n     */\r\n    var game = function(width, height, domElement, params) {\r\n        this.settings = params || {};\r\n        \r\n        width = width || window.innerWidth;\r\n        height = height || window.innerHeight;\r\n        this.domElement = document.body;\r\n\r\n        // FIXME : This part is totaly awefull\r\n        if (typeof(domElement) instanceof HTMLElement) {\r\n            this.domElement = domElement;\r\n        } else if (typeof(domElement) === \"string\") {\r\n            if (domElement[0] === \".\") {\r\n                domElement = domElement.replace(\".\", \"\");\r\n                this.domElement = document.getElementsByClassName(domElement)[0];\r\n            } else {\r\n                domElement = (domElement[0] === \"#\") ? domElement.replace(\"#\", \"\") : domElement;\r\n                this.domElement = document.getElementById(domElement);\r\n            }\r\n        }\r\n\r\n        if (this.domElement instanceof HTMLCanvasElement) {\r\n            this.settings.canvas = this.domElement;\r\n        }\r\n\r\n        this.version = \"0.0.0.1\";\r\n        this.gameTime = new Atlantis.GameTime();\r\n        this.components = new Atlantis.GameComponentCollection();\r\n        this.content = new Atlantis.ContentManager();\r\n        this.keyboard = null;\r\n        this.mouse = null;\r\n        this.touchPanel = null;\r\n        this.gamepad = null;\r\n        this.preloader = null;\r\n\r\n        this.graphicsDevice = new Atlantis.GraphicsDevice(width, height, this.settings);\r\n        this.canvas = this.settings.canvas;\r\n        this.frontBuffer = null;\r\n        this.context = null;\r\n        this.initialized = false;\r\n        this._paused = false;\r\n\r\n        _instance = this;\r\n    };\r\n\r\n    /**\r\n     * Gets the scale factor relative to the backbuffer.\r\n     * @property {Atlantis.Vector2} scaleFactor\r\n     */\r\n    game.scaleFactor = new Atlantis.Vector2(1, 1);\r\n\r\n    game.prototype._internalIntialize = function() {\r\n        this.frontBuffer = this.graphicsDevice.getFrontBuffer();\r\n        this.context = this.frontBuffer.getContext();\r\n\r\n        if (!this.canvas) {\r\n            this.canvas = this.frontBuffer.getCanvas();\r\n        }\r\n\r\n        this.keyboard = new Atlantis.Keyboard();\r\n        this.mouse = new Atlantis.Mouse(this.frontBuffer.getCanvas());\r\n        this.touchPanel = new Atlantis.TouchPanel(this.frontBuffer.getCanvas());\r\n        this.gamepad = new Atlantis.Gamepad();\r\n\r\n        this.components.add(this.gamepad);\r\n\r\n        if (this.settings.resizeEnabled) {\r\n            window.addEventListener(\"resize\", onResize, false);\r\n        }\r\n\r\n        if (this.domElement && !this.settings.canvas) {\r\n            this.domElement.appendChild(this.frontBuffer.getCanvas());\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Initialize the game logic and components.\r\n     * @method initialize\r\n     */\r\n    game.prototype.initialize = function() {\r\n        this.components.initialize();\r\n    };\r\n\r\n    /**\r\n     * Load the content.\r\n     * @method loadContent\r\n     */\r\n    game.prototype.loadContent = function() {\r\n        this.components.loadContent(this.content);\r\n    };\r\n\r\n    /**\r\n     * Unload the content.\r\n     * @method unloadContent\r\n     */\r\n    game.prototype.unloadContent = function() {\r\n        this.components.unloadContent();\r\n    };\r\n\r\n    /**\r\n     * Update the logic of the game.\r\n     * @method update\r\n     * @param {GameTime} gameTime The game time.\r\n     */\r\n    game.prototype.update = function(gameTime) {\r\n        this.components.update(gameTime);\r\n    };\r\n\r\n    /**\r\n     * Draw the content on the screen.\r\n     * @method draw\r\n     * @param {GameTime} gameTime The game time.\r\n     * @param {CanvasRenderingContext2D} context The 2D context.\r\n     */\r\n    game.prototype.draw = function(gameTime, context) {\r\n        if (this.settings.autoClear) {\r\n            this.graphicsDevice.clear();\r\n        }\r\n\r\n        this.components.draw(gameTime, context);\r\n    };\r\n\r\n    /**\r\n     * Called when the `draw` method has done its work.\r\n     * @method afterDraw\r\n     * @param {GameTime} gameTime The game time.\r\n     */\r\n    game.prototype.afterDraw = function(gameTime) {\r\n        this.graphicsDevice.present();\r\n    };\r\n\r\n    /** \r\n     * Start the game by initializing the engine. The preloader is activated \r\n     * afterwards the components are initialized and the main loop is started.\r\n     * @method run\r\n     */\r\n    game.prototype.run = function() {\r\n        var that = this;\r\n        var startProcess = function() {\r\n            that.initialize();\r\n            that.initialized = true;\r\n            that.loadContent();\r\n            that.frontBuffer.getCanvas().focus();\r\n            mainLoop();\r\n        };\r\n\r\n        if (!this.initialized) {\r\n            this.initialized = true;\r\n            this._internalIntialize();\r\n\r\n            if (this.content.preloader.length) {\r\n\r\n                // If user don't use a custom preloader\r\n                if (this.preloader === null) {\r\n                    this.preloader = new Atlantis.Preloader(this);\r\n                }\r\n\r\n                this.content.preload(function(progress) {\r\n                    this.preloader.onProgress(this.context, progress);\r\n                }.bind(this), function() {\r\n                    this.context.clearRect(0, 0, this.frontBuffer.getWidth(), this.frontBuffer.getHeight());\r\n                    startProcess();\r\n                }.bind(this));\r\n            } else {\r\n                startProcess();\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Sets the game in pause mode.\r\n     * @method pause\r\n     */\r\n    game.prototype.pause = function() {\r\n        cancelAnimationFrame(mainLoop);\r\n        this._paused = true;\r\n    };\r\n\r\n    /**\r\n     * Resume a paused game.\r\n     * @method resume\r\n     */\r\n    game.prototype.resume = function() {\r\n        if (this._paused) {\r\n            this._paused = false;\r\n            mainLoop();\r\n        }\r\n    };\r\n\r\n    // The mainLoop\r\n    function mainLoop() {\r\n        _instance.gameTime.update();\r\n        _instance.update(_instance.gameTime);\r\n        _instance.draw(_instance.gameTime);\r\n        _instance.afterDraw(_instance.gamepad);\r\n\r\n        if (!_instance._paused) {\r\n            requestAnimationFrame(mainLoop);\r\n        }\r\n    }\r\n\r\n    // Callback for window resize\r\n    function onResize(event) {\r\n        _instance.width = event.target.innerWidth;\r\n        _instance.height = event.target.innerHeight;\r\n        _instance.canvas.width = _instance.width;\r\n        _instance.canvas.height = _instance.height;\r\n    }\r\n\r\n    return game;\r\n})();"],"sourceRoot":"/source/"}