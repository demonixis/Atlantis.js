var Atlantis=window.Atlantis||{};Atlantis.events={ContentPreloading:"atlantis.preloading",ResolutionChanged:"atlantis.graphics.resize"},Atlantis.ajax=function(t){var e=t||{},i=t.url,n=t.success||function(){},s=new XMLHttpRequest;if("POST"===e.method)s.open("POST",i),s.onreadystatechange=function(){4==s.readyState&&200==s.status&&n(s.responseText)},s.send(e.data);else{var a=e.data?[i,"?",e.data].join(""):i;s.open("GET",a),s.onreadystatechange=function(){4==s.readyState&&n(s.responseText)},s.send(null)}},Atlantis.notify=function(t,e){var i=document.createEvent("HTMLEvents");if(i.initEvent(t,!0,!1),e instanceof Object)for(var n in e)i[n]=e[n];document.dispatchEvent(i)},Atlantis.isMobileDevice=function(){return navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|Windows Phone/i)},Atlantis._createProperty=function(t,e,i,n){Object.defineProperty(t,e,{get:i,set:n,enumerable:!0,configurable:!0})};var Atlantis=window.Atlantis||{};Atlantis.ContentManager=function(t){this.rootDirectory=t||"",this._assets={},this.preloader=[]},Atlantis.ContentManager.PreloadTimerInterval=250,Atlantis.ContentManager.prototype.preload=function(t,e){for(var i=this.preloader.length,n=0,t="function"==typeof t?t:function(){},e="function"==typeof e?e:function(){},s=function(t){n++},a=0;i>a;a++)this.load(this.preloader[a],s);var r=this,o={status:"Loading",progress:0},h=setInterval(function(){o.progress=100*n/i,n===i&&(clearInterval(h),o.status="Complete",r.preloader.length=0,e()),Atlantis.notify(Atlantis.events.ContentPreloading,o),t(o)},Atlantis.ContentManager.PreloadTimerInterval)},Atlantis.ContentManager.prototype.load=function(t,e){var e="function"==typeof e?e:function(){},i=t.split("."),n=i[i.length-1];if(t=this.rootDirectory+t,this._assets[t])return e(this._assets[t]),this._assets[t];switch(n){case"png":case"jpg":case"bmp":this.loadImage(t,e);break;case"mp3":case"ogg":case"wav":this.loadAudio(t,e);break;case"mp4":case"ogv":this.loadVideo(t,e);case"xml":case"json":case"js":this.loadResource(t,n,e)}return this._assets[t]},Atlantis.ContentManager.prototype.loadImage=function(t,e){var i=new Image;return i.onload=function(){this.style.position="absolute",this.style.left="-9999px",document.body.appendChild(i),document.body.removeChild(i),this.style.position="",this.style.left="",e(this)},i.src=t,this._assets[t]=i,i},Atlantis.ContentManager.prototype.loadAudio=function(t,e){var i=document.createElement("audio");return i.src=t,i.load(),i.controls=!1,this._assets[t]=i,e(i),i},Atlantis.ContentManager.prototype.loadVideo=function(t,e){var i=document.createElement("video");return i.onload=e,i.src=t,this._assets[t]=i,i},Atlantis.ContentManager.prototype.loadResource=function(t,e,i){var n=this;Atlantis.ajax({method:"GET",url:t,success:function(s){var a=s;"json"==e&&(a=JSON.parse(s)),n._assets[t]=a,i(a)}})},Atlantis.ContentManager.prototype.dispose=function(){this._assets.length=0};var Atlantis=window.Atlantis||{};Atlantis.GameComponent=function(t){this.game=t,this.enabled=!0,this.initialized=!1},Atlantis.GameComponent.prototype.initialize=function(){this.initialized=!0},Atlantis.GameComponent.prototype.update=function(t){},Atlantis.GameComponent.prototype.isEnabled=function(){return this.enabled},Atlantis.GameComponent.prototype.isInitialized=function(){return this.initialized},Atlantis.GameComponent.prototype.setEnabled=function(t){this.enabled=t},Atlantis.DrawableGameComponent=function(t){Atlantis.GameComponent.call(this,t),this.visible=!0,this.assetLoaded=!1},Atlantis.DrawableGameComponent.prototype=new Atlantis.GameComponent,Atlantis.DrawableGameComponent.prototype.loadContent=function(){this.assetLoaded=!0},Atlantis.DrawableGameComponent.prototype.unloadContent=function(){this.assetLoaded=!1},Atlantis.DrawableGameComponent.prototype.draw=function(t,e){},Atlantis.DrawableGameComponent.prototype.isVisible=function(){return this.isVisible},Atlantis.DrawableGameComponent.prototype.setVisible=function(t){this.isVisible=t},Atlantis.GameComponentCollection=function(){this.components=[],this.drawables=[],this.initialized=!1,this.assetLoaded=!1},Atlantis.GameComponentCollection.prototype.initialize=function(t){for(var e=0,i=this.components.length;i>e;e++)this.components[e].initialize();this.initialized=!0},Atlantis.GameComponentCollection.prototype.loadContent=function(){for(var t=0,e=this.drawables.length;e>t;t++)this.drawables[t].loadContent();this.assetLoaded=!0},Atlantis.GameComponentCollection.prototype.unloadContent=function(){for(var t=0,e=this.drawables.length;e>t;t++)this.drawables[t].unloadContent();this.assetLoaded=!1},Atlantis.GameComponentCollection.prototype.update=function(t){for(var e=0,i=this.components.length;i>e;e++)this.components[e].isEnabled()&&this.components[e].update(t)},Atlantis.GameComponentCollection.prototype.draw=function(t,e){for(var i=0,n=this.drawables.length;n>i;i++)this.drawables[i].isVisible()&&this.drawables[i].draw(t,e)},Atlantis.GameComponentCollection.prototype.add=function(t){-1==this.components.indexOf(t)&&(this.components.push(t),this.initialized&&t.initialize(),t instanceof Atlantis.DrawableGameComponent&&(this.drawables.push(t),this.assetLoaded&&t.loadContent()))},Atlantis.GameComponentCollection.prototype.remove=function(t){var e=this.components.indexOf(t);return e>-1?(this.components.splice(e,1),t instanceof Atlantis.DrawableGameComponent&&(e=this.drawables.indexOf(t),e>-1&&this.drawables.splice(e,1)),!0):!1},Atlantis.GameComponentCollection.prototype.get=function(t){var e=null,i=this.components.indexOf(gameComponent);return i>-1&&(e=this.components[t]),null};var Atlantis=window.Atlantis||{};Atlantis.GameTime=function(){this.reset()},Atlantis.GameTime.prototype.reset=function(){this.elapsedTime=0,this.totalGameTime=0,this.currentTime=+new Date,this.fps=0},Atlantis.GameTime.prototype.update=function(){var t=+new Date;this.elapsedTime=t-this.currentTime,this.totalGameTime+=this.elapsedTime,this.fps=1e3/(t-this.currentTime),this.currentTime=t},Atlantis.GameTime.prototype.getElapsedTime=function(){return this.elapsedTime},Atlantis.GameTime.prototype.getTotalGameTime=function(){return this.totalGameTime},Atlantis.GameTime.prototype.getFPS=function(){return this.fps};var Atlantis=window.Atlantis||{};Atlantis.MathHelper={Pi:Math.PI,PiOver2:Math.PI/2,PiOver4:Math.PI/4,TwoPi:2*Math.PI,clamp:function(t,e,i){return t=t>i?i:t,t=e>t?e:t},distance:function(t,e){return Math.abs(t-e)},hermite:function(t,e,i,n,s){var a=s*s*s,r=s*s;return 0===s?t:1===s?i:(2*t-2*i+n+e)*a+(3*i-3*t-2*e-n)*r+e*s+t},lerp:function(t,e,i){return i=0>i?0:i,i=i>1?1:i,t+(e-t)*i},smoothStep:function(t,e,i){var n=this.clamp(i,0,1);return n=this.hermite(t,0,e,0,n)},toDegrees:function(t){return t*(180/Math.PI)},toRadians:function(t){return t*(Math.PI/180)},isPowerOfTwo:function(t){return t>0&&0==(t&t-1)}};var Atlantis=Atlantis||{};Atlantis.Rectangle=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0},Atlantis.Rectangle.prototype.add=function(t){this.x+=t.x,this.y+=t.y,this.width+=t.width,this.height+=t.height},Atlantis.Rectangle.prototype.divide=function(t){this.x/=t.x,this.y/=t.y,this.width/=t.width,this.height/=t.height},Atlantis.Rectangle.prototype.fromRectangle=function(t){this.x=t.x?+t.x:0,this.y=t.y?+t.y:0,this.width=t.width?+t.width:0,this.height=t.height?+t.height:0},Atlantis.Rectangle.prototype.multiply=function(t){this.x*=t.x,this.y*=t.y,this.width*=t.width,this.height*=t.height},Atlantis.Rectangle.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y,this.width-=t.width,this.height-=t.height},Atlantis.Rectangle.prototype.contains=function(t,e){return t instanceof Atlantis.Rectangle?this.x<=t.x&&t.getRight()<=this.getRight()&&this.y<=t.y&&t.getBottom()<=this.getBottom():this.x<=t&&t<this.getRight()&&this.y<=e&&e<this.getBottom()},Atlantis.Rectangle.prototype.intersects=function(t){return t.getLeft()<this.getRight()&&this.getLeft()<t.getRight()&&t.getTop()<this.getBottom()&&this.getTop()<t.getBottom()},Atlantis.Rectangle.prototype.toString=function(){return["x: ",this.x," y: ",this.y," width: ",this.width," height: ",this.height].toString()},Atlantis.Rectangle.prototype.toVector2=function(){return new Atlantis.Vector2(this.x,this.y)},Atlantis.Rectangle.prototype.toPoint=function(){return new Atlantis.Point(this.x,this.y)},Atlantis.Rectangle.prototype.getTop=function(){return this.y},Atlantis.Rectangle.prototype.getBottom=function(){return this.y+this.height},Atlantis.Rectangle.prototype.getLeft=function(){return this.x},Atlantis.Rectangle.prototype.getRight=function(){return this.x+this.width},Atlantis.Rectangle.prototype.getCenter=function(){return new Atlantis.Point(this.x+this.width/2,this.y+this.height/2)},Atlantis.Rectangle.prototype.getWidth=function(){return this.width},Atlantis.Rectangle.prototype.getHeight=function(){return this.height},Atlantis.Rectangle.prototype.getTopCenter=function(){return new Atlantis.Vector2(this.x+this.width/2,this.y)},Atlantis.Rectangle.prototype.getBottomCenter=function(){return new Atlantis.Vector2(this.x+this.width/2,this.y+this.height)},Atlantis.Rectangle.prototype.getLeftCenter=function(){return new Atlantis.Vector2(this.x,this.y+this.height/2)},Atlantis.Rectangle.prototype.getRightCenter=function(){return new Atlantis.Vector2(this.x+this.width,this.y+this.height/2)},Atlantis.Rectangle.prototype.set=function(t,e,i,n){t instanceof Atlantis.Rectangle?(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height):(this.x=t,this.y=e,this.width=i,this.height=n)},Atlantis.Rectangle.prototype.setPosition=function(t,e){this.x=t,this.y=e},Atlantis.Rectangle.prototype.setSize=function(t,e){this.width=t,this.height=e},Atlantis.Rectangle.prototype.clone=function(){return new Atlantis.Rectangle(this.x,this.y,this.width,this.height)},Atlantis.Rectangle.prototype.toString=function(){return["x: ",this.x," y: ",this.y," width: ",this.width," height: ",this.height].join("")};var Atlantis=window.Atlantis||{};Atlantis.Matrix=function(t){if(t instanceof Atlantis.Matrix){var t=t.toArray();this.set(t)}else t instanceof Array&&16==t.length?this.set(t):(this.M11=0,this.M12=0,this.M13=0,this.M14=0,this.M21=0,this.M22=0,this.M23=0,this.M24=0,this.M31=0,this.M32=0,this.M33=0,this.M34=0,this.M41=0,this.M42=0,this.M43=0,this.M44=0)},Atlantis.Matrix.prototype.clone=function(){return new Atlantis.Matrix(this.toArray())},Atlantis.Matrix.prototype.set=function(t){16==t.length&&(this.M11=t[0],this.M12=t[1],this.M13=t[2],this.M14=t[3],this.M21=t[4],this.M22=t[5],this.M23=t[6],this.M24=t[7],this.M31=t[8],this.M32=t[9],this.M33=t[10],this.M34=t[11],this.M41=t[12],this.M42=t[13],this.M43=t[14],this.M44=t[15])},Atlantis.Matrix.prototype.getIdentityValues=function(){var t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return t},Atlantis.Matrix.prototype.getZeroValues=function(){for(var t=[],e=0;16>e;e++)t.push(0);return t},Atlantis.Matrix.prototype.setIdentity=function(){this.set(this.getIdentityValues())},Atlantis.Matrix.getMatrixIdentity=function(){var t=new Atlantis.Matrix;return t.setIdentity(),t},Atlantis.Matrix.prototype.toArray=function(){var t=[];return t.push(this.M11),t.push(this.M12),t.push(this.M13),t.push(this.M14),t.push(this.M21),t.push(this.M22),t.push(this.M23),t.push(this.M24),t.push(this.M31),t.push(this.M32),t.push(this.M33),t.push(this.M34),t.push(this.M41),t.push(this.M42),t.push(this.M43),t.push(this.M44),t},Atlantis.Matrix.prototype.setLeft=function(t){this.M11=-t.x,this.M12=-t.y,this.M13=-t.z},Atlantis.Matrix.prototype.getLeft=function(){var t=new Atlantis.Vector3;return t.x=-this.M11,t.y=-this.M12,t.z=-this.M13,t},Atlantis.Matrix.prototype.setRight=function(t){this.M11=t.x,this.M12=t.y,this.M13=t.z},Atlantis.Matrix.prototype.getRight=function(){var t=new Atlantis.Vector3;return t.x=this.M11,t.y=this.M12,t.z=this.M13,t},Atlantis.Matrix.prototype.setUp=function(t){this.M21=t.x,this.M22=t.y,this.M23=t.z},Atlantis.Matrix.prototype.getUp=function(){var t=new Atlantis.Vector3;return t.x=this.M21,t.y=this.M22,t.z=this.M23,t},Atlantis.Matrix.prototype.setDown=function(t){this.M21=-t.x,this.M22=-t.y,this.M23=-t.z},Atlantis.Matrix.prototype.getDown=function(){var t=new Atlantis.Vector3;return t.x=-this.M21,t.y=-this.M22,t.z=-this.M23,t},Atlantis.Matrix.prototype.setBackward=function(t){this.M31=t.x,this.M32=t.y,this.M33=t.z},Atlantis.Matrix.prototype.getBackward=function(){var t=new Atlantis.Vector3;return t.x=this.M31,t.y=this.M32,t.z=this.M33,t},Atlantis.Matrix.prototype.setForward=function(t){this.M31=-t.x,this.M32=-t.y,this.M33=-t.z},Atlantis.Matrix.prototype.getForward=function(){var t=new Atlantis.Vector3;return t.x=-this.M31,t.y=-this.M32,t.z=-this.M33,t},Atlantis.Matrix.prototype.setTranslation=function(t){this.M41=t.x,this.M42=t.y,this.M43=t.z},Atlantis.Matrix.prototype.add=function(t){for(var e=this.toArray(),i=t.toArray(),n=0;16>n;n++)e[n]+=i[n];this.set(e)},Atlantis.Matrix.add=function(t,e){var i=new Atlantis.Matrix(t);return i.add(e),i},Atlantis.Matrix.createRotationX=function(t){var e=getMatrixIdentity(),i=Math.cos(t),n=Math.sin(t);return e.M22=i,e.M23=n,e.M32=-n,e.M33=i,e},Atlantis.Matrix.createRotationY=function(t){var e=getMatrixIdentity(),i=Math.cos(t),n=Math.sin(t);return e.M11=i,e.M13=-n,e.M31=n,e.M33=i,e},Atlantis.Matrix.createRotationZ=function(t){var e=this.getMatrixIdentity(),i=Math.cos(t),n=Math.sin(t);return e.M11=i,e.M13=n,e.M31=-n,e.M33=i,e},Atlantis.Matrix.createScale=function(t,e,i){var n=Atlantis.Matrix.getMatrixIdentity();return n.M11=t,n.M22=e||t,n.M33=i||t,n},Atlantis.Matrix.createTranslation=function(t,e,i){var n=Atantis.Matrix.getMatrixIdentity();return n.M41=t,n.M42=e||t,n.M43=i||t,n},Atlantis.Matrix.createLookAt=function(t,e,i){var n=Atlantis.Vector3.subtract(e,t);n.normalize();var s=Atlantis.Vector3.cross(i,n);s.normalize();var a=Atlantis.Vector3.cross(n,s);a.normalize();var r=Atlantis.Matrix.getMatrixIdentity();return r.M11=s.x,r.M21=s.y,r.M31=s.z,r.M12=a.x,r.M22=a.y,r.M32=a.z,r.M13=n.x,r.M23=n.y,r.M33=n.z,r.M41=-Atlantis.Vector3.dot(s,t),r.M42=-Atlantis.Vector3.dot(a,t),r.M43=-Atlantis.Vector3.dot(n,t),r},Atlantis.Matrix.createOrthographic=function(t,e,i,n){var s=new Matrix;return s.M11=2/t,s.M12=s.M13=s.M14=0,s.M22=2/e,s.M21=s.M23=s.M24=0,s.M33=1/(i-n),s.M31=s.M32=s.M34=0,s.M41=s.M42=0,s.M43=i/(i-n),s.M44=1,s},Atlantis.Matrix.createOrthographicOffCenter=function(t,e,i,n,s,a){var r=new Atlantis.Matrix;return r.M11=2/(e-t),r.M12=0,r.M13=0,r.M14=0,r.M21=0,r.M22=2/(n-i),r.M23=0,r.M24=0,r.M31=0,r.M32=0,r.M33=1/(s-a),r.M34=0,r.M41=(t+e)/(t-e),r.M42=(n+i)/(i-n),r.M43=s/(s-a),r.M44=1,r},Atlantis.Matrix.createPerspectiveFieldOfView=function(t,e,i,n){var s=1/Math.tan(.5*t),a=s/e,r=i/a,o=i/s;return Atlantis.Matrix.createPerspectiveOffCenter(-r,r,-o,o,i,n)},Atlantis.Matrix.createPerspetiveFieldOfViewRH=function(t,e,i,n){var s=1/Math.tan(.5*t),a=s/e,r=i/a,o=i/s;return Matrix.createPerspectiveOffCenterRH(-r,r,-o,o,i,n)},Atlantis.Matrix.createPerspectiveOffCenter=function(t,e,i,n,s,a){var r=a/(a-s),o=new Atlantis.Matrix;return o.M11=2*s/(e-t),o.M22=2*s/(n-i),o.M31=(t+e)/(t-e),o.M32=(n+i)/(i-n),o.M33=r,o.M34=1,o.M43=-s*r,o},Atlantis.Matrix.createPerspectiveOffCenterRH=function(t,e,i,n,s,a){var r=createPerspectiveOffCenter(t,e,i,n,s,a);return r.M31*=-1,r.M32*=-1,r.M33*=-1,r.M34*=-1,r},Atlantis.Matrix.prototype.invert=function(){var t=this.M31*this.M42-this.M32*this.M41,e=this.M31*this.M43-this.M33*this.M41,i=this.M34*this.M41-this.M31*this.M44,n=this.M32*this.M43-this.M33*this.M42,s=this.M34*this.M42-this.M32*this.M44,a=this.M33*this.M44-this.M34*this.M43,r=this.M22*a+this.M23*s+this.M24*n,o=this.M21*a+this.M23*i+this.M24*e,h=this.M21*-s+this.M22*i+this.M24*t,l=this.M21*n+this.M22*-e+this.M23*t,c=this.M11*r-this.M12*o+this.M13*h-this.M14*l;if(0==Math.abs(c))return void this.set(this.getZeroValues());c=1/c;var p=this.M11*this.M22-this.M12*this.M21,u=this.M11*this.M23-this.M13*this.M21,d=this.M14*this.M21-this.M11*this.M24,f=this.M12*this.M23-this.M13*this.M22,y=this.M14*this.M22-this.M12*this.M24,A=this.M13*this.M24-this.M14*this.M23,g=this.M12*a+this.M13*s+this.M14*n,m=this.M11*a+this.M13*i+this.M14*e,M=this.M11*-s+this.M12*i+this.M14*t,v=this.M11*n+this.M12*-e+this.M13*t,x=this.M42*A+this.M43*y+this.M44*f,w=this.M41*A+this.M43*d+this.M44*u,_=this.M41*-y+this.M42*d+this.M44*p,S=this.M41*f+this.M42*-u+this.M43*p,b=this.M32*A+this.M33*y+this.M34*f,T=this.M31*A+this.M33*d+this.M34*u,V=this.M31*-y+this.M32*d+this.M34*p,C=this.M31*f+this.M32*-u+this.M33*p;this.M11=+r*c,this.M12=-g*c,this.M13=+x*c,this.M14=-b*c,this.M21=-o*c,this.M22=+m*c,this.M23=-w*c,this.M24=+T*c,this.M31=+h*c,this.M32=-M*c,this.M33=+_*c,this.M34=-V*c,this.M41=-l*c,this.M42=+v*c,this.M43=-S*c,this.M44=+C*c},Atlantis.Matrix.invert=function(t){var e=new Matrix(t);return e.invert(),e},Atlantis.Matrix.createWorld=function(t,e,i){var n=new Atlantis.Matrix,s=Atlantis.Vector3.cross(e,i),a=Atlantis.Vector3.cross(s,e);return Atlantis.Vector3.normalize(e),s.normalize(),a.normalize(),n.setTranslation(t),n.M44=1,n},Atlantis.Matrix.prototype.multiply=function(t){var e=this.M11*t.M11+this.M12*t.M21+this.M13*t.M31+this.M14*t.M41,i=this.M11*t.M12+this.M12*t.M22+this.M13*t.M32+this.M14*t.M42,n=this.M11*t.M13+this.M12*t.M23+this.M13*t.M33+this.M14*t.M43,s=this.M11*t.M14+this.M12*t.M24+this.M13*t.M34+this.M14*t.M44,a=this.M21*t.M11+this.M22*t.M21+this.M23*t.M31+this.M24*t.M41,r=this.M21*t.M12+this.M22*t.M22+this.M23*t.M32+this.M24*t.M42,o=this.M21*t.M13+this.M22*t.M23+this.M23*t.M33+this.M24*t.M43,h=this.M21*t.M14+this.M22*t.M24+this.M23*t.M34+this.M24*t.M44,l=this.M31*t.M11+this.M32*t.M21+this.M33*t.M31+this.M34*t.M41,c=this.M31*t.M12+this.M32*t.M22+this.M33*t.M32+this.M34*t.M42,p=this.M31*t.M13+this.M32*t.M23+this.M33*t.M33+this.M34*t.M43,u=this.M31*t.M14+this.M32*t.M24+this.M33*t.M34+this.M34*t.M44,d=this.M41*t.M11+this.M42*t.M21+this.M43*t.M31+this.M44*t.M41,f=this.M41*t.M12+this.M42*t.M22+this.M43*t.M32+this.M44*t.M42,y=this.M41*t.M13+this.M42*t.M23+this.M43*t.M33+this.M44*t.M43,A=this.M41*t.M14+this.M42*t.M24+this.M43*t.M34+this.M44*t.M44;this.M11=e,this.M12=i,this.M13=n,this.M14=s,this.M21=a,this.M22=r,this.M23=o,this.M24=h,this.M31=l,this.M32=c,this.M33=p,this.M34=u,this.M41=d,this.M42=f,this.M43=y,this.M44=A},Atlantis.Matrix.multiply=function(t,e,i){var n=new Atlantis.Matrix(t);return n.multiply(e),i instanceof Atlantis.Matrix&&n.multiply(i),n},Atlantis.Matrix.prototype.subtract=function(t){for(var e=this.toArray(),i=t.toArray(),n=0;16>n;n++)e[n]-=i[n];this.set(e)},Atlantis.Matrix.subtract=function(t,e){var i=new Atlantis.Matrix(t);return i.subtract(e),i},Atlantis.Matrix.prototype.toString=function(){for(var t=this.toArray(),e=[],i=0;16>i;i+=4)e.push("["),e.push(t[i]+" "),e.push(t[i+1]+" "),e.push(t[i+2]+" "),e.push(t[i+3]),e.push("] ");return e.join("")};var Atlantis=Atlantis||{};Atlantis.Quaternion=function(t,e,i,n){this.x=t?+t:0,this.y=e?+e:0,this.z=i?+i:0,this.z=n?+n:0},Atlantis.Quaternion.prototype.fromQuaternion=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},Atlantis.Quaternion.Identity=function(){return new Atlantis.Quaternion(0,0,0,1)},Atlantis.Quaternion.prototype.add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w},Atlantis.Quaternion.add=function(t,e){var i=new Quaternion(t);return i.add(e),i},Atlantis.Quaternion.prototype.conjugate=function(){this.x*=-1,this.y*=-1,this.z*=-1},Atlantis.Quaternion.conjugate=function(t){var e=new Quaternion(t);return e.conjugate(),e},Atlantis.Quaternion.createFromYawPitchRoll=function(t,e,i){var n=new Quaternion,s=.5*t,a=.5*e,r=.5*i,o=Math.sin(s),h=Math.cos(s),l=Math.sin(a),c=Math.cos(a),p=Math.sin(r),u=Math.cos(r);return n.x=h*l*u+o*c*p,n.y=o*c*u-h*l*p,n.z=h*c*p-o*l*u,n.w=h*c*u-o*l*p,n},Atlantis.Quaternion.prototype.clone=function(){return new Atlantis.Quaternion(this.x,this.y,this.z,this.w)},Atlantis.Quaternion.prototype.toString=function(){return["x: ",this.x," y: ",this.y," z: ",this.z," w: ",this.w].join("")};var Atlantis=window.Atlantis||{};Atlantis.Point=function(t,e){this.x=t?+t:0,this.y=e?+e:0},Atlantis.Point.clone=function(t,e){return new Atlantis.Point(this.x,this.y)},Atlantis.Point.prototype.toString=function(){return["x: ",this.x," y: ",this.y].join("")},Atlantis.Vector2=function(t,e){this.x=t?+t:0,this.y=e?+e:0},Atlantis.Vector2.prototype.fromVector=function(t){this.x=t.x,this.y=t.y},Atlantis.Vector2.Zero=function(){return new Vector2},Atlantis.Vector2.One=function(){return new Vector2(1,1)},Atlantis.Vector2.UnitX=function(){return new Vector2(1,0)},Atlantis.Vector2.UnitY=function(){return new Vector2(0,1)},Atlantis.Vector2.prototype.add=function(t){"number"==typeof t?(this.x+=t,this.y+=t):(this.x+=t.x,this.y+=t.y)},Atlantis.Vector2.add=function(t,e){var i=t.clone();return i.add(e),i},Atlantis.Vector2.addToRef=function(t,e,i){i.x=t.x+e.x,i.y=t.y+e.y},Atlantis.Vector2.prototype.subtract=function(t){"number"==typeof t?(this.x-=t,this.y-=t):(this.x-=t.x,this.y-=t.y)},Atlantis.Vector2.subtract=function(t,e){var i=t.clone();return i.subtract(e),i},Atlantis.Vector2.subtractToRef=function(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y},Atlantis.Vector2.prototype.divide=function(t){"number"==typeof t?(this.x/=t,this.y/=t):(this.x/=t.x,this.y/=t.y)},Atlantis.Vector2.divide=function(t,e){var i=t.clone();return i.divide(e),i},Atlantis.Vector2.divideToRef=function(t,e,i){i.x=t.x/e.x,i.y=t.y/e.y},Atlantis.Vector2.prototype.multiply=function(t){"number"==typeof t?(this.x*=t,this.y*=t):(this.x*=t.x,this.y*=t.y)},Atlantis.Vector2.multiply=function(t,e){var i=t.clone();return i.multiply(e),i},Atlantis.Vector2.multiplyToRef=function(t,e,i){i.x=t.x*e.x,i.y=t.y*e.y},Atlantis.Vector2.prototype.distance=function(t){return Atlantis.Vector2.distance(this,t)},Atlantis.Vector2.distance=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},Atlantis.Vector2.prototype.dot=function(t){return Atlantis.Vector2.dot(this,t)},Atlantis.Vector2.dot=function(t,e){return t.x*e.x+t.y*e.y},Atlantis.Vector2.prototype.length=function(){return Atlantis.Vector2.length(this)},Atlantis.Vector2.length=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},Atlantis.Vector2.lerp=function(t,e,i){return Atlantis.Vector2.lerpToRef(t,e,i,new Atlantis.Vector2),vector},Atlantis.Vector2.lerpToRef=function(t,e,i,n){n.x=Atlantis.MathHelper.lerp(t.x,e.x,i),n.y=Atlantis.MathHelper.lerp(t.y,e.y,i)},Atlantis.Vector2.min=function(t,e){var i=new Atlantis.Vector2;return Atlantis.Vector2.minToRef(t,e,i),i},Atlantis.Vector2.minToRef=function(t,e,i){i.x=t.x<e.x?t.x:e.x,i.y=t.y<e.y?t.y:e.y},Atlantis.Vector2.max=function(t,e){var i=new Vector2;return Atlantis.Vector2.maxToRef(t,e,i),i},Atlantis.Vector2.maxToRef=function(t,e,i){i.x=t.x>e.x?t.x:e.x,i.y=t.y>e.y?t.y:e.y},Atlantis.Vector2.prototype.negate=function(t){"number"==typeof t?(this.x=-t,this.y=-t):(this.x=-t.x,this.y=-t.y)},Atlantis.Vector2.negate=function(t){var e=t.clone();return e.x*=-1,e.y*=-1,e},Atlantis.Vector2.prototype.normalize=function(){Atlantis.Vector2.normalizeToRef(this)},Atlantis.Vector2.normalize=function(t){var e=t.clone();return e.normalize(),e},Atlantis.Vector2.normalizeToRef=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);e||(t.x=0,t.y=0);var i=1/e;t.x*=i,t.y*=i},Atlantis.Vector2.reflect=function(t,e){var i=new Atlantis.Vector2;return Atlantis.ReflectToRef(t,e,i),i},Atlantis.Vector2.reflectToRef=function(t,e,i){var n=2*(t.x*e.x+t.y*e.y);i.x=t.x-e.x*n,i.y=t.y-e.y*n},Atlantis.Vector2.smoothStep=function(t,e,i){var n=new Atlantis.Vector2;return Atlantis.Vector2.smoothStepToRef(t,e,i,n),n},Atlantis.Vector2.smoothStepToRef=function(t,e,i,n){n.x=Atlantis.MathHelper.smoothStep(t.x,e.x,i),n.y=Atlantis.MathHelper.smoothStep(t.y,e.y,i)},Atlantis.Vector2.transform=function(t,e){var i=new Atlantis.Vector3;return Atlantis.Vector2.transformToRef(t,e,i),i},Atlantis.Vector2.transformToRef=function(t,e,i){var n=t.x*e.M11+t.y*e.M21+e.M41,s=t.x*e.M12+t.y*e.M22+e.M42;i.x=n,i.x=s},Atlantis.Vector2.transformNormal=function(t,e){var i=new Atlantis.Vector3;return Atlantis.Vector2.transformNormalToRef(t,e,i),i},Atlantis.Vector2.transformNormalToRef=function(t,e,i){var n=t.x*e.M11+t.y*e.M21,s=t.x*e.M12+t.y*e.M22;i.x=n,i.y=s},Atlantis.Vector2.prototype.set=function(t,e){this.x=t,this.y=e},Atlantis.Vector2.prototype.clone=function(){return new Atlantis.Vector2(this.x,this.y)},Atlantis.Vector2.prototype.toString=function(){return["x: ",this.x," y: ",this.y].join("")};var Atlantis=window.Atlantis||{};Atlantis.Vector3=function(t,e,i){this.x=t?+t:0,this.y=e?+e:0,this.z=i?+i:0},Atlantis.Vector3.prototype.fromVector=function(t){this.x=t.x,this.y=t.y,this.z=t.z},Atlantis.Vector3.Zero=function(){return new Atlantis.Vector3(0,0,0)},Atlantis.Vector3.One=function(){return new Atlantis.Vector3(1,1,1)},Atlantis.Vector3.UnitX=function(){return new Atlantis.Vector3(1,0,0)},Atlantis.Vector3.UnitY=function(){return new Atlantis.Vector3(0,1,0)},Atlantis.Vector3.UnitZ=function(){return new Atlantis.Vector3(0,0,1)},Atlantis.Vector3.Up=function(){return new Atlantis.Vector3(0,1,0)},Atlantis.Vector3.Down=function(){return new Atlantis.Vector3(0,-1,0)},Atlantis.Vector3.Right=function(){return new Atlantis.Vector3(1,0,0)},Atlantis.Vector3.Left=function(){return new Atlantis.Vector3(-1,0,0)},Atlantis.Vector3.Forward=function(){return new Atlantis.Vector3(0,0,-1)},Atlantis.Vector3.Backward=function(){return new Atlantis.Vector3(0,0,1)},Atlantis.Vector3.prototype.add=function(t){t instanceof Atlantis.Vector3?(this.x+=t.x,this.y+=t.y,this.z+=t.z):(this.x+=t,this.y+=t,this.z+=t)},Atlantis.Vector3.add=function(t,e){var i=new Vector3(t);return i.add(e),i},Atlantis.Vector3.prototype.subtract=function(t){t instanceof Atlantis.Vector3?(this.x-=t.x,this.y-=t.y,this.z-=t.z):(this.x-=t,this.y-=t,this.z-=t)},Atlantis.Vector3.subtract=function(t,e){var i=new Atlantis.Vector3(t);return i.subtract(e),i},Atlantis.Vector3.prototype.divide=function(t){0!=t.x&&(this.x/=t.x),0!=t.y&&(this.y/=t.y),0!=t.z&&(this.z/=t.z)},Atlantis.Vector3.divide=function(t,e){var i=new Atlantis.Vector3(t);return i.divide(e),i},Atlantis.Vector3.prototype.multiply=function(t){t instanceof Atlantis.Vector3?(this.x*=t.x,this.y*=t.y,this.z*=t.z):(this.x*=t,this.y*=t,this.z*=t)},Atlantis.Vector3.multiply=function(t,e){var i=new Atlantis.Vector3(t);return i.multiply(e),i},Atlantis.Vector3.cross=function(t,e){var i=new Atlantis.Vector3;return i.x=t.y*e.z-e.y*t.z,i.y=-(t.x*e.z-e.x*t.z),i.z=t.x*e.y-e.x*t.y,i},Atlantis.Vector3.distance=function(t,e){return Math.sqrt(Atlantis.Vector3.distanceSquared(t,e))},Atlantis.Vector3.distanceSquared=function(t,e){var i=t.x-e.x,n=t.y-e.y,s=t.z-e.z;return i*i+n*n+s*s},Atlantis.Vector3.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},Atlantis.Vector3.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Atlantis.Vector3.prototype.lerp=function(t,e){this.x=Atlantis.MathHelper.lerp(this.x,t.x,e),this.y=Atlantis.MathHelper.lerp(this.y,t.y,e),this.z=Atlantis.MathHelper.lerp(this.z,t.z,e)},Atlantis.Vector3.lerp=function(t,e){var i=Atlantis.MathHelper.lerp(t.x,e.x,amount),n=Atlantis.MathHelper.lerp(t.y,e.y,amount),s=Atlantis.MathHelper.lerp(t.z,e.z,amount);return new Atlantis.Vector3(i,n,s)},Atlantis.Vector3.min=function(t,e){var i=new Atlantis.Vector3;return i.x=t.x<e.x?t.x:e.x,i.y=t.y<e.y?t.y:e.y,i.z=t.z<e.z?t.z:e.z,i},Atlantis.Vector3.max=function(t,e){var i=new Atlantis.Vector3;return i.x=t.x>e.x?t.x:e.x,i.y=t.y>e.y?t.y:e.y,i.z=t.z>e.z?t.z:e.z,i},Atlantis.Vector3.prototype.negate=function(){this.x*=-1,this.y*=-1,this.z*=-1},Atlantis.Vector3.negate=function(t){var e=new Atlantis.Vector3(t);return e.negate(),e},Atlantis.Vector3.prototype.normalize=function(){var t=distance(this,new Atlantis.Vector3);0!=t&&(t=1/t,this.set(this.x*t,this.y*t,this.z*t))},Atlantis.Vector3.normalize=function(t){var e=new Vector3(t);return e.normalize(),e},Atlantis.Vector3.transform=function(t,e){var i=new Vector3(t.x*e.M11+t.y*e.M21+t.z*e.M31+e.M41,t.x*e.M12+t.y*e.M22+t.z*e.M32+e.M42,t.x*e.M13+t.y*e.M23+t.z*e.M33+e.M43);return i},Atlantis.Vector3.transformCoordinate=function(t,e){var i=new Atlantis.Vector4;return i.x=t.x*e.M11+t.y*e.M21+t.z*e.M31+e.M41,i.y=t.x*e.M12+t.y*e.M22+t.z*e.M32+e.M42,i.z=t.x*e.M13+t.y*e.M23+t.z*e.M33+e.M43,i.w=1/(t.x*e.M14+t.y*e.M24+t.z*e.M34+e.M44),new Atlantis.Vector3(i.x*i.w,i.y*i.w,i.z*i.w)},Atlantis.Vector3.prototype.set=function(t,e,i){this.x=t,this.y=e,this.z=i},Atlantis.Vector3.prototype.clone=function(){return new Atlantis.Vector3(this.x,this.y,this.z)},Atlantis.Vector3.prototype.toString=function(){return["x: ",this.x," y: ",this.y," z: ",this.z].join("")};var Atlantis=window.Atlantis||{};Atlantis.Vector4=function(t,e,i,n){this.x=t?+t:0,this.y=e?+e:0,this.z=i?+i:0,this.z=n?+n:0},Atlantis.Vector4.prototype.fromVector=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},Atlantis.Vector4.prototype.lerp=function(t,e){this.x=Atlantis.MathHelper.lerp(this.x,t.x,e),this.y=Atlantis.MathHelper.lerp(this.y,t.y,e),this.z=Atlantis.MathHelper.lerp(this.z,t.z,e),this.w=Atlantis.MathHelper.lerp(this.w,t.w,e)},Atlantis.Vector4.lerp=function(t,e,i){var n=new Vector4(t);return n.lerp(e,i),n},Atlantis.Vector4.prototype.clone=function(){return new Atlantis.Vector4(this.x,this.y,this.z,this.w)},Atlantis.Vector4.prototype.toString=function(){return["x: ",this.x," y: ",this.y," z: ",this.z," w: ",this.w].join("")};var Atlantis=window.Atlantis||{};Atlantis.KeyboardState=function(t){this.keys=[];for(var e=0,i=t.length;i>e;e++)this.keys.push(t[e])},Atlantis.KeyboardState.prototype.clone=function(){return new Atlantis.Input.KeyboardState(this.keys)},Atlantis.KeyboardState.prototype.isKeyDown=function(t){return this.keys[t]===!0},Atlantis.KeyboardState.prototype.isKeyUp=function(t){return this.keys[t]===!1},Atlantis.Keyboard=function(t){this.keys=[],this.maxKeys=t||130;for(var e=0;t>e;e++)this.keys[e]=!1;var i=this,n=function(t){Atlantis.Keyboard.preventDefault&&t.preventDefault(),i.keys[t.keyCode]="keydown"===t.type?!0:!1};document.addEventListener("keydown",n,!1),document.addEventListener("keyup",n,!1)},Atlantis.Keyboard.preventDefault=!1,Atlantis.Keyboard.prototype.getState=function(){return new Atlantis.KeyboardState(this.keys)};var Atlantis=window.Atlantis||{};Atlantis.ButtonState={Released:0,Pressed:1},Atlantis.MouseState=function(t,e,i,n){this.x=t,this.y=e,this.scrollWheelValue=i,this.leftButton=n[0],this.rightButton=n[2],this.middleButton=n[1]},Atlantis.MouseState.prototype.clone=function(){return new Atlantis.MouseState(this.x,this.y,this.scrollWheelValue,[this.leftButton,this.middleButton,this.rightButton])},Atlantis.Mouse=function(t){var t=t instanceof HTMLElement?t:document.body;this._x=0,this._y=0,this._scroll=0,this._buttons=[],this._buttons[0]=!1,this._buttons[1]=!1,this._buttons[2]=!1,this.preventDefault=!0;var e=this,i=function(){e._buttons[0]=!1,e._buttons[1]=!1,e._buttons[2]=!1},n=function(n){e._x=(n.pageX-t.offsetLeft)*Atlantis.Game.scaleFactor.x,e._y=(n.pageY-t.offsetTop)*Atlantis.Game.scaleFactor.y,"mousemove"!==n.type&&"pointermove"!==n.type&&(i(),"mousedown"===n.type||"pointerdown"===n.type?e._buttons[n.button]=!0:e._buttons[n.button]=!1)},s=function(t){e._scroll=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail))};t.addEventListener("mousedown",n,!1),t.addEventListener("mousemove",n,!1),t.addEventListener("mouseup",n,!1),t.addEventListener("mousewheel",s,!1),t.addEventListener("DOMMouseScroll",s,!1)},Atlantis.Mouse.prototype.getState=function(){return new Atlantis.MouseState(this._x,this._y,this._scroll,this._buttons)};var Atlantis=window.Atlantis||{};Atlantis.TouchLocationState={Invalid:1,Moved:2,Pressed:3,Released:4},Atlantis.TouchCollection=function(t){Array.call(this);for(var t=t||[],e=0,i=t.length;i>e;e++)this.push(new Atlantis.TouchPanelState(t[e]))},Atlantis.TouchCollection.prototype=Object.create(Array.prototype),Atlantis.TouchCollection.prototype.clone=function(){for(var t=[],e=0,i=this.length;i>e;e++)t.push(this[e].clone());return new Atlantis.TouchCollection(t)},Atlantis.TouchPanelState=function(t){this.state=t.state||Atlantis.TouchLocationState.Invalid,this.position=t.position?t.position:new Atlantis.Vector2(0,0)},Atlantis.TouchPanelState.prototype.clone=function(){
return new Atlantis.TouchPanelState({state:this.state,position:{x:this.position.x,y:this.position.y}})},Atlantis.TouchPanel=function(t){this._states=[new Atlantis.TouchPanelState({}),new Atlantis.TouchPanelState({}),new Atlantis.TouchPanelState({})];var e={up:"touchend",down:"touchstart",cancel:"touchcancel",move:"touchmove",callback:null},i=this,n=null,s=!1,a=function(a,r){if(i._states[a]||(i._states[a]=new Atlantis.TouchPanelState),r.touches?(i._states[a].position.x=r.touches[a].pageX-t.offsetLeft,i._states[a].position.y=r.touches[a].pageY-t.offsetTop):(i._states[a].position.x=r.clientX-t.offsetLeft,i._states[a].position.y=r.clientY-t.offsetTop),i._states[a].position.x*=Atlantis.Game.scaleFactor.x,i._states[a].position.y*=Atlantis.Game.scaleFactor.y,s){var o=n===e.down&&r.type===e.move;if(n=r.type,o)return void(n=null)}r.type==e.down?i._states[a].state=Atlantis.TouchLocationState.Pressed:r.type==e.move?(r.preventDefault(),i._states[a].state=Atlantis.TouchLocationState.Moved):r.type==e.up?i._states[a].state=Atlantis.TouchLocationState.Released:i._states[a].state=Atlantis.TouchLocationState.Invalid},r=function(t){if("touchend"===t.type||"touchcancel"===t.type)for(var e=0,n=i._states.length;n>e;e++)i._states[e].state="touchend"===t.type?Atlantis.TouchLocationState.Released:Atlantis.TouchLocationState.Invalid;else for(var e=0,n=t.touches.length;n>e;e++)a(e,t)},o=function(t){t.preventDefault(),"MSPointerUp"===t.type||"MSPointerCancel"===t.type||"pointerup"===t.type||"pointercancel"===t.type?i._states[0].state="MSPointerUp"===t.type||"pointerup"===t.type?Atlantis.TouchLocationState.Released:Atlantis.TouchLocationState.Invalid:a(0,t)},h=+navigator.maxTouchPoints||+navigator.msMaxTouchPoints;0!==h&&(window.PointerEvent?(e.up="pointerup",e.down="pointerdown",e.move="pointermove",e.cancel="pointercancel",e.callback=o):window.MSPointerEvent?(e.up="MSPointerUp",e.down="MSPointerDown",e.move="MSPointerMove",e.cancel="MSPointerCancel",e.callback=o):e.callback=r,s="touchstart"!==e.down,t.addEventListener(e.down,e.callback,!1),t.addEventListener(e.move,e.callback,!1),t.addEventListener(e.up,e.callback,!1),t.addEventListener(e.cancel,e.callback,!1))},Atlantis.TouchPanel.prototype.getCapabilities=function(){return{hasTouch:!!("ontouchstart"in window)||!!("ongesturechange"in window)}},Atlantis.TouchPanel.prototype.getState=function(t){return"number"==typeof t?new Atlantis.TouchPanelState(this._states[t]?this._states[t]:{}):new Atlantis.TouchCollection(this._states)};var Atlantis=window.Atlantis||{};Atlantis.GamepadButton={A:0,B:1,X:2,Y:3,LeftShoulder:4,RightShoulder:5,LeftTrigger:6,RightTrigger:7,Select:8,Start:9,L3:10,R3:11,DPadUp:12,DPadDown:13,DPadLeft:14,DPadRight:15},Atlantis.GamepadAxis={Horizontal:0,Vertical:1,HorizontalRight:2,VerticalRight:3},Atlantis.GamepadState=function(t,e){if(this.axis=[],this.buttons=[],t)for(var i=0,n=t.length;n>i;i++)this.axis.push(t[i]);else for(var i=0;6>i;i++)this.axis.push(0);if(e)for(var i=0,n=e.length;n>i;i++)this.buttons.push(e[i]);else for(var i=0;15>i;i++)this.buttons.push(!1)},Atlantis.GamepadState.prototype.isButtonDown=function(t){return this.buttons[t]},Atlantis.GamepadState.prototype.isButtonUp=function(t){return!this.buttons[t]},Atlantis.GamepadState.prototype.getAxis=function(t){return this.axis[t]},Atlantis.Gamepad=function(){Atlantis.GameComponent.call(this),this._gamepads=[],this._states={}},Atlantis.Gamepad.prototype=Object.create(Atlantis.GameComponent.prototype),Atlantis.Gamepad.prototype.initialize=function(){var t=this;navigator.getGamepads=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads,this._gamepadsSupported=navigator.getGamepads?!0:!1,window.addEventListener("gamepadconnected",function(e){t._addGamepad(e.gamepad)},!1),window.addEventListener("gamepaddisconnected",function(e){t._removeGamepad(e.gamepad)},!1)},Atlantis.Gamepad.prototype._addGamepad=function(t){this._gamepads.push(t),this._states[t.index]=new Atlantis.GamepadState},Atlantis.Gamepad.prototype._removeGamepad=function(t){delete this._gamepads[t.index],delete this._states[t.index]},Atlantis.Gamepad.prototype._updateGamepads=function(){for(var t=navigator.getGamepads(),e=0;e<t.length;e++)t[e]&&-1===this._gamepads.indexOf(t[e])&&this._addGamepad(t[e])},Atlantis.Gamepad.prototype.update=function(t){if(this._gamepadsSupported){this._updateGamepads();for(var e=0,i=this._gamepads.length;i>e;e++){for(var n=this._gamepads[e],s=0,a=n.buttons.length;a>s;s++){var r=n.buttons[s],o=1===r?!0:!1;"object"==typeof r&&(o=r.pressed,r=r.value),this._states[n.index].buttons[s]=o}for(var s=0,a=n.axes.length;a>s;s++)this._states[n.index].axis[s]=0|+n.axes[s]}}},Atlantis.Gamepad.prototype.getState=function(t){var t="undefined"!=typeof t?t:0;return this._gamepads[t]?new Atlantis.GamepadState(this._states[t].axis,this._states[t].buttons):new Atlantis.GamepadState};var Atlantis=window.Atlantis||{};Atlantis.Keys={BackSpace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Pause:19,Escape:27,Space:32,Home:36,End:35,Left:37,Up:38,Right:39,Down:40,Suppr:46,PageUp:33,PageDown:34,Insert:45,Num0:48,Num1:49,Num2:50,Num3:51,Num4:52,Num5:53,Num6:54,Num7:55,Num8:56,Num9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Super:91,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};var Atlantis=window.Atlantis||{};Atlantis.ScaleMode={ScaleToFit:0,ConserveAspectRatio:1,NoScaleCenter:2},Atlantis.GraphicsDevice=function(t,e,i){var i=i||{};if(i.width=t,i.height=e,this.preferredBackBufferWidth=i.backBufferWidth||t,this.preferredBackBufferHeight=i.backBufferHeight||e,this.disableSmoothing=!1,this.forceDisableSmoothing=!1,this.viewport=new Atlantis.Rectangle,this.scaleMode=Atlantis.ScaleMode.ScaleToFit,t&&e){this._frontBuffer=new Atlantis.RenderTarget(t,e,i.canvas),this._fbContext=this._frontBuffer.getContext(),this._backBuffer=new Atlantis.RenderTarget(this.preferredBackBufferWidth,this.preferredBackBufferHeight),this._bbCanvas=this._backBuffer.getCanvas();var n=this._frontBuffer.getCanvas();n.style.msTouchAction="none",n.style.backgroundColor="#000",n.id=n.id?n.id:"AtlantisCanvas",this.viewport.setSize(this.preferredBackBufferWidth,this.preferredBackBufferHeight)}},Atlantis.GraphicsDevice.prototype.applyChanges=function(){this._backBuffer.setSize(this.preferredBackBufferWidth,this.preferredBackBufferHeight);var t=this._frontBuffer.getWidth(),e=this._frontBuffer.getHeight();if(this.scaleMode==Atlantis.ScaleMode.ScaleToFit||t===this.preferredBackBufferWidth&&e===this.preferredBackBufferHeight)this.viewport.set(0,0,t,e);else if(this.scaleMode==Atlantis.ScaleMode.ConserveAspectRatio){var i=0;this.preferredBackBufferWidth>this.preferredBackBufferHeight?(i=this.preferredBackBufferWidth/t,this.viewport.width=t,this.viewport.height=this.preferredBackBufferHeight*(1+i)):(i=this.preferredBackBufferHeight/e,this.viewport.width=this.preferredBackBufferWidth*(1+i),this.viewport.height=e),this.viewport.x=t/2-this.viewport.width/2,this.viewport.y=e/2-this.viewport.height/2}else this.scaleMode==Atlantis.ScaleMode.NoScaleCenter&&(this.viewport.x=t/2-this.preferredBackBufferWidth/2,this.viewport.y=e/2-this.preferredBackBufferHeight/2,this.viewport.width=this.preferredBackBufferWidth,this.viewport.height=this.preferredBackBufferHeight);Atlantis.Game.scaleFactor.x=this.preferredBackBufferWidth/this._frontBuffer.getWidth(),Atlantis.Game.scaleFactor.y=this.preferredBackBufferHeight/this._frontBuffer.getHeight(),Atlantis.notify(Atlantis.events.ResolutionChanged,{width:this.preferredBackBufferWidth,height:this.preferredBackBufferHeight})},Atlantis.GraphicsDevice.prototype.getBackBuffer=function(){return this._backBuffer},Atlantis.GraphicsDevice.prototype.getFrontBuffer=function(){return this._frontBuffer},Atlantis.GraphicsDevice.prototype.clear=function(t){this._backBuffer.clear(t),this._frontBuffer.clear(t),this.disableSmoothing&&(this._backBuffer.getContext().imageSmoothingEnabled=!1,this._fbContext.imageSmoothingEnabled=!1)},Atlantis.GraphicsDevice.prototype.present=function(){this._fbContext.drawImage(this._bbCanvas,this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height)},Atlantis.GraphicsDevice.prototype.toggleFullscreen=function(t){var t=t instanceof HTMLElement?t:this._frontBuffer.getCanvas(),e=this.isFullscreen();t.requestFullScreen=t.requestFullScreen||t.webkitRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||function(){return!1},document.cancelFullScreen=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||function(){return!1},e?document.cancelFullScreen():t.requestFullScreen()},Atlantis.GraphicsDevice.prototype.isFullscreen=function(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||!1};var Atlantis=window.Atlantis||{};Atlantis.SpriteSortMode={BackToFront:0,FrontToBack:1,Immediate:2},Atlantis.SpriteEffect={None:0,FlipHorizontaly:1,FlipVerticaly:2},Atlantis.BatchItemType={Texture:0,Font:1},Atlantis.SpriteBatch=function(t){this._graphicsDevice=t,this._viewport=new Atlantis.Rectangle(0,0,t.preferredBackBufferWidth,t.preferredBackBufferHeight),this._canvas=this._graphicsDevice.getBackBuffer().getCanvas(),this._context=this._graphicsDevice.getBackBuffer().getContext(),this._batchItems=[],this._batchStarted=!1,this._spriteSortMode=Atlantis.SpriteSortMode.Immediate,this._transformMatrix=null,this._cacheColoredTextures=[],this._batchRect=new Atlantis.Rectangle,document.addEventListener(Atlantis.events.ResolutionChanged,this._onResize.bind(this),!1)},Atlantis.SpriteBatch.prototype._onResize=function(t){this._viewport.width=t.width,this._viewport.height=t.height},Atlantis.SpriteBatch.prototype.begin=function(t,e){this._batchStarted||(this._batchStarted=!0,this._spriteSortMode="number"==typeof t?t:Atlantis.SpriteSortMode.Immediate,this._transformMatrix=e,this._transformMatrix&&(this._context.save(),this._context.transform(this._transformMatrix[0],this._transformMatrix[1],this._transformMatrix[2],this._transformMatrix[3],this._transformMatrix[4],this._transformMatrix[5])))},Atlantis.SpriteBatch.prototype.draw=function(t,e,i,n,s,a,r,o,h){this._batchStarted&&(e.width||(e.width=t.width,e.height=t.height),this._spriteSortMode==Atlantis.SpriteSortMode.Immediate?this._drawBatchItem(t,e,i,n,s,a,r,o,h,Atlantis.BatchItemType.Texture):this._batchItems.push({type:Atlantis.BatchItemType.Texture,texture2D:t,sourceRectangle:i,destinationRectangle:e,color:n,rotation:s,origin:a,scale:r,effect:o?o:Atlantis.SpriteEffect.None,layerDepth:0|+h}))},Atlantis.SpriteBatch.prototype.drawString=function(t,e,i,n,s,a,r,o,h){this._batchStarted&&(this._spriteSortMode===Atlantis.SpriteSortMode.Immediate?this._drawBatchItem(t,i,e,n,s,a,r,o,h,Atlantis.BatchItemType.Font):this._batchItems.push({type:Atlantis.BatchItemType.Font,texture2D:t,sourceRectangle:e,destinationRectangle:{x:i.x,y:i.y,width:1,height:1},color:n,rotation:s,origin:a,scale:r,effect:o?o:Atlantis.SpriteEffect.None,layerDepth:0|+h}))},Atlantis.SpriteBatch.prototype.end=function(){if(this._batchStarted){if(this._spriteSortMode!==Atlantis.SpriteSortMode.Immediate){this._batchItems=this._batchItems.sort(this._sortBatchItem.bind(this));for(var t=0,e=this._batchItems.length;e>t;t++)this._drawBatchItem(this._batchItems[t].texture2D,this._batchItems[t].destinationRectangle,this._batchItems[t].sourceRectangle,this._batchItems[t].color,this._batchItems[t].rotation,this._batchItems[t].origin,this._batchItems[t].scale,this._batchItems[t].effect,this._batchItems[t].layerDepth,this._batchItems[t].type);this._batchItems.length=0}this._transformMatrix&&this._context.restore(),this._batchStarted=!1}},Atlantis.SpriteBatch.drawTexture=function(t,e,i,n,s,a,r){r?t.drawImage(e,r.x,r.y,r.width,r.height,i,n,s,a):t.drawImage(e,i,n,s,a)},Atlantis.SpriteBatch.drawString=function(t,e,i,n,s){t.fillStyle=s,t.font=e.getFont(),e.strokeStyle&&e.lineWidth&&(t.lineWidth=e.lineWidth,t.strokeStyle=e.strokeStyle,e.wrapText||t.strokeText(i,n.x,n.y)),e.wrapText?Atlantis.SpriteBatch._wrapText(t,i,n.x,n.y,n.width,e.size,e.strokeStyle&&e.lineWidth):t.fillText(i,n.x,n.y)},Atlantis.SpriteBatch.prototype._drawBatchItem=function(t,e,i,n,s,a,r,o,h,l){if(this._batchRect.fromRectangle(e),this._viewport.intersects(this._batchRect)){var c=a?a.x:0,p=a?a.y:0;this._context.save(),this._context.translate(e.x,e.y),this._context.translate(c,p),this._batchRect.x=-c,this._batchRect.y=-p,s&&this._context.rotate(s),r&&this._context.scale(r.x,r.y),o&&o!==Atlantis.SpriteEffect.None&&(o==Atlantis.SpriteEffect.FlipHorizontaly?(this._context.scale(-1,1),this._batchRect.x-=this._batchRect.width):(this._context.scale(1,-1),this._batchRect.y-=this._batchRect.height)),l===Atlantis.BatchItemType.Texture?n&&t.width&&t.height?Atlantis.SpriteBatch.drawTexture(this._context,this._colorizeTexture(t,n),this._batchRect.x,this._batchRect.y,this._batchRect.width,this._batchRect.height,i):Atlantis.SpriteBatch.drawTexture(this._context,t,this._batchRect.x,this._batchRect.y,this._batchRect.width,this._batchRect.height,i):l===Atlantis.BatchItemType.Font&&Atlantis.SpriteBatch.drawString(this._context,t,i,this._batchRect,n),this._context.restore()}},Atlantis.SpriteBatch.prototype._colorizeTexture=function(t,e){var i=this._searchColoredTexture(t,e);if(!i){i=document.createElement("canvas"),i.width=t.width,i.height=t.height;var n=i.getContext("2d");n.drawImage(t,0,0);for(var s=n.getImageData(0,0,t.width,t.height),a=this._hexaToBytes(e),r=0,o=s.data.length;o>r;r+=4)s.data[r]=a.r|s.data[r],s.data[r+1]=a.g|s.data[r+1],s.data[r+2]=a.b|s.data[r+2],s.data[r+3]=a.a|s.data[r+3];n.putImageData(s,0,0),this._cacheColoredTextures.push({texture:t,color:e,canvas:i})}return i},Atlantis.SpriteBatch.prototype._hexaToBytes=function(t){var e=t.split("#")[1],i={r:0,g:0,b:0,a:0},n=e.length;return 3===n?(i.r=parseInt(e[0]+e[0],16),i.g=parseInt(e[1]+e[1],16),i.b=parseInt(e[2]+e[2],16)):6===n?(i.r=parseInt(e.slice(0,2),16),i.g=parseInt(e.slice(2,4),16),i.b=parseInt(e.slice(4,6),16)):8===n&&(i.r=parseInt(e.slice(0,2),16),i.g=parseInt(e.slice(2,4),16),i.b=parseInt(e.slice(4,6),16),i.a=parseInt(e.slice(6,8),16)),i},Atlantis.SpriteBatch.prototype._searchColoredTexture=function(t,e){for(var i=0,n=this._cacheColoredTextures.length,s=null;n>i&&null===s;)s=this._cacheColoredTextures[i].texture===t&&this._cacheColoredTextures[i].color===e?this._cacheColoredTextures[i].canvas:null,i++;return s},Atlantis.SpriteBatch.prototype._sortBatchItem=function(t,e){return this._spriteSortMode===Atlantis.SpriteSortMode.BackToFront?+t.layerDepth>+e.layerDepth?1:+t.layerDepth<+e.layerDepth?-1:0:+t.layerDepth<+e.layerDepth?1:+t.layerDepth>+e.layerDepth?-1:0},Atlantis.SpriteBatch._wrapText=function(t,e,i,n,s,a,r){for(var o=e.split(" "),h="",l=0;l<o.length;l++){var c=h+o[l]+" ",p=t.measureText(c),u=p.width;u>s&&l>0?(r&&t.strokeText(h,i,n),t.fillText(h,i,n),h=o[l]+" ",n+=a):h=c}r&&t.strokeText(h,i,n),t.fillText(h,i,n)};var Atlantis=window.Atlantis||{};Atlantis.RenderTarget=function(t,e,i){this._canvas=i,this._canvas||(this._canvas=document.createElement("canvas"),this.setSize(t,e)),this._context=null,this._data=null,this._needUpdate=!1,this._context=this._canvas.getContext("2d"),this.setSize(t,e)},Atlantis.RenderTarget.fromImage=function(t){var e=new Atlantis.RenderTarget(t.width,t.height,!1);return e._context.drawImage(t,0,0,t.width,t.height),e},Atlantis.RenderTarget.prototype.setData=function(t){this._context.putImageData(t,0,0)},Atlantis.RenderTarget.prototype.getData=function(){return(!this._data||this._needUpdate)&&(this._data=this._context.getImageData(0,0,this._canvas.width,this._canvas.height)),this._data},Atlantis.RenderTarget.prototype.getPixelData=function(t,e){var i=this._context.getImageData(t,e,1,1).data;return{r:i[0],g:i[1],b:i[2],a:i[3]}},Atlantis.RenderTarget.prototype.getContext=function(){return this._context},Atlantis.RenderTarget.prototype.getCanvas=function(){return this._canvas},Atlantis.RenderTarget.prototype.getWidth=function(){return this._canvas.width},Atlantis.RenderTarget.prototype.getHeight=function(){return this._canvas.height},Atlantis.RenderTarget.prototype.setSize=function(t,e){this._canvas.width=t,this._canvas.height=e},Atlantis.RenderTarget.prototype.clear=function(t){this._context.clearRect(0,0,this._canvas.width,this._canvas.height)},Atlantis.RenderTarget.prototype.saveAsPng=function(){return this._canvas.toDataURL("image/png")},Atlantis.RenderTarget.prototype.saveAsJpg=function(){return this._canvas.toDataURL("image/jpg")};var Atlantis=window.Atlantis||{};Atlantis.SpriteFont=function(t,e,i){this.fontName=t||"Arial",this.size=e||14,this.style=i||"normal",this.strokeStyle=null,this.lineWidth=0},Atlantis.SpriteFont.prototype.getFont=function(){return[this.style," ",this.size,"px ",this.fontName].join("")},Atlantis.SpriteFont.prototype.clone=function(){var t=new Atlantis.SpriteFont(this.fontName,this.size,this.style);return t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t};var Atlantis=window.Atlantis||{};Atlantis.Preloader=function(t){this.screenWidth=t.graphicsDevice.preferredBackBufferWidth,this.screenHeight=t.graphicsDevice.preferredBackBufferHeight,this.screenWidthPerTwo=this.screenWidth/2,this.screenHeightPerTwo=this.screenHeight/2,this.spriteFont=new Atlantis.SpriteFont("Arial",32)},Atlantis.Preloader.prototype.onProgress=function(t,e){var i=["Game loading ",Math.round(e.progress),"%"].join(""),n=t.measureText(i),s=this.screenWidthPerTwo-n.width/2,a=this.screenHeightPerTwo-this.spriteFont.size/2;t.clearRect(0,0,this.screenWidth,this.screenHeight),t.fillStyle="#fafafa",t.font=this.spriteFont.getFont(),t.fillText(i,s,a)};var Atlantis=window.Atlantis||{};Atlantis.Game=function(){function t(){i.gameTime.update(),i.update(i.gameTime),i.draw(i.gameTime),i.afterDraw(i.gamepad),i._paused||requestAnimationFrame(t)}function e(t){i.width=t.target.innerWidth,i.height=t.target.innerHeight,i.canvas.width=i.width,i.canvas.height=i.height}var i=null,n=function(t,e,n,s){this.settings=s||{};var t=t||window.innerWidth,e=e||window.innerHeight;this.domElement=document.body,typeof n instanceof HTMLElement?this.domElement=n:"string"==typeof n&&("."===n[0]?(n=n.replace(".",""),this.domElement=document.getElementsByClassName(n)[0]):(n="#"===n[0]?n.replace("#",""):n,this.domElement=document.getElementById(n))),this.domElement instanceof HTMLCanvasElement&&(this.settings.canvas=this.domElement),this.version="0.0.0.1",this.gameTime=new Atlantis.GameTime,this.components=new Atlantis.GameComponentCollection,this.content=new Atlantis.ContentManager,this.keyboard=null,this.mouse=null,this.touchPanel=null,this.gamepad=null,this.preloader=null,this.graphicsDevice=new Atlantis.GraphicsDevice(t,e,this.settings),this.canvas=this.settings.canvas,this.frontBuffer=null,this.context=null,this.initialized=!1,this._paused=!1,i=this};return n.scaleFactor=new Atlantis.Vector2(1,1),n.prototype._internalIntialize=function(){this.frontBuffer=this.graphicsDevice.getFrontBuffer(),this.context=this.frontBuffer.getContext(),this.canvas||(this.canvas=this.frontBuffer.getCanvas()),this.keyboard=new Atlantis.Keyboard,this.mouse=new Atlantis.Mouse(this.frontBuffer.getCanvas()),this.touchPanel=new Atlantis.TouchPanel(this.frontBuffer.getCanvas()),this.gamepad=new Atlantis.Gamepad,this.components.add(this.gamepad),this.settings.resizeEnabled&&window.addEventListener("resize",e,!1),this.domElement&&!this.settings.canvas&&this.domElement.appendChild(this.frontBuffer.getCanvas())},n.prototype.initialize=function(){this.components.initialize()},n.prototype.loadContent=function(){this.components.loadContent(this.content)},n.prototype.unloadContent=function(){this.components.unloadContent()},n.prototype.update=function(t){this.components.update(t)},n.prototype.draw=function(t,e){this.settings.autoClear&&this.graphicsDevice.clear(),this.components.draw(t,e)},n.prototype.afterDraw=function(t){this.graphicsDevice.present()},n.prototype.run=function(){var e=this,i=function(){e.initialize(),e.initialized=!0,e.loadContent(),e.frontBuffer.getCanvas().focus(),t()};this.initialized||(this.initialized=!0,this._internalIntialize(),this.content.preloader.length?(null===this.preloader&&(this.preloader=new Atlantis.Preloader(this)),this.content.preload(function(t){this.preloader.onProgress(this.context,t)}.bind(this),function(){this.context.clearRect(0,0,this.frontBuffer.getWidth(),this.frontBuffer.getHeight()),i()}.bind(this))):i())},n.prototype.pause=function(){cancelAnimationFrame(t),this._paused=!0},n.prototype.resume=function(){this._paused&&(this._paused=!1,t())},n}();var Atlantis=window.Atlantis||{};Atlantis.Random={value:function(){return Math.random()},randomFloat:function(t,e){return Math.random()*(e-t)+t},randomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},vector2:function(t,e){return new Atlantis.Vector2(this.randomFloat(t,e),this.randomFloat(t,e))},vector3:function(t,e){return new Atlantis.Vector3(this.randomFloat(t,e),this.randomFloat(t,e),this.randomFloat(t,e))},vector4:function(t,e){return new Atlantis.Vector4(this.randomFloat(t,e),this.randomFloat(t,e),this.randomFloat(t,e),this.randomFloat(t,e))},color:function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},randomArrayItem:function(t){return 0===t.length?void 0:t[Atlantis.Random.randomInt(0,t.length-1)]}};var Atlantis=window.Atlantis||{};Atlantis.MusicState={Playing:1,Stopped:2,Paused:3},Atlantis.AudioManager=function(){this.repeatMusic=!1,this.currentMusic=null,this.volume=1,this.currentState=Atlantis.MusicState.STOPPED},Atlantis.AudioManager.prototype.playOneShot=function(t){t.play()},Atlantis.AudioManager.prototype.play=function(t,e){this.stopMusic(),this.currentMusic=t,this.repeat=e,this.currentMusic.play(),this.currentState=Atlantis.MusicState.Playing},Atlantis.AudioManager.prototype.stop=function(){this.currentMusic.stop(),this.currentState=Atlantis.MusicState.Stopped},Atlantis.AudioManager.prototype.pause=function(){this.currentState==Atlantis.MusicState.Playing&&(this.currentMusic.pause(),this.currentState=Atlantis.MusicState.Paused)},Atlantis.AudioManager.prototype.resume=function(){this.currentState==Atlantis.MusicState.Paused&&(this.currentMusic.play(),this.currentState=Atlantis.MusicState.Playing)};var Atlantis=window.Atlantis||{};Atlantis.StorageManager=function(){this.container="atlantis.game"},Atlantis.StorageManager.prototype.save=function(t,e){"object"==typeof e&&(e=JSON.stringify(e)),localStorage.setItem(this.getLocalStorageKey(t),e)},Atlantis.StorageManager.prototype.load=function(t,e){var i=localStorage.getItem(this.getLocalStorageKey(t));return null!==i?i:e},Atlantis.StorageManager.prototype.getLocalStorageKey=function(t){return[this.container,".",t].join("")};var Atlantis=window.Atlantis||{};Atlantis.LevelManager=function(t){Atlantis.DrawableGameComponent.call(this,t),this.graphicsDevice=t.graphicsDevice,this.levels=[],this.autoClear=!0,this.activeLevel=null,this.initialized=!1,this._autoLoadLevel},Atlantis.LevelManager.prototype=Object.create(Atlantis.DrawableGameComponent.prototype),Atlantis.LevelManager.prototype.initialize=function(){this.initialized=!0,"undefined"!=typeof this._autoLoadLevel&&(this.loadLevel(this._autoLoadLevel),this._autoLoadLevel="")},Atlantis.LevelManager.prototype.update=function(t){this.activeLevel&&this.activeLevel.update(t)},Atlantis.LevelManager.prototype.draw=function(t){this.activeLevel&&(this.autoClear&&this.graphicsDevice.clear(),this.activeLevel.draw(t))},Atlantis.LevelManager.prototype.loadLevel=function(t,e){var i="boolean"==typeof e?e:!0;return this.initialized?(this.activeLevel&&this.activeLevel.onDisabled(),this.activeLevel=null,"string"==typeof t?this.activeLevel=this.getLevelByName(t):this._checkIndex(t)&&(this.activeLevel=this.levels[t]),void(this.activeLevel&&(i&&this.activeLevel.initialize(),this.activeLevel.active=!0,this.activeLevel.onEnabled()))):void(this._autoLoadLevel=t)},Atlantis.LevelManager.prototype.add=function(t,e){this.levels.push(t),e&&this.loadLevel(this.levels.length-1)},Atlantis.LevelManager.prototype.remove=function(t){var e=null,i=-1;"string"==typeof t?(e=this.getLevelByName(t),i=this.levels.indexOf(e)):this._checkIndex(t)&&(e=this.levels[t],i=t),e===this.activeLevel&&(this.activeLevel=null),this._checkIndex(i)&&this.levels.splice(i,1)},Atlantis.LevelManager.prototype.get=function(t){return"string"==typeof t?this.getLevelByName(t):this._checkIndex(t)?this.levels[t]:null},Atlantis.LevelManager.prototype.getLevelByName=function(t){for(var e=0,i=this.levels.length,n=null;i>e&&null===n;)n=this.levels[e].name===t?this.levels[e]:n,e++;return n},Atlantis.LevelManager.prototype.getLoadedLevelIndex=function(){return this.activeLevel?this.levels.indexOf(this.activeLevel):-1},Atlantis.LevelManager.prototype.getLoadedLevelName=function(){return this.activeLevel?this.activeLevel.name:-1},Atlantis.LevelManager.prototype._checkIndex=function(t){return t>-1&&t<this.levels.length};var Atlantis=window.Atlantis||{};Atlantis.SpriteAnimation=function(t,e){this.rectangles=new Array(t),this.framerate=e,this.index=0,this.max=t,this.elapsedTime=0,this.length=t},Atlantis.SpriteAnimation.prototype.next=function(){return this.index>=this.rectangles.length&&(this.index=0),this.rectangles[this.index]},Atlantis.SpriteAnimation.prototype.update=function(t){this.elapsedTime+=t.getElapsedTime(),this.elapsedTime>this.framerate&&(this.index++,this.elapsedTime=0)},Atlantis.SpriteAnimator=function(){this.animations={},this.spriteWidth=0,this.spriteHeight=0,this.textureWidth=0,this.textureHeight=0,this.nbSpriteX=0,this.nbSpriteY=0,this.spritesheetLength=0,this.currentAnimationName=""},Atlantis.SpriteAnimator.prototype.initialize=function(t,e,i,n){this.animations={},this.spriteWidth=t,this.spriteHeight=e,this.textureWidth=i,this.textureHeight=n,this.nbSpriteX=this.textureWidth/this.spriteWidth,this.nbSpriteY=this.textureHeight/this.spriteHeight,this.spritesheetLength=this.nbSpriteX*this.nbSpriteY,this.currentAnimationName=""},Atlantis.SpriteAnimator.prototype.add=function(t,e,i){var n=e.length,s=new Atlantis.SpriteAnimation(n,i);if(e instanceof Atlantis.Rectangle)s.rectangles=e;else for(var a=0;n>a;a++){var r=e[a]%this.nbSpriteX,o=Math.floor(e[a]/this.nbSpriteX);r%=o>0?this.nbSpriteX*o:this.nbSpriteX,s.rectangles[a]=new Atlantis.Rectangle(r*this.spriteWidth,o*this.spriteHeight,this.spriteWidth,this.spriteHeight)}this.animations[t]=s},Atlantis.SpriteAnimator.prototype.play=function(t){return this.currentAnimationName=t,this.animations[t].next()},Atlantis.SpriteAnimator.prototype.getCurrentAnimation=function(){return""!==this.currentAnimationName?this.animations[this.currentAnimationName]:null},Atlantis.SpriteAnimator.prototype.update=function(t,e){""!==this.currentAnimationName&&this.animations[this.currentAnimationName].update(t)},Atlantis.SpriteAnimator.prototype.checkForIDLEAnimation=function(t){return""!==this.currentAnimationName&&0===t.x&&0===t.y?this.animations[this.currentAnimationName].rectangles[0]:null};var Atlantis=window.Atlantis||{};Atlantis.Camera2D=function(t,e,i,n){this._follow=null,this.set(t,e,i,n)},Atlantis.Camera2D.prototype.set=function(t,e,i,n){this.x=0|+t,this.y=0|+e,this.viewport=new Atlantis.Rectangle(0,0,+i|!1?+i:Atlantis.screen.width,+n|!1?+n:Atlantis.screen.height),this._center=new Atlantis.Vector2(Atlantis.screen.widthPerTwo,Atlantis.screen.heightPerTwo)},Atlantis.Camera2D.prototype.reset=function(){this.x=0,this.y=0},Atlantis.Camera2D.onResize=function(t,e){this._center=new Atlantis.Vector2(t>>1,e>>1)},Atlantis.Camera2D.prototype.follow=function(t){this._follow=t},Atlantis.Camera2D.prototype.getSpritePosition=function(){return this._follow?this.getRelativePosition(this._follow):{x:this.x,y:this.y}},Atlantis.Camera2D.prototype.getRelativePosition=function(t){return{x:t.rectangle.x+this.x,y:t.rectangle.y+this.y}},Atlantis.Camera2D.prototype.update=function(){if(this._follow){var t=this._follow.rectangle.x-this._follow.lastPosition.x,e=this._follow.rectangle.y-this._follow.lastPosition.y,i=this._follow.rectangle.x,n=this._follow.rectangle.y;(this._follow.rectangle.x>=this._center.x&&this.x<this.viewport.getRight()-Atlantis.screen.width||this._follow.rectangle.x<=this._center.x&&this.x>this.viewport.x)&&(this.x+=t,i=this._center.x),(this._follow.rectangle.y>=this._center.y&&this.y<this.viewport.getBottom()-Atlantis.screen.height||this._follow.rectangle.y<=this._center.y&&this.y>this.viewport.y)&&(this.y+=e,n=this._center.y),this._follow.move(i,n)}this.x<this.viewport.x?this.x=this.viewport.x:this.x+Atlantis.screen.width>this.viewport.getRight()?this.x=this.viewport.getRight()-Atlantis.screen.width:this.y<this.viewport.y&&(this.y=this.viewport.y),this.y+Atlantis.screen.height>this.viewport.getBottom()&&(this.y=this.viewport.getBottom()-Atlantis.screen.height)};var Atlantis=window.Atlantis||{};Atlantis.SpriteCollisionType={None:0,Stop:1},Atlantis.Sprite=function(t,e){this.name="GameObject",this.enabled=!0,this.visible=!0,this.rectangle=new Atlantis.Rectangle,this.collisionType=Atlantis.SpriteCollisionType.None,this._texture=null,this._dead=!1,this._initialized=!1,this.sourceRectangle=null,this._textureName="string"==typeof t?t:"",this.color=null,this.rotation=0,this.scale=new Atlantis.Vector2(1,1),this.origin=new Atlantis.Vector2,this.layerDepth=Atlantis.Sprite.Counter++,this.parent=null,this.direction=new Atlantis.Vector2,this.lastPosition=new Atlantis.Vector2,this.lastDistance=new Atlantis.Vector2,this.acceleration=new Atlantis.Vector2,this.velocity=new Atlantis.Vector2,this.maxVelocity=1,this.viewport=new Atlantis.Rectangle(0,0,Atlantis.screen.width,Atlantis.screen.height),this.insideScreen=!1,this.acrossScreen=!1,this.spriteAnimator=new Atlantis.SpriteAnimator,this.hasAnimations=!1,this.deleteIf=null;var i=this;Atlantis._createProperty(this,"active",function(){return i.visible&&i.enabled},function(t){i.enabled=t,i.visible=t}),Atlantis._createProperty(this,"alive",function(){return!i._dead},function(t){t&&i._dead?i.revive():t||i._dead||i.kill()}),Atlantis._createProperty(this,"x",function(){return i.rectangle.x},function(t){i.lastPosition.x=i.rectangle.x,i.rectangle.x=t,i.direction.x=i.rectangle.x-i.lastPosition.x}),Atlantis._createProperty(this,"y",function(){return i.rectangle.y},function(t){i.lastPosition.y=i.rectangle.y,i.rectangle.y=t,i.direction.y=i.rectangle.x-i.lastPosition.y}),Atlantis._createProperty(this,"width",function(){return i.rectangle.width},function(t){i.rectangle.width=t}),Atlantis._createProperty(this,"height",function(){return i.rectangle.height},function(t){i.rectangle.height=t}),Atlantis._createProperty(this,"textureName",function(){return i._textureName},function(t){i._textureName=t,i._initialized=!1}),Atlantis._createProperty(this,"texture",function(){return i._texture},function(t){i._texture=t,i._texture?(i.rectangle.setSize(i._texture.width,i._texture.height),i._initialized=!0):(i.rectangle.setSize(0,0),i._initialized=!1)}),e=e||{};for(var n in e)this[n]=e[n]},Atlantis.Sprite.Counter=0,Atlantis.Sprite.prototype.initialize=function(t){if(this.viewport=new Atlantis.Rectangle(0,0,Atlantis.screen.width,Atlantis.screen.height),""!==this._textureName&&this._initialized===!1){t="function"==typeof t?t:function(){};var e=this;this._texture=Atlantis.app.content.load(this._textureName,function(i){e.rectangle.width=i.width,e.rectangle.height=i.height,e._initialized=!0,t(e)})}else t&&t(this)},Atlantis.Sprite.prototype.copy=function(t){this._dead=t._dead,this._textureName=t._textureName,this.visible=t.visible,this.enabled=t.enabled,this._initialized=t._initialized,this._texture=t._texture,this.rectangle=t.rectangle,this.sourceRectangle=t.sourceRectangle,this.hasAnimations=t.hasAnimations,this.spriteAnimator=t.spriteAnimator},Atlantis.Sprite.prototype.collides=function(t){var e=this.rectangle.intersects(t.rectangle);
return t.collisionType===Atlantis.SpriteCollisionType.Stop&&t.move(t.lastPosition.x,t.lastPosition.y),e},Atlantis.Sprite.prototype.kill=function(){this.enabled=!1,this.visible=!1,this._dead=!0},Atlantis.Sprite.prototype.revive=function(){this.enabled=!0,this.visible=!0,this._dead=!1},Atlantis.Sprite.prototype.prepareAnimation=function(t,e){if(this._initialized){this.hasAnimations=!0;var i=t,n=e||i;this.spriteAnimator.initialize(i,n,this._texture.width||this.rectangle.width,this._texture.height||this.rectangle.height),this.rectangle.width=i,this.rectangle.height=n}},Atlantis.Sprite.prototype.addAnimation=function(t,e,i,n){if(this._initialized){if(n){for(var s=[],a=e[0];a<=e[1];a++)s.push(a);e=s}this.spriteAnimator.add(t,e,i),this.sourceRectangle=this.spriteAnimator.animations[t].rectangles[0]}},Atlantis.Sprite.prototype.play=function(t){this._initialized&&(this.sourceRectangle=this.spriteAnimator.play(t))},Atlantis.Sprite.prototype.preUpdate=function(t){},Atlantis.Sprite.prototype.update=function(t){this.lastDistance.x=this.rectangle.x-this.lastPosition.x,this.lastDistance.y=this.rectangle.y-this.lastPosition.y,this.lastPosition.x=this.rectangle.x,this.lastPosition.y=this.rectangle.y,this.rectangle.x+=this.velocity.x,this.rectangle.y+=this.velocity.y,this.velocity.multiply(this.maxVelocity),this.velocity.add(this.acceleration),this.hasAnimations&&this._initialized&&(this.spriteAnimator.update(t),0===this.lastDistance.x&&0===this.lastDistance.y&&""!==this.spriteAnimator.currentAnimationName&&(this.sourceRectangle=this.spriteAnimator.getCurrentAnimation().rectangles[0]))},Atlantis.Sprite.prototype.postUpdate=function(){this.direction.x=this.rectangle.x-this.lastPosition.x,this.direction.y=this.rectangle.y-this.lastPosition.y,this.insideScreen?(this.rectangle.x<this.viewport.x?(this.rectangle.x=this.viewport.x,this.velocity.multiply(0)):this.rectangle.getRight()>this.viewport.width&&(this.rectangle.x=this.viewport.width-this.rectangle.width,this.velocity.multiply(0)),this.rectangle.y<this.viewport.y?(this.rectangle.y=this.viewport.y,this.velocity.multiply(0)):this.rectangle.getBottom()>this.viewport.height&&(this.rectangle.y=this.viewport.height-this.rectangle.height,this.velocity.multiply(0))):this.acrossScreen&&(this.rectangle.getRight()<this.viewport.x?this.rectangle.x=this.viewport.width:this.rectangle.x>this.viewport.width&&(this.rectangle.x=this.viewport.x),this.rectangle.getBottom()<this.viewport.y?this.rectangle.y=this.viewport.height:this.rectangle.y>this.viewport.height&&(this.rectangle.y=this.viewport.y)),this.deleteIf&&this.deleteIf(this)&&this.kill()},Atlantis.Sprite.prototype.draw=function(t){this._initialized&&t.draw(this._texture,this.rectangle,this.sourceRectangle,this.color,this.rotation,this.origin,this.scale,this.effect,this.layerDepth)},Atlantis.Sprite.prototype.setSize=function(t,e){this.rectangle.width=t||this.rectangle.width,this.rectangle.height=e||this.rectangle.height},Atlantis.Sprite.prototype.move=function(t,e){this.rectangle.x=t,this.rectangle.y=e,this.lastPosition.x=t,this.lastPosition.y=e},Atlantis.Sprite.prototype.translate=function(t,e){this.rectangle.x+=t,this.rectangle.y+=e},Atlantis.Sprite.prototype.getBoundingRect=function(){return this.rectangle};var Atlantis=window.Atlantis||{};Atlantis.SpriteText=function(t,e,i){Atlantis.Sprite.call(this,void 0,i),this.spriteFont=t,this.text=e},Atlantis.SpriteText.prototype=Object.create(Atlantis.Sprite.prototype),Atlantis.SpriteText.prototype.initialize=function(){var t=this.measureText();this.rectangle.width=t.width,this.rectangle.height=this.spriteFont.size},Atlantis.SpriteText.prototype.preUpdate=function(){},Atlantis.SpriteText.prototype.update=function(){},Atlantis.SpriteText.prototype.postUpdate=function(){},Atlantis.SpriteText.prototype.draw=function(t){t.drawString(this.spriteFont,this.text,this.rectangle,this.color,this.rotation,this.origin,this.scale,this.effect,this.layerDepth)},Atlantis.SpriteText.prototype.measureText=function(t){var e=Atlantis.app.game.graphicsDevice.getBackBuffer().getContext(),i=e.font;e.font=this.spriteFont.getFont();var n=e.measureText(t||this.text);return e.font=i,n},Atlantis.SpriteText.prototype.measureTextHeight=function(t,e,i){t=t||this.text,e=e||this.width;for(var n=t.split(" "),s="",a="",r=i||this.spriteFont.size,o=null,h=0,l=Atlantis.app.game.graphicsDevice.getBackBuffer().getContext(),c=0;c<n.length;c++)a=s+n[c]+" ",o=l.measureText(a),h=o.width,h>e&&c>0?(s=n[c]+" ",r+=i):s=a;return r};var Atlantis=window.Atlantis||{};Atlantis.SpriteGroup=function(){Atlantis.Sprite.call(this),this._initialized=!1,this._sprites=[],this._length=0,this._needBoundingCompute=!0;var t=this;Atlantis._createProperty(this,"x",function(){return t.rectangle.x},function(e){var i=e-t.rectangle.x;t.rectangle.x=e;for(var n=0,s=t._sprites.length;s>n;n++)t._sprites[n].translate(i,0);t._needBoundingCompute=!0}),Atlantis._createProperty(this,"y",function(){return t.rectangle.y},function(e){var i=e-t.rectangle.y;t.rectangle.x=e;for(var n=0,s=t._sprites.length;s>n;n++)t._sprites[n].translate(0,i);t._needBoundingCompute=!0})},Atlantis.SpriteGroup.prototype=Object.create(Atlantis.Sprite.prototype),Atlantis.SpriteGroup.prototype.initialize=function(t){if(t="function"==typeof t?t:function(){},this._initialized)t(this);else{for(var e=0;e<this._length;e++)this._sprites[e].initialize();this._initialized=!0,t(this)}},Atlantis.SpriteGroup.prototype.update=function(t){if(Atlantis.Sprite.prototype.update.call(this,t),!this._dead&&this.enabled)for(var e=0;e<this._length;e++)null!==this._sprites[e]&&this._sprites[e].alive&&this._sprites[e].enabled&&(this._sprites[e].preUpdate(t),this._sprites[e].update(t),this._sprites[e].postUpdate(t))},Atlantis.SpriteGroup.prototype.postUpdate=function(t){},Atlantis.SpriteGroup.prototype.draw=function(t){if(this.visible)for(var e=0;e<this._length;e++)null!==this._sprites[e]&&this._sprites[e].alive&&this._sprites[e].visible&&this._sprites[e].draw(t)},Atlantis.SpriteGroup.prototype.clear=function(){this._sprites.length=0,this._length=0},Atlantis.SpriteGroup.prototype.collides=function(t){if(this.collidesWithGroup(t)){for(var e=0,i=!1;e<this._length&&i===!1;)i=t.collides(this._sprites[e])?!0:i,e++;return i&&t.collisionType===Atlantis.SpriteCollisionType.Stop&&t.move(t.lastPosition.x,t.lastPosition.y),i}return!1},Atlantis.SpriteGroup.prototype.collidesWithGroup=function(t,e){return(e||this._needBoundingCompute)&&this.computeBoundingRect(),this.rectangle.intersects(t.rectangle)},Atlantis.SpriteGroup.prototype.computeBoundingRect=function(){this.rectangle.setSize(0,0);for(var t=0;t<this._length;t++)this.rectangle.width=Math.max(this.rectangle.getRight(),this._sprites[t].rectangle.getRight())-this.rectangle.x,this.rectangle.height=Math.max(this.rectangle.getBottom(),this._sprites[t].rectangle.getBottom())-this.rectangle.y;this._needBoundingCompute=!1},Atlantis.SpriteGroup.prototype.countLiving=function(){for(var t=0,e=0;e<this._length;e++)t+=null!==this._sprites[e]&&this._sprites[e].alive?1:0;return t},Atlantis.SpriteGroup.prototype.countDead=function(){for(var t=0,e=0;e<this._length;e++)t+=null===this._sprites[e]||this._sprites[e].alive?0:1;return t},Atlantis.SpriteGroup.prototype.size=function(){return this._length},Atlantis.SpriteGroup.prototype.forEach=function(t){for(var e=0;e<this._length;e++)null!==this._sprites[e]&&this._sprites[e].alive&&t(this._sprites[e],e)},Atlantis.SpriteGroup.prototype.get=function(t){var e=null;return t>-1&&t<this._sprites.length&&(e=this._sprites[t]),e},Atlantis.SpriteGroup.prototype.getFirstDead=function(){for(var t=0,e=null;t<this._length&&null===e;)e=this._sprites[t].alive?e:this._sprites[t],t++;return e},Atlantis.SpriteGroup.prototype.getFirstAlive=function(){for(var t=0,e=null;t<this._length&&null===e;)e=this._sprites[t].alive?this._sprites[t]:e,t++;return e},Atlantis.SpriteGroup.prototype.getFirstNull=function(){for(var t=-1,e=0;e<this._length&&-1===t;)t=null===this._sprites[e]?e:t,e++;return t},Atlantis.SpriteGroup.prototype.kill=function(){Atlantis.Sprite.prototype.kill.call(this);for(var t=0;t<this._length;t++)null!==this._sprites[t]&&this._sprites[t].kill()},Atlantis.SpriteGroup.prototype.revive=function(){Atlantis.Sprite.prototype.revive.call(this);for(var t=0;t<this._length;t++)null!==this._sprites[t]&&this._sprites[t].revive()},Atlantis.SpriteGroup.prototype.add=function(t){if(t instanceof Atlantis.Sprite&&-1===this._sprites.indexOf(t)){var e=this.getFirstNull();-1===e?(this._sprites.push(t),this._length++):this._sprites[e]=t,t.parent=this,this._initialized&&t.initialize(),this._needBoundingCompute=!0}},Atlantis.SpriteGroup.prototype.removeAt=function(t,e){var i=null;return this._sprites[t]&&(i=this._sprites[t],i.parent=null,e?this._sprites.splice(t,1):this._sprites[t]=null,this._length--,this._needBoundingCompute=!0),i},Atlantis.SpriteGroup.prototype.remove=function(t,e){var i=this._sprites.indexOf(t);return this.removeAt(i,e)},Atlantis.SpriteGroup.prototype.replace=function(t,e){var i=this._sprites.indexOf(t);return i>-1?(t.parent=null,e.parent=this,this._sprites[i]=e,this._needBoundingCompute=!0,e):null},Atlantis.SpriteGroup.toArray=function(){for(var t=[],e=0;e<this._length;e++)t.push(this._sprites[e]);return t};var Atlantis=window.Atlantis||{};Atlantis.TilemapLayerType={Tiles:"tilelayer",Background:"imagelayer",Objects:"objectlayer"},Atlantis.TilemapProjection={Orthogonal:"orthogonal",Isometric:"isometric"},Atlantis.Tileset=function(t){this.firstGID=+t.firstgid||1,this.id=Atlantis.Tileset.Counter++,this.name=t.name||["Tileset_",this.id].join(""),this.texture=t.texture,this.width=0|+t.imagewidth,this.height=0|+t.imageheight,this.margin=0|+t.margin,this.padding=0|+t.spacing,this.tileWidth=0|+t.tilewidth,this.tileHeight=0|+t.tileheight,this.properties=t.properties||{}},Atlantis.Tileset.Counter=0,Atlantis.TilemapLayer=function(t){t=t||{},this.id=Atlantis.TilemapLayer.Counter++,this.data=t.data||[],this.type=t.type||Atlantis.TilemapLayer.Tiles,this.visible=t.visible,this.opacity=+t.opacity,this.name=t.name||["Layer_",this.id].join(""),this.width=0|+t.width,this.height=0|+t.height,this.offset={x:0|+t.x,y:0|+t.y},this.properties=t.properties||{},this.backgroundId=+t.backgroundId||+this.properties.backgroundId||0,this.tilesetId=+t.tilesetId||+this.properties.tilesetId||0},Atlantis.TilemapLayer.Counter=0,Atlantis.Tilemap=function(t){t=t||{},this.id=Atlantis.Tilemap.Counter++,this.name=t.name||["Tilemap_",this.id].join(""),this.version=0|+t.version,this.projection=t.orientation||t.projection||Atlantis.TilemapProjection.Orthogonal,this.layers=t.layers||[],this.tilesets=t.tilesets||[],this.backgrounds=t.backgrounds||[],this.width=0|+t.width,this.height=0|+t.height,this.tileWidth=0|+t.tilewidth,this.tileHeight=0|+t.tileheight,this.mapWidth=this.width*this.tileWidth,this.mapHeight=this.height*this.tileHeight,this.properties=t.properties||{},this.loaded="undefined"!=typeof t.loaded?t.loaded:!1,this.visible="undefined"!=typeof t.visible?t.visible:!0,this._cacheTilesCanvas=[]},Atlantis.Tilemap.Counter=0,Atlantis.Tilemap.prototype.update=function(t){},Atlantis.Tilemap.prototype.draw=function(t,e){if(this.visible&&this.loaded)for(var i=0,n=this.layers.length;n>i;i++)this.layers[i].visible&&(this.layers[i].type===Atlantis.TilemapLayerType.Background?this.drawBackground(t,this.layers[i],this.backgrounds[this.layers[i].backgroundId]):this.layers[i].type===Atlantis.TilemapLayerType.Tiles&&this.drawLayer(t,e,this.layers[i],this.tilesets[this.layers[i].tilesetId]))},Atlantis.Tilemap.prototype.drawBackground=function(t,e,i){t.draw(i,{x:e.offset.x,y:e.offset.y})},Atlantis.Tilemap.prototype.drawLayer=function(t,e,i,n){for(var s=Math.floor((n.width-4*n.margin)/n.tileWidth),a=e.x/this.tileWidth,r=e.y/this.tileHeight,o=Math.floor(a),h=Math.floor(r),l=Math.min(Math.round((e.x+Atlantis.screen.width)/n.tileWidth)+1,i.width),c=Math.min(Math.round((e.y+Atlantis.screen.height)/n.tileHeight)+1,i.height),p=0,u=0,d=0,f=0,y=0,A=0,g=0,m=o;l>m;m++)for(var M=h;c>M;M++)g=i.data[m+M*i.width]-n.firstGID,g>=0&&(p=g%s,u=Math.floor(g/s),p=u>0?p%(s*u):p%s,d=(m+i.offset.x-a)*this.tileWidth,f=(M+i.offset.y-r)*this.tileHeight,this.projection===Atlantis.TilemapProjection.Isometric&&(y=d/2-f,A=(d/2+f)/2,d=y+Atlantis.screen.width/2,f=A),t.draw(n.texture,{x:d,y:f,width:this.tileWidth,height:this.tileHeight},{x:n.margin+p*(n.tileWidth+n.padding),y:n.margin+u*(n.tileHeight+n.padding),width:n.tileWidth-n.padding,height:n.tileHeight-n.padding}))},Atlantis.Tilemap.isoToScreen=function(t,e){return{x:(2*e+t)/2,y:(2*e-t)/2}},Atlantis.Tilemap.screenToIso=function(t,e){return{x:t-e,y:(t+e)/2}},Atlantis.Tilemap.prototype.getTileIdAt=function(t,e,i){if(this.layers[t]){var n=this.layers[t],s=Math.floor(e/this.tileWidth),a=Math.floor(i/this.tileHeight);return n.data[s+a*n.width]}return 0},Atlantis.Tilemap.prototype.getTileRectAt=function(t,e,i){var n={x:0,y:0,width:this.tileWidth,height:this.tileHeight};return this.layers[t]&&(n.x=Math.floor(e/this.tileWidth),n.y=Math.floor(i/this.tileHeight)),n},Atlantis.Tilemap.prototype.getTileAt=function(t,e,i,n){if(this.layers[e]){var s=this.layers[e],a=this.getTileIdAt(e,i,n),r=[s.id,"_",t.id,"_",a].join("");if(this._cacheTilesCanvas[r])return this._cacheTilesCanvas[r];var o=document.createElement("canvas"),h=o.getContext("2d");if(o.width=t.tileWidth,o.height=t.tileHeight,a>=0){var l=t.imagewidth/t.tilewidth,c=a%l,p=Math.floor(a/l);return c=p>0?c%(l*p):c%l,h.drawImage(t.texture,{x:c*t.tileWidth,y:p*t.tileHeight,width:t.tileWidth,height:t.tileHeight},{x:0,y:0,width:this.tileWidth,height:this.tileHeight}),this._cacheTilesCanvas[r]=o,o}}return null};var Atlantis=window.Atlantis||{};Atlantis.TmxLoader={load:function(t,e){var i=new Atlantis.Tilemap;return Atlantis.app.content.load(t,function(t){var n=0,s=0;for(n=0,s=t.tilesets.length;s>n;n++)i.tilesets.push(new Atlantis.Tileset(t.tilesets[n])),i.tilesets[n].texture=Atlantis.app.content.load(t.tilesets[n].image),i.tilesets[n].texture.width=t.tilesets[n].imagewidth,i.tilesets[n].texture.height=t.tilesets[n].imageheight;for(n=0,s=t.layers.length;s>n;n++)i.layers.push(new Atlantis.TilemapLayer(t.layers[n])),t.layers[n].image&&(i.backgrounds.push(Atlantis.app.content.load(t.layers[n].image)),i.layers[n].backgroundId=n);i.height=t.height,i.width=t.width,i.tileWidth=t.tilewidth,i.tileHeight=t.tileheight,i.mapWidth=i.width*i.tileWidth,i.mapHeight=i.height*i.tileHeight,i.projection=t.orientation,i.version=t.version,i.properties=t.properties,i.visible=!0,i.loaded=!0,e&&e(i)}),i}};var Atlantis=window.Atlantis||{};Atlantis.KeyboardComponent=function(){var t=Atlantis.Keys,e=function(t){Atlantis.GameComponent.call(this,t),this.keysState=t.keyboard.getState(),this.previousKeysState=null};return e.prototype=Object.create(Atlantis.GameComponent.prototype),e.prototype.update=function(t){this.previousKeysState=this.keysState,this.keysState=this.game.keyboard.getState()},e.prototype.pressed=function(t){return this.keysState.isKeyDown(t)},e.prototype.released=function(t){return this.keysState.isKeyUp(t)},e.prototype.justPressed=function(t){return this.keysState.isKeyUp(t)&&this.previousKeysState.isKeyDown(t)},e.prototype.justReleased=function(t){return this.keysState.isKeyDown(t)&&this.previousKeysState.isKeyUp(t)},e.prototype.up=function(){return this.pressed(t.Up)},e.prototype.down=function(){return this.pressed(t.Down)},e.prototype.left=function(){return this.pressed(t.Left)},e.prototype.right=function(){return this.pressed(t.Right)},e.prototype.enter=function(){return this.pressed(t.Enter)},e.prototype.space=function(){return this.pressed(t.Space)},e.prototype.escape=function(){return this.pressed(t.Escape)},e.prototype.control=function(){return this.pressed(t.Control)},e.prototype.shift=function(){return this.pressed(t.Shift)},e.prototype.tab=function(){return this.pressed(t.Tab)},e}();var Atlantis=window.Atlantis||{};Atlantis.TouchComponent=function(){var t=function(t){Atlantis.GameComponent.call(this,t),this.sensibility=new Atlantis.Vector2(1,1),this.deadZone=new Atlantis.Vector2(0,0),this.maxDelta=100,this.maxFingerPoints=1,this.delta=new Atlantis.Vector2(0,0),this._touchCollection=new Atlantis.TouchCollection,this._position=[],this._lastPosition=[],this._needUpdate=!1};return t.prototype=Object.create(Atlantis.GameComponent.prototype),t.prototype.initialize=function(){Atlantis.GameComponent.prototype.initialize(this),this._touchCollection=this.game.touchPanel.getState(),this._lastTouchCollection=this.game.touchPanel.getState(),this._position.length=0,this._lastPosition.length=0;for(var t=0;t<this.maxFingerPoints;t++)this._position.push(new Atlantis.Vector2(0,0)),this._lastPosition.push(new Atlantis.Vector2(0,0))},t.prototype.update=function(t){if(this.maxFingerPoints){this._touchCollection=this.game.touchPanel.getState();var e=this._touchCollection.length;if(e){for(var i=0;i<this.maxFingerPoints;i++)e>i?this._updateTouchState(i):this._resetTrouchState(i);this.delta.x=(this._position[0].x-this._lastPosition[0].x)*this.sensibility.x,this.delta.y=(this._position[0].y-this._lastPosition[0].y)*this.sensibility.y}else this.delta.x=0,this.delta.y=0}},t.prototype._updateTouchState=function(t){this._lastPosition[t].x=this._position[t].x,this._lastPosition[t].y=this._position[t].y,this._position[t].x=this._touchCollection[t].position.x,this._position[t].y=this._touchCollection[t].position.y},t.prototype._resetTrouchState=function(t){this._lastPosition[t].x=0,this._lastPosition[t].y=0,this._position[t].x=0,this._position[t].y=0},t.prototype.pressed=function(t){return this._touchCollection[t]?this._touchCollection[t].state===Atlantis.TouchLocationState.Pressed:!1},t.prototype.released=function(t){return this._touchCollection[t]?this._touchCollection[t].state===(Atlantis.TouchLocationState.Released||Atlantis.TouchLocationState.Invalid):!1},t.prototype.moved=function(t){return this._touchCollection[t]?this._touchCollection[t].state===Atlantis.TouchLocationState.Moved:!1},t}();var Atlantis=window.Atlantis||{};Atlantis.Level=function(t){this.active=!1,this.name=t||"Level_0",this.scene=new Atlantis.SpriteGroup,this.camera=new Atlantis.Camera2D(0,0,Atlantis.screen.width,Atlantis.screen.height),this.spriteBatch=new Atlantis.SpriteBatch(Atlantis.app.game.graphicsDevice)},Atlantis.Level.prototype.initialize=function(){this.scene.initialize(),this.camera.reset()},Atlantis.Level.prototype.update=function(t){this.scene.update(t),this.camera.update(t)},Atlantis.Level.prototype.draw=function(t){this.spriteBatch.begin(),this.scene.draw(this.spriteBatch),this.spriteBatch.end()},Atlantis.Level.prototype.onEnabled=function(){},Atlantis.Level.prototype.onDisabled=function(){};var Atlantis=window.Atlantis||{};Atlantis.app={},Atlantis.input={},Atlantis.screen={},Atlantis.GameApplication=function(t,e,i,n){Atlantis.Game.call(this,t,e,i,n),this.audioManager=new Atlantis.AudioManager,this.storageManager=new Atlantis.StorageManager,this.levelManager=new Atlantis.LevelManager(this),this.components.add(this.levelManager);var s=this;Atlantis.app={game:s,content:s.content,components:s.components,storage:s.storageManager,levelManager:s.levelManager},Atlantis.input={keys:null,mouse:null,touch:null,gamepad:null},Atlantis.screen={width:t,widthPerTwo:t/2,height:e,heightPerTwo:e/2,getCanvasWidth:function(){return s.graphicsDevice.getFrontBuffer().getWidth()},getCanvasHeight:function(){return s.graphicsDevice.getFrontBuffer().getHeight()}},document.addEventListener(Atlantis.events.ResolutionChanged,function(t){Atlantis.screen.width=t.width,Atlantis.screen.widthPerTwo=t.width/2,Atlantis.screen.height=t.height,Atlantis.screen.heightPerTwo=t.height/2},!1)},Atlantis.GameApplication.prototype=Object.create(Atlantis.Game.prototype),Atlantis.GameApplication.prototype.initialize=function(){Atlantis.Game.prototype.initialize.call(this),Atlantis.screen.width=this.graphicsDevice.preferredBackBufferWidth,Atlantis.screen.height=this.graphicsDevice.preferredBackBufferHeight;var t=new Atlantis.KeyboardComponent(this);this.components.add(t),Atlantis.input.keys=t},Atlantis.GameApplication.prototype.setScreenSize=function(t,e){this.graphicsDevice._frontBuffer.setSize(t,e),this.graphicsDevice.applyChanges()};
//# sourceMappingURL=atlantis.min.js.map